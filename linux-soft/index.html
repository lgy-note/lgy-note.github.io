



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>linux-soft - mkdocs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.30686662.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#mkdocs" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="mkdocs" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              mkdocs
            </span>
            <span class="md-header-nav__topic">
              
                linux-soft
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href=".." class="md-tabs__link">
        home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../python-base/" class="md-tabs__link">
          python
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../nginx/" class="md-tabs__link">
          service
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../mysql/" class="md-tabs__link">
          database
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../open-falcon/" class="md-tabs__link">
          monitor
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../tcp-issue/" class="md-tabs__link md-tabs__link--active">
          basis
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="mkdocs" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    mkdocs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="home" class="md-nav__link">
      home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      python
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        python
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../python-base/" title="python-base" class="md-nav__link">
      python-base
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../python-lib/" title="python-lib" class="md-nav__link">
      python-lib
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../python-lib2/" title="python-lib2" class="md-nav__link">
      python-lib2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../python-web/" title="python-web" class="md-nav__link">
      python-web
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../python-other/" title="python-other" class="md-nav__link">
      python-other
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      service
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        service
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../nginx/" title="nginx" class="md-nav__link">
      nginx
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../nginx2/" title="nginx2" class="md-nav__link">
      nginx2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../apache/" title="apache" class="md-nav__link">
      apache
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../saltstack/" title="saltstack" class="md-nav__link">
      saltstack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tomcat/" title="tomcat" class="md-nav__link">
      tomcat
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ansible/" title="ansible" class="md-nav__link">
      ansible
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../trafficserver/" title="trafficserver" class="md-nav__link">
      trafficserver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../haproxy/" title="haproxy" class="md-nav__link">
      haproxy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../docker/" title="docker" class="md-nav__link">
      docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../varnish/" title="varnish" class="md-nav__link">
      varnish
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bind/" title="bind" class="md-nav__link">
      bind
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lvs/" title="lvs" class="md-nav__link">
      lvs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../log-analysis/" title="log-analysis" class="md-nav__link">
      log-analysis
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      database
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        database
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../mysql/" title="mysql" class="md-nav__link">
      mysql
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mysql2/" title="mysql2" class="md-nav__link">
      mysql2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../memcached/" title="memcached" class="md-nav__link">
      memcached
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../redis/" title="redis" class="md-nav__link">
      redis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mongodb/" title="mongodb" class="md-nav__link">
      mongodb
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hadoop/" title="hadoop" class="md-nav__link">
      hadoop
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../postgresql/" title="postgresql" class="md-nav__link">
      postgresql
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      monitor
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        monitor
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../open-falcon/" title="open-falcon" class="md-nav__link">
      open-falcon
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../zabbix/" title="zabbix" class="md-nav__link">
      zabbix
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../zabbix2/" title="zabbix2" class="md-nav__link">
      zabbix2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../netdata/" title="netdata" class="md-nav__link">
      netdata
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      basis
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        basis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../tcp-issue/" title="tcp-issue" class="md-nav__link">
      tcp-issue
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../git-svn/" title="git-svn" class="md-nav__link">
      git-svn
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vpn/" title="vpn" class="md-nav__link">
      vpn
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../shell/" title="shell" class="md-nav__link">
      shell
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../disk/" title="disk" class="md-nav__link">
      disk
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../filesystem/" title="filesystem" class="md-nav__link">
      filesystem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../source/" title="source" class="md-nav__link">
      source
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../command/" title="command" class="md-nav__link">
      command
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../linux-base/" title="linux-base" class="md-nav__link">
      linux-base
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        linux-soft
      </label>
    
    <a href="./" title="linux-soft" class="md-nav__link md-nav__link--active">
      linux-soft
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mkdocs" class="md-nav__link">
    mkdocs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ntopng" class="md-nav__link">
    ntopng
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dokuwiki" class="md-nav__link">
    dokuwiki
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#phpproxy" class="md-nav__link">
    phpproxy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solr" class="md-nav__link">
    solr
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#smokeping" class="md-nav__link">
    smokeping
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#redmine" class="md-nav__link">
    redmine
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cobbler" class="md-nav__link">
    cobbler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tcpcopy" class="md-nav__link">
    tcpcopy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ffmpeng" class="md-nav__link">
    ffmpeng
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#openldap" class="md-nav__link">
    openldap
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#openldap_1" class="md-nav__link">
    openldap修改密码
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kvm" class="md-nav__link">
    kvm虚拟化
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#opennebula" class="md-nav__link">
    opennebula虚拟化
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tmpfs" class="md-nav__link">
    tmpfs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ipa-server" class="md-nav__link">
    ipa-server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sendmail" class="md-nav__link">
    sendmail转发
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../other/" title="other" class="md-nav__link">
      other
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mkdocs" class="md-nav__link">
    mkdocs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ntopng" class="md-nav__link">
    ntopng
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dokuwiki" class="md-nav__link">
    dokuwiki
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#phpproxy" class="md-nav__link">
    phpproxy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solr" class="md-nav__link">
    solr
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#smokeping" class="md-nav__link">
    smokeping
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#redmine" class="md-nav__link">
    redmine
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cobbler" class="md-nav__link">
    cobbler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tcpcopy" class="md-nav__link">
    tcpcopy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ffmpeng" class="md-nav__link">
    ffmpeng
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#openldap" class="md-nav__link">
    openldap
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#openldap_1" class="md-nav__link">
    openldap修改密码
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kvm" class="md-nav__link">
    kvm虚拟化
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#opennebula" class="md-nav__link">
    opennebula虚拟化
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tmpfs" class="md-nav__link">
    tmpfs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ipa-server" class="md-nav__link">
    ipa-server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sendmail" class="md-nav__link">
    sendmail转发
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>linux-soft</h1>
                
                <h2 id="mkdocs">mkdocs</h2>
<div class="codehilite"><pre><span></span><span class="nv">http</span>:<span class="o">//</span><span class="nv">mkdocs</span>.<span class="nv">org</span>

<span class="nv">yum</span> <span class="nv">install</span> <span class="nv">python</span><span class="o">-</span><span class="nv">pip</span>
<span class="nv">pip</span> <span class="nv">install</span> <span class="nv">mkdocs</span>
<span class="nv">pip</span> <span class="nv">install</span> <span class="nv">mkdocs</span><span class="o">-</span><span class="nv">windmill</span>

<span class="nv">mkdocs</span> <span class="nv">new</span> [<span class="nv">dir</span><span class="o">-</span><span class="nv">name</span>] <span class="o">-</span> <span class="nv">Create</span> <span class="nv">a</span> <span class="nv">new</span> <span class="nv">project</span>.
<span class="nv">mkdocs</span> <span class="nv">help</span> <span class="o">-</span> <span class="nv">Print</span> <span class="nv">this</span> <span class="nv">help</span> <span class="nv">message</span>.
<span class="nv">mkdocs</span> <span class="nv">serve</span> <span class="o">-</span><span class="nv">a</span> <span class="mi">0</span>.<span class="mi">0</span>.<span class="mi">0</span>.<span class="mi">0</span>:<span class="mi">8080</span>
<span class="nv">mkdocs</span> <span class="nv">build</span> <span class="o">--</span><span class="nv">clean</span> <span class="o">&amp;&amp;</span> <span class="nv">mkdocs</span> <span class="nv">build</span>

查找是否有多余的文件
<span class="nv">find</span> . <span class="o">-</span><span class="nv">name</span> <span class="s2">&quot;</span><span class="s">*.md</span><span class="s2">&quot;</span> <span class="o">|</span> <span class="nv">awk</span> <span class="o">-</span><span class="nv">F</span> <span class="s1">&#39;</span><span class="s">/</span><span class="s1">&#39;</span> <span class="s1">&#39;</span><span class="s">{print $3}</span><span class="s1">&#39;</span> <span class="o">|</span> <span class="k">while</span> <span class="nv">read</span> <span class="nv">line</span><span class="c1">; do grep $line mkdocs.yml ; if [  $? -ne 0 ];then echo $line &gt;&gt; /tmp/diff; fi; done</span>
</pre></div>


<h2 id="ntopng">ntopng</h2>
<div class="codehilite"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">packages</span><span class="p">.</span><span class="n">ntop</span><span class="p">.</span><span class="n">org</span><span class="o">/</span><span class="n">centos</span><span class="o">-</span><span class="k">stable</span><span class="o">/</span>

<span class="n">wget</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">packages</span><span class="p">.</span><span class="n">ntop</span><span class="p">.</span><span class="n">org</span><span class="o">/</span><span class="n">centos</span><span class="o">-</span><span class="k">stable</span><span class="o">/</span><span class="n">ntop</span><span class="p">.</span><span class="n">repo</span> <span class="o">-</span><span class="n">O</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">yum</span><span class="p">.</span><span class="n">repos</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">ntop</span><span class="p">.</span><span class="n">repo</span>
<span class="n">yum</span> <span class="n">install</span> <span class="n">pfring</span> <span class="n">n2disk</span> <span class="n">nprobe</span> <span class="n">ntopng</span> <span class="n">ntopng</span><span class="o">-</span><span class="k">data</span> <span class="n">cento</span> <span class="n">pfring</span><span class="o">-</span><span class="n">drivers</span><span class="o">-</span><span class="n">zc</span><span class="o">-</span><span class="n">dkms</span> <span class="n">redis</span>
<span class="n">systemctl</span> <span class="k">start</span> <span class="n">redis</span>
<span class="n">systemctl</span> <span class="k">start</span> <span class="n">ntopng</span>

<span class="n">IP</span><span class="p">:</span><span class="mi">3000</span>  <span class="k">admin</span><span class="o">/</span><span class="k">admin</span>
</pre></div>


<h2 id="dokuwiki">dokuwiki</h2>
<div class="codehilite"><pre><span></span><span class="err">一、环境准备</span><span class="p">:</span>
<span class="n">yum</span> <span class="n">install</span> <span class="n">httpd</span> <span class="n">php</span> <span class="n">php</span><span class="o">-</span><span class="n">gd</span> <span class="n">php</span><span class="o">-</span><span class="n">ldap</span>
<span class="err">二、安装部署</span>
<span class="mi">1</span><span class="p">.</span><span class="err">下载</span><span class="n">dokuwiki</span><span class="err">网站源码</span>
<span class="o">#</span> <span class="n">wget</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">download</span><span class="p">.</span><span class="n">dokuwiki</span><span class="p">.</span><span class="n">org</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">dokuwiki</span><span class="o">/</span><span class="n">dokuwiki</span><span class="o">-</span><span class="k">stable</span><span class="p">.</span><span class="n">tgz</span>

<span class="mi">2</span><span class="p">.</span><span class="err">解压源码安装</span>
<span class="o">#</span><span class="n">tar</span> <span class="o">-</span><span class="n">zvxf</span> <span class="n">dokuwiki</span><span class="o">-</span><span class="k">stable</span><span class="p">.</span><span class="n">tgz</span>    <span class="o">//</span><span class="err">解包解压缩</span>
<span class="o">#</span><span class="n">cd</span> <span class="n">dokuwiki</span><span class="o">-</span><span class="mi">2016</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">26</span><span class="n">a</span>   <span class="o">//</span><span class="err">进入解压后的目录</span>
<span class="o">#</span><span class="n">cp</span> <span class="o">-</span><span class="n">R</span> <span class="n">dokuwiki</span><span class="o">-</span><span class="mi">2016</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">26</span><span class="n">a</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">www</span><span class="o">/</span> <span class="n">dokuwiki</span>   <span class="o">//</span><span class="err">复制解压的网站源码文件到网站根目录</span>
<span class="o">#</span><span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="n">www</span><span class="p">:</span><span class="n">www</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">www</span>   <span class="o">//</span><span class="err">将文件所有者由</span><span class="n">root</span><span class="err">用户改为</span><span class="n">www</span><span class="err">用户</span><span class="p">(</span><span class="err">你</span><span class="n">nginx</span><span class="err">运行的用户</span><span class="p">)</span>
<span class="err">在浏览器输入：</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="err">域名或者</span><span class="n">ip</span><span class="o">/</span><span class="n">install</span><span class="p">.</span><span class="n">php</span> <span class="err">就可以看到如下界面：</span>


<span class="err">先在右上角选好语言，简体中文</span><span class="n">zh</span>
<span class="err">填写好网站的名称，管理员等，协议等</span>
<span class="err">安装完后，为了安全，要删除</span><span class="n">install</span><span class="p">.</span><span class="n">php</span><span class="err">文件，然后再用刚才设置的用户名密码登陆</span>
<span class="err">三、设置使用</span><span class="n">LDAP</span><span class="err">用户验证</span>
<span class="mi">1</span><span class="err">、首先在扩展管理器中安装</span><span class="n">LDAP</span><span class="err">插件</span>
<span class="mi">2</span><span class="err">、管理</span><span class="o">-</span><span class="err">配置样式中设置</span>
</pre></div>


<h2 id="phpproxy">phpproxy</h2>
<div class="codehilite"><pre><span></span><span class="nv">wget</span> <span class="nv">https</span>:<span class="o">//</span><span class="nv">www</span>.<span class="nv">php</span><span class="o">-</span><span class="nv">proxy</span>.<span class="nv">com</span><span class="o">/</span><span class="nv">download</span><span class="o">/</span><span class="nv">php</span><span class="o">-</span><span class="nv">proxy</span>.<span class="nv">zip</span> 解压到<span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">www</span><span class="o">/</span>
<span class="nv">chmod</span> <span class="mi">777</span> <span class="o">/</span><span class="nv">vat</span><span class="o">/</span><span class="nv">www</span> <span class="o">-</span><span class="nv">R</span>
<span class="nv">vim</span> <span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">www</span><span class="o">/</span><span class="nv">templates</span><span class="o">/</span><span class="nv">url_form</span>.<span class="nv">php</span> 添加<span class="nv">style</span>
<span class="o">&lt;</span><span class="nv">div</span> <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">top_form</span><span class="s2">&quot;</span> <span class="nv">style</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">display:none;</span><span class="s2">&quot;</span><span class="o">&gt;</span>  隐藏上面的<span class="nv">form</span>

<span class="nv">vim</span> <span class="nv">vendor</span><span class="o">/</span><span class="nv">athlon1600</span><span class="o">/</span><span class="nv">php</span><span class="o">-</span><span class="nv">proxy</span><span class="o">/</span><span class="nv">src</span><span class="o">/</span><span class="nv">helpers</span>.<span class="nv">php</span>  替换<span class="nv">http</span>为<span class="nv">https</span>，可选，避免部分网站提示不安全的脚本

<span class="nv">nginx</span> 配置
<span class="nv">yum</span> <span class="nv">install</span> <span class="nv">php</span><span class="o">-</span><span class="nv">fpm</span> <span class="nv">php</span><span class="o">-</span><span class="nv">curl</span> <span class="nv">php</span><span class="o">-</span><span class="nv">mbstring</span> <span class="nv">youtube</span><span class="o">-</span><span class="nv">dl</span>

        <span class="nv">root</span> <span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">www</span><span class="c1">;</span>
        <span class="nv">location</span> <span class="o">/</span> {
              <span class="nv">index</span> <span class="nv">index</span>.<span class="nv">php</span><span class="c1">;</span>
        }
        <span class="nv">location</span> <span class="o">~</span> \.<span class="nv">php</span>$ {
              <span class="nv">fastcgi_pass</span> <span class="mi">127</span>.<span class="mi">0</span>.<span class="mi">0</span>.<span class="mi">1</span>:<span class="mi">9000</span><span class="c1">;</span>
              <span class="nv">fastcgi_index</span> <span class="nv">index</span>.<span class="nv">php</span><span class="c1">;</span>
              <span class="nv">fastcgi_param</span> <span class="nv">SCRIPT_FILENAME</span> <span class="mh">$d</span><span class="nv">ocument_root</span><span class="mh">$fa</span><span class="nv">stcgi_script_name</span><span class="c1">;</span>
              <span class="k">include</span> <span class="nv">fastcgi_params</span><span class="c1">;</span>
        }

<span class="nv">apache</span>
<span class="nv">yum</span> <span class="nv">install</span> <span class="nv">httpd</span> <span class="nv">php</span> <span class="nv">php</span><span class="o">-</span><span class="nv">curl</span> <span class="nv">php</span><span class="o">-</span><span class="nv">mbstring</span> <span class="nv">youtube</span><span class="o">-</span><span class="nv">dl</span>
<span class="nv">cd</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">httpd</span> 
<span class="nv">rm</span> <span class="nv">conf</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">welcome</span>.<span class="nv">conf</span>

<span class="nv">vim</span> <span class="nv">conf</span><span class="o">/</span><span class="nv">httpd</span>.<span class="nv">conf</span>

添加<span class="nv">index</span>.<span class="nv">php</span>
<span class="o">&lt;</span><span class="nv">IfModule</span> <span class="nv">dir_module</span><span class="o">&gt;</span>
    <span class="nv">DirectoryIndex</span> <span class="nv">index</span>.<span class="nv">html</span> <span class="nv">index</span>.<span class="nv">php</span>
<span class="o">&lt;/</span><span class="nv">IfModule</span><span class="o">&gt;</span>

添加<span class="nv">php</span><span class="o">-</span><span class="nv">proxy</span>
<span class="o">&lt;</span><span class="nv">VirtualHost</span> <span class="o">*</span>:<span class="mi">80</span><span class="o">&gt;</span>
        <span class="nv">DocumentRoot</span> <span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">www</span><span class="o">/</span>
<span class="o">&lt;/</span><span class="nv">VirtualHost</span><span class="o">&gt;</span>

<span class="nv">ServerLimit</span> <span class="mi">10</span>

<span class="o">&lt;</span><span class="nv">IfModule</span> <span class="nv">mpm_prefork_module</span><span class="o">&gt;</span>
    <span class="nv">StartServers</span>        <span class="mi">5</span>
    <span class="nv">MinSpareServers</span>     <span class="mi">5</span>
    <span class="nv">MaxSpareServers</span>     <span class="mi">10</span>
    <span class="nv">MaxClients</span>          <span class="mi">10</span>
    <span class="nv">MaxRequestsPerChild</span> <span class="mi">0</span>
<span class="o">&lt;/</span><span class="nv">IfModule</span><span class="o">&gt;</span>

<span class="nv">ExtendedStatus</span> <span class="nv">On</span>

<span class="o">&lt;</span><span class="nv">Location</span> <span class="o">/</span><span class="nv">proxy</span><span class="o">-</span><span class="nv">status</span><span class="o">&gt;</span>
        <span class="nv">SetHandler</span> <span class="nv">server</span><span class="o">-</span><span class="nv">status</span>
<span class="o">&lt;/</span><span class="nv">Location</span><span class="o">&gt;</span>
</pre></div>


<h2 id="solr">solr</h2>
<div class="codehilite"><pre><span></span><span class="err">下载：</span>
<span class="err">官网地址：</span><span class="nl">http</span><span class="p">:</span><span class="c1">//lucene.apache.org/solr/</span>
<span class="err">国内下载地址：</span><span class="nl">http</span><span class="p">:</span><span class="c1">//mirrors.cnnic.cn/apache/lucene/solr/</span>
<span class="err">安装：</span>
<span class="err">需要</span><span class="n">apache</span> <span class="n">java</span>
<span class="n">yum</span> <span class="n">install</span> <span class="n">java</span> <span class="n">httpd</span>
<span class="n">java</span> <span class="err">–</span><span class="n">version</span> <span class="err">出现一下内容则</span><span class="n">java</span><span class="err">正常</span>
<span class="n">openjdk</span> <span class="n">version</span> <span class="s">&quot;1.8.0_65&quot;</span>
<span class="n">OpenJDK</span> <span class="n">Runtime</span> <span class="n">Environment</span> <span class="p">(</span><span class="n">build</span> <span class="mf">1.8.0</span><span class="n">_65</span><span class="o">-</span><span class="n">b17</span><span class="p">)</span>
<span class="n">OpenJDK</span> <span class="mi">64</span><span class="o">-</span><span class="n">Bit</span> <span class="n">Server</span> <span class="n">VM</span> <span class="p">(</span><span class="n">build</span> <span class="mf">25.65</span><span class="o">-</span><span class="n">b01</span><span class="p">,</span> <span class="n">mixed</span> <span class="n">mode</span><span class="p">)</span>


<span class="n">tar</span> <span class="o">-</span><span class="n">zxf</span> <span class="n">solr</span><span class="o">-</span><span class="mf">5.3.1</span><span class="p">.</span><span class="n">tgz</span>
<span class="n">cd</span> <span class="n">solr</span><span class="o">-</span><span class="mf">5.3.1</span><span class="o">/</span>
<span class="err">启动</span> <span class="p">.</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">solr</span> <span class="n">start</span> <span class="o">-</span><span class="n">e</span> <span class="n">cloud</span> <span class="o">-</span><span class="n">noprompt</span>
<span class="err">导入文件</span> <span class="p">.</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">post</span> <span class="o">-</span><span class="n">c</span> <span class="n">gettingstarted</span> <span class="err">文件路径</span>
<span class="err">清楚所有（重新初始化）</span> <span class="p">.</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">solr</span> <span class="n">stop</span> <span class="o">-</span><span class="n">all</span> <span class="p">;</span> <span class="n">rm</span> <span class="o">-</span><span class="n">Rf</span> <span class="n">example</span><span class="o">/</span><span class="n">cloud</span><span class="o">/</span>
<span class="err">删除</span>  <span class="p">.</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">post</span> <span class="o">-</span><span class="n">c</span> <span class="n">gettingstarted</span> <span class="o">-</span><span class="n">d</span> <span class="s">&quot;&lt;delete&gt;&lt;id&gt;SP2514N&lt;/id&gt;&lt;/delete&gt;&quot;</span>

<span class="err">定时添加文件索引，加入计划任务</span>
<span class="err">*/</span><span class="mi">1</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span> <span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">add_file_solr</span><span class="p">.</span><span class="n">sh</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
<span class="err">脚本：</span>
<span class="cp">#!/usr/bin/env bash</span>
<span class="n">file</span><span class="o">=</span><span class="err">`</span><span class="n">find</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">logfile</span> <span class="o">-</span><span class="n">type</span> <span class="n">f</span> <span class="o">-</span><span class="n">amin</span> <span class="mi">1</span><span class="err">`</span>
<span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="err">$</span><span class="n">file</span>
<span class="k">do</span>
         <span class="k">if</span> <span class="p">[</span> <span class="err">$</span><span class="n">i</span><span class="o">==</span><span class="s">&quot;&quot;</span> <span class="p">];</span><span class="n">then</span>
                 <span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">solr</span><span class="o">-</span><span class="mf">5.3.1</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">post</span> <span class="o">-</span><span class="n">c</span> <span class="n">gettingstarted</span> <span class="err">$</span><span class="n">i</span>
         <span class="k">else</span>
                 <span class="n">exit</span>
         <span class="n">fi</span>
<span class="n">done</span>

<span class="err">主界面</span> <span class="nl">http</span><span class="p">:</span><span class="c1">//localhost:8983/solr</span>
<span class="err">导入的文件界面</span>  <span class="nl">http</span><span class="p">:</span><span class="c1">//localhost:8983/solr/gettingstarted/browse</span>


<span class="n">Documents</span>  <span class="err">选择（</span><span class="n">solr</span> <span class="n">command</span><span class="err">）</span>
<span class="err">添加索引</span>
<span class="o">&lt;</span><span class="n">add</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">doc</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">fieldname</span><span class="o">=</span><span class="s">&quot;url&quot;</span><span class="o">&gt;</span><span class="nl">http</span><span class="p">:</span><span class="c1">//localhost/myBlog/solr-rocks.html&lt;/field&gt;</span>
<span class="o">&lt;</span><span class="n">field</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;title&quot;</span><span class="o">&gt;</span><span class="n">Solr</span> <span class="n">Search</span> <span class="n">is</span> <span class="n">Simply</span> <span class="n">Great</span><span class="o">&lt;/</span><span class="n">field</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">field</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;keywords&quot;</span><span class="o">&gt;</span><span class="n">solr</span><span class="p">,</span><span class="n">lucene</span><span class="p">,</span><span class="n">enterprise</span><span class="p">,</span><span class="n">search</span><span class="o">&lt;/</span><span class="n">field</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">fieldname</span><span class="o">=</span><span class="s">&quot;creationDate&quot;</span><span class="o">&gt;</span><span class="mi">2007</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mo">06</span><span class="nl">T05</span><span class="p">:</span><span class="mo">04</span><span class="o">:</span><span class="mf">00.000</span><span class="n">Z</span><span class="o">&lt;/</span><span class="n">field</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">field</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;rating&quot;</span><span class="o">&gt;</span><span class="mi">10</span><span class="o">&lt;/</span><span class="n">field</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">field</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;content&quot;</span><span class="o">&gt;</span><span class="n">Solr</span> <span class="n">is</span> <span class="n">a</span> <span class="n">really</span> <span class="n">great</span> <span class="n">open</span> <span class="n">source</span> <span class="n">searchserver</span><span class="p">.</span> <span class="n">It</span> <span class="n">scales</span><span class="p">,</span>
<span class="n">it</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">easy</span> <span class="n">to</span> <span class="n">configure</span> <span class="n">and</span> <span class="n">the</span> <span class="n">Solr</span> <span class="n">community</span> <span class="n">is</span> <span class="n">reallysupportive</span><span class="p">.</span><span class="o">&lt;/</span><span class="n">field</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">field</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;published&quot;</span><span class="o">&gt;</span><span class="n">on</span><span class="o">&lt;/</span><span class="n">field</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">doc</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">add</span><span class="o">&gt;</span>

<span class="err">删除制定</span><span class="n">ID</span><span class="err">的索引</span>
<span class="o">&lt;</span><span class="n">delete</span><span class="o">&gt;&lt;</span><span class="kt">id</span><span class="o">&gt;</span><span class="mo">0513</span><span class="mi">8022</span><span class="o">&lt;/</span><span class="kt">id</span><span class="o">&gt;&lt;/</span><span class="n">delete</span><span class="o">&gt;</span>

<span class="err">删除查询到的索引数据</span>
<span class="o">&lt;</span><span class="n">delete</span><span class="o">&gt;&lt;</span><span class="n">query</span><span class="o">&gt;</span><span class="kt">id</span><span class="o">:</span><span class="n">IW</span><span class="o">-</span><span class="mo">02</span><span class="o">&lt;/</span><span class="n">query</span><span class="o">&gt;&lt;/</span><span class="n">delete</span><span class="o">&gt;</span>

<span class="err">删除所有索引数据</span>
<span class="o">&lt;</span><span class="n">delete</span><span class="o">&gt;&lt;</span><span class="n">query</span><span class="o">&gt;*:*&lt;/</span><span class="n">query</span><span class="o">&gt;&lt;/</span><span class="n">delete</span><span class="o">&gt;</span>

<span class="n">Apache</span> <span class="err">反向代理和用户验证</span>
<span class="n">Vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">httpd</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">httpd</span><span class="p">.</span><span class="n">conf</span>
<span class="err">确保</span> <span class="n">LoadModule</span> <span class="n">proxy_module</span> <span class="n">modules</span><span class="o">/</span><span class="n">mod_proxy</span><span class="p">.</span><span class="n">so</span><span class="err">和</span>
   <span class="n">LoadModule</span> <span class="n">proxy_http_module</span> <span class="n">modules</span><span class="o">/</span><span class="n">mod_proxy_http</span><span class="p">.</span><span class="n">so</span><span class="err">没有被注释</span>

<span class="err">添加：</span>
<span class="o">&lt;</span><span class="n">VirtualHost</span> <span class="o">*:</span><span class="mi">80</span><span class="o">&gt;</span>
    <span class="n">ServerAdmin</span> <span class="n">yunwei</span><span class="mi">@3</span><span class="n">mang</span><span class="p">.</span><span class="n">com</span>
    <span class="n">ServerName</span> <span class="n">log</span><span class="mf">.3</span><span class="n">mang</span><span class="p">.</span><span class="n">com</span>
    <span class="n">ProxyRequests</span> <span class="n">Off</span>
    <span class="o">&lt;</span><span class="n">Proxy</span> <span class="o">*&gt;</span>
        <span class="n">AuthType</span> <span class="n">Basic</span>
        <span class="n">allowoverride</span> <span class="n">AuthConfig</span>
        <span class="n">order</span> <span class="n">allow</span><span class="p">,</span><span class="n">deny</span> 
        <span class="n">allow</span> <span class="n">from</span> <span class="n">all</span>
        <span class="n">AuthName</span> <span class="s">&quot;admin&quot;</span>
        <span class="n">AuthUserFile</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">httpd</span><span class="o">/</span><span class="p">.</span><span class="n">htpassword</span>    <span class="err">增加用户登录</span>
        <span class="n">require</span> <span class="n">valid</span><span class="o">-</span><span class="n">user</span>
    <span class="o">&lt;/</span><span class="n">Proxy</span><span class="o">&gt;</span>
    <span class="n">ProxyPass</span> <span class="o">/</span><span class="n">solr</span> <span class="nl">http</span><span class="p">:</span><span class="c1">//127.0.0.1:8983/solr</span>
    <span class="n">ProxyPass</span> <span class="o">/</span><span class="n">solr</span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">cores</span> <span class="nl">http</span><span class="p">:</span><span class="c1">//127.0.0.1:8983/solr/admin/cores</span>
    <span class="n">ProxyPassReverse</span> <span class="o">/</span><span class="n">solr</span> <span class="nl">http</span><span class="p">:</span><span class="c1">//127.0.0.1:8983/solr</span>
<span class="o">&lt;/</span><span class="n">VirtualHost</span><span class="o">&gt;</span>

<span class="n">htpasswd</span> <span class="o">-</span><span class="n">cm</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">httpd</span><span class="o">/</span><span class="p">.</span><span class="n">htpassword</span> <span class="n">admin</span>    <span class="err">创建文件并添加用户，之前有会清空</span>
<span class="n">htpasswd</span> <span class="o">-</span><span class="n">m</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">httpd</span><span class="o">/</span><span class="p">.</span><span class="n">htpassword</span> <span class="n">test</span>      <span class="err">只添加用户</span>
<span class="n">chown</span> <span class="n">apache</span><span class="p">.</span><span class="n">apache</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">httpd</span><span class="o">/</span><span class="p">.</span><span class="n">htpassword</span>
<span class="n">chmod</span> <span class="mi">400</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">httpd</span><span class="o">/</span><span class="p">.</span><span class="n">htpassword</span>
</pre></div>


<h2 id="smokeping">smokeping</h2>
<div class="codehilite"><pre><span></span>    <span class="nv">https</span>:<span class="o">//</span><span class="nv">oss</span>.<span class="nv">oetiker</span>.<span class="nv">ch</span><span class="o">/</span><span class="nv">smokeping</span><span class="o">/</span><span class="nv">doc</span><span class="o">/</span><span class="nv">smokeping_install</span>.<span class="nv">en</span>.<span class="nv">html</span>


    <span class="nv">yum</span> <span class="o">-</span><span class="nv">y</span> <span class="nv">install</span> <span class="nv">gcc</span> <span class="nv">httpd</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">libxml2</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">libpng</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">glib</span> <span class="nv">pango</span> <span class="nv">pango</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">freetype</span> <span class="nv">freetype</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">fontconfig</span> <span class="nv">cairo</span> <span class="nv">cairo</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">libart_lgpl</span> <span class="nv">libart_lgpl</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">popt</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">rrdtool</span> <span class="nv">rrdtool</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">rrdtool</span><span class="o">-</span><span class="nv">perl</span> <span class="nv">fping</span> <span class="nv">mod_fcgid</span> <span class="nv">perl</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">fcgi</span> <span class="nv">perl</span><span class="o">-</span><span class="nv">Sys</span><span class="o">-</span><span class="nv">Syslog</span>
    需要<span class="nv">rrdtool</span> <span class="nv">cgilib</span> <span class="nv">fping</span>  <span class="nv">echoping</span>  <span class="nv">fcgi</span>

    <span class="nv">wget</span> <span class="nv">https</span>:<span class="o">//</span><span class="nv">launchpad</span>.<span class="nv">net</span><span class="o">/</span><span class="nv">cgilib</span><span class="o">/</span><span class="nv">main</span><span class="o">/</span><span class="mi">0</span>.<span class="mi">5</span><span class="o">/+</span><span class="nv">download</span><span class="o">/</span><span class="nv">cgilib</span><span class="o">-</span><span class="mi">0</span>.<span class="mi">5</span>.<span class="nv">tar</span>.<span class="nv">gz</span>
    <span class="nv">tar</span> <span class="nv">zxvf</span> <span class="nv">cgilib</span><span class="o">-</span><span class="mi">0</span>.<span class="mi">5</span>.<span class="nv">tar</span>.<span class="nv">gz</span>
    <span class="nv">cd</span> <span class="nv">cgilib</span><span class="o">-</span><span class="mi">0</span>.<span class="mi">5</span>
    <span class="nv">make</span>
    <span class="nv">cp</span> <span class="nv">libcgi</span>.<span class="nv">a</span> <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">lib</span>
    <span class="nv">cp</span> <span class="nv">cgi</span>.<span class="nv">h</span> <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="k">include</span>

    <span class="nv">wget</span> <span class="nv">https</span>:<span class="o">//</span><span class="nv">fossies</span>.<span class="nv">org</span><span class="o">/</span><span class="nv">linux</span><span class="o">/</span><span class="nv">misc</span><span class="o">/</span><span class="nv">old</span><span class="o">/</span><span class="nv">echoping</span><span class="o">-</span><span class="mi">6</span>.<span class="mi">0</span>.<span class="mi">2</span>.<span class="nv">tar</span>.<span class="nv">gz</span>
    <span class="nv">tar</span> <span class="nv">zxvf</span> <span class="nv">echoping</span><span class="o">-</span><span class="mi">6</span>.<span class="mi">0</span>.<span class="mi">2</span>.<span class="nv">tar</span>.<span class="nv">gz</span>
    <span class="nv">cd</span> <span class="nv">echoping</span><span class="o">-</span><span class="mi">6</span>.<span class="mi">0</span>.<span class="mi">2</span>
    .<span class="o">/</span><span class="nv">configure</span> <span class="o">--</span><span class="nv">without</span><span class="o">-</span><span class="nv">libidn</span>
    <span class="nv">make</span> <span class="o">&amp;&amp;</span> <span class="nv">make</span> <span class="nv">install</span>

    <span class="nv">yum</span> <span class="nv">install</span> <span class="nv">perl</span><span class="o">-</span><span class="nv">core</span> <span class="o">-</span><span class="nv">y</span>
    <span class="nv">wget</span> <span class="nv">https</span>:<span class="o">//</span><span class="nv">oss</span>.<span class="nv">oetiker</span>.<span class="nv">ch</span><span class="o">/</span><span class="nv">smokeping</span><span class="o">/</span><span class="nv">pub</span><span class="o">/</span><span class="nv">smokeping</span><span class="o">-</span><span class="mi">2</span>.<span class="mi">7</span>.<span class="mi">2</span>.<span class="nv">tar</span>.<span class="nv">gz</span>
    <span class="nv">tar</span> <span class="nv">zxvf</span> <span class="nv">smokeping</span><span class="o">-</span><span class="mi">2</span>.<span class="mi">7</span>.<span class="mi">2</span>.<span class="nv">tar</span>.<span class="nv">gz</span>
    <span class="nv">cd</span> <span class="nv">smokeping</span><span class="o">-</span><span class="mi">2</span>.<span class="mi">7</span>.<span class="mi">2</span>
    .<span class="o">/</span><span class="nv">configure</span> <span class="o">--</span><span class="nv">prefix</span><span class="o">=/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">smokeping</span>
    <span class="nv">gmake</span> <span class="nv">install</span>
    <span class="nv">gmake</span> <span class="nv">install</span>  执行两次

    配置<span class="nv">smokeping</span>
    <span class="nv">cd</span> <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">smokeping</span><span class="o">/</span>
    <span class="nv">mkdir</span> <span class="nv">cache</span> <span class="nv">data</span> <span class="nv">var</span>
    <span class="nv">chmod</span> <span class="mi">777</span> <span class="nv">cache</span> <span class="nv">data</span> <span class="nv">var</span>
    <span class="nv">cd</span> <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">smokeping</span><span class="o">/</span><span class="nv">htdocs</span><span class="o">/</span>
    <span class="nv">cp</span> <span class="nv">smokeping</span>.<span class="nv">fcgi</span>.<span class="nv">dist</span> <span class="nv">smokeping</span>.<span class="nv">fcgi</span>
    <span class="nv">cd</span> <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">smokeping</span><span class="o">/</span><span class="nv">etc</span><span class="o">/</span>
    <span class="nv">cp</span> <span class="nv">config</span>.<span class="nv">dist</span> <span class="nv">config</span>
    <span class="nv">chmod</span> <span class="mi">400</span> <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">smokeping</span><span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">smokeping_secrets</span>.<span class="nv">dist</span>
    <span class="nv">ln</span> <span class="o">-</span><span class="nv">s</span> <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">smokeping</span><span class="o">/</span><span class="nv">cache</span> <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">smokeping</span><span class="o">/</span><span class="nv">htdocs</span><span class="o">/</span><span class="nv">cache</span>

    创建开机自动运行脚本
    <span class="nv">vi</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">local</span>
    写入如下内容

    <span class="nv">nohup</span> <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">smokeping</span><span class="o">/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">smokeping</span> <span class="o">--</span><span class="nv">logfile</span><span class="o">=/</span><span class="nv">var</span><span class="o">/</span><span class="nv">log</span><span class="o">/</span><span class="nv">smokeping</span>.<span class="nv">log</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span> <span class="o">&amp;</span>
    修改<span class="nv">apache</span>配置文件

    <span class="nv">Alias</span> <span class="o">/</span><span class="nv">smokeping</span><span class="o">/</span> <span class="s2">&quot;</span><span class="s">/usr/local/smokeping/htdocs/</span><span class="s2">&quot;</span>
    <span class="o">&lt;</span><span class="nv">Directory</span> <span class="s2">&quot;</span><span class="s">/usr/local/smokeping/</span><span class="s2">&quot;</span><span class="o">&gt;</span>
    <span class="nv">AllowOverride</span> <span class="nv">None</span>
    <span class="nv">Options</span> <span class="nv">All</span>
    <span class="nv">AddHandler</span> <span class="nv">cgi</span><span class="o">-</span><span class="nv">script</span> .<span class="nv">fcgi</span> .<span class="nv">cgi</span>
    <span class="nv">Order</span> <span class="nv">allow</span>,<span class="nv">deny</span>
    <span class="nv">Allow</span> <span class="nv">from</span> <span class="nv">all</span>      <span class="nv">apache2</span>.<span class="mi">4</span>没用<span class="nv">allow</span> <span class="nv">order</span> 改为<span class="nv">Require</span> <span class="nv">all</span> <span class="nv">granted</span>
    <span class="nv">DirectoryIndex</span> <span class="nv">smokeping</span>.<span class="nv">fcgi</span>
    <span class="o">&lt;/</span><span class="nv">Directory</span><span class="o">&gt;</span>
    最后重器<span class="nv">apache</span>服务，运行
    <span class="nv">nohup</span> <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">smokeping</span><span class="o">/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">smokeping</span> <span class="o">--</span><span class="nv">logfile</span><span class="o">=/</span><span class="nv">var</span><span class="o">/</span><span class="nv">log</span><span class="o">/</span><span class="nv">smokeping</span>.<span class="nv">log</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span> <span class="o">&amp;</span>

    <span class="nv">kill</span> <span class="o">-</span><span class="mi">9</span> `<span class="nv">ps</span> <span class="nv">aux</span> <span class="o">|</span> <span class="nv">grep</span> <span class="nv">smokeping</span> <span class="o">|</span> <span class="nv">grep</span> <span class="o">-</span><span class="nv">v</span> <span class="nv">grep</span> <span class="o">|</span> <span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">{print $2}</span><span class="s1">&#39;</span>`
    <span class="nv">nohup</span> <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">smokeping</span><span class="o">/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">smokeping</span> <span class="o">--</span><span class="nv">logfile</span><span class="o">=/</span><span class="nv">var</span><span class="o">/</span><span class="nv">log</span><span class="o">/</span><span class="nv">smokeping</span>.<span class="nv">log</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span> <span class="o">&amp;</span>

    监控节点的增加
    <span class="nv">vim</span> <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">smokeping</span><span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">config</span>

    中文支持 
    <span class="o">***</span> <span class="nv">Presentation</span> <span class="o">***</span> 添加
    <span class="nv">charset</span> <span class="o">=</span> <span class="nv">utf</span><span class="o">-</span><span class="mi">8</span>

    <span class="o">+</span> <span class="nv">TEST</span>
    <span class="nv">menu</span> <span class="o">=</span> <span class="nv">TEST</span>
    <span class="nv">title</span> <span class="o">=</span> <span class="nv">TEST</span>
    ################<span class="nv">web</span> <span class="nv">server</span>############################
    <span class="o">++</span> <span class="nv">TEST</span><span class="o">-</span><span class="nv">web</span><span class="o">-</span><span class="nv">bbs</span>
    <span class="nv">menu</span> <span class="o">=</span> <span class="nv">TEST</span><span class="o">-</span><span class="nv">web</span><span class="o">-</span><span class="nv">bbs</span>
    <span class="nv">title</span> <span class="o">=</span> <span class="nv">TEST</span>网站 <span class="mi">10</span>.<span class="mi">0</span>.<span class="mi">100</span>.<span class="mi">10</span>
    <span class="nv">host</span> <span class="o">=</span> <span class="mi">61</span>.<span class="mi">160</span>.<span class="mi">248</span>.<span class="mi">10</span>
    <span class="o">++</span> <span class="nv">TEST</span><span class="o">-</span><span class="nv">web</span><span class="o">-</span><span class="nv">main</span>
    <span class="nv">menu</span> <span class="o">=</span> <span class="nv">TEST</span>网站主<span class="nv">WEB</span>服务器
    <span class="nv">title</span> <span class="o">=</span> <span class="nv">TEST</span>网站主<span class="nv">WEB</span>服务器 <span class="mi">10</span>.<span class="mi">0</span>.<span class="mi">100</span>.<span class="mi">21</span>
    <span class="nv">host</span> <span class="o">=</span> <span class="mi">10</span>.<span class="mi">0</span>.<span class="mi">100</span>.<span class="mi">21</span>
</pre></div>


<h2 id="redmine">redmine</h2>
<div class="codehilite"><pre><span></span><span class="nv">http</span>:<span class="o">//</span><span class="nv">www</span>.<span class="nv">redmine</span>.<span class="nv">org</span><span class="o">/</span><span class="nv">projects</span><span class="o">/</span><span class="nv">redmine</span><span class="o">/</span><span class="nv">wiki</span><span class="o">/</span><span class="nv">RedmineInstall</span>



<span class="nv">Step</span> <span class="mi">1</span> <span class="o">-</span> <span class="nv">Redmine</span> <span class="nv">application</span>

下载<span class="nv">redmine</span> <span class="nv">http</span>:<span class="o">//</span><span class="nv">www</span>.<span class="nv">redmine</span>.<span class="nv">org</span><span class="o">/</span><span class="nv">projects</span><span class="o">/</span><span class="nv">redmine</span><span class="o">/</span><span class="nv">wiki</span><span class="o">/</span><span class="nv">Download</span>
解压换<span class="nv">gem</span>源，国外的很慢
<span class="nv">gem</span> <span class="nv">sources</span> <span class="o">--</span><span class="nv">add</span> <span class="nv">http</span>:<span class="o">//</span><span class="nv">gems</span>.<span class="nv">ruby</span><span class="o">-</span><span class="nv">china</span>.<span class="nv">org</span><span class="o">/</span> <span class="o">--</span><span class="nv">remove</span> <span class="nv">http</span>:<span class="o">//</span><span class="nv">rubygems</span>.<span class="nv">org</span><span class="o">/</span>
解压缩<span class="nv">redmine</span>  
<span class="nv">vim</span> <span class="nv">Gemfile</span> 修改第一行
<span class="nv">source</span> <span class="s1">&#39;</span><span class="s">https://gems.ruby-china.org/</span><span class="s1">&#39;</span>

创建数据库和用户
<span class="nv">MySQL</span>

<span class="nv">CREATE</span> <span class="nv">DATABASE</span> <span class="nv">redmine</span> <span class="nv">CHARACTER</span> <span class="nv">SET</span> <span class="nv">utf8</span><span class="c1">; </span>
<span class="nv">CREATE</span> <span class="nv">USER</span> <span class="s1">&#39;</span><span class="s">redmine</span><span class="s1">&#39;</span>@<span class="s1">&#39;</span><span class="s">localhost</span><span class="s1">&#39;</span> <span class="nv">IDENTIFIED</span> <span class="nv">BY</span> <span class="s1">&#39;</span><span class="s">my_password</span><span class="s1">&#39;</span><span class="c1">; </span>
<span class="nv">GRANT</span> <span class="nv">ALL</span> <span class="nv">PRIVILEGES</span> <span class="nv">ON</span> <span class="nv">redmine</span>.<span class="o">*</span> <span class="nv">TO</span> <span class="s1">&#39;</span><span class="s">redmine</span><span class="s1">&#39;</span>@<span class="s1">&#39;</span><span class="s">localhost</span><span class="s1">&#39;</span><span class="c1">;</span>
<span class="k">For</span> <span class="nv">versions</span> <span class="nv">of</span> <span class="nv">MySQL</span> <span class="nv">prior</span> <span class="nv">to</span> <span class="mi">5</span>.<span class="mi">0</span>.<span class="mi">2</span> <span class="o">-</span> <span class="nv">skip</span> <span class="nv">the</span> <span class="s1">&#39;</span><span class="s">create user</span><span class="s1">&#39;</span> <span class="nv">step</span> <span class="nv">and</span> <span class="nv">instead</span>:
<span class="nv">GRANT</span> <span class="nv">ALL</span> <span class="nv">PRIVILEGES</span> <span class="nv">ON</span> <span class="nv">redmine</span>.<span class="o">*</span> <span class="nv">TO</span> <span class="s1">&#39;</span><span class="s">redmine</span><span class="s1">&#39;</span>@<span class="s1">&#39;</span><span class="s">localhost</span><span class="s1">&#39;</span> <span class="nv">IDENTIFIED</span> <span class="nv">BY</span> <span class="s1">&#39;</span><span class="s">my_password</span><span class="s1">&#39;</span><span class="c1">;</span>

<span class="nv">PostgreSQL</span>

<span class="nv">CREATE</span> <span class="nv">ROLE</span> <span class="nv">redmine</span> <span class="nv">LOGIN</span> <span class="nv">ENCRYPTED</span> <span class="nv">PASSWORD</span> <span class="s1">&#39;</span><span class="s">my_password</span><span class="s1">&#39;</span> <span class="nv">NOINHERIT</span> <span class="nv">VALID</span> <span class="k">UNTIL</span> <span class="s1">&#39;</span><span class="s">infinity</span><span class="s1">&#39;</span><span class="c1">; </span>
<span class="nv">CREATE</span> <span class="nv">DATABASE</span> <span class="nv">redmine</span> <span class="nv">WITH</span> <span class="nv">ENCODING</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">UTF8</span><span class="s1">&#39;</span> <span class="nv">OWNER</span><span class="o">=</span><span class="nv">redmine</span><span class="c1">;</span>

<span class="nv">SQL</span> <span class="nv">Server</span>

<span class="nv">The</span> <span class="nv">database</span>, <span class="nv">login</span> <span class="nv">and</span> <span class="nv">user</span> <span class="nv">can</span> <span class="nv">be</span> <span class="nv">created</span> <span class="nv">within</span> <span class="nv">SQL</span> <span class="nv">Server</span> <span class="nv">Management</span> <span class="nv">Studio</span> <span class="nv">with</span> <span class="nv">a</span> <span class="nv">few</span> <span class="nv">clicks</span>.
<span class="k">If</span> <span class="nv">you</span> <span class="nv">prefer</span> <span class="nv">the</span> <span class="nv">command</span> <span class="nv">line</span> <span class="nv">option</span> <span class="nv">with</span> <span class="nv">SQLCMD</span>, <span class="nv">here</span><span class="s1">&#39;</span><span class="s">s some basic example:</span>
<span class="k">Show</span> <span class="nv">SQL</span>

<span class="nv">Step</span> <span class="mi">3</span> <span class="o">-</span> <span class="nv">Database</span> <span class="nv">connection</span> <span class="nv">configuration</span>

配置数据库连接
<span class="nv">Copy</span> <span class="nv">config</span><span class="o">/</span><span class="nv">database</span>.<span class="nv">yml</span>.<span class="nv">example</span> <span class="nv">to</span> <span class="nv">config</span><span class="o">/</span><span class="nv">database</span>.<span class="nv">yml</span> <span class="nv">and</span> <span class="nv">edit</span> <span class="nv">this</span> <span class="nv">file</span> <span class="nv">in</span> <span class="nv">order</span> <span class="nv">to</span> <span class="nv">configure</span> <span class="nv">your</span>
 <span class="nv">database</span> <span class="nv">settings</span> <span class="k">for</span> <span class="s2">&quot;</span><span class="s">production</span><span class="s2">&quot;</span> <span class="nv">environment</span>.
<span class="nv">Example</span> <span class="k">for</span> <span class="nv">a</span> <span class="nv">MySQL</span> <span class="nv">database</span> <span class="nv">using</span> <span class="nv">ruby</span> <span class="mi">1</span>.<span class="mi">8</span> <span class="nv">or</span> <span class="nv">jruby</span>:
<span class="nv">production</span>:
  <span class="nv">adapter</span>: <span class="nv">mysql</span>
  <span class="nv">database</span>: <span class="nv">redmine</span>
  <span class="nv">host</span>: <span class="nv">localhost</span>
  <span class="nv">username</span>: <span class="nv">redmine</span>
  <span class="nv">password</span>: <span class="nv">my_password</span>
<span class="nv">Example</span> <span class="k">for</span> <span class="nv">a</span> <span class="nv">MySQL</span> <span class="nv">database</span> <span class="nv">using</span> <span class="nv">ruby</span> <span class="mi">1</span>.<span class="mi">9</span> <span class="ss">(</span><span class="nv">adapter</span> <span class="nv">must</span> <span class="nv">be</span> <span class="nv">set</span> <span class="nv">to</span> <span class="nv">mysql2</span><span class="ss">)</span>:
<span class="nv">production</span>:
  <span class="nv">adapter</span>: <span class="nv">mysql2</span>
  <span class="nv">database</span>: <span class="nv">redmine</span>
  <span class="nv">host</span>: <span class="nv">localhost</span>
  <span class="nv">username</span>: <span class="nv">redmine</span>
  <span class="nv">password</span>: <span class="nv">my_password</span>
<span class="k">If</span> <span class="nv">your</span> <span class="nv">server</span> <span class="nv">is</span> <span class="nv">not</span> <span class="nv">running</span> <span class="nv">on</span> <span class="nv">the</span> <span class="nv">standard</span> <span class="nv">port</span> <span class="ss">(</span><span class="mi">3306</span><span class="ss">)</span>, <span class="nv">use</span> <span class="nv">this</span> <span class="nv">configuration</span> <span class="nv">instead</span>:
<span class="nv">production</span>:
  <span class="nv">adapter</span>: <span class="nv">mysql</span>
  <span class="nv">database</span>: <span class="nv">redmine</span>
  <span class="nv">host</span>: <span class="nv">localhost</span>
  <span class="nv">port</span>: <span class="mi">3307</span>
  <span class="nv">username</span>: <span class="nv">redmine</span>
  <span class="nv">password</span>: <span class="nv">my_password</span>
<span class="nv">Example</span> <span class="k">for</span> <span class="nv">a</span> <span class="nv">PostgreSQL</span> <span class="nv">database</span> <span class="ss">(</span><span class="nv">default</span> <span class="nv">port</span><span class="ss">)</span>:
<span class="nv">production</span>:
  <span class="nv">adapter</span>: <span class="nv">postgresql</span>
  <span class="nv">database</span>: <span class="o">&lt;</span><span class="nv">your_database_name</span><span class="o">&gt;</span>
  <span class="nv">host</span>: <span class="o">&lt;</span><span class="nv">postgres_host</span><span class="o">&gt;</span>
  <span class="nv">username</span>: <span class="o">&lt;</span><span class="nv">postgres_user</span><span class="o">&gt;</span>
  <span class="nv">password</span>: <span class="o">&lt;</span><span class="nv">postgres_user_password</span><span class="o">&gt;</span>
  <span class="nv">encoding</span>: <span class="nv">utf8</span>
  <span class="nv">schema_search_path</span>: <span class="o">&lt;</span><span class="nv">database_schema</span><span class="o">&gt;</span> <span class="ss">(</span><span class="nv">default</span> <span class="o">-</span> <span class="nv">public</span><span class="ss">)</span>
<span class="nv">Example</span> <span class="k">for</span> <span class="nv">a</span> <span class="nv">SQL</span> <span class="nv">Server</span> <span class="nv">database</span> <span class="ss">(</span><span class="nv">default</span> <span class="nv">host</span> <span class="nv">localhost</span>, <span class="nv">default</span> <span class="nv">port</span> <span class="mi">1433</span><span class="ss">)</span>:
<span class="nv">production</span>:
  <span class="nv">adapter</span>: <span class="nv">sqlserver</span>
  <span class="nv">database</span>: <span class="nv">redmine</span>
  <span class="nv">username</span>: <span class="nv">redmine</span> # <span class="nv">should</span> <span class="nv">match</span> <span class="nv">the</span> <span class="nv">database</span> <span class="nv">user</span> <span class="nv">name</span>
  <span class="nv">password</span>: <span class="nv">redminepassword</span> # <span class="nv">should</span> <span class="nv">match</span> <span class="nv">the</span> <span class="nv">login</span> <span class="nv">password</span>
<span class="nv">Step</span> <span class="mi">4</span> <span class="o">-</span> <span class="nv">Dependencies</span> <span class="nv">installation</span>

安装需要的依赖包
<span class="nv">Redmine</span> <span class="nv">uses</span> <span class="nv">Bundler</span> <span class="nv">to</span> <span class="nv">manage</span> <span class="nv">gems</span> <span class="nv">dependencies</span>.
<span class="nv">gem</span> <span class="nv">install</span> <span class="nv">bundler</span>
<span class="k">Then</span> <span class="nv">you</span> <span class="nv">can</span> <span class="nv">install</span> <span class="nv">all</span> <span class="nv">the</span> <span class="nv">gems</span> <span class="nv">required</span> <span class="nv">by</span> <span class="nv">Redmine</span> <span class="nv">using</span> <span class="nv">the</span> <span class="nv">following</span> <span class="nv">command</span>:
<span class="nv">bundle</span> <span class="nv">install</span> <span class="o">--</span><span class="nv">without</span> <span class="nv">development</span> <span class="nv">test</span>
<span class="nv">Optional</span> <span class="nv">dependencies</span>

<span class="nv">RMagick</span> <span class="ss">(</span><span class="nv">allows</span> <span class="nv">the</span> <span class="nv">use</span> <span class="nv">of</span> <span class="nv">ImageMagick</span> <span class="nv">to</span> <span class="nv">manipulate</span> <span class="nv">images</span> <span class="k">for</span> <span class="nv">PDF</span> <span class="nv">and</span> <span class="nv">PNG</span> <span class="nv">export</span><span class="ss">)</span>

<span class="k">If</span> <span class="nv">ImageMagick</span> <span class="nv">is</span> <span class="nv">not</span> <span class="nv">installed</span> <span class="nv">on</span> <span class="nv">your</span> <span class="nv">system</span>, <span class="nv">you</span> <span class="nv">should</span> <span class="nv">skip</span> <span class="nv">the</span> <span class="nv">installation</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">rmagick</span> <span class="nv">gem</span> <span class="nv">using</span>:
<span class="nv">bundle</span> <span class="nv">install</span> <span class="o">--</span><span class="nv">without</span> <span class="nv">development</span> <span class="nv">test</span> <span class="nv">rmagick</span>
<span class="k">If</span> <span class="nv">you</span> <span class="nv">have</span> <span class="nv">trouble</span> <span class="nv">installing</span> <span class="nv">rmagick</span> <span class="nv">on</span> <span class="nv">Windows</span>, <span class="nv">refer</span> <span class="nv">to</span> <span class="nv">this</span> <span class="nv">HowTo</span>.
<span class="nv">Database</span> <span class="nv">adapters</span>

<span class="nv">Redmine</span> <span class="nv">automatically</span> <span class="nv">installs</span> <span class="nv">the</span> <span class="nv">adapter</span> <span class="nv">gems</span> <span class="nv">required</span> <span class="nv">by</span> <span class="nv">your</span> <span class="nv">database</span> <span class="nv">configuration</span> <span class="nv">by</span> <span class="nv">reading</span> <span class="nv">it</span> <span class="nv">from</span> 
<span class="nv">the</span> <span class="nv">config</span><span class="o">/</span><span class="nv">database</span>.<span class="nv">yml</span> <span class="nv">file</span> <span class="ss">(</span><span class="nv">eg</span>. <span class="k">if</span> <span class="nv">you</span> <span class="nv">configured</span> <span class="nv">only</span> <span class="nv">a</span> <span class="nv">connection</span> <span class="nv">using</span> <span class="nv">the</span> <span class="nv">mysql2</span> <span class="nv">adapter</span>, <span class="k">then</span> <span class="nv">only</span> 
<span class="nv">the</span> <span class="nv">mysql2</span> <span class="nv">gem</span> <span class="nv">will</span> <span class="nv">be</span> <span class="nv">installed</span><span class="ss">)</span>.
<span class="nv">Don</span><span class="s1">&#39;</span><span class="s">t forget to re-run bundle install --without development test ... after adding or removing adapters in </span>
<span class="nv">the</span> <span class="nv">config</span><span class="o">/</span><span class="nv">database</span>.<span class="nv">yml</span> <span class="nv">file</span><span class="o">!</span>
<span class="nv">Additional</span> <span class="nv">dependencies</span> <span class="ss">(</span><span class="nv">Gemfile</span>.<span class="nv">local</span><span class="ss">)</span>

<span class="k">If</span> <span class="nv">you</span> <span class="nv">need</span> <span class="nv">to</span> <span class="nv">load</span> <span class="nv">gems</span> <span class="nv">that</span> <span class="nv">are</span> <span class="nv">not</span> <span class="nv">required</span> <span class="nv">by</span> <span class="nv">Redmine</span> <span class="nv">core</span> <span class="ss">(</span><span class="nv">eg</span>. <span class="nv">Puma</span>, <span class="nv">fcgi</span><span class="ss">)</span>, <span class="nv">create</span> <span class="nv">a</span> <span class="nv">file</span> <span class="nv">named</span> 
<span class="nv">Gemfile</span>.<span class="nv">local</span> <span class="nv">at</span> <span class="nv">the</span> <span class="nv">root</span> <span class="nv">of</span> <span class="nv">your</span> <span class="nv">redmine</span> <span class="nv">directory</span>. <span class="nv">It</span> <span class="nv">will</span> <span class="nv">be</span> <span class="nv">loaded</span> <span class="nv">automatically</span> <span class="nv">when</span> <span class="nv">running</span> <span class="nv">bundle</span> <span class="nv">install</span>.
<span class="nv">Example</span>:
# <span class="nv">Gemfile</span>.<span class="nv">local</span> <span class="nv">gem</span> <span class="s1">&#39;</span><span class="s">puma</span><span class="s1">&#39;</span>

<span class="nv">Step</span> <span class="mi">5</span> <span class="o">-</span> <span class="nv">Session</span> <span class="nv">store</span> <span class="nv">secret</span> <span class="nv">generation</span>

<span class="nv">This</span> <span class="nv">step</span> <span class="nv">generates</span> <span class="nv">a</span> <span class="k">random</span> <span class="nv">key</span> <span class="nv">used</span> <span class="nv">by</span> <span class="nv">Rails</span> <span class="nv">to</span> <span class="nv">encode</span> <span class="nv">cookies</span> <span class="nv">storing</span> <span class="nv">session</span> <span class="nv">data</span> <span class="nv">thus</span> <span class="nv">preventing</span> <span class="nv">their</span> <span class="nv">tampering</span>.
<span class="nv">Generating</span> <span class="nv">a</span> <span class="nv">new</span> <span class="nv">secret</span> <span class="nv">token</span> <span class="nv">invalidates</span> <span class="nv">all</span> <span class="nv">existing</span> <span class="nv">sessions</span> <span class="nv">after</span> <span class="nv">restart</span>.
<span class="nv">with</span> <span class="nv">Redmine</span> <span class="mi">1</span>.<span class="mi">4</span>.<span class="nv">x</span>:
<span class="nv">bundle</span> <span class="k">exec</span> <span class="nv">rake</span> <span class="nv">generate_session_store</span>
<span class="nv">with</span> <span class="nv">Redmine</span> <span class="mi">2</span>.<span class="nv">x</span>:
<span class="nv">bundle</span> <span class="k">exec</span> <span class="nv">rake</span> <span class="nv">generate_secret_token</span>
<span class="nv">Alternatively</span>, <span class="nv">you</span> <span class="nv">can</span> <span class="nv">store</span> <span class="nv">this</span> <span class="nv">secret</span> <span class="nv">in</span> <span class="nv">config</span><span class="o">/</span><span class="nv">secrets</span>.<span class="nv">yml</span>:
<span class="nv">http</span>:<span class="o">//</span><span class="nv">guides</span>.<span class="nv">rubyonrails</span>.<span class="nv">org</span><span class="o">/</span><span class="nv">upgrading_ruby_on_rails</span>.<span class="nv">html</span>#<span class="nv">config</span><span class="o">-</span><span class="nv">secrets</span><span class="o">-</span><span class="nv">yml</span>
<span class="nv">Step</span> <span class="mi">6</span> <span class="o">-</span> <span class="nv">Database</span> <span class="nv">schema</span> <span class="nv">objects</span> <span class="nv">creation</span>

创建数据库的表
<span class="nv">Create</span> <span class="nv">the</span> <span class="nv">database</span> <span class="nv">structure</span>, <span class="nv">by</span> <span class="nv">running</span> <span class="nv">the</span> <span class="nv">following</span> <span class="nv">command</span> <span class="nv">under</span> <span class="nv">the</span> <span class="nv">application</span> <span class="nv">root</span> <span class="nv">directory</span>:
<span class="nv">RAILS_ENV</span><span class="o">=</span><span class="nv">production</span> <span class="nv">bundle</span> <span class="k">exec</span> <span class="nv">rake</span> <span class="nv">db</span>:<span class="nv">migrate</span>
<span class="nv">Windows</span> <span class="nv">syntax</span>:
<span class="nv">set</span> <span class="nv">RAILS_ENV</span><span class="o">=</span><span class="nv">production</span>
<span class="nv">bundle</span> <span class="k">exec</span> <span class="nv">rake</span> <span class="nv">db</span>:<span class="nv">migrate</span>
<span class="nv">It</span> <span class="nv">will</span> <span class="nv">create</span> <span class="nv">tables</span> <span class="nv">by</span> <span class="nv">running</span> <span class="nv">all</span> <span class="nv">migrations</span> <span class="nv">one</span> <span class="nv">by</span> <span class="nv">one</span> <span class="k">then</span> <span class="nv">create</span> <span class="nv">the</span> <span class="nv">set</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">permissions</span> <span class="nv">and</span> <span class="nv">the</span>
 <span class="nv">application</span> <span class="nv">administrator</span> <span class="nv">account</span>, <span class="nv">named</span> <span class="nv">admin</span>.
<span class="nv">Ubuntu</span> <span class="nv">troubleshooting</span>:
<span class="k">If</span> <span class="nv">you</span> <span class="nv">get</span> <span class="nv">this</span> <span class="nv">error</span> <span class="nv">with</span> <span class="nv">Ubuntu</span>:
<span class="nv">Rake</span> <span class="nv">aborted</span><span class="o">!</span> <span class="nv">no</span> <span class="nv">such</span> <span class="nv">file</span> <span class="nv">to</span> <span class="nv">load</span> <span class="o">--</span> <span class="nv">net</span><span class="o">/</span><span class="nv">https</span>

<span class="k">Then</span> <span class="nv">you</span> <span class="nv">need</span> <span class="nv">to</span> <span class="nv">install</span> <span class="nv">libopenssl</span><span class="o">-</span><span class="nv">ruby1</span>.<span class="mi">8</span> <span class="nv">just</span> <span class="nv">like</span> <span class="nv">this</span>: <span class="nv">apt</span><span class="o">-</span><span class="nv">get</span> <span class="nv">install</span> <span class="nv">libopenssl</span><span class="o">-</span><span class="nv">ruby1</span>.<span class="mi">8</span>.
<span class="nv">Step</span> <span class="mi">7</span> <span class="o">-</span> <span class="nv">Database</span> <span class="nv">default</span> <span class="nv">data</span> <span class="nv">set</span>

<span class="nv">Insert</span> <span class="nv">default</span> <span class="nv">configuration</span> <span class="nv">data</span> <span class="nv">in</span> <span class="nv">database</span>, <span class="nv">by</span> <span class="nv">running</span> <span class="nv">the</span> <span class="nv">following</span> <span class="nv">command</span>:
<span class="nv">RAILS_ENV</span><span class="o">=</span><span class="nv">production</span> <span class="nv">bundle</span> <span class="k">exec</span> <span class="nv">rake</span> <span class="nv">redmine</span>:<span class="nv">load_default_data</span>
<span class="nv">Redmine</span> <span class="nv">will</span> <span class="nv">prompt</span> <span class="nv">you</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">data</span> <span class="nv">set</span> <span class="nv">language</span> <span class="nv">that</span> <span class="nv">should</span> <span class="nv">be</span> <span class="nv">loaded</span><span class="c1">; you can also define the REDMINE_LANG</span>
 <span class="nv">environment</span> <span class="nv">variable</span> <span class="nv">before</span> <span class="nv">running</span> <span class="nv">the</span> <span class="nv">command</span> <span class="nv">to</span> <span class="nv">a</span> <span class="nv">value</span> <span class="nv">which</span> <span class="nv">will</span> <span class="nv">be</span> <span class="nv">automatically</span> <span class="nv">and</span> <span class="nv">silently</span> <span class="nv">picked</span>
  <span class="nv">up</span> <span class="nv">by</span> <span class="nv">the</span> <span class="nv">task</span>.
<span class="nv">E</span>.<span class="nv">g</span>.:
<span class="nv">Unices</span>:
<span class="nv">RAILS_ENV</span><span class="o">=</span><span class="nv">production</span> <span class="nv">REDMINE_LANG</span><span class="o">=</span><span class="nv">fr</span> <span class="nv">bundle</span> <span class="k">exec</span> <span class="nv">rake</span> <span class="nv">redmine</span>:<span class="nv">load_default_data</span>
<span class="nv">Windows</span>:
<span class="nv">set</span> <span class="nv">RAILS_ENV</span><span class="o">=</span><span class="nv">production</span>
<span class="nv">set</span> <span class="nv">REDMINE_LANG</span><span class="o">=</span><span class="nv">fr</span>
<span class="nv">bundle</span> <span class="k">exec</span> <span class="nv">rake</span> <span class="nv">redmine</span>:<span class="nv">load_default_data</span>
<span class="nv">Step</span> <span class="mi">8</span> <span class="o">-</span> <span class="nv">File</span> <span class="nv">system</span> <span class="nv">permissions</span>
<span class="nv">NB</span>: <span class="nv">Windows</span> <span class="nv">users</span> <span class="nv">can</span> <span class="nv">skip</span> <span class="nv">this</span> <span class="nv">section</span>.
<span class="nv">The</span> <span class="nv">user</span> <span class="nv">account</span> <span class="nv">running</span> <span class="nv">the</span> <span class="nv">application</span> <span class="nv">must</span> <span class="nv">have</span> <span class="nv">write</span> <span class="nv">permission</span> <span class="nv">on</span> <span class="nv">the</span> <span class="nv">following</span> <span class="nv">subdirectories</span>:
<span class="nv">files</span> <span class="ss">(</span><span class="nv">storage</span> <span class="nv">of</span> <span class="nv">attachments</span><span class="ss">)</span>
<span class="nv">log</span> <span class="ss">(</span><span class="nv">application</span> <span class="nv">log</span> <span class="nv">file</span> <span class="nv">production</span>.<span class="nv">log</span><span class="ss">)</span>
<span class="nv">tmp</span> <span class="nv">and</span> <span class="nv">tmp</span><span class="o">/</span><span class="nv">pdf</span> <span class="ss">(</span><span class="nv">create</span> <span class="nv">these</span> <span class="nv">ones</span> <span class="k">if</span> <span class="nv">not</span> <span class="nv">present</span>, <span class="nv">used</span> <span class="nv">to</span> <span class="nv">generate</span> <span class="nv">PDF</span> <span class="nv">documents</span> <span class="nv">among</span> <span class="nv">other</span> <span class="nv">things</span><span class="ss">)</span>
<span class="nv">public</span><span class="o">/</span><span class="nv">plugin_assets</span> <span class="ss">(</span><span class="nv">assets</span> <span class="nv">of</span> <span class="nv">plugins</span><span class="ss">)</span>
<span class="nv">E</span>.<span class="nv">g</span>., <span class="nv">assuming</span> <span class="nv">you</span> <span class="nv">run</span> <span class="nv">the</span> <span class="nv">application</span> <span class="nv">with</span> <span class="nv">a</span> <span class="nv">redmine</span> <span class="nv">user</span> <span class="nv">account</span>:
<span class="nv">mkdir</span> <span class="o">-</span><span class="nv">p</span> <span class="nv">tmp</span> <span class="nv">tmp</span><span class="o">/</span><span class="nv">pdf</span> <span class="nv">public</span><span class="o">/</span><span class="nv">plugin_assets</span>
<span class="nv">chown</span> <span class="o">-</span><span class="nv">R</span> <span class="nv">redmine</span>:<span class="nv">redmine</span> <span class="nv">files</span> <span class="nv">log</span> <span class="nv">tmp</span> <span class="nv">public</span><span class="o">/</span><span class="nv">plugin_assets</span>
<span class="nv">chmod</span> <span class="o">-</span><span class="nv">R</span> <span class="mi">755</span> <span class="nv">files</span> <span class="nv">log</span> <span class="nv">tmp</span> <span class="nv">public</span><span class="o">/</span><span class="nv">plugin_assets</span>

<span class="nv">Step</span> <span class="mi">9</span> <span class="o">-</span> <span class="nv">Test</span> <span class="nv">the</span> <span class="nv">installation</span>

<span class="nv">Test</span> <span class="nv">the</span> <span class="nv">installation</span> <span class="nv">by</span> <span class="nv">running</span> <span class="nv">WEBrick</span> <span class="nv">web</span> <span class="nv">server</span>:
<span class="nv">with</span> <span class="nv">Redmine</span> <span class="mi">1</span>.<span class="mi">4</span>.<span class="nv">x</span>:
<span class="nv">bundle</span> <span class="k">exec</span> <span class="nv">ruby</span> <span class="nv">script</span><span class="o">/</span><span class="nv">server</span> <span class="nv">webrick</span> <span class="o">-</span><span class="nv">e</span> <span class="nv">production</span>
<span class="nv">with</span> <span class="nv">Redmine</span> <span class="mi">2</span>.<span class="nv">x</span>:
<span class="nv">bundle</span> <span class="k">exec</span> <span class="nv">ruby</span> <span class="nv">script</span><span class="o">/</span><span class="nv">rails</span> <span class="nv">server</span> <span class="nv">webrick</span> <span class="o">-</span><span class="nv">e</span> <span class="nv">production</span>
<span class="nv">with</span> <span class="nv">Redmine</span> <span class="mi">3</span>.<span class="nv">x</span>:
<span class="nv">bundle</span> <span class="k">exec</span> <span class="nv">rails</span> <span class="nv">server</span> <span class="nv">webrick</span> <span class="o">-</span><span class="nv">e</span> <span class="nv">production</span>
<span class="nv">Once</span> <span class="nv">WEBrick</span> <span class="nv">has</span> <span class="nv">started</span>, <span class="nv">point</span> <span class="nv">your</span> <span class="nv">browser</span> <span class="nv">to</span> <span class="nv">http</span>:<span class="o">//</span><span class="nv">localhost</span>:<span class="mi">3000</span><span class="o">/</span>. <span class="nv">You</span> <span class="nv">should</span> <span class="nv">now</span> <span class="nv">see</span> <span class="nv">the</span> <span class="nv">application</span>
 <span class="nv">welcome</span> <span class="nv">page</span>.
<span class="nv">Note</span>: <span class="nv">Webrick</span> <span class="nv">is</span> <span class="nv">not</span> <span class="nv">suitable</span> <span class="k">for</span> <span class="nv">production</span> <span class="nv">use</span>, <span class="nv">please</span> <span class="nv">only</span> <span class="nv">use</span> <span class="nv">webrick</span> <span class="k">for</span> <span class="nv">testing</span> <span class="nv">that</span> <span class="nv">the</span> <span class="nv">installation</span>
 <span class="nv">up</span> <span class="nv">to</span> <span class="nv">this</span> <span class="nv">point</span> <span class="nv">is</span> <span class="nv">functional</span>. <span class="nv">Use</span> <span class="nv">one</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">many</span> <span class="nv">other</span> <span class="nv">guides</span> <span class="nv">in</span> <span class="nv">this</span> <span class="nv">wiki</span> <span class="nv">to</span> <span class="nv">setup</span> <span class="nv">redmine</span> <span class="nv">to</span> <span class="nv">use</span> <span class="nv">either</span>
  <span class="nv">Passenger</span> <span class="ss">(</span><span class="nv">aka</span> <span class="nv">mod_rails</span><span class="ss">)</span>, <span class="nv">FCGI</span> <span class="nv">or</span> <span class="nv">a</span> <span class="nv">Rack</span> <span class="nv">server</span> <span class="ss">(</span><span class="nv">Unicorn</span>, <span class="nv">Thin</span>, <span class="nv">Puma</span>, <span class="nv">hellip</span><span class="c1">;) to serve up your redmine.</span>
<span class="nv">Step</span> <span class="mi">10</span> <span class="o">-</span> <span class="nv">Logging</span> <span class="nv">into</span> <span class="nv">the</span> <span class="nv">application</span>

<span class="nv">Use</span> <span class="nv">default</span> <span class="nv">administrator</span> <span class="nv">account</span> <span class="nv">to</span> <span class="nv">log</span> <span class="nv">in</span>:
<span class="nv">login</span>: <span class="nv">admin</span>
<span class="nv">password</span>: <span class="nv">admin</span>
<span class="nv">You</span> <span class="nv">can</span> <span class="nv">go</span> <span class="nv">to</span> <span class="nv">Administration</span> <span class="nv">menu</span> <span class="nv">and</span> <span class="nv">choose</span> <span class="nv">Settings</span> <span class="nv">to</span> <span class="nv">modify</span> <span class="nv">most</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">application</span> <span class="nv">settings</span>.
<span class="nv">Configuration</span>

<span class="nv">Redmine</span> <span class="nv">settings</span> <span class="nv">are</span> <span class="nv">defined</span> <span class="nv">in</span> <span class="nv">a</span> <span class="nv">file</span> <span class="nv">named</span> <span class="nv">config</span><span class="o">/</span><span class="nv">configuration</span>.<span class="nv">yml</span>.
<span class="k">If</span> <span class="nv">you</span> <span class="nv">need</span> <span class="nv">to</span> <span class="nv">override</span> <span class="nv">default</span> <span class="nv">application</span> <span class="nv">settings</span>, <span class="nv">simply</span> <span class="nv">copy</span> <span class="nv">config</span><span class="o">/</span><span class="nv">configuration</span>.<span class="nv">yml</span>.<span class="nv">example</span> <span class="nv">to</span>
 <span class="nv">config</span><span class="o">/</span><span class="nv">configuration</span>.<span class="nv">yml</span> <span class="nv">and</span> <span class="nv">edit</span> <span class="nv">the</span> <span class="nv">new</span> <span class="nv">file</span><span class="c1">; the file is well commented by itself, so you should have </span>
 <span class="nv">a</span> <span class="nv">look</span> <span class="nv">at</span> <span class="nv">it</span>.
<span class="nv">These</span> <span class="nv">settings</span> <span class="nv">may</span> <span class="nv">be</span> <span class="nv">defined</span> <span class="nv">per</span> <span class="nv">Rails</span> <span class="nv">environment</span> <span class="ss">(</span><span class="nv">production</span><span class="o">/</span><span class="nv">development</span><span class="o">/</span><span class="nv">test</span><span class="ss">)</span>.
<span class="nv">Important</span> : <span class="nv">don</span><span class="s1">&#39;</span><span class="s">t forget to restart the application after any change.</span>
<span class="nv">Email</span> <span class="o">/</span> <span class="nv">SMTP</span> <span class="nv">server</span> <span class="nv">settings</span>

<span class="nv">Email</span> <span class="nv">configuration</span> <span class="nv">is</span> <span class="nv">described</span> <span class="nv">in</span> <span class="nv">a</span> <span class="nv">dedicated</span> <span class="nv">page</span>.
<span class="nv">SCM</span> <span class="nv">settings</span>

<span class="nv">This</span> <span class="nv">configuration</span> <span class="nv">section</span> <span class="nv">allows</span> <span class="nv">you</span> <span class="nv">to</span>:

<span class="nv">override</span> <span class="nv">default</span> <span class="nv">commands</span> <span class="nv">names</span> <span class="k">if</span> <span class="nv">the</span> <span class="nv">SCM</span> <span class="nv">binaries</span> <span class="nv">present</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">PATH</span> <span class="nv">variable</span> <span class="nv">doesn</span><span class="s1">&#39;</span><span class="s">t use the standard name </span>
<span class="ss">(</span><span class="nv">Windows</span> .<span class="nv">bat</span><span class="o">/</span><span class="nv">NaNd</span> <span class="nv">names</span> <span class="nv">won</span><span class="s1">&#39;</span><span class="s">t work)</span>
<span class="nv">specify</span> <span class="nv">the</span> <span class="nv">full</span> <span class="nv">path</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">binary</span>
<span class="nv">Examples</span> <span class="ss">(</span><span class="nv">with</span> <span class="nv">Subversion</span><span class="ss">)</span>:
<span class="nv">Command</span> <span class="nv">name</span> <span class="nv">override</span>:
<span class="nv">scm_subversion_command</span>: <span class="s2">&quot;</span><span class="s">svn_replacement.exe</span><span class="s2">&quot;</span>
<span class="nv">Absolute</span> <span class="nv">path</span>:
<span class="nv">scm_subversion_command</span>: <span class="s2">&quot;</span><span class="s">C:\Program Files\Subversion\bin\svn.exe</span><span class="s2">&quot;</span>
<span class="nv">Attachment</span> <span class="nv">storage</span> <span class="nv">settings</span>

<span class="nv">You</span> <span class="nv">can</span> <span class="nv">set</span> <span class="nv">a</span> <span class="nv">path</span> <span class="nv">where</span> <span class="nv">Redmine</span> <span class="nv">attachments</span> <span class="nv">will</span> <span class="nv">be</span> <span class="nv">stored</span> <span class="nv">which</span> <span class="nv">is</span> <span class="nv">different</span> <span class="nv">from</span> <span class="nv">the</span> <span class="nv">default</span> <span class="s1">&#39;</span><span class="s">files</span><span class="s1">&#39;</span>
 <span class="nv">directory</span> <span class="nv">of</span> <span class="nv">your</span> <span class="nv">Redmine</span> <span class="nv">instance</span> <span class="nv">using</span> <span class="nv">the</span> <span class="nv">attachments_storage_path</span> <span class="nv">setting</span>.
<span class="nv">Examples</span>:
<span class="nv">attachments_storage_path</span>: <span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">redmine</span><span class="o">/</span><span class="nv">files</span>
<span class="nv">attachments_storage_path</span>: <span class="nv">D</span>:<span class="o">/</span><span class="nv">redmine</span><span class="o">/</span><span class="nv">files</span>
<span class="nv">Logging</span> <span class="nv">configuration</span>

<span class="nv">Redmine</span> <span class="nv">defaults</span> <span class="nv">to</span> <span class="nv">a</span> <span class="nv">log</span> <span class="nv">level</span> <span class="nv">of</span> :<span class="nv">info</span>, <span class="nv">writing</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">log</span> <span class="nv">subdirectory</span>. <span class="nv">Depending</span> <span class="nv">on</span> <span class="nv">site</span> <span class="nv">usage</span>, 
<span class="nv">this</span> <span class="nv">can</span> <span class="nv">be</span> <span class="nv">a</span> <span class="nv">lot</span> <span class="nv">of</span> <span class="nv">data</span> <span class="nv">so</span> <span class="nv">to</span> <span class="nv">avoid</span> <span class="nv">the</span> <span class="nv">contents</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">logfile</span> <span class="nv">growing</span> <span class="nv">without</span> <span class="nv">bound</span>, <span class="nv">consider</span> <span class="nv">rotating</span> <span class="nv">them</span>,
 <span class="nv">either</span> <span class="nv">through</span> <span class="nv">a</span> <span class="nv">system</span> <span class="nv">utility</span> <span class="nv">like</span> <span class="k">logrotate</span> <span class="nv">or</span> <span class="nv">via</span> <span class="nv">theconfig</span><span class="o">/</span><span class="nv">additional_environment</span>.<span class="nv">rb</span> <span class="nv">file</span>.
<span class="nv">To</span> <span class="nv">use</span> <span class="nv">the</span> <span class="nv">latter</span>, <span class="nv">copy</span> <span class="nv">config</span><span class="o">/</span><span class="nv">additional_environment</span>.<span class="nv">rb</span>.<span class="nv">example</span> <span class="nv">to</span> <span class="nv">config</span><span class="o">/</span><span class="nv">additional_environment</span>.<span class="nv">rb</span> <span class="nv">and</span> <span class="nv">add</span> <span class="nv">the</span> 
<span class="nv">following</span> <span class="nv">lines</span>. <span class="nv">Note</span> <span class="nv">that</span> <span class="nv">the</span> <span class="nv">new</span> <span class="nv">logger</span> <span class="nv">defaults</span> <span class="nv">to</span> <span class="nv">a</span> <span class="nv">high</span> <span class="nv">log</span> <span class="nv">level</span> <span class="nv">and</span> <span class="nv">hence</span> <span class="nv">has</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">explicitly</span> <span class="nv">set</span> <span class="nv">to</span> <span class="nv">info</span>.
#<span class="nv">Logger</span>.<span class="nv">new</span><span class="ss">(</span><span class="nv">PATH</span>,<span class="nv">NUM_FILES_TO_ROTATE</span>,<span class="nv">FILE_SIZE</span><span class="ss">)</span> <span class="nv">config</span>.<span class="nv">logger</span> <span class="o">=</span> <span class="nv">Logger</span>.<span class="nv">new</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">/path/to/logfile.log</span><span class="s1">&#39;</span>, <span class="mi">2</span>, <span class="mi">1000000</span><span class="ss">)</span>
 <span class="nv">config</span>.<span class="nv">logger</span>.<span class="nv">level</span> <span class="o">=</span> <span class="nv">Logger</span>::<span class="nv">INFO</span>

<span class="nv">Backups</span>

<span class="nv">Redmine</span> <span class="nv">backups</span> <span class="nv">should</span> <span class="k">include</span>:
<span class="nv">data</span> <span class="ss">(</span><span class="nv">stored</span> <span class="nv">in</span> <span class="nv">your</span> <span class="nv">redmine</span> <span class="nv">database</span><span class="ss">)</span>
<span class="nv">attachments</span> <span class="ss">(</span><span class="nv">stored</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">files</span> <span class="nv">directory</span> <span class="nv">of</span> <span class="nv">your</span> <span class="nv">Redmine</span> <span class="nv">install</span><span class="ss">)</span>
<span class="nv">Here</span> <span class="nv">is</span> <span class="nv">a</span> <span class="nv">simple</span> <span class="nv">shell</span> <span class="nv">script</span> <span class="nv">that</span> <span class="nv">can</span> <span class="nv">be</span> <span class="nv">used</span> <span class="k">for</span> <span class="nv">daily</span> <span class="nv">backups</span> <span class="ss">(</span><span class="nv">assuming</span> <span class="nv">you</span><span class="s1">&#39;</span><span class="s">re using a mysql database):</span>
# <span class="nv">Database</span> <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">mysqldump</span> <span class="o">-</span><span class="nv">u</span> <span class="o">&lt;</span><span class="nv">username</span><span class="o">&gt;</span> <span class="o">-</span><span class="nv">p</span><span class="o">&lt;</span><span class="nv">password</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="nv">redmine_database</span><span class="o">&gt;</span> <span class="o">|</span> 
<span class="nv">gzip</span> <span class="o">&gt;</span> <span class="o">/</span><span class="nv">path</span><span class="o">/</span><span class="nv">to</span><span class="o">/</span><span class="nv">backup</span><span class="o">/</span><span class="nv">db</span><span class="o">/</span><span class="nv">redmine_</span>`<span class="nv">date</span> <span class="o">+%</span><span class="nv">y_</span><span class="o">%</span><span class="nv">m_</span><span class="o">%</span><span class="nv">d</span>`.<span class="nv">gz</span> # <span class="nv">Attachments</span> 
<span class="nv">rsync</span> <span class="o">-</span><span class="nv">a</span> <span class="o">/</span><span class="nv">path</span><span class="o">/</span><span class="nv">to</span><span class="o">/</span><span class="nv">redmine</span><span class="o">/</span><span class="nv">files</span> <span class="o">/</span><span class="nv">path</span><span class="o">/</span><span class="nv">to</span><span class="o">/</span><span class="nv">backup</span><span class="o">/</span><span class="nv">files</span>
<span class="nv">Notes</span> <span class="nv">on</span> <span class="nv">Linux</span><span class="o">/</span><span class="nv">Unix</span> <span class="nv">installation</span>

<span class="nv">Be</span> <span class="nv">sure</span> <span class="nv">to</span> <span class="nv">disable</span> <span class="nv">security</span> <span class="nv">hardenning</span> <span class="nv">tools</span> <span class="nv">during</span> <span class="nv">the</span> <span class="nv">installation</span> <span class="nv">process</span> <span class="k">if</span> <span class="nv">you</span> <span class="nv">run</span> <span class="nv">into</span> <span class="nv">bizarre</span> 
<span class="nv">permission</span> <span class="nv">problems</span>. <span class="nv">These</span> <span class="nv">problems</span> <span class="nv">are</span> <span class="nv">mostly</span> <span class="nv">silent</span> <span class="nv">and</span> <span class="nv">can</span> <span class="nv">be</span> <span class="nv">caused</span> <span class="nv">by</span> <span class="nv">tools</span> <span class="nv">like</span> <span class="nv">extended</span> <span class="nv">ACLs</span>, 
<span class="nv">SELinux</span>, <span class="nv">or</span> <span class="nv">AppArmor</span>. <span class="nv">There</span> <span class="nv">tools</span> <span class="nv">are</span> <span class="nv">mostly</span> <span class="nv">used</span> <span class="nv">in</span> <span class="nv">big</span> <span class="nv">companies</span> <span class="nv">with</span> <span class="nv">a</span> <span class="nv">strict</span> <span class="nv">security</span> <span class="nv">policy</span>, 
<span class="nv">default</span> <span class="nv">Linux</span><span class="o">/</span><span class="nv">Unix</span> <span class="nv">distributions</span> <span class="nv">settings</span> <span class="nv">shouldn</span><span class="s1">&#39;</span><span class="s">t be a problem.</span>
<span class="nv">Notes</span> <span class="nv">on</span> <span class="nv">Windows</span> <span class="nv">installation</span>

<span class="nv">There</span> <span class="nv">is</span> <span class="nv">an</span> <span class="nv">prebuilt</span> <span class="nv">installer</span> <span class="nv">of</span> <span class="nv">Ruby</span> <span class="nv">MRI</span> <span class="nv">available</span> <span class="nv">from</span> <span class="nv">http</span>:<span class="o">//</span><span class="nv">rubyinstaller</span>.<span class="nv">org</span>.
<span class="nv">After</span> <span class="nv">installing</span> <span class="nv">it</span>, <span class="nv">select</span> <span class="nv">Start</span> <span class="nv">Command</span> <span class="nv">Prompt</span> <span class="nv">with</span> <span class="nv">Ruby</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">start</span> <span class="nv">menu</span>.
<span class="nv">Specifying</span> <span class="nv">the</span> <span class="nv">RAILS_ENV</span> <span class="nv">environment</span> <span class="nv">variable</span>:
<span class="nv">When</span> <span class="nv">running</span> <span class="nv">command</span> <span class="nv">as</span> <span class="nv">described</span> <span class="nv">in</span> <span class="nv">this</span> <span class="nv">guide</span>, <span class="nv">you</span> <span class="nv">have</span> <span class="nv">to</span> <span class="nv">set</span> <span class="nv">the</span> <span class="nv">RAILS_ENV</span> <span class="nv">environment</span> <span class="nv">variable</span> 
<span class="nv">using</span> <span class="nv">a</span> <span class="nv">separate</span> <span class="nv">command</span>.
<span class="nv">I</span>.<span class="nv">e</span>. <span class="nv">commands</span> <span class="nv">with</span> <span class="nv">the</span> <span class="nv">following</span> <span class="nv">syntaxes</span>:
<span class="nv">RAILS_ENV</span><span class="o">=</span><span class="nv">production</span> <span class="o">&lt;</span><span class="nv">any</span> <span class="nv">commmand</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nv">any</span> <span class="nv">commmand</span><span class="o">&gt;</span> <span class="nv">RAILS_ENV</span><span class="o">=</span><span class="nv">production</span>
<span class="nv">have</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">turned</span> <span class="nv">into</span> <span class="mi">2</span> <span class="nv">subsequent</span> <span class="nv">commands</span>:
<span class="nv">set</span> <span class="nv">RAILS_ENV</span><span class="o">=</span><span class="nv">production</span> <span class="o">&lt;</span><span class="nv">any</span> <span class="nv">commmand</span><span class="o">&gt;</span>
<span class="nv">MySQL</span> <span class="nv">gem</span> <span class="nv">installation</span> <span class="nv">issue</span>:
<span class="nv">You</span> <span class="nv">may</span> <span class="nv">need</span> <span class="nv">to</span> <span class="nv">manually</span> <span class="nv">install</span> <span class="nv">the</span> <span class="nv">mysql</span> <span class="nv">gem</span> <span class="nv">using</span> <span class="nv">the</span> <span class="nv">following</span> <span class="nv">command</span>:
<span class="nv">gem</span> <span class="nv">install</span> <span class="nv">mysql</span>
</pre></div>


<h2 id="cobbler">cobbler</h2>
<div class="codehilite"><pre><span></span><span class="nl">http</span><span class="p">:</span><span class="c1">//blog.chinaunix.net/uid-16728139-id-4174109.html</span>
<span class="err">关闭</span>  <span class="n">ipv6</span><span class="err">：</span>
<span class="n">cat</span> <span class="o">&lt;&lt;</span><span class="n">EOF</span><span class="o">&gt;&gt;/</span><span class="n">etc</span><span class="o">/</span><span class="n">modprobe</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">dist</span><span class="p">.</span><span class="n">conf</span>
<span class="n">alias</span> <span class="n">net</span><span class="o">-</span><span class="n">pf</span><span class="o">-</span><span class="mi">10</span> <span class="n">off</span>
<span class="n">alias</span> <span class="n">ipv6</span> <span class="n">off</span>
<span class="n">EOF</span>

<span class="n">yum</span> <span class="n">install</span> <span class="n">cobbler</span> <span class="n">cobbler</span><span class="o">-</span><span class="n">web</span> <span class="n">createrepo</span> <span class="n">yum</span><span class="o">-</span><span class="n">utils</span> <span class="n">dhcp</span> <span class="n">httpd</span>  <span class="n">tftp</span> <span class="n">cman</span> <span class="n">pykickstart</span> <span class="n">debmirror</span> <span class="o">-</span><span class="n">y</span>

<span class="err">二：配置环境</span>
<span class="mi">1</span><span class="o">&gt;</span><span class="err">修改</span><span class="n">cobbler</span> <span class="err">的配置文件</span>
    <span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">locahost</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">cobbler</span><span class="o">/</span><span class="n">settings</span>
    <span class="nl">next_server</span><span class="p">:</span> <span class="mf">10.3.3.31</span>
    <span class="nl">server</span><span class="p">:</span> <span class="mf">10.3.3.31</span>
    <span class="nl">manage_dhcp</span><span class="p">:</span> <span class="mi">1</span>
    <span class="nl">manage_rsync</span><span class="p">:</span> <span class="mi">1</span>
<span class="err">生成密码串</span><span class="o">:</span>
    <span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">locahost</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span>  <span class="n">openssl</span> <span class="n">passwd</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="n">salt</span> <span class="s">&quot;cobber&quot;</span> <span class="s">&quot;123456&quot;</span>
    <span class="n">$1$cobber$yV9XfOuaaiVDvImopK7o</span><span class="mf">.1</span>
<span class="n">openssl</span> <span class="n">passwd</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="n">salt</span> <span class="err">&#39;任间字符</span><span class="sc">&#39; &#39;</span><span class="err">密码&#39;</span>
<span class="err">这个命令的用法，任意字符可以随便写，这个密码就是安装完系统</span><span class="n">root</span><span class="err">的密码了。替换配置文件里的字串。</span>
    <span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">locahost</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">cobbler</span><span class="o">/</span><span class="n">settings</span>
    <span class="nl">default_password_crypted</span><span class="p">:</span> <span class="s">&quot;$1$cobber$yV9XfOuaaiVDvImopK7o.1&quot;</span>
<span class="mi">2</span><span class="o">&gt;</span><span class="err">启用</span><span class="n">tfpt</span> <span class="err">和</span> <span class="n">rsync</span>
    <span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">locahost</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">xinetd</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">tftp</span>    
    <span class="n">disable</span>                 <span class="o">=</span> <span class="n">no</span>
    <span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">locahost</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">xinetd</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">rsync</span>
    <span class="n">disable</span> <span class="o">=</span> <span class="n">no</span>
<span class="err">启动服务</span>
    <span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">locahost</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">xinetd</span> <span class="n">restart</span>
<span class="mi">3</span><span class="o">&gt;</span><span class="err">修改</span><span class="n">dhcp</span><span class="err">的配置文件</span>
    <span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">cobbler</span><span class="o">/</span><span class="n">dhcp</span><span class="p">.</span><span class="k">template</span>
<span class="n">subnet</span> <span class="mf">192.168.18.0</span> <span class="n">netmask</span> <span class="mf">255.255.255.0</span> <span class="p">{</span>
     <span class="n">option</span> <span class="n">routers</span>             <span class="mf">192.168.18.5</span><span class="p">;</span>
     <span class="n">option</span> <span class="n">domain</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">servers</span> <span class="mf">192.168.1.1</span><span class="p">;</span>
     <span class="n">option</span> <span class="n">subnet</span><span class="o">-</span><span class="n">mask</span>         <span class="mf">255.255.255.0</span><span class="p">;</span>
     <span class="n">range</span> <span class="n">dynamic</span><span class="o">-</span><span class="n">bootp</span>        <span class="mf">192.168.18.100</span> <span class="mf">192.168.18.254</span><span class="p">;</span>
     <span class="n">filename</span>                   <span class="s">&quot;/pxelinux.0&quot;</span><span class="p">;</span>
     <span class="k">default</span><span class="o">-</span><span class="n">lease</span><span class="o">-</span><span class="n">time</span>         <span class="mi">21600</span><span class="p">;</span>
     <span class="n">max</span><span class="o">-</span><span class="n">lease</span><span class="o">-</span><span class="n">time</span>             <span class="mi">43200</span><span class="p">;</span>
     <span class="n">next</span><span class="o">-</span><span class="n">server</span>                <span class="n">$next_server</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">locahost</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">debmirror</span><span class="p">.</span><span class="n">conf</span>
<span class="cp">#@dists=&quot;sid&quot;;</span>
<span class="err">@</span><span class="n">sections</span><span class="o">=</span><span class="s">&quot;main,main/debian-installer,contrib,non-free&quot;</span><span class="p">;</span>
<span class="cp">#@arches=&quot;i386&quot;;</span>

<span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">locahost</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">cobblerd</span> <span class="n">restart</span>
<span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">locahost</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">httpd</span> <span class="n">restart</span>
<span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">locahost</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">xinetd</span> <span class="n">restart</span>
<span class="cp">#[root@locahost ~]# /etc/init.d/dhcpd restart</span>

<span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">locahost</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">cobbler</span> <span class="n">get</span><span class="o">-</span><span class="n">loaders</span>
<span class="n">downloading</span> <span class="nl">http</span><span class="p">:</span><span class="c1">//cobbler.github.io/loaders/README to /var/lib/cobbler/loaders/README  (可以把文件放到这个目录)</span>
<span class="p">......</span>

<span class="err">三</span><span class="o">:</span><span class="err">配置</span><span class="n">web</span><span class="err">环境</span>
<span class="n">htdigest</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">cobbler</span><span class="o">/</span><span class="n">users</span><span class="p">.</span><span class="n">digest</span> <span class="s">&quot;Cobbler&quot;</span> <span class="n">cobbler</span>
<span class="nl">https</span><span class="p">:</span><span class="c1">//ip/cobbler_web</span>


<span class="mi">1</span><span class="err">：添加</span><span class="n">DVD</span><span class="err">源，</span>
    <span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">locahost</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">cdrom</span>
    <span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">locahost</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">mount</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">cdrom</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">cdrom</span><span class="o">/</span>
    <span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">locahost</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">cobbler</span> <span class="n">import</span> <span class="o">--</span><span class="n">path</span><span class="o">=/</span><span class="n">mnt</span><span class="o">/</span><span class="n">cdrom</span><span class="o">/</span> <span class="o">--</span><span class="n">name</span><span class="o">=</span><span class="n">centos6</span><span class="mf">.4</span> <span class="o">--</span><span class="n">arch</span><span class="o">=</span><span class="n">x86_64</span>
    <span class="n">cd</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">cobbler</span><span class="o">/</span><span class="n">kickstarts</span><span class="o">/</span>
       <span class="n">cp</span> <span class="n">sample_end</span><span class="p">.</span><span class="n">ks</span> <span class="n">centos6</span><span class="p">.</span><span class="n">ks</span>
    <span class="n">cobbler</span> <span class="n">profile</span> <span class="n">profile</span> <span class="n">edit</span> <span class="o">--</span><span class="n">name</span><span class="o">=</span><span class="n">centos6</span><span class="mf">.4</span> <span class="o">--</span><span class="n">distro</span><span class="o">=</span><span class="n">centos6</span><span class="mf">.4</span> <span class="o">--</span><span class="n">kickstart</span><span class="o">=/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">cobbler</span><span class="o">/</span><span class="n">kickstarts</span><span class="o">/</span><span class="n">centos6</span><span class="p">.</span><span class="n">ks</span>
    <span class="n">cobbler</span> <span class="n">report</span>
    <span class="n">cobbler</span> <span class="n">sync</span>

<span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">locahost</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">cobblerd</span> <span class="n">restart</span>
<span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">locahost</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">cobbler</span> <span class="n">sync</span>


<span class="err">直接部署单一系统，不用手选择：</span>
<span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">cobbler</span><span class="o">/</span><span class="n">pxe</span><span class="o">/</span><span class="n">pxedefault</span><span class="p">.</span><span class="k">template</span>
    <span class="n">DEFAULT</span> <span class="n">menu</span><span class="err">（改为安装的系统名称）</span>


    <span class="err">创建</span><span class="n">kickstarts</span><span class="err">自动安装：</span>
    <span class="n">cd</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">cobbler</span><span class="o">/</span><span class="n">kickstarts</span>  <span class="err">#进入默认</span><span class="n">Kickstart</span><span class="err">模板目录</span>

<span class="n">vi</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">cobbler</span><span class="o">/</span><span class="n">kickstarts</span><span class="o">/</span><span class="n">CentOS</span><span class="o">-</span><span class="mf">5.10</span><span class="o">-</span><span class="n">x86_64</span><span class="p">.</span><span class="n">ks</span>  <span class="err">#创建</span><span class="n">CentOS</span><span class="o">-</span><span class="mf">5.10</span><span class="o">-</span><span class="n">x86_64</span><span class="err">安装脚本</span>
<span class="cp"># Kickstart file automatically generated by anaconda.</span>
<span class="n">install</span>
<span class="n">url</span> <span class="o">--</span><span class="n">url</span><span class="o">=</span><span class="nl">http</span><span class="p">:</span><span class="c1">//192.168.21.128/cobbler/ks_mirror/CentOS-5.10-x86_64-x86_64/</span>
<span class="n">lang</span> <span class="n">en_US</span><span class="p">.</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span>
<span class="n">zerombr</span>  <span class="n">yes</span>
<span class="n">key</span> <span class="o">--</span><span class="n">skip</span>
<span class="n">keyboard</span> <span class="n">us</span>
<span class="n">network</span> <span class="o">--</span><span class="n">device</span> <span class="n">eth0</span> <span class="o">--</span><span class="n">bootproto</span> <span class="n">dhcp</span>  <span class="o">--</span><span class="n">onboot</span> <span class="n">on</span>
<span class="cp">#network --device eth0 --bootproto static --ip 192.168.21.250 --netmask 255.255.255.0 --gateway 192.168.21.2 </span>
<span class="o">--</span><span class="n">nameserver</span> <span class="mf">8.8.8.8</span> <span class="o">--</span><span class="n">hostname</span> <span class="n">CentOS5</span><span class="mf">.10</span>
<span class="n">rootpw</span> <span class="o">--</span><span class="n">iscrypted</span> <span class="n">$1$QqobZZ1g$rYnrawi9kYlEeUuq1vcRS</span><span class="o">/</span>
<span class="n">firewall</span> <span class="o">--</span><span class="n">enabled</span> <span class="o">--</span><span class="n">port</span><span class="o">=</span><span class="mi">22</span><span class="o">:</span><span class="n">tcp</span>
<span class="n">authconfig</span> <span class="o">--</span><span class="n">enableshadow</span> <span class="o">--</span><span class="n">enablemd5</span>
<span class="n">selinux</span> <span class="o">--</span><span class="n">disabled</span>
<span class="n">timezone</span> <span class="n">Asia</span><span class="o">/</span><span class="n">Shanghai</span>
<span class="n">bootloader</span> <span class="o">--</span><span class="n">location</span><span class="o">=</span><span class="n">mbr</span> <span class="o">--</span><span class="n">driveorder</span><span class="o">=</span><span class="n">sda</span>
<span class="cp"># The following is the partition information you requested</span>
<span class="cp"># Note that any partitions you deleted are not expressed</span>
<span class="cp"># here so unless you clear all partitions first, this is</span>
<span class="cp"># not guaranteed to work</span>
<span class="cp">#clearpart --linux</span>
<span class="n">clearpart</span> <span class="o">--</span><span class="n">all</span> <span class="o">--</span><span class="n">initlabel</span>
<span class="n">part</span> <span class="o">/</span> <span class="o">--</span><span class="n">bytes</span><span class="o">-</span><span class="n">per</span><span class="o">-</span><span class="n">inode</span><span class="o">=</span><span class="mi">4096</span> <span class="o">--</span><span class="n">fstype</span><span class="o">=</span><span class="s">&quot;ext3&quot;</span> <span class="o">--</span><span class="n">size</span><span class="o">=</span><span class="mi">2048</span>
<span class="n">part</span> <span class="o">/</span><span class="n">boot</span> <span class="o">--</span><span class="n">bytes</span><span class="o">-</span><span class="n">per</span><span class="o">-</span><span class="n">inode</span><span class="o">=</span><span class="mi">4096</span> <span class="o">--</span><span class="n">fstype</span><span class="o">=</span><span class="s">&quot;ext3&quot;</span> <span class="o">--</span><span class="n">size</span><span class="o">=</span><span class="mi">128</span>
<span class="n">part</span> <span class="n">swap</span> <span class="o">--</span><span class="n">bytes</span><span class="o">-</span><span class="n">per</span><span class="o">-</span><span class="n">inode</span><span class="o">=</span><span class="mi">4096</span> <span class="o">--</span><span class="n">fstype</span><span class="o">=</span><span class="s">&quot;swap&quot;</span> <span class="o">--</span><span class="n">size</span><span class="o">=</span><span class="mi">500</span>
<span class="n">part</span> <span class="o">/</span><span class="n">data</span> <span class="o">--</span><span class="n">bytes</span><span class="o">-</span><span class="n">per</span><span class="o">-</span><span class="n">inode</span><span class="o">=</span><span class="mi">4096</span> <span class="o">--</span><span class="n">fstype</span><span class="o">=</span><span class="s">&quot;ext3&quot;</span> <span class="o">--</span><span class="n">grow</span> <span class="o">--</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span>
<span class="n">reboot</span>
<span class="nf">%packages</span>
<span class="n">ntp</span>
<span class="err">@</span><span class="n">base</span>
<span class="err">@</span><span class="n">core</span>
<span class="err">@</span><span class="n">dialup</span>
<span class="err">@</span><span class="n">editors</span>
<span class="err">@</span><span class="n">text</span><span class="o">-</span><span class="n">internet</span>
<span class="n">keyutils</span>
<span class="n">trousers</span> 
<span class="n">fipscheck</span>
<span class="n">device</span><span class="o">-</span><span class="n">mapper</span><span class="o">-</span><span class="n">multipath</span>
<span class="nf">%post</span>
<span class="cp">#同步系统时间</span>
<span class="n">ntpdate</span> <span class="n">cn</span><span class="p">.</span><span class="n">pool</span><span class="p">.</span><span class="n">ntp</span><span class="p">.</span><span class="n">org</span>
<span class="n">hwclock</span> <span class="o">--</span><span class="n">systohc</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;0 1 * * * root /usr/sbin/ntpdate cn.pool.ntp.org &gt; /dev/null&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">crontab</span>
<span class="n">service</span> <span class="n">crond</span> <span class="n">restart</span>
<span class="cp">#禁止root用户直接登录系统</span>

<span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s">&quot;s/#PermitRootLogin yes/PermitRootLogin no/g&quot;</span> <span class="err">&#39;</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/</span><span class="n">sshd_config</span><span class="err">&#39;</span>

<span class="n">service</span> <span class="n">sshd</span> <span class="n">restart</span>

<span class="cp">#禁止开机启动的服务</span>
<span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="err">`</span><span class="n">chkconfig</span> <span class="o">--</span><span class="n">list</span> <span class="o">|</span> <span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span><span class="n">print</span> <span class="n">$1</span><span class="p">}</span><span class="err">&#39;`</span><span class="p">;</span><span class="k">do</span>
    <span class="k">if</span> <span class="p">[[</span> <span class="n">$i</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">atd</span><span class="err">&#39;</span> <span class="o">||</span> <span class="n">$i</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">crond</span><span class="err">&#39;</span> <span class="o">||</span> <span class="n">$i</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">irqbalance</span><span class="err">&#39;</span> <span class="o">||</span> <span class="n">$i</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">network</span><span class="err">&#39;</span> <span class="o">||</span> <span class="n">$i</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">sshd</span><span class="err">&#39;</span> <span class="o">||</span> <span class="n">$i</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">rsyslog</span><span class="err">&#39;</span> <span class="o">||</span> 
    <span class="n">$i</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">httpd</span><span class="err">&#39;</span> <span class="o">||</span> <span class="n">$i</span> <span class="o">=</span> <span class="n">salt</span><span class="o">-*</span> <span class="o">||</span> <span class="n">$i</span> <span class="o">=</span> <span class="n">zabbix_</span><span class="o">*</span> <span class="p">]];</span><span class="n">then</span>
        <span class="n">chkconfig</span> <span class="o">--</span><span class="n">level</span> <span class="mi">3</span> <span class="n">$i</span> <span class="n">on</span>
    <span class="k">else</span>
        <span class="n">chkconfig</span> <span class="n">$i</span> <span class="n">off</span>
    <span class="n">fi</span>
<span class="n">done</span>
<span class="n">grep</span> <span class="o">-</span><span class="n">v</span> <span class="s">&quot;^#&quot;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/</span><span class="n">sshd_config</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">v</span> <span class="s">&quot;^$&quot;</span> <span class="o">|</span> <span class="n">grep</span> <span class="s">&quot;^UseDNS no&quot;</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
<span class="k">if</span> <span class="p">[[</span> <span class="err">$</span><span class="o">?</span> <span class="o">-</span><span class="n">ne</span> <span class="mi">0</span> <span class="p">]];</span><span class="n">then</span>
    <span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="err">&#39;</span><span class="mi">122</span><span class="n">a</span><span class="err">\</span><span class="n">UseDNS</span> <span class="n">no</span><span class="err">&#39;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/</span><span class="n">sshd_config</span>
    <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">sshd</span> <span class="n">restart</span>
<span class="n">fi</span>
<span class="n">cat</span>  <span class="o">&gt;&gt;/</span><span class="n">etc</span><span class="o">/</span><span class="n">profile</span><span class="o">&lt;&lt;</span><span class="n">EOF</span>
<span class="k">if</span> <span class="p">[</span> <span class="n">$SHELL</span> <span class="o">=</span> <span class="s">&quot;/bin/ksh&quot;</span> <span class="p">];</span> <span class="n">then</span>
     <span class="n">ulimit</span> <span class="o">-</span><span class="n">p</span> <span class="mi">16384</span>
     <span class="n">ulimit</span> <span class="o">-</span><span class="n">n</span> <span class="mi">65536</span>
     <span class="n">ulimit</span> <span class="o">-</span><span class="n">c</span> <span class="n">unlimited</span>
<span class="k">else</span>
     <span class="n">ulimit</span> <span class="o">-</span><span class="n">u</span> <span class="mi">16384</span> <span class="o">-</span><span class="n">n</span> <span class="mi">65536</span> <span class="o">-</span><span class="n">c</span> <span class="n">unlimited</span>
<span class="n">fi</span>
<span class="n">EOF</span>

<span class="n">source</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">profile</span>

<span class="cp">##set ulimit file</span>
<span class="n">cat</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">security</span><span class="o">/</span><span class="n">limits</span><span class="p">.</span><span class="n">conf</span><span class="o">&lt;&lt;</span><span class="n">EOF</span>
<span class="o">*</span>           <span class="n">soft</span>    <span class="n">nproc</span>   <span class="mi">10000</span>
<span class="o">*</span>          <span class="n">hard</span>    <span class="n">nproc</span>   <span class="mi">16384</span>
<span class="o">*</span>           <span class="n">soft</span>    <span class="n">nofile</span>   <span class="mi">65536</span>
<span class="o">*</span>           <span class="n">hard</span>    <span class="n">nofile</span>  <span class="mi">65536</span>
<span class="n">EOF</span>
<span class="cp">#禁止使用Ctrl+Alt+Del快捷键重启服务器</span>
<span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s">&quot;s/ca::ctrlaltdel:\/sbin\/shutdown -t3 -r now/#ca::ctrlaltdel:\/sbin\/shutdown -t3 -r now/g&quot;</span> <span class="err">&#39;</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">inittab</span><span class="err">&#39;</span>

<span class="cp">#优化系统内核</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;ulimit -c unlimited&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">profile</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;ulimit -s unlimited&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">profile</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;ulimit -SHn 65535&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">profile</span>
<span class="n">source</span>  <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">profile</span>
<span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s">&quot;s/net.ipv4.ip_forward = 0/net.ipv4.ip_forward = 1/g&quot;</span> <span class="err">&#39;</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span><span class="err">&#39;</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;net.core.somaxconn = 262144&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;net.core.netdev_max_backlog = 262144&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;net.core.wmem_default = 8388608&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;net.core.rmem_default = 8388608&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;net.core.rmem_max = 16777216&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;net.core.wmem_max = 16777216&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;net.ipv4.netfilter.ip_conntrack_max = 131072&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;net.ipv4.netfilter.ip_conntrack_tcp_timeout_established = 180&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;net.ipv4.route.gc_timeout = 20&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;net.ipv4.ip_conntrack_max = 819200&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;net.ipv4.ip_local_port_range = 10024  65535&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;net.ipv4.tcp_retries2 = 5&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;net.ipv4.tcp_fin_timeout = 30&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;net.ipv4.tcp_syn_retries = 1&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;net.ipv4.tcp_synack_retries = 1&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;net.ipv4.tcp_timestamps = 0&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;net.ipv4.tcp_tw_recycle = 1&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;net.ipv4.tcp_tw_len = 1&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;net.ipv4.tcp_tw_reuse = 1&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;net.ipv4.tcp_keepalive_time = 120&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;net.ipv4.tcp_keepalive_probes = 3&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;net.ipv4.tcp_keepalive_intvl = 15&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;net.ipv4.tcp_max_tw_buckets = 36000&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;net.ipv4.tcp_max_orphans = 3276800&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;net.ipv4.tcp_max_syn_backlog = 262144&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;net.ipv4.tcp_wmem = 8192 131072 16777216&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;net.ipv4.tcp_rmem = 32768 131072 16777216&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;net.ipv4.tcp_mem = 94500000 915000000 927000000&quot;</span>  <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span>
<span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">sysctl</span> <span class="o">-</span><span class="n">p</span>
<span class="cp">#执行外部脚本</span>
<span class="n">cd</span> <span class="o">/</span><span class="n">root</span>
<span class="n">wget</span> <span class="nl">http</span><span class="p">:</span><span class="c1">//192.168.21.128/cobbler/ks_mirror/config/autoip.sh</span>
<span class="n">sh</span> <span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">autoip</span><span class="p">.</span><span class="n">sh</span>


<span class="n">vi</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">cobbler</span><span class="o">/</span><span class="n">ks_mirror</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">autoip</span><span class="p">.</span><span class="n">sh</span>  <span class="err">#创建脚本，自动设置</span><span class="n">Linux</span><span class="err">系统静态</span><span class="n">IP</span><span class="err">地址、</span><span class="n">DNS</span><span class="err">、网关、计算机名称</span>
<span class="cp">#!/bin/sh</span>
<span class="n">ROUTE</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">route</span> <span class="o">-</span><span class="n">n</span><span class="o">|</span><span class="n">grep</span> <span class="s">&quot;^0.0.0.0&quot;</span><span class="o">|</span><span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span><span class="n">print</span> <span class="n">$2</span><span class="p">}</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">BROADCAST</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">ifconfig</span> <span class="n">eth0</span><span class="o">|</span><span class="n">grep</span> <span class="o">-</span><span class="n">i</span> <span class="n">bcast</span><span class="o">|</span><span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span><span class="n">print</span> <span class="n">$3</span><span class="p">}</span><span class="err">&#39;</span><span class="o">|</span><span class="n">awk</span> <span class="o">-</span><span class="n">F</span><span class="s">&quot;:&quot;</span> <span class="err">&#39;</span><span class="p">{</span><span class="n">print</span> <span class="n">$2</span><span class="p">}</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">HWADDR</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">ifconfig</span> <span class="n">eth0</span><span class="o">|</span><span class="n">grep</span> <span class="o">-</span><span class="n">i</span> <span class="n">HWaddr</span><span class="o">|</span><span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span><span class="n">print</span> <span class="n">$5</span><span class="p">}</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">IPADDR</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">ifconfig</span> <span class="n">eth0</span><span class="o">|</span><span class="n">grep</span> <span class="s">&quot;inet addr&quot;</span><span class="o">|</span><span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span><span class="n">print</span> <span class="n">$2</span><span class="p">}</span><span class="err">&#39;</span><span class="o">|</span><span class="n">awk</span> <span class="o">-</span><span class="n">F</span><span class="s">&quot;:&quot;</span> <span class="err">&#39;</span><span class="p">{</span><span class="n">print</span> <span class="n">$2</span><span class="p">}</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">NETMASK</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">ifconfig</span> <span class="n">eth0</span><span class="o">|</span><span class="n">grep</span> <span class="s">&quot;inet addr&quot;</span><span class="o">|</span><span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span><span class="n">print</span> <span class="n">$4</span><span class="p">}</span><span class="err">&#39;</span><span class="o">|</span><span class="n">awk</span> <span class="o">-</span><span class="n">F</span><span class="s">&quot;:&quot;</span> <span class="err">&#39;</span><span class="p">{</span><span class="n">print</span> <span class="n">$2</span><span class="p">}</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">cat</span> <span class="o">&gt;/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysconfig</span><span class="o">/</span><span class="n">network</span><span class="o">-</span><span class="n">scripts</span><span class="o">/</span><span class="n">ifcfg</span><span class="o">-</span><span class="n">eth0</span><span class="o">&lt;&lt;</span><span class="n">EOF</span>
<span class="n">DEVICE</span><span class="o">=</span><span class="n">eth0</span>
<span class="n">BOOTPROTO</span><span class="o">=</span><span class="k">static</span>
<span class="n">BROADCAST</span><span class="o">=</span><span class="n">$BROADCAST</span>
<span class="n">HWADDR</span><span class="o">=</span><span class="n">$HWADDR</span>
<span class="n">IPADDR</span><span class="o">=</span><span class="n">$IPADDR</span>
<span class="n">NETMASK</span><span class="o">=</span><span class="n">$NETMASK</span>
<span class="n">GATEWAY</span><span class="o">=</span><span class="n">$ROUTE</span>
<span class="n">ONBOOT</span><span class="o">=</span><span class="n">yes</span>
<span class="n">EOF</span>
<span class="n">IPADDR1</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">echo</span> <span class="n">$IPADDR</span><span class="o">|</span><span class="n">awk</span> <span class="o">-</span><span class="n">F</span><span class="s">&quot;.&quot;</span> <span class="err">&#39;</span><span class="p">{</span><span class="n">print</span> <span class="n">$4</span><span class="p">}</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">cat</span> <span class="o">&gt;/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysconfig</span><span class="o">/</span><span class="n">network</span><span class="o">-</span><span class="n">scripts</span><span class="o">/</span><span class="n">ifcfg</span><span class="o">-</span><span class="n">eth1</span><span class="o">&lt;&lt;</span><span class="n">EOF</span>
<span class="n">DEVICE</span><span class="o">=</span><span class="n">eth1</span>
<span class="n">BOOTPROTO</span><span class="o">=</span><span class="k">static</span>
<span class="n">BROADCAST</span><span class="o">=</span><span class="mf">10.0.0.255</span>
<span class="n">HWADDR</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">ifconfig</span> <span class="n">eth1</span><span class="o">|</span><span class="n">grep</span> <span class="o">-</span><span class="n">i</span> <span class="n">HWaddr</span><span class="o">|</span><span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span><span class="n">print</span> <span class="n">$5</span><span class="p">}</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">IPADDR</span><span class="o">=</span><span class="mf">10.0.0</span><span class="p">.</span><span class="n">$IPADDR1</span>
<span class="n">NETMASK</span><span class="o">=</span><span class="mf">255.255.255.0</span>
<span class="n">ONBOOT</span><span class="o">=</span><span class="n">yes</span>
<span class="n">EOF</span>
<span class="n">HOSTNAME</span><span class="o">=</span><span class="n">OsYunWei_HZ_</span><span class="err">$</span><span class="p">(</span><span class="n">echo</span> <span class="n">$IPADDR</span><span class="o">|</span><span class="n">awk</span> <span class="o">-</span><span class="n">F</span><span class="s">&quot;.&quot;</span> <span class="err">&#39;</span><span class="p">{</span><span class="n">print</span> <span class="n">$4</span><span class="p">}</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">cat</span> <span class="o">&gt;/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysconfig</span><span class="o">/</span><span class="n">network</span><span class="o">&lt;&lt;</span><span class="n">EOF</span>
<span class="n">NETWORKING</span><span class="o">=</span><span class="n">yes</span>
<span class="n">NETWORKING_IPV6</span><span class="o">=</span><span class="n">no</span>
<span class="n">HOSTNAME</span><span class="o">=</span><span class="n">$HOSTNAME</span>
<span class="n">GATEWAY</span><span class="o">=</span><span class="n">$ROUTE</span>
<span class="n">EOF</span>
<span class="n">echo</span> <span class="s">&quot;127.0.0.1  $HOSTNAME&quot;</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">hosts</span>
<span class="n">hostname</span><span class="o">=</span><span class="n">$HOSTNAME</span>
<span class="n">echo</span> <span class="s">&quot;nameserver  8.8.8.8&quot;</span>  <span class="o">&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">resolv</span><span class="p">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="s">&quot;nameserver  8.8.4.4&quot;</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">resolv</span><span class="p">.</span><span class="n">conf</span>
</pre></div>


<h2 id="tcpcopy">tcpcopy</h2>
<div class="codehilite"><pre><span></span><span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="k">session</span><span class="o">-</span><span class="n">replay</span><span class="o">-</span><span class="n">tools</span><span class="o">/</span><span class="n">intercept</span><span class="o">/</span><span class="n">archive</span><span class="o">/</span><span class="n">master</span><span class="p">.</span><span class="n">zip</span>
<span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="k">session</span><span class="o">-</span><span class="n">replay</span><span class="o">-</span><span class="n">tools</span><span class="o">/</span><span class="n">tcpcopy</span><span class="o">/</span><span class="n">archive</span><span class="o">/</span><span class="n">master</span><span class="p">.</span><span class="n">zip</span>

<span class="n">tomcat</span><span class="err">要配置</span><span class="k">session</span><span class="err">共享，测试服务器连接存储</span><span class="k">session</span><span class="err">的</span><span class="n">redis</span><span class="err">的备库，否则会有很多问题出现。</span>

<span class="err">复制源服务器安装</span><span class="n">tcpcopy</span>  <span class="n">ip</span> <span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="mi">6</span>
<span class="p">.</span><span class="o">/</span><span class="n">configure</span>
<span class="n">make</span> <span class="o">&amp;&amp;</span> <span class="n">make</span> <span class="n">install</span>

<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="k">local</span><span class="o">/</span><span class="n">tcpcopy</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">tcpcopy</span> <span class="o">-</span><span class="n">x</span> <span class="mi">8180</span><span class="o">-</span><span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="mi">3</span><span class="p">:</span><span class="mi">8080</span> <span class="o">-</span><span class="n">s</span> <span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="mi">3</span> <span class="o">-</span><span class="k">c</span> <span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="mi">6</span>
<span class="err">配置防火墙，拒绝响应</span>  <span class="n">iptables</span> <span class="o">-</span><span class="n">I</span> <span class="k">INPUT</span> <span class="o">-</span><span class="n">s</span> <span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="mi">3</span> <span class="o">-</span><span class="n">p</span> <span class="n">tcp</span> <span class="c1">--sport 8080-j DROP</span>
<span class="o">#</span><span class="n">tcpdump</span><span class="err">可以抓到回包，其实并没有真正收到，</span><span class="n">tcpdump</span><span class="err">一般抓包是在数据链路层抓的，</span><span class="n">iptables</span><span class="err">是在</span><span class="n">ip</span><span class="err">层</span><span class="k">drop</span><span class="err">掉响应包，</span>
<span class="err">而响应包先到数据链路层，再往上到达</span><span class="n">ip</span><span class="err">层，所以响应包会经过数据链路层，</span><span class="n">tcpdump</span><span class="err">能够抓到也正常，抓不到才不正常</span>
<span class="err">复制</span><span class="mi">8180</span><span class="err">端口应用的请求到</span> <span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="mi">3</span><span class="err">上面的</span><span class="mi">8080</span><span class="err">端口，</span>
<span class="o">-</span><span class="n">s</span>     <span class="n">intercept</span><span class="err">服务器地址</span>
<span class="o">-</span><span class="n">n</span> <span class="mi">3</span> <span class="err">复制</span><span class="mi">3</span> <span class="err">倍的流量过去</span>
<span class="o">-</span><span class="k">c</span>     <span class="err">修改源</span><span class="n">IP</span><span class="err">地址</span><span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="err">为</span> <span class="mi">62</span><span class="p">.</span><span class="mi">135</span><span class="p">.</span><span class="mi">200</span><span class="p">.</span><span class="n">x</span><span class="err">地址</span>  

<span class="o">==============</span>
<span class="err">测试服务器安装</span><span class="n">intercept</span>  <span class="n">ip</span> <span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="mi">3</span>   <span class="err">不要开启</span><span class="n">ip_forward</span>
<span class="n">yum</span> <span class="n">install</span> <span class="n">libpcap</span><span class="o">-</span><span class="n">devel</span> <span class="o">-</span><span class="n">y</span>
<span class="p">.</span><span class="o">/</span><span class="n">configure</span>
<span class="n">make</span> <span class="o">&amp;&amp;</span> <span class="n">make</span> <span class="n">install</span>

<span class="p">.</span><span class="o">/</span><span class="n">intercept</span> <span class="o">-</span><span class="n">i</span> <span class="n">eth0</span> <span class="o">-</span><span class="n">F</span> <span class="s1">&#39;tcp and src port 8080&#39;</span> <span class="o">-</span><span class="n">d</span>     <span class="n">tomcat</span><span class="err">不要配置</span><span class="k">session</span><span class="err">共享</span>
<span class="o">-</span><span class="n">d</span> <span class="err">后台模式</span>
<span class="o">-</span><span class="n">F</span> <span class="err">过滤包</span>
</pre></div>


<h2 id="ffmpeng">ffmpeng</h2>
<div class="codehilite"><pre><span></span>二进制版  <span class="nv">http</span>:<span class="o">//</span><span class="nv">johnvansickle</span>.<span class="nv">com</span><span class="o">/</span><span class="nv">ffmpeg</span><span class="o">/</span>
<span class="nv">wget</span> <span class="nv">http</span>:<span class="o">//</span><span class="nv">johnvansickle</span>.<span class="nv">com</span><span class="o">/</span><span class="nv">ffmpeg</span><span class="o">/</span><span class="nv">builds</span><span class="o">/</span><span class="nv">ffmpeg</span><span class="o">-</span><span class="nv">git</span><span class="o">-</span><span class="mi">64</span><span class="nv">bit</span><span class="o">-</span><span class="nv">static</span>.<span class="nv">tar</span>.<span class="nv">xz</span>


出自  <span class="nv">http</span>:<span class="o">//</span><span class="nv">www</span>.<span class="nv">yaosansi</span>.<span class="nv">com</span><span class="o">/</span><span class="nv">post</span><span class="o">/</span><span class="nv">ffmpeg</span><span class="o">-</span><span class="nv">on</span><span class="o">-</span><span class="nv">centos</span><span class="o">/</span>
安装<span class="nv">epel</span>，<span class="nv">rpmforce</span>源

依赖
<span class="nv">yum</span> <span class="o">-</span><span class="nv">y</span> <span class="nv">install</span> <span class="nv">glibc</span> <span class="nv">gcc</span> <span class="nv">gcc</span><span class="o">-</span><span class="nv">c</span><span class="o">++</span> <span class="nv">autoconf</span> <span class="nv">automake</span> <span class="nv">libtool</span> <span class="nv">git</span> <span class="nv">make</span> <span class="nv">nasm</span> <span class="nv">pkgconfig</span> <span class="nv">SDL</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">a52dec</span> <span class="nv">a52dec</span><span class="o">-</span><span class="nv">devel</span> 
<span class="nv">alsa</span><span class="o">-</span><span class="nv">lib</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">faac</span> <span class="nv">faac</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">faad2</span> <span class="nv">faad2</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">freetype</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">giflib</span> <span class="nv">gsm</span> <span class="nv">gsm</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">imlib2</span> <span class="nv">imlib2</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">lame</span>
 <span class="nv">lame</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">libICE</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">libSM</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">libX11</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">libXau</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">libXdmcp</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">libXext</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">libXrandr</span><span class="o">-</span><span class="nv">devel</span> 
 <span class="nv">libXrender</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">libXt</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">libogg</span> <span class="nv">libvorbis</span> <span class="nv">vorbis</span><span class="o">-</span><span class="nv">tools</span> <span class="nv">mesa</span><span class="o">-</span><span class="nv">libGL</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">mesa</span><span class="o">-</span><span class="nv">libGLU</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">xorg</span><span class="o">-</span><span class="nv">x11</span><span class="o">-</span><span class="nv">proto</span><span class="o">-</span><span class="nv">devel</span>
  <span class="nv">zlib</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">libtheora</span> <span class="nv">theora</span><span class="o">-</span><span class="nv">tools</span> <span class="nv">ncurses</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">libdc1394</span> <span class="nv">libdc1394</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">amrnb</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">amrwb</span><span class="o">-</span><span class="nv">devel</span> <span class="nv">opencore</span><span class="o">-</span><span class="nv">amr</span><span class="o">-</span><span class="nv">devel</span>


<span class="nv">cd</span> <span class="o">/</span><span class="nv">opt</span>
<span class="nv">wget</span> <span class="nv">http</span>:<span class="o">//</span><span class="nv">downloads</span>.<span class="nv">xvid</span>.<span class="nv">org</span><span class="o">/</span><span class="nv">downloads</span><span class="o">/</span><span class="nv">xvidcore</span><span class="o">-</span><span class="mi">1</span>.<span class="mi">3</span>.<span class="mi">2</span>.<span class="nv">tar</span>.<span class="nv">gz</span>
<span class="nv">tar</span> <span class="nv">xzvf</span> <span class="nv">xvidcore</span><span class="o">-</span><span class="mi">1</span>.<span class="mi">3</span>.<span class="mi">2</span>.<span class="nv">tar</span>.<span class="nv">gz</span> <span class="o">&amp;&amp;</span> <span class="nv">rm</span> <span class="o">-</span><span class="nv">f</span> <span class="nv">xvidcore</span><span class="o">-</span><span class="mi">1</span>.<span class="mi">3</span>.<span class="mi">2</span>.<span class="nv">tar</span>.<span class="nv">gz</span>
<span class="nv">cd</span> <span class="nv">xvidcore</span><span class="o">/</span><span class="nv">build</span><span class="o">/</span><span class="nv">generic</span>
.<span class="o">/</span><span class="nv">configure</span> <span class="o">--</span><span class="nv">prefix</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">$HOME/ffmpeg_build</span><span class="s2">&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">make</span> <span class="o">&amp;&amp;</span> <span class="nv">make</span> <span class="nv">install</span>

<span class="nv">cd</span> <span class="o">/</span><span class="nv">opt</span>
<span class="nv">wget</span> <span class="nv">http</span>:<span class="o">//</span><span class="nv">downloads</span>.<span class="nv">xiph</span>.<span class="nv">org</span><span class="o">/</span><span class="nv">releases</span><span class="o">/</span><span class="nv">ogg</span><span class="o">/</span><span class="nv">libogg</span><span class="o">-</span><span class="mi">1</span>.<span class="mi">3</span>.<span class="mi">1</span>.<span class="nv">tar</span>.<span class="nv">gz</span>
<span class="nv">tar</span> <span class="nv">xzvf</span> <span class="nv">libogg</span><span class="o">-</span><span class="mi">1</span>.<span class="mi">3</span>.<span class="mi">1</span>.<span class="nv">tar</span>.<span class="nv">gz</span> <span class="o">&amp;&amp;</span> <span class="nv">rm</span> <span class="o">-</span><span class="nv">f</span> <span class="nv">libogg</span><span class="o">-</span><span class="mi">1</span>.<span class="mi">3</span>.<span class="mi">1</span>.<span class="nv">tar</span>.<span class="nv">gz</span>
<span class="nv">cd</span> <span class="nv">libogg</span><span class="o">-</span><span class="mi">1</span>.<span class="mi">3</span>.<span class="mi">1</span>
.<span class="o">/</span><span class="nv">configure</span> <span class="o">--</span><span class="nv">prefix</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">$HOME/ffmpeg_build</span><span class="s2">&quot;</span> <span class="o">--</span><span class="nv">disable</span><span class="o">-</span><span class="nv">shared</span> <span class="o">&amp;&amp;</span> <span class="nv">make</span> <span class="o">&amp;&amp;</span> <span class="nv">make</span> <span class="nv">install</span>

<span class="nv">cd</span> <span class="o">/</span><span class="nv">opt</span>
<span class="nv">wget</span> <span class="nv">http</span>:<span class="o">//</span><span class="nv">downloads</span>.<span class="nv">xiph</span>.<span class="nv">org</span><span class="o">/</span><span class="nv">releases</span><span class="o">/</span><span class="nv">vorbis</span><span class="o">/</span><span class="nv">libvorbis</span><span class="o">-</span><span class="mi">1</span>.<span class="mi">3</span>.<span class="mi">4</span>.<span class="nv">tar</span>.<span class="nv">gz</span>
<span class="nv">tar</span> <span class="nv">xzvf</span> <span class="nv">libvorbis</span><span class="o">-</span><span class="mi">1</span>.<span class="mi">3</span>.<span class="mi">4</span>.<span class="nv">tar</span>.<span class="nv">gz</span> <span class="o">&amp;&amp;</span> <span class="nv">rm</span> <span class="o">-</span><span class="nv">f</span> <span class="nv">libvorbis</span><span class="o">-</span><span class="mi">1</span>.<span class="mi">3</span>.<span class="mi">4</span>.<span class="nv">tar</span>.<span class="nv">gz</span>
<span class="nv">cd</span> <span class="nv">libvorbis</span><span class="o">-</span><span class="mi">1</span>.<span class="mi">3</span>.<span class="mi">4</span>
.<span class="o">/</span><span class="nv">configure</span> <span class="o">--</span><span class="nv">prefix</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">$HOME/ffmpeg_build</span><span class="s2">&quot;</span> <span class="o">--</span><span class="nv">with</span><span class="o">-</span><span class="nv">ogg</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">$HOME/ffmpeg_build</span><span class="s2">&quot;</span> <span class="o">--</span><span class="nv">disable</span><span class="o">-</span><span class="nv">shared</span> <span class="o">&amp;&amp;</span> <span class="nv">make</span> <span class="o">&amp;&amp;</span> <span class="nv">make</span> <span class="nv">install</span>

<span class="nv">cd</span> <span class="o">/</span><span class="nv">opt</span>
<span class="nv">wget</span> <span class="nv">http</span>:<span class="o">//</span><span class="nv">downloads</span>.<span class="nv">xiph</span>.<span class="nv">org</span><span class="o">/</span><span class="nv">releases</span><span class="o">/</span><span class="nv">theora</span><span class="o">/</span><span class="nv">libtheora</span><span class="o">-</span><span class="mi">1</span>.<span class="mi">1</span>.<span class="mi">1</span>.<span class="nv">tar</span>.<span class="nv">gz</span>
<span class="nv">tar</span> <span class="nv">xzvf</span> <span class="nv">libtheora</span><span class="o">-</span><span class="mi">1</span>.<span class="mi">1</span>.<span class="mi">1</span>.<span class="nv">tar</span>.<span class="nv">gz</span> <span class="o">&amp;&amp;</span> <span class="nv">rm</span> <span class="o">-</span><span class="nv">f</span> <span class="nv">libtheora</span><span class="o">-</span><span class="mi">1</span>.<span class="mi">1</span>.<span class="mi">1</span>.<span class="nv">tar</span>.<span class="nv">gz</span>
<span class="nv">cd</span> <span class="nv">libtheora</span><span class="o">-</span><span class="mi">1</span>.<span class="mi">1</span>.<span class="mi">1</span>
.<span class="o">/</span><span class="nv">configure</span> <span class="o">--</span><span class="nv">prefix</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">$HOME/ffmpeg_build</span><span class="s2">&quot;</span> <span class="o">--</span><span class="nv">with</span><span class="o">-</span><span class="nv">ogg</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">$HOME/ffmpeg_build</span><span class="s2">&quot;</span> <span class="o">--</span><span class="nv">disable</span><span class="o">-</span><span class="nv">examples</span> <span class="o">--</span><span class="nv">disable</span><span class="o">-</span><span class="nv">shared</span> 
<span class="o">--</span><span class="nv">disable</span><span class="o">-</span><span class="nv">sdltest</span> <span class="o">--</span><span class="nv">disable</span><span class="o">-</span><span class="nv">vorbistest</span> <span class="o">&amp;&amp;</span> <span class="nv">make</span> <span class="o">&amp;&amp;</span> <span class="nv">make</span> <span class="nv">install</span>

<span class="nv">cd</span> <span class="o">/</span><span class="nv">opt</span>
<span class="nv">wget</span> <span class="nv">http</span>:<span class="o">//</span><span class="nv">downloads</span>.<span class="nv">sourceforge</span>.<span class="nv">net</span><span class="o">/</span><span class="nv">opencore</span><span class="o">-</span><span class="nv">amr</span><span class="o">/</span><span class="nv">vo</span><span class="o">-</span><span class="nv">aacenc</span><span class="o">-</span><span class="mi">0</span>.<span class="mi">1</span>.<span class="mi">2</span>.<span class="nv">tar</span>.<span class="nv">gz</span>
<span class="nv">tar</span> <span class="nv">xzvf</span> <span class="nv">vo</span><span class="o">-</span><span class="nv">aacenc</span><span class="o">-</span><span class="mi">0</span>.<span class="mi">1</span>.<span class="mi">2</span>.<span class="nv">tar</span>.<span class="nv">gz</span> <span class="o">&amp;&amp;</span> <span class="nv">rm</span> <span class="o">-</span><span class="nv">f</span> <span class="nv">vo</span><span class="o">-</span><span class="nv">aacenc</span><span class="o">-</span><span class="mi">0</span>.<span class="mi">1</span>.<span class="mi">2</span>.<span class="nv">tar</span>.<span class="nv">gz</span>
<span class="nv">cd</span> <span class="nv">vo</span><span class="o">-</span><span class="nv">aacenc</span><span class="o">-</span><span class="mi">0</span>.<span class="mi">1</span>.<span class="mi">2</span>
.<span class="o">/</span><span class="nv">configure</span> <span class="o">--</span><span class="nv">prefix</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">$HOME/ffmpeg_build</span><span class="s2">&quot;</span> <span class="o">--</span><span class="nv">disable</span><span class="o">-</span><span class="nv">shared</span> <span class="o">&amp;&amp;</span> <span class="nv">make</span> <span class="nv">install</span>

<span class="nv">yum</span> <span class="o">-</span><span class="nv">y</span> <span class="nv">remove</span> <span class="nv">yasm</span>
<span class="nv">cd</span> <span class="o">/</span><span class="nv">opt</span>
<span class="nv">wget</span> <span class="nv">http</span>:<span class="o">//</span><span class="nv">www</span>.<span class="nv">tortall</span>.<span class="nv">net</span><span class="o">/</span><span class="nv">projects</span><span class="o">/</span><span class="nv">yasm</span><span class="o">/</span><span class="nv">releases</span><span class="o">/</span><span class="nv">yasm</span><span class="o">-</span><span class="mi">1</span>.<span class="mi">2</span>.<span class="mi">0</span>.<span class="nv">tar</span>.<span class="nv">gz</span>
<span class="nv">tar</span> <span class="nv">xzfv</span> <span class="nv">yasm</span><span class="o">-</span><span class="mi">1</span>.<span class="mi">2</span>.<span class="mi">0</span>.<span class="nv">tar</span>.<span class="nv">gz</span> <span class="o">&amp;&amp;</span> <span class="nv">rm</span> <span class="o">-</span><span class="nv">f</span> <span class="nv">yasm</span><span class="o">-</span><span class="mi">1</span>.<span class="mi">2</span>.<span class="mi">0</span>.<span class="nv">tar</span>.<span class="nv">gz</span>
<span class="nv">cd</span> <span class="nv">yasm</span><span class="o">-</span><span class="mi">1</span>.<span class="mi">2</span>.<span class="mi">0</span>
.<span class="o">/</span><span class="nv">configure</span> <span class="o">--</span><span class="nv">prefix</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">$HOME/ffmpeg_build</span><span class="s2">&quot;</span> <span class="o">--</span><span class="nv">bindir</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">$HOME/bin</span><span class="s2">&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">make</span> <span class="nv">install</span>
<span class="nv">export</span> <span class="s2">&quot;</span><span class="s">PATH=$PATH:$HOME/bin</span><span class="s2">&quot;</span> 

<span class="nv">cd</span> <span class="o">/</span><span class="nv">opt</span>
<span class="nv">git</span> <span class="nv">clone</span> <span class="nv">http</span>:<span class="o">//</span><span class="nv">git</span>.<span class="nv">chromium</span>.<span class="nv">org</span><span class="o">/</span><span class="nv">webm</span><span class="o">/</span><span class="nv">libvpx</span>.<span class="nv">git</span>
<span class="nv">cd</span> <span class="nv">libvpx</span>
<span class="nv">git</span> <span class="nv">checkout</span> <span class="nv">tags</span><span class="o">/</span><span class="nv">v1</span>.<span class="mi">3</span>.<span class="mi">0</span>
.<span class="o">/</span><span class="nv">configure</span> <span class="o">--</span><span class="nv">prefix</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">$HOME/ffmpeg_build</span><span class="s2">&quot;</span> <span class="o">--</span><span class="nv">disable</span><span class="o">-</span><span class="nv">examples</span> <span class="o">&amp;&amp;</span> <span class="nv">make</span> <span class="o">&amp;&amp;</span> <span class="nv">make</span> <span class="nv">install</span>

<span class="nv">cd</span> <span class="o">/</span><span class="nv">opt</span>
<span class="nv">git</span> <span class="nv">clone</span> <span class="nv">git</span>:<span class="o">//</span><span class="nv">git</span>.<span class="nv">videolan</span>.<span class="nv">org</span><span class="o">/</span><span class="nv">x264</span>.<span class="nv">git</span>
<span class="nv">cd</span> <span class="nv">x264</span>
.<span class="o">/</span><span class="nv">configure</span> <span class="o">--</span><span class="nv">prefix</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">$HOME/ffmpeg_build</span><span class="s2">&quot;</span> <span class="o">--</span><span class="nv">bindir</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">$HOME/bin</span><span class="s2">&quot;</span> <span class="o">--</span><span class="nv">enable</span><span class="o">-</span><span class="nv">static</span> <span class="o">&amp;&amp;</span> <span class="nv">make</span> <span class="nv">install</span>

<span class="nv">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">lib</span><span class="o">/</span>:$<span class="nv">HOME</span><span class="o">/</span><span class="nv">ffmpeg_build</span><span class="o">/</span><span class="nv">lib</span><span class="o">/</span>
<span class="nv">echo</span> <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">lib</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">ld</span>.<span class="nv">so</span>.<span class="nv">conf</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">custom</span><span class="o">-</span><span class="nv">libs</span>.<span class="nv">conf</span>
<span class="nv">echo</span> $<span class="nv">HOME</span><span class="o">/</span><span class="nv">ffmpeg_build</span><span class="o">/</span><span class="nv">lib</span><span class="o">/</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">ld</span>.<span class="nv">so</span>.<span class="nv">conf</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">custom</span><span class="o">-</span><span class="nv">libs</span>.<span class="nv">conf</span>
<span class="nv">ldconfig</span>

<span class="nv">cd</span> <span class="o">/</span><span class="nv">opt</span>
<span class="nv">git</span> <span class="nv">clone</span> <span class="nv">git</span>:<span class="o">//</span><span class="nv">source</span>.<span class="nv">ffmpeg</span>.<span class="nv">org</span><span class="o">/</span><span class="nv">ffmpeg</span>.<span class="nv">git</span>
<span class="nv">cd</span> <span class="nv">ffmpeg</span>
<span class="nv">git</span> <span class="nv">checkout</span> <span class="nv">release</span><span class="o">/</span><span class="mi">2</span>.<span class="mi">2</span>
<span class="nv">PKG_CONFIG_PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">$HOME/ffmpeg_build/lib/pkgconfig</span><span class="s2">&quot;</span>
<span class="nv">export</span> <span class="nv">PKG_CONFIG_PATH</span>
.<span class="o">/</span><span class="nv">configure</span> <span class="o">--</span><span class="nv">prefix</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">$HOME/ffmpeg_build</span><span class="s2">&quot;</span> <span class="o">--</span><span class="nv">extra</span><span class="o">-</span><span class="nv">cflags</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">-I$HOME/ffmpeg_build/include</span><span class="s2">&quot;</span> 
<span class="o">--</span><span class="nv">extra</span><span class="o">-</span><span class="nv">ldflags</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">-L$HOME/ffmpeg_build/lib</span><span class="s2">&quot;</span> <span class="o">--</span><span class="nv">bindir</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">$HOME/bin</span><span class="s2">&quot;</span> 
<span class="o">--</span><span class="nv">extra</span><span class="o">-</span><span class="nv">libs</span><span class="o">=-</span><span class="nv">ldl</span> <span class="o">--</span><span class="nv">enable</span><span class="o">-</span><span class="nv">version3</span> <span class="o">--</span><span class="nv">enable</span><span class="o">-</span><span class="nv">libopencore</span><span class="o">-</span><span class="nv">amrnb</span> <span class="o">--</span><span class="nv">enable</span><span class="o">-</span><span class="nv">libopencore</span><span class="o">-</span><span class="nv">amrwb</span>
 <span class="o">--</span><span class="nv">enable</span><span class="o">-</span><span class="nv">libvpx</span> <span class="o">--</span><span class="nv">enable</span><span class="o">-</span><span class="nv">libfaac</span> 
<span class="o">--</span><span class="nv">enable</span><span class="o">-</span><span class="nv">libmp3lame</span> <span class="o">--</span><span class="nv">enable</span><span class="o">-</span><span class="nv">libtheora</span> <span class="o">--</span><span class="nv">enable</span><span class="o">-</span><span class="nv">libvorbis</span> <span class="o">--</span><span class="nv">enable</span><span class="o">-</span><span class="nv">libx264</span> <span class="o">--</span><span class="nv">enable</span><span class="o">-</span><span class="nv">libvo</span><span class="o">-</span><span class="nv">aacenc</span> 
<span class="o">--</span><span class="nv">enable</span><span class="o">-</span><span class="nv">libxvid</span> <span class="o">--</span><span class="nv">disable</span><span class="o">-</span><span class="nv">ffplay</span> 
<span class="o">--</span><span class="nv">enable</span><span class="o">-</span><span class="nv">gpl</span> <span class="o">--</span><span class="nv">enable</span><span class="o">-</span><span class="nv">postproc</span> <span class="o">--</span><span class="nv">enable</span><span class="o">-</span><span class="nv">nonfree</span> <span class="o">--</span><span class="nv">enable</span><span class="o">-</span><span class="nv">avfilter</span> <span class="o">--</span><span class="nv">enable</span><span class="o">-</span><span class="nv">pthreads</span> <span class="o">--</span><span class="nv">arch</span><span class="o">=</span><span class="nv">x86_64</span> <span class="o">&amp;&amp;</span> <span class="nv">make</span> <span class="nv">install</span>

# <span class="nv">Test</span> <span class="nv">the</span> <span class="nv">resulting</span> <span class="nv">ffmpeg</span> <span class="nv">binary</span>
<span class="nv">cp</span> $<span class="nv">HOME</span><span class="o">/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">ffmpeg</span> <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">bin</span><span class="o">/</span>
<span class="nv">ffmpeg</span> <span class="o">-</span><span class="nv">v</span>
</pre></div>


<h2 id="openldap">openldap</h2>
<div class="codehilite"><pre><span></span><span class="nv">yum</span> <span class="nv">install</span> <span class="nv">openldap</span><span class="o">-*</span> <span class="nv">db4</span><span class="o">-*</span> <span class="o">-</span><span class="nv">y</span>
<span class="nv">sed</span> <span class="o">-</span><span class="nv">i</span> <span class="s2">&quot;</span><span class="s">/local4.*/d</span><span class="s2">&quot;</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">rsyslog</span>.<span class="nv">conf</span>
<span class="nv">cat</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">rsyslog</span>.<span class="nv">conf</span> <span class="o">&lt;&lt;</span> <span class="nv">EOF</span>
<span class="nv">local4</span>.<span class="o">*</span>                        <span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">log</span><span class="o">/</span><span class="nv">slapd</span>.<span class="nv">log</span>
<span class="nv">EOF</span>
<span class="nv">service</span> <span class="nv">rsyslog</span> <span class="nv">restart</span>
<span class="nv">cd</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">openldap</span><span class="o">/</span>
<span class="nv">cp</span>  <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">share</span><span class="o">/</span><span class="nv">openldap</span><span class="o">-</span><span class="nv">servers</span><span class="o">/</span><span class="nv">slapd</span>.<span class="nv">conf</span>.<span class="nv">obsolete</span> <span class="nv">slapd</span>.<span class="nv">conf</span>
<span class="nv">slappasswd</span>    输入完密码后,返回一串密文，先保存到剪贴板,之后要复制到<span class="nv">LDAP</span>配置文件中使
<span class="nv">New</span> <span class="nv">password</span>: 
<span class="nv">Re</span><span class="o">-</span><span class="nv">enter</span> <span class="nv">new</span> <span class="nv">password</span>: 
{<span class="nv">SSHA</span>}<span class="nv">hEH5ZdU2atsKNI0kUniBdU</span><span class="o">/</span><span class="mi">9</span><span class="nv">eCf</span><span class="o">+</span><span class="nv">VYkB</span>

<span class="nv">vim</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">openldap</span><span class="o">/</span><span class="nv">slapd</span>.<span class="nv">conf</span>
# <span class="nv">enable</span> <span class="nv">server</span> <span class="nv">status</span> <span class="nv">monitoring</span> <span class="ss">(</span><span class="nv">cn</span><span class="o">=</span><span class="nv">monitor</span><span class="ss">)</span>
<span class="nv">database</span> <span class="nv">monitor</span>
<span class="nv">access</span> <span class="nv">to</span> <span class="o">*</span>
        <span class="nv">by</span> <span class="nv">dn</span>.<span class="nv">exact</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth</span><span class="s2">&quot;</span> <span class="nv">read</span>
        <span class="nv">by</span> <span class="nv">dn</span>.<span class="nv">exact</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">cn=admin,dc=test,dc=com</span><span class="s2">&quot;</span> <span class="nv">read</span>
        <span class="nv">by</span> <span class="o">*</span> <span class="nv">none</span>


#######################################################################
# <span class="nv">database</span> <span class="nv">definitions</span>
#######################################################################


<span class="nv">database</span>        <span class="nv">bdb</span>
<span class="nv">suffix</span>          <span class="s2">&quot;</span><span class="s">dc=test,dc=com</span><span class="s2">&quot;</span>
<span class="nv">checkpoint</span>      <span class="mi">1024</span> <span class="mi">15</span>
<span class="nv">rootdn</span>          <span class="s2">&quot;</span><span class="s">cn=admin,dc=test,dc=com</span><span class="s2">&quot;</span>
# <span class="nv">Cleartext</span> <span class="nv">passwords</span>, <span class="nv">especially</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">rootdn</span>, <span class="nv">should</span>
# <span class="nv">be</span> <span class="nv">avoided</span>.  <span class="nv">See</span> <span class="nv">slappasswd</span><span class="ss">(</span><span class="mi">8</span><span class="ss">)</span> <span class="nv">and</span> <span class="nv">slapd</span>.<span class="nv">conf</span><span class="ss">(</span><span class="mi">5</span><span class="ss">)</span> <span class="k">for</span> <span class="nv">details</span>.
# <span class="nv">Use</span> <span class="nv">of</span> <span class="nv">strong</span> <span class="nv">authentication</span> <span class="nv">encouraged</span>.
# <span class="nv">rootpw</span>                <span class="nv">secret</span>
# <span class="nv">rootpw</span>                {<span class="nv">crypt</span>}<span class="nv">ijFYNcSNctBYg</span>
<span class="nv">rootpw</span> {<span class="nv">SSHA</span>}<span class="nv">pfAJm</span><span class="o">+</span><span class="nv">JJa4ec2y8GjTc8uMEJpoR5YKMn</span>
.......
保存退出
<span class="nv">cp</span>  <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">share</span><span class="o">/</span><span class="nv">openldap</span><span class="o">-</span><span class="nv">servers</span><span class="o">/</span><span class="nv">DB_CONFIG</span>.<span class="nv">example</span>  <span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">lib</span><span class="o">/</span><span class="nv">ldap</span><span class="o">/</span><span class="nv">DB_CONFIG</span>
<span class="nv">rm</span> <span class="o">-</span><span class="nv">rf</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">openldap</span><span class="o">/</span><span class="nv">slapd</span>.<span class="nv">d</span><span class="cm">/*     删除默认/etc/openldap/slapd.d下面的所有内容，否则后面在使用ldapadd的时候会报错</span>
<span class="cm">/etc/init.d/slapd restart</span>
<span class="cm">chkconfig slap on</span>
<span class="cm">chkconfig slapd on</span>
<span class="cm">chown -R ldap.ldap /var/lib/ldap</span>
<span class="cm">chown -R ldap.ldap /etc/openldap/</span>
<span class="cm">测试并生成配置文件</span>
<span class="cm">slaptest  -f /etc/openldap/slapd.conf -F /etc/openldap/slapd.d   </span>
<span class="cm">config file testing succeeded</span>
<span class="cm">chown -R ldap:ldap /etc/openldap/slapd.d</span>
<span class="cm">/etc/init.d/slapd restart</span>
<span class="cm">至此，用户仅仅是系统上存在的用户（存储在/etc/passwd和/etc/shadow上），并没有在LDAP数据库里，所以要把这些用户导入到LDAP里面去。</span>
<span class="cm">但LDAP只能识别特定格式的文件 即后缀为ldif的文件（也是文本文件），所以不能直接使用/etc/passwd和/etc/shadow。 </span>
<span class="cm">需要migrationtools这个工具把这两个文件转变成LDAP能识别的文件</span>

<span class="cm">yum install migrationtools -y</span>
<span class="cm">cd /usr/share/migrationtools/</span>
<span class="cm">vim migrate_common.ph</span>
<span class="cm"># Default DNS domain</span>
<span class="cm">$DEFAULT_MAIL_DOMAIN = &quot;test.com&quot;;</span>


<span class="cm"># Default base</span>
<span class="cm">$DEFAULT_BASE = &quot;dc=test,dc=com&quot;;</span>

<span class="cm">K.下面利用pl脚本将/etc/passwd 和/etc/shadow生成LDAP能读懂的文件格式，保存在/tmp/下</span>
<span class="cm"># ./migrate_base.pl &gt; /tmp/base.ldif</span>
<span class="cm"># ./migrate_passwd.pl  /etc/passwd &gt; /tmp/passwd.ldif</span>
<span class="cm"># ./migrate_group.pl  /etc/group &gt; /tmp/group.ldif</span>
<span class="cm">L.下面就要把这三个文件导入到LDAP，这样LDAP的数据库里就有了我们想要的用户</span>
<span class="cm"># ldapadd -x -D &quot;cn=admin,dc=example,dc=com&quot; -W -f /tmp/base.ldif</span>
<span class="cm"># ldapadd -x -D &quot;cn=admin,dc=example,dc=com&quot; -W -f /tmp/passwd.ldif</span>
<span class="cm"># ldapadd -x -D &quot;cn=admin,dc=example,dc=com&quot; -W -f /tmp/group.ldif</span>
<span class="cm">过程若无报错，则LDAP服务端配置完毕</span>

<span class="cm">M.重启slapd完成配置</span>
<span class="cm"># service slapd restart</span>

<span class="cm">N.现安装NFS，并把ldapuser1的家目录做NFS共享.</span>
<span class="cm">默认REDHAT已安装</span>
<span class="cm"># yum install nfs* -y</span>
<span class="cm">配置NFS共享：</span>
<span class="cm"># vi /etc/exports</span>
<span class="cm">--------------</span>
<span class="cm">/home/ldapuser1         *(rw,no_root_squash)</span>
<span class="cm">--------------</span>
<span class="cm">重启nfs服务：</span>
<span class="cm"># service rpcbind restart</span>
<span class="cm"># service nfs restart</span>
<span class="cm">PS.本地需要做ldap控制的账号都要导入到LDAP DB中，否则客户端配置无法正常识别登录。</span>

<span class="cm">客户端配置有两种方法：</span>

<span class="cm">使用authconfig-tui ，也就是setup命令中的 &quot;Authentication configuration&quot;</span>
<span class="cm">手动配置</span>
<span class="cm">无论哪种方式，都要先安装客户端：</span>

<span class="cm">yum -y install openldap openldap-clients nss-pam-ldapd pam_ldap</span>
<span class="cm">第一种方法：</span>
<span class="cm">在命令行中输入authconfig-tui或者setup命令中选择&quot;Authentication configuration&quot;，选中 ”Use LDAP“和“Use LDAP Authentication”，</span>
<span class="cm">之后点击NEXT，输入服务器地址和“BASE DN”即可。全部图形化添加，非常简单，推荐使用。</span>

<span class="cm">authconfig --enablemkhomedir --disableldaptls --enableldap --enableldapauth --ldapserver=ldap://192.168.18.150,</span>
<span class="cm">ldap://10.84.126.150,ldap://192.168.200.10 --ldapbasedn=&quot;ou=Common Linux servers,dc=synnex,dc=org&quot;  --update</span>

<span class="cm">第二种方法需要修改文件较多：</span>
<span class="cm">编辑/etc/openldap/ldap.conf，加入：</span>

<span class="cm">URI ldap://10.11.15.78/   //LDAP服务器地址</span>
<span class="cm">BASE dc=52os,dc=net</span>
<span class="cm">TLS_CACERTDIR /etc/openldap/cacerts</span>
<span class="cm">编辑/etc/nslcd.conf，加入：</span>

<span class="cm">uri ldap://10.11.15.78/</span>
<span class="cm">base dc=52os,dc=net</span>
<span class="cm">ssl no</span>
<span class="cm">tls_cacertdir /etc/openldap/cacerts</span>
<span class="cm">系统命名服务（NSS）配置使用LDAP，编辑 /etc/nsswitch.conf，修改如下几项为：</span>

<span class="cm">passwd:     files ldap</span>
<span class="cm">shadow:     files ldap</span>
<span class="cm">group:      files ldap</span>
<span class="cm">netgroup:   files ldap</span>
<span class="cm">automount:  files ldap</span>
<span class="cm">编辑/etc/pam.d/system-auth，修改如下几项为：</span>

<span class="cm">auth        sufficient    pam_ldap.so use_first_pass</span>
<span class="cm">account     required      pam_unix.so broken_shadow</span>
<span class="cm">account     [default=bad success=ok user_unknown=ignore] pam_ldap.so</span>
<span class="cm">password    sufficient    pam_ldap.so use_authtok</span>
<span class="cm">session     required      pam_unix.so</span>
<span class="cm">session     optional      pam_ldap.so  #这一行要加在pam_unix.so下面</span>
<span class="cm">session     optional      pam_mkhomedir.so skel=/etc/skel/ umask=0022 #自动创建用户的宿主目录</span>
<span class="cm">编辑/etc/sysconfig/authconfig:</span>

<span class="cm">USELDAPAUTH=yes</span>
<span class="cm">USELDAP=yes</span>
<span class="cm">修改好之后启动nslcd服务，并设置开机启动</span>

<span class="cm">service nslcd start  &amp;&amp; chkconfig nslcd on</span>
<span class="cm">验证：</span>
<span class="cm">test用户只有在ldap server上有，在客户端如果也能查看到，就说明设置成功：</span>

<span class="cm">id test</span>
<span class="cm">或者使用：</span>

<span class="cm">getent passwd |grep test</span>
<span class="cm">这时就能用test账号登录客户端了。</span>

<span class="cm">三、其它设置:</span>
<span class="cm">1.日志配置</span>

<span class="cm">openLDAP默认是不打日志的，要配合rsyslog才能打日志。</span>
<span class="cm">在/etc/openldap/slapd.conf 中设置日志级别，加入：</span>

<span class="cm">loglevel 1</span>
<span class="cm">具体的loglevel解释，可以：</span>

<span class="cm">man slapd.conf</span>
<span class="cm">在/etc/rsyslog.conf最后加入：</span>

<span class="cm">local4.*  /var/log/slapd.log</span>
<span class="cm">重启rsyslog和slapd：</span>

<span class="cm">service rsyslog restart</span>
<span class="cm">service slapd restart</span>
<span class="cm">2.sudo管理</span>

<span class="cm">在openldap的服务器端拷贝sudo schema到openldap配置目录</span>

<span class="cm">cp /usr/share/doc/sudo-1.8.6p3/schema.OpenLDAP /etc/openldap/schema/sudo.schema</span>
<span class="cm">加载sudo schema，在/etc/openldap/slapd.conf　 添加：</span>

<span class="cm">include         /etc/openldap/schema/sudo.schema</span>
<span class="cm">重新生产配置文件：</span>

<span class="cm">rm -rf /etc/openldap/slapd.d/*</span>
<span class="cm">sudo -u ldap slaptest -f /etc/openldap/slapd.conf -F /etc/openldap/slapd.d</span>
<span class="cm">service slapd restart</span>
<span class="cm">新建一个sudo.ldif文件，内容为：</span>

<span class="cm">dn: ou=Sudoers,dc=52os,dc=net</span>
<span class="cm">objectClass: top</span>
<span class="cm">objectClass: organizationalUnit</span>
<span class="cm">ou: Sudoers</span>

<span class="cm">dn: cn=defaults,ou=Sudoers,dc=52os,dc=net</span>
<span class="cm">objectClass: top</span>
<span class="cm">objectClass: sudoRole</span>
<span class="cm">cn: defaults</span>
<span class="cm">sudoOption: !visiblepw</span>
<span class="cm">sudoOption: always_set_home</span>
<span class="cm">sudoOption: env_reset</span>
<span class="cm">sudoOption: requiretty</span>

<span class="cm">dn: cn=test,ou=Sudoers,dc=52os,dc=net</span>
<span class="cm">objectClass: top</span>
<span class="cm">objectClass: sudoRole</span>
<span class="cm">cn: test</span>
<span class="cm">sudoCommand: ALL</span>
<span class="cm">sudoHost: ALL</span>
<span class="cm">sudoOption: !authenticate</span>
<span class="cm">sudoRunAsUser: ALL</span>
<span class="cm">sudoUser: test</span>
<span class="cm">上面的内容按实际情况更改，注意每行最后不要有空格，ldif里的大小写不敏感。我允许sudo的用户是test，允许使用全部命令，允许所有主机sudo</span>
<span class="cm">导入sudo.ldif记录:</span>

<span class="cm">ldapadd -x -D &quot;cn=admin,dc=52os,dc=net&quot; -W -f sudo.ldif</span>
<span class="cm">设置客户端：</span>
<span class="cm">在/etc/sudo-ldap.conf中加入：</span>

<span class="cm">uri ldap://10.11.15.78</span>
<span class="cm">sudoers_base ou=Sudoers,dc=52os,dc=net</span>
<span class="cm">在/etc/nsswitch.conf中加入：</span>

<span class="cm">Sudoers: files ldap</span>
<span class="cm">在客户端用切换到test用户，测试一下sudo是否可用</span>

<span class="cm">3.用户目录自动挂载</span>

<span class="cm">使用Openldap的好处就是在服务器端建好一个用户后，各个客户端去服务器端验证，不需要在创建该用户。验证通过后会在客户端/home目录下</span>
<span class="cm">创建该用户的宿主目录，虽然是同一用户，但目前的配置来说，每个客户端和服务器之间宿主目录是独立的，并没有共享服务器端的宿主目录。</span>
<span class="cm">举例来说，我在服务器端的宿主目录中上传了一份代码，如果客户端共享服务器的宿主目录，当用户在任意一个客户端登录时，都会看到服务器上</span>
<span class="cm">宿主目录的代码，管理起来就十分方便了。</span>

<span class="cm">配置用户目录共享，需要在服务器端安装nfs，在客户端安装autofs。</span>
<span class="cm">安装并启动nfs：</span>

<span class="cm">yum install nfs-utils</span>
<span class="cm">service rpcbind start</span>
<span class="cm">service nfslock start</span>
<span class="cm">service nfs start</span>
<span class="cm">启动好后用chkconfig加入开机启动。</span>
<span class="cm">编辑/etc/exports文件，加入：</span>

<span class="cm">/home  *(rw,sync)</span>
<span class="cm">要注意用户需在nfs服务器/home下有宿主目录，否则autofs无法挂载。&quot;*&quot;可以写成具体的ip或ip段，设置好后重启nfs服务，测试并查看：</span>

<span class="cm">showmount -e localhost</span>
<span class="cm">服务器端的nfs配置完成。</span>
<span class="cm">客户端要安装autofs和nfs-utils，但nfs服务不用启动:</span>

<span class="cm">yum install nfs-utils autofs</span>
<span class="cm">配置autofs，在/etc/auto.master最后加入：</span>

<span class="cm">/home   /etc/auto.nfs</span>
<span class="cm">新建一个/etc/auto.nfs文件，内容为：</span>

<span class="cm">*   -fstype=nfs                      10.11.15.78:/home/&amp;</span>
<span class="cm">启动autofs：</span>

<span class="cm">service autofs start</span>
<span class="cm">用su - test测试是否正常切换,在用mount命令查看挂载：</span>

<span class="cm">10.11.15.78:/home/test on /home/test type nfs (rw,vers=4,addr=10.11.15.78,clientaddr=10.11.15.79)</span>
<span class="cm">说明挂载成功了，客户端的用户目录和服务器端的用户目录内容就能正常同步了</span>

<span class="cm">其它的一些设置，用到在写。</span>
<span class="cm">1.安全设置主要有两点：1.启用TLS加密 2.关闭匿名查询</span>
<span class="cm">2.主备高可用配置</span>
<span class="cm">3.web管理工具：phpldapadmin和LDAP Account Manager</span>

<span class="cm">四、一些问题</span>
<span class="cm">1.用户不能建立宿主目录</span>
<span class="cm">提示 “could not chdir to home directory /home/user: No such file or directory”</span>
<span class="cm">解决方法：</span>
<span class="cm">在 /etc/pam.d/password-auth 和/etc/pam.d/system-auth 都要加入：</span>

<span class="cm">session     optional      pam_mkhomedir.so skel=/etc/skel/ umask=0022</span>
<span class="cm">2.导入ldif文件时报错</span>
<span class="cm">ldap_bind: Invalid credentials (49)</span>
<span class="cm">这种情况是管理员密码错误或者rootdn信息错误</span>

<span class="cm">3.配置autofs后，切换su - test 报错</span>

<span class="cm">Creating directory &#39;/home/test&#39;.</span>
<span class="cm">Unable to create and initialize directory &#39;/home/test&#39;.</span>
<span class="cm">su: warning: cannot change directory to /home/test: No such file or directory</span>
<span class="cm">这是由于nfs服务器上/home下没有test用户的宿主目录造成的，且权限要正确，否则autofs无法挂载目录，用户也无法在客户端登录。</span>



<span class="cm">3. LDAP数据库相关增删查改操作：</span>
<span class="cm">操作LDAP的方式有很多，下面以bash下用openldap-clients 套件提供的工具来进行。</span>



<span class="cm">1、初始化数据</span>
<span class="cm">这一步通常是由特定的应用程序根据其自身使用的需要创建的。包括两部分的内容：</span>
<span class="cm">a、创建.schema文件，该文件定义了后面ldap 中存放对象的类型和属性，这已经在上面sldapd.conf文件中定义；</span>
<span class="cm">b、初始化数据结构，其结构必须由上面的.schema文件已经定义的，并由应用程序读取和使用。</span>


<span class="cm">初始化文件通常为.ldif 结尾，称为LDIF数据交换格式。这种格式是行界定、冒号分隔的属性-值对。例如：</span>


<span class="cm">引用</span>
<span class="cm">dn: dc=ldapuser1,ou=People,dc=test,dc=com</span>
<span class="cm">objectClass: top</span>
<span class="cm">objectClass: dcObject</span>
<span class="cm">objectClass: organization</span>
<span class="cm">....</span>


<span class="cm">导入时，执行：</span>
<span class="cm"># ldapadd -x -h 192.168.1.10 -D &#39;cn=admin,dc=test,dc=com&#39; -W -f info.ldif</span>


<span class="cm">ldapadd 命令各参数含义如下：</span>
<span class="cm">-x 为使用简单密码验证方式</span>
<span class="cm">-D 指定管理员DN（与slapd.conf中一致）</span>
<span class="cm">-W 为管理员密码，可以使用-w password 直接输入密码</span>
<span class="cm">-f 为初始化数据LDIF的文件名</span>
<span class="cm">-h 为操作的服务器IP地址</span>

<span class="cm">2、搜索操作</span>
<span class="cm">LDAP是读优化数据库，因此，读的速度很快，也很常用。但与关系数据库不同，其以树结构形式读取数据，若不添加过滤，会显示匹配节点下</span>
<span class="cm">所有节点的内容。若以ldif 的形式表达，刚开始可能不太习惯。</span>
<span class="cm"># ldapsearch -x -b &#39;dc=test,dc=com&#39;</span>


<span class="cm">首先要留意的是，ldapsearch 不需要提供验证信息。因为正如前面提到的，LDAP 默认供任何人可读。</span>
<span class="cm">-b 后面定义搜索节点位置，即从该节点往其子节点进行搜索</span>


<span class="cm">3、身份验证</span>
<span class="cm">修改或添加内容需进行用户验证，可通过下面的命令确认验证信息：</span>
<span class="cm"># ldapwhoami -x -D &#39;cn=ldapuser1,dc=test,dc=com&#39; -w &#39;yourpasswd&#39;</span>
<span class="cm">dn:cn=admin,dc=test,dc=com</span>
<span class="cm">Result: Success (0)</span>


<span class="cm">4、修改操作</span>
<span class="cm">修改内容通常由LDIF 文件提供。因此，可先用ldapsearch 导出节点内容：</span>


<span class="cm"># ldapsearch -x -LLL -b &#39;dc=test,dc=com&#39;</span>
<span class="cm">-LLL 表示不输出注释内容，以便后续重新导入。</span>

<span class="cm">其实也可以使用文件进行批量修改，我们只要把需要修改信息写入文件即可，比如：</span>
<span class="cm">dn: uid=ldapuser1,ou=People,dc=test,dc=com</span>
<span class="cm">changetype: modify</span>
<span class="cm">replace: uidNumber</span>
<span class="cm">uidNumber: 1000</span>

<span class="cm">把以上内容写入test.ldif中，运行如下命令：</span>

<span class="cm">ldapmodify -x -D &quot;cn=admin,dc=test,dc=com&quot; -w yourpasswd -f test.ldif</span>


<span class="cm">a、ldapadd 与ldapmodify -a 作用相同</span>
<span class="cm">b、如果在添加或修改时，报Naming violation等错误，则说明添加或修改的内容不符合schema中定义的对象属性规范，需修改后才能重新操作。</span>



<span class="cm">5、删除操作</span>
<span class="cm">删除时，给出DN即可：</span>
<span class="cm"># ldapdelete -x -D &#39;cn=admin,dc=test,dc=com&#39; -w yourpasswd -r &#39;dc=test,dc=com&#39;</span>
<span class="cm">-r 表示以递归模式删除，即删除该节点下面的所有子节点。</span>


<span class="cm">web管理</span>
<span class="cm">yum install httpd php php-bcmath php-gd php-mbstring php-xml php-ldap phpldapadmin</span>
<span class="cm">vim /etc/httpd/conf.d/phpldapadmin.conf </span>
<span class="cm">Order Deny,Allow</span>
<span class="cm">  Allow from all</span>

<span class="cm">/etc/init.d/httpd restart</span>
<span class="cm">vim /etc/phpldapadmin/config.php</span>
<span class="cm">397行</span>
<span class="cm">//$servers-&gt;setValue(&#39;server&#39;,&#39;name&#39;,&#39;Local LDAP Server&#39;);</span>
<span class="cm">$servers-&gt;setValue(&#39;login&#39;,&#39;attr&#39;,&#39;dn&#39;);</span>

<span class="cm">登录</span>
<span class="cm">用户 cn=admin,dc=test,dc=com</span>
<span class="cm">密码 之前输入的</span>

<span class="cm">web修改密码</span>
<span class="cm">在LDAP中，默认情况下用户无权修改自己的密码，如果用户自行修改密码，会遇到Result: Insufficient access (50)</span>
<span class="cm">vim /etc/openldap/slapd.conf</span>
<span class="cm">修改配置文件，在database config前添加如下内容（注意格式！）</span>

<span class="cm">access to attrs=userPassword</span>
<span class="cm">    by self write</span>
<span class="cm">    by anonymous auth</span>
<span class="cm">    by * none</span>

<span class="cm">access to * by * read</span>

<span class="cm">rm -rf /etc/openldap/slapd.d/*</span>
<span class="cm">slaptest -f /etc/openldap/slapd.conf -F /etc/openldap/slapd.d</span>
<span class="cm">chown -R ldap:ldap /etc/openldap/slapd.d</span>
<span class="cm">service slapd restart</span>

<span class="cm">https://github.com/koppor/phpLdapPasswd</span>
<span class="cm">http://tools.ltb-project.org/attachments/download/800/ltb-project-self-service-password-0.9.tar.gz</span>
</pre></div>


<h2 id="openldap_1">openldap修改密码</h2>
<div class="codehilite"><pre><span></span>自主修改密码，邮箱重置密码等
<span class="nv">https</span>:<span class="o">//</span><span class="nv">github</span>.<span class="nv">com</span><span class="o">/</span><span class="nv">ltb</span><span class="o">-</span><span class="nv">project</span><span class="o">/</span><span class="nv">self</span><span class="o">-</span><span class="nv">service</span><span class="o">-</span><span class="nv">password</span>

[<span class="nv">ltb</span><span class="o">-</span><span class="nv">project</span><span class="o">-</span><span class="nv">noarch</span>]
<span class="nv">name</span><span class="o">=</span><span class="nv">LTB</span> <span class="nv">project</span> <span class="nv">packages</span> <span class="ss">(</span><span class="nv">noarch</span><span class="ss">)</span>
<span class="nv">baseurl</span><span class="o">=</span><span class="nv">http</span>:<span class="o">//</span><span class="nv">ltb</span><span class="o">-</span><span class="nv">project</span>.<span class="nv">org</span><span class="o">/</span><span class="nv">rpm</span><span class="o">/</span>$<span class="nv">releasever</span><span class="o">/</span><span class="nv">noarch</span>
<span class="nv">enabled</span><span class="o">=</span><span class="mi">1</span>
<span class="nv">gpgcheck</span><span class="o">=</span><span class="mi">0</span>


<span class="nv">yum</span> <span class="nv">install</span> <span class="nv">httpd</span> <span class="nv">self</span><span class="o">-</span><span class="nv">service</span><span class="o">-</span><span class="nv">password</span>  <span class="nv">php</span><span class="o">-</span><span class="nv">mcrypt</span>

<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">httpd</span><span class="o">/</span><span class="nv">conf</span><span class="o">/</span><span class="nv">httpd</span>.<span class="nv">conf</span> 添加
<span class="nv">TraceEnable</span> <span class="nv">Off</span>
<span class="nv">RewriteEngine</span> <span class="nv">on</span>
<span class="nv">RewriteCond</span> <span class="o">%</span>{<span class="nv">REQUEST_METHOD</span>} <span class="o">^</span><span class="ss">(</span><span class="nv">TRACE</span><span class="o">|</span><span class="nv">TRACK</span><span class="ss">)</span>
<span class="nv">RewriteRule</span> .<span class="o">*</span> <span class="o">-</span> [<span class="nv">F</span>]

<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">share</span><span class="o">/</span><span class="nv">self</span><span class="o">-</span><span class="nv">service</span><span class="o">-</span><span class="nv">password</span><span class="o">/</span><span class="nv">conf</span><span class="o">/</span><span class="nv">config</span>.<span class="nv">inc</span>.<span class="nv">php</span>
$<span class="nv">ldap_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">ldap://hostname</span><span class="s2">&quot;</span><span class="c1">;</span>
$<span class="nv">ldap_starttls</span> <span class="o">=</span> <span class="nv">false</span><span class="c1">;</span>
$<span class="nv">ldap_binddn</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">uid=admin,cn=users,cn=accounts,dc=l,dc=d01,dc=test,dc=com,dc=cn</span><span class="s2">&quot;</span><span class="c1">;</span>
$<span class="nv">ldap_bindpw</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">admin passwd</span><span class="s2">&quot;</span><span class="c1">;</span>
$<span class="nv">ldap_base</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">cn=users,cn=accounts,dc=l,dc=d01,dc=test,dc=com,dc=cn</span><span class="s2">&quot;</span><span class="c1">;</span>

$<span class="nv">who_change_password</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">manager</span><span class="s2">&quot;</span><span class="c1">;  用上面的管理员用户改密码</span>
$<span class="nv">mail_address_use_ldap</span> <span class="o">=</span> <span class="nv">true</span><span class="c1">;</span>

<span class="nv">centos6</span>设置 <span class="mh">$c</span><span class="nv">rypt_tokens</span> <span class="o">=</span> <span class="nv">false</span><span class="c1">;</span>
$<span class="nv">keyphrase</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">hgfrtygfhfgdd</span><span class="s2">&quot;</span><span class="c1">;   随便生成一个，加密用</span>
<span class="mh">$defa</span><span class="nv">ult_action</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">sendtoken</span><span class="s2">&quot;</span><span class="c1">;  默认页面</span>


<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">share</span><span class="o">/</span><span class="nv">self</span><span class="o">-</span><span class="nv">service</span><span class="o">-</span><span class="nv">password</span><span class="o">/</span><span class="nv">pages</span><span class="o">/</span><span class="nv">sendtoken</span>.<span class="nv">php</span> 修改
<span class="mi">103</span>行
$<span class="nv">mailValues</span> <span class="o">=</span> <span class="nv">ldap_get_values</span><span class="ss">(</span>$<span class="nv">ldap</span>, <span class="mh">$e</span><span class="nv">ntry</span>, $<span class="nv">mail_attribute</span><span class="ss">)</span><span class="c1">;</span>
<span class="nv">unset</span><span class="ss">(</span>$<span class="nv">mailValues</span>[<span class="s2">&quot;</span><span class="s">count</span><span class="s2">&quot;</span>]<span class="ss">)</span><span class="c1">;</span>
改为
$<span class="nv">mailValues</span> <span class="o">=</span> $<span class="nv">login</span> . <span class="s2">&quot;</span><span class="s">@test.cn</span><span class="s2">&quot;</span><span class="c1">;</span>
#<span class="nv">unset</span><span class="ss">(</span>$<span class="nv">mailValues</span>[<span class="s2">&quot;</span><span class="s">count</span><span class="s2">&quot;</span>]<span class="ss">)</span><span class="c1">;</span>

<span class="mi">127</span>行
$<span class="nv">mail</span> <span class="o">=</span> $<span class="nv">mailValue</span><span class="c1">; 改为  $mail = $mailValues;</span>

<span class="mi">201</span>行添加
$<span class="nv">mailcom</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">/usr/local/bin/sendEmail -s 127.0.0.1 -f test -t </span><span class="s1">&#39;</span> . $<span class="nv">mail</span> .  <span class="s1">&#39;</span><span class="s"> -u &quot;Reset Ldap Password&quot; -m &quot;</span><span class="s1">&#39;</span> . $<span class="nv">reset_url</span> . <span class="s1">&#39;</span><span class="s">&quot;</span><span class="s1">&#39;</span><span class="c1">;</span>
<span class="k">if</span> <span class="ss">(</span> <span class="k">exec</span><span class="ss">(</span>$<span class="nv">mailcom</span><span class="ss">)</span> <span class="ss">)</span> {
注释 <span class="k">if</span> <span class="ss">(</span> <span class="nv">send_mail</span><span class="ss">(</span>$<span class="nv">mailer</span>, $<span class="nv">mail</span>, $<span class="nv">mail_from</span>, $<span class="nv">mail_from_name</span> .. <span class="ss">)</span> {

<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">share</span><span class="o">/</span><span class="nv">self</span><span class="o">-</span><span class="nv">service</span><span class="o">-</span><span class="nv">password</span><span class="o">/</span><span class="nv">pages</span><span class="o">/</span><span class="nv">resetbytoken</span>.<span class="nv">php</span>
<span class="mi">161</span>行
$<span class="nv">mailValues</span> <span class="o">=</span> <span class="nv">ldap_get_values</span><span class="ss">(</span>$<span class="nv">ldap</span>, <span class="mh">$e</span><span class="nv">ntry</span>, $<span class="nv">mail_attribute</span><span class="ss">)</span><span class="c1">;</span>
        <span class="k">if</span> <span class="ss">(</span> $<span class="nv">mailValues</span>[<span class="s2">&quot;</span><span class="s">count</span><span class="s2">&quot;</span>] <span class="o">&gt;</span> <span class="mi">0</span> <span class="ss">)</span> {
            $<span class="nv">mail</span> <span class="o">=</span> $<span class="nv">mailValues</span>[<span class="mi">0</span>]<span class="c1">;</span>
改为

$<span class="nv">mailValues</span> <span class="o">=</span> $<span class="nv">login</span> . <span class="s2">&quot;</span><span class="s">@test.cn</span><span class="s2">&quot;</span><span class="c1">;</span>
        <span class="k">if</span> <span class="ss">(</span> $<span class="nv">mailValues</span> <span class="ss">)</span> {
            $<span class="nv">mail</span> <span class="o">=</span> $<span class="nv">mailValues</span><span class="c1">;</span>
        }
</pre></div>


<h2 id="kvm">kvm虚拟化</h2>
<div class="codehilite"><pre><span></span><span class="n">cpu</span><span class="err">需要支持虚拟化</span> <span class="n">grep</span> <span class="n">flag</span> <span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">cpuinfo</span>  <span class="o">|</span> <span class="n">egrep</span> <span class="ss">&quot;vmx|svm&quot;</span>

<span class="err">环境</span> <span class="n">centos6</span><span class="p">.</span><span class="mi">5</span>

<span class="n">yum</span> <span class="n">install</span> <span class="n">kvm</span> <span class="n">kmod</span><span class="o">-</span><span class="n">kvm</span> <span class="n">qemu</span> <span class="n">kvm</span><span class="o">-</span><span class="n">qemu</span><span class="o">-</span><span class="n">img</span> <span class="n">virt</span><span class="o">-</span><span class="n">viewer</span> <span class="n">virt</span><span class="o">-</span><span class="n">manager</span> <span class="n">bridge</span><span class="o">-</span><span class="n">utils</span> <span class="n">tunctl</span> <span class="n">libvirt</span> <span class="n">device</span><span class="o">-</span><span class="n">mapper</span><span class="o">*</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">libvirtd</span> <span class="k">start</span>
<span class="n">lsmod</span>  <span class="o">|</span> <span class="n">grep</span> <span class="n">kvm</span>   <span class="err">检查模块是否有加载</span>

<span class="n">virsh</span> <span class="o">-</span><span class="k">c</span> <span class="n">qemu</span><span class="p">:</span><span class="o">///</span><span class="k">system</span> <span class="n">list</span>  <span class="err">检查</span><span class="n">KVM</span><span class="err">是否成功安装</span>
<span class="n">Id</span> <span class="n">Name</span>                 <span class="k">State</span>
<span class="c1">----------------------------------</span>

 <span class="n">xmanager</span> <span class="err">连接</span>
<span class="mi">1</span>  <span class="n">grep</span> <span class="n">X11Forwarding</span> <span class="c1">--color /etc/ssh/sshd_config</span>
    <span class="n">X11Forwarding</span> <span class="n">yes</span>
<span class="n">xshell</span> <span class="err">也需要打开</span><span class="n">X11Forwarding</span><span class="err">转发</span>
<span class="mi">2</span>   <span class="n">yum</span> <span class="n">install</span> <span class="n">xorg</span><span class="o">-</span><span class="n">x11</span><span class="o">-</span><span class="n">xauth</span> <span class="n">xorg</span><span class="o">-</span><span class="n">x11</span><span class="o">-</span><span class="n">xinit</span> <span class="n">xorg</span><span class="o">-</span><span class="n">x11</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">utils</span> <span class="n">xorg</span><span class="o">-</span><span class="n">x11</span><span class="o">-</span><span class="n">utils</span> <span class="n">xorg</span><span class="o">-</span><span class="n">x11</span><span class="o">-</span><span class="n">drv</span><span class="o">-</span><span class="n">ati</span><span class="o">-</span><span class="n">firmware</span>
<span class="mi">3</span>  <span class="n">export</span> <span class="n">DISPLAY</span><span class="o">=</span><span class="n">localhost</span><span class="p">:</span><span class="mi">10</span><span class="p">.</span><span class="mi">0</span>
<span class="mi">4</span>   <span class="err">重新登录</span>

<span class="n">Unable</span> <span class="k">to</span> <span class="k">set</span> <span class="n">bridge</span> <span class="n">virbr0</span> <span class="n">forward_delay</span><span class="p">:</span> <span class="err">只读文件系统</span>
<span class="n">mount</span> <span class="o">-</span><span class="n">o</span> <span class="n">rw</span><span class="p">,</span><span class="n">remount</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span>


<span class="n">virt</span><span class="o">-</span><span class="n">manager</span>  <span class="err">图形界面</span>

<span class="err">网络模式</span>   <span class="n">Bridge</span><span class="err">和</span><span class="n">Nat</span>

<span class="err">常用命令</span>
<span class="err">生成</span><span class="n">kvm</span><span class="err">虚拟机：</span><span class="n">virt</span><span class="o">-</span><span class="n">install</span>
<span class="err">查看在运行的虚拟机：</span><span class="n">virsh</span> <span class="n">list</span>
<span class="err">查看所有虚拟机：</span><span class="n">virsh</span> <span class="n">list</span> <span class="err">–</span><span class="k">all</span>
<span class="err">查看</span><span class="n">kvm</span><span class="err">虚拟机配置文件：</span><span class="n">virsh</span> <span class="n">dumpxml</span> <span class="n">name</span>
<span class="err">启动</span><span class="n">kvm</span><span class="err">虚拟机：</span><span class="n">virsh</span> <span class="k">start</span> <span class="n">name</span>
<span class="err">停止：</span><span class="n">virsh</span> <span class="k">destroy</span> <span class="n">name</span>
<span class="err">删除：</span><span class="n">virsh</span> <span class="n">undefine</span> <span class="n">name</span>
<span class="err">根据配置文件定义虚拟机：</span><span class="n">virsh</span> <span class="n">define</span> <span class="n">file</span><span class="o">-</span><span class="n">name</span><span class="p">.</span><span class="n">xml</span>
<span class="n">console</span><span class="err">虚拟机：</span><span class="n">virsh</span> <span class="n">console</span> <span class="n">name</span>

<span class="err">虚拟机键盘错位</span>
<span class="err">关闭要调整的虚拟机，编辑虚拟机配置文件</span>
<span class="o">#</span><span class="n">virsh</span> <span class="n">edit</span> <span class="s1">&#39;your vm name&#39;</span>
<span class="err">找到配置文件中的以下字段：</span>
<span class="o">&lt;</span><span class="n">graphics</span> <span class="k">type</span><span class="o">=</span><span class="s1">&#39;vnc&#39;</span> <span class="n">port</span><span class="o">=</span><span class="s1">&#39;-1&#39;</span><span class="o">/&gt;</span>
<span class="err">加入键盘的语言布局后如下：</span>
<span class="o">&lt;</span><span class="n">graphics</span> <span class="k">type</span><span class="o">=</span><span class="s1">&#39;vnc&#39;</span> <span class="n">port</span><span class="o">=</span><span class="s1">&#39;-1&#39;</span> <span class="n">keymap</span><span class="o">=</span><span class="s1">&#39;en-us&#39;</span><span class="o">/&gt;</span>
<span class="err">保存退出后，重启</span>
<span class="err">如果要避免这种情况，在使用</span><span class="n">virt</span><span class="o">-</span><span class="n">install</span><span class="err">安装的时候，就加入键盘布局的字段</span>
<span class="c1">--keymap=en-us</span>

<span class="err">端口映射</span>
<span class="n">iptables</span> <span class="o">-</span><span class="n">F</span>   <span class="err">不要清空</span><span class="n">nat</span><span class="err">表</span>
<span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">nat</span> <span class="o">-</span><span class="n">A</span> <span class="n">PREROUTING</span> <span class="o">-</span><span class="n">d</span> <span class="mi">124</span><span class="p">.</span><span class="mi">202</span><span class="p">.</span><span class="mi">158</span><span class="p">.</span><span class="mi">170</span><span class="err">（外网</span><span class="n">ip</span><span class="err">）</span> <span class="o">-</span><span class="n">p</span> <span class="n">tcp</span> <span class="o">-</span><span class="n">m</span> <span class="n">tcp</span> <span class="c1">--dport 1937 -j DNAT </span>
<span class="c1">--to-destination 192.168.122.100:22(要映射的虚拟机和端口)              </span>
<span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">nat</span> <span class="o">-</span><span class="n">A</span> <span class="n">POSTROUTING</span> <span class="o">-</span><span class="n">s</span> <span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">122</span><span class="p">.</span><span class="mi">0</span><span class="o">/</span><span class="mi">255</span><span class="p">.</span><span class="mi">255</span><span class="p">.</span><span class="mi">255</span><span class="p">.</span><span class="mi">0</span> <span class="o">-</span><span class="n">d</span> <span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">122</span><span class="p">.</span><span class="mi">100</span> <span class="o">-</span><span class="n">p</span> <span class="n">tcp</span> <span class="o">-</span><span class="n">m</span> <span class="n">tcp</span> 
<span class="c1">--dport 22 -j SNAT --to-source 192.168.122.1</span>
</pre></div>


<h2 id="opennebula">opennebula虚拟化</h2>
<div class="codehilite"><pre><span></span>下载地址   <span class="nv">http</span>:<span class="o">//</span><span class="nv">downloads</span>.<span class="nv">opennebula</span>.<span class="nv">org</span><span class="o">/</span><span class="nv">packages</span><span class="o">/</span>
<span class="nv">centos6</span>  <span class="mi">4</span>.<span class="nv">xxx</span>   <span class="nv">centos7</span>  <span class="mi">5</span>.<span class="nv">xxx</span>

配置好<span class="nv">epel</span>源 <span class="nv">gem</span> 源
<span class="nv">wget</span>  <span class="nv">http</span>:<span class="o">//</span><span class="nv">downloads</span>.<span class="nv">opennebula</span>.<span class="nv">org</span><span class="o">/</span><span class="nv">packages</span><span class="o">/</span><span class="nv">opennebula</span><span class="o">-</span><span class="mi">5</span>.<span class="mi">1</span>.<span class="mi">80</span><span class="o">/</span><span class="nv">centos7</span><span class="o">/</span><span class="nv">opennebula</span><span class="o">-</span><span class="mi">5</span>.<span class="mi">1</span>.<span class="mi">80</span><span class="o">-</span><span class="mi">1</span>.<span class="nv">tar</span>.<span class="nv">gz</span>
<span class="nv">tar</span> <span class="o">-</span><span class="nv">zxf</span> <span class="nv">opennebula</span><span class="o">-</span><span class="mi">5</span>.<span class="mi">1</span>.<span class="mi">80</span><span class="o">-</span><span class="mi">1</span>.<span class="nv">tar</span>.<span class="nv">gz</span>
<span class="nv">cd</span> <span class="nv">opennebula</span><span class="o">-</span><span class="mi">5</span>.<span class="mi">1</span>.<span class="mi">80</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span>

在控制节点（或叫做头节点）上安装 <span class="nv">opennebula</span> 和 <span class="nv">opennebula</span><span class="o">-</span><span class="nv">sunstone</span> 等：
<span class="nv">gem</span> <span class="nv">install</span> <span class="nv">sinatra</span> <span class="nv">builder</span> <span class="nv">zendesk_api</span>
<span class="nv">gem</span> <span class="nv">install</span> <span class="nv">treetop</span> <span class="nv">parse</span><span class="o">-</span><span class="nv">cron</span><span class="ss">(</span><span class="nv">opennebula</span><span class="o">-</span><span class="nv">flow</span>需要<span class="ss">)</span>
<span class="nv">yum</span> <span class="nv">localinstall</span> <span class="nv">opennebula</span><span class="o">-</span><span class="mi">5</span>.<span class="mi">1</span>.<span class="mi">80</span><span class="o">-</span><span class="mi">1</span>.<span class="nv">x86_64</span>.<span class="nv">rpm</span> <span class="nv">opennebula</span><span class="o">-</span><span class="nv">server</span><span class="o">-</span><span class="mi">5</span>.<span class="mi">1</span>.<span class="mi">80</span><span class="o">-</span><span class="mi">1</span>.<span class="nv">x86_64</span>.<span class="nv">rpm</span> 
<span class="nv">opennebula</span><span class="o">-</span><span class="nv">ruby</span><span class="o">-</span><span class="mi">5</span>.<span class="mi">1</span>.<span class="mi">80</span><span class="o">-</span><span class="mi">1</span>.<span class="nv">x86_64</span>.<span class="nv">rpm</span> <span class="nv">opennebula</span><span class="o">-</span><span class="nv">common</span><span class="o">-</span><span class="mi">5</span>.<span class="mi">1</span>.<span class="mi">80</span><span class="o">-</span><span class="mi">1</span>.<span class="nv">x86_64</span>.<span class="nv">rpm</span> <span class="nv">opennebula</span><span class="o">-</span><span class="nv">sunstone</span><span class="o">-</span><span class="mi">5</span>.<span class="mi">1</span>.<span class="mi">80</span><span class="o">-</span><span class="mi">1</span>.<span class="nv">x86_64</span>.<span class="nv">rpm</span>

在计算节点上安装 <span class="nv">kvm</span> 和 <span class="nv">opennebula</span><span class="o">-</span><span class="nv">node</span><span class="o">-</span><span class="nv">kvm</span>：
<span class="nv">yum</span> <span class="nv">install</span> <span class="nv">qemu</span><span class="o">-</span><span class="nv">kvm</span> <span class="nv">qemu</span><span class="o">-</span><span class="nv">kvm</span><span class="o">-</span><span class="nv">tools</span> <span class="nv">libvirt</span>
<span class="nv">yum</span> <span class="nv">localinstall</span> <span class="nv">opennebula</span><span class="o">-</span><span class="nv">node</span><span class="o">-</span><span class="nv">kvm</span><span class="o">-</span><span class="mi">5</span>.<span class="mi">1</span>.<span class="mi">80</span><span class="o">-</span><span class="mi">1</span>.<span class="nv">x86_64</span>.<span class="nv">rpm</span>
<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">init</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">libvirtd</span> <span class="nv">start</span>

安装搞定，<span class="nv">OpenNebula</span> 的安装就是这么简单，开始在控制节点上启动服务吧：
<span class="nv">vi</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">one</span><span class="o">/</span><span class="nv">sunstone</span><span class="o">-</span><span class="nv">server</span>.<span class="nv">conf</span>  配置控制台
<span class="nl">:host</span>: <span class="mi">0</span>.<span class="mi">0</span>.<span class="mi">0</span>.<span class="mi">0</span>
<span class="nl">:port</span>: <span class="mi">9869</span>

<span class="nv">systemctl</span> <span class="nv">start</span> <span class="nv">opennebula</span>
<span class="nv">systemctl</span> <span class="nv">start</span> <span class="nv">opennebula</span><span class="o">-</span><span class="nv">sunstone</span>



<span class="nv">http</span>:<span class="o">//</span><span class="mi">192</span>.<span class="mi">168</span>.<span class="mi">2</span>.<span class="mi">150</span>:<span class="mi">9869</span>  登录
<span class="nv">cat</span> <span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">lib</span><span class="o">/</span><span class="nv">one</span><span class="o">/</span>.<span class="nv">one</span><span class="o">/</span><span class="nv">one_auth</span>
<span class="nv">oneadmin</span>:<span class="mi">0</span><span class="nv">dee417dfb22f2372866d686c7b12889</span>

集群
<span class="nv">http</span>:<span class="o">//</span><span class="nv">www</span>.<span class="nv">chinacloud</span>.<span class="nv">cn</span><span class="o">/</span><span class="k">show</span>.<span class="nv">aspx</span>?<span class="nv">id</span><span class="o">=</span><span class="mi">20875</span><span class="o">&amp;</span><span class="nv">cid</span><span class="o">=</span><span class="mi">22</span>
<span class="nv">OpenNebula</span> <span class="mi">4</span>.<span class="mi">10</span>入门之安装和节点配置
　　环境说明：
　　所有系统环境管理端和节点宿主机都采用<span class="nv">CentOS</span> <span class="mi">6</span>.<span class="mi">6</span> <span class="nv">x86_64</span>
　　服务器使用情况：
　　<span class="mi">1</span>. 控制节点和存储节点使用同一台服务器.
　　<span class="mi">2</span>. 计算节点分别使用两台服务器
　　系统约定：
　　<span class="nv">cloud</span>.<span class="nv">webxury</span>.<span class="nv">com</span> <span class="mi">192</span>.<span class="mi">168</span>.<span class="mi">15</span>.<span class="mi">100</span> <span class="ss">(</span>计算节点<span class="ss">)</span>
　　<span class="nv">cloud1</span>.<span class="nv">webxury</span>.<span class="nv">com</span> <span class="mi">192</span>.<span class="mi">168</span>.<span class="mi">15</span>.<span class="mi">101</span> <span class="ss">(</span>计算节点<span class="ss">)</span>
　　<span class="nv">storage</span>.<span class="nv">webxury</span>.<span class="nv">com</span> <span class="mi">192</span>.<span class="mi">168</span>.<span class="mi">15</span>.<span class="mi">200</span> <span class="ss">(</span>存储和控制<span class="ss">)</span>
　　系统最小化安装<span class="ss">(</span>略过<span class="ss">)</span>,并且根据约定配置好<span class="nv">IP</span>地址,修改好计算机名,检查系统时间是否正确,确保机器能和外界通信,
并且将以上内容添加到本地<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">hosts</span>文件内,确保域名解析正常,并且永久关闭<span class="nv">SELINUX</span>以及<span class="nv">IPTABLES</span>,并且重启,方可进行安装部署.因为是测试,
所以暂时关闭,正式上线,需要添加需要权限以及防火墙的端口设定.
　　控制台安装篇
　　<span class="mi">1</span>. 为系统添加<span class="nv">EPEL</span>源,添加<span class="nv">EPEL</span>源的原因是因为要解决一些在安装上的依赖
　　<span class="nv">yum</span> –<span class="nv">y</span> <span class="nv">install</span> <span class="nv">epel</span><span class="o">-</span><span class="nv">release</span>
　　<span class="mi">2</span>. 为系统添加<span class="nv">Opennebula</span>官方源
　　# <span class="nv">vi</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">yum</span>.<span class="nv">repos</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">opennebula</span>.<span class="nv">repo</span> [<span class="nv">opennebula</span>] <span class="nv">name</span><span class="o">=</span><span class="nv">opennebula</span> <span class="nv">baseurl</span><span class="o">=</span><span class="nv">http</span>:<span class="o">//</span><span class="nv">downloads</span>.<span class="nv">opennebula</span>.<span class="nv">org</span><span class="o">/</span><span class="nv">repo</span><span class="o">/</span>
<span class="mi">4</span>.<span class="mi">10</span><span class="o">/</span><span class="nv">CentOS</span><span class="o">/</span><span class="mi">6</span><span class="o">/</span><span class="nv">x86_64</span><span class="o">/</span> <span class="nv">enabled</span><span class="o">=</span><span class="mi">1</span> <span class="nv">gpgcheck</span><span class="o">=</span><span class="mi">0</span>
　　<span class="mi">3</span>. 生成源缓存<span class="ss">(</span>个人习惯<span class="ss">)</span>
　　<span class="nv">yum</span> <span class="nv">makecache</span>
　　<span class="mi">4</span>. 安装<span class="nv">Opennebula</span>控制台.
　　<span class="mi">1</span>.<span class="ss">)</span># <span class="nv">yum</span> –<span class="nv">y</span> <span class="nv">install</span> <span class="nv">opennebula</span><span class="o">-</span><span class="nv">server</span> <span class="nv">opennebula</span><span class="o">-</span><span class="nv">sunstone</span>
　　安装完成之后创建如下用户以及目录文件：
　　# <span class="nv">grep</span> <span class="nv">oneadmin</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">passwd</span> <span class="nv">oneadmin</span>:<span class="nv">x</span>:<span class="mi">9869</span>:<span class="mi">9869</span>::<span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">lib</span><span class="o">/</span><span class="nv">one</span>:<span class="o">/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">bash</span> # <span class="nv">ls</span> <span class="o">-</span><span class="nv">ld</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">one</span><span class="o">/</span> <span class="o">//</span><span class="nv">OpenNebula</span>相关配置
文件所在目录 <span class="nv">drwxr</span><span class="o">-</span><span class="nv">x</span><span class="o">---</span>. <span class="mi">11</span> <span class="nv">root</span> <span class="nv">oneadmin</span> <span class="mi">4096</span> <span class="nv">Feb</span> <span class="mi">2</span> <span class="mi">11</span>:<span class="mi">35</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">one</span><span class="o">/</span> #<span class="nv">ls</span><span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">init</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">opennebula</span><span class="o">*</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">init</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">opennebula</span> 
<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">init</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">opennebula</span><span class="o">-</span><span class="nv">occi</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">init</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">opennebula</span><span class="o">-</span><span class="nv">sunstone</span> # <span class="nv">ls</span> <span class="o">-</span><span class="nv">ld</span> <span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">log</span><span class="o">/</span><span class="nv">one</span><span class="o">/</span> <span class="nv">drwxr</span><span class="o">-</span><span class="nv">x</span><span class="o">---</span>. 
<span class="mi">2</span> <span class="nv">oneadmin</span> <span class="nv">oneadmin</span> <span class="mi">4096</span> <span class="nv">Feb</span> <span class="mi">2</span> <span class="mi">01</span>:<span class="mi">13</span> <span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">log</span><span class="o">/</span><span class="nv">one</span><span class="o">/</span>
　　<span class="mi">2</span><span class="ss">)</span>.安装组件
　　# <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">share</span><span class="o">/</span><span class="nv">one</span><span class="o">/</span><span class="nv">install_gems</span> <span class="nv">lsb_release</span> <span class="nv">command</span> <span class="nv">not</span> <span class="nv">found</span>. <span class="k">If</span> <span class="nv">you</span> <span class="nv">are</span> <span class="nv">using</span> <span class="nv">a</span> <span class="nv">RedHat</span> <span class="nv">based</span> <span class="nv">distribution</span> <span class="nv">install</span> 
<span class="nv">redhat</span><span class="o">-</span><span class="nv">lsb</span> <span class="nv">Select</span> <span class="nv">your</span> <span class="nv">distribution</span> <span class="nv">or</span> <span class="nv">press</span> <span class="nv">enter</span> <span class="nv">to</span> <span class="k">continue</span> <span class="nv">without</span> <span class="nv">installing</span> <span class="nv">dependencies</span>.
 <span class="mi">0</span>. <span class="nv">CentOS</span><span class="o">/</span><span class="nv">RedHat</span> <span class="mi">1</span>. <span class="nv">Ubuntu</span><span class="o">/</span><span class="nv">Debian</span>
　　选择相对应的操作系统,我们选择<span class="mi">0</span>
　　<span class="mi">5</span>. 默认<span class="nv">OpenNebula</span>数据存储使用<span class="nv">sqlite</span>，如果需要使用<span class="nv">MySQL</span>，则需要做如下操作
　　<span class="mi">1</span><span class="ss">)</span>.安装<span class="nv">mysql</span>数据库
　　<span class="nv">yum</span> –<span class="nv">y</span> <span class="nv">install</span> <span class="nv">mysql</span> <span class="nv">mysql</span><span class="o">-</span><span class="nv">server</span> #<span class="nv">service</span> <span class="nv">mysqld</span> <span class="nv">start</span> #<span class="nv">chkconfig</span> <span class="nv">mysqld</span> <span class="nv">on</span>
　　并且设置<span class="nv">MYSQL</span>密码<span class="ss">(</span>忽略<span class="ss">)</span>
　　<span class="mi">2</span><span class="ss">)</span>.创建数据库
　　$ <span class="nv">mysql</span> <span class="o">-</span><span class="nv">u</span> <span class="nv">root</span> <span class="o">-</span><span class="nv">p</span> <span class="nv">Enter</span> <span class="nv">password</span>: <span class="nv">Welcome</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">MySQL</span> <span class="nv">monitor</span>. [...] <span class="nv">mysql</span><span class="o">&gt;</span> <span class="nv">GRANT</span> <span class="nv">ALL</span> <span class="nv">PRIVILEGES</span> <span class="nv">ON</span> <span class="nv">opennebula</span>.<span class="o">*</span>
 <span class="nv">TO</span> <span class="s1">&#39;</span><span class="s">用户名</span><span class="s1">&#39;</span> <span class="nv">IDENTIFIED</span> <span class="nv">BY</span> <span class="s1">&#39;</span><span class="s">密码</span><span class="s1">&#39;</span><span class="c1">; Query OK, 0 rows affected (0.00 sec)</span>
　　<span class="mi">3</span><span class="ss">)</span>.设置隔离级别
　　<span class="nv">mysql</span><span class="o">&gt;</span> <span class="nv">SET</span> <span class="nv">GLOBAL</span> <span class="nv">TRANSACTION</span> <span class="nv">ISOLATION</span> <span class="nv">LEVEL</span> <span class="nv">READ</span> <span class="nv">COMMITTED</span><span class="c1">;</span>
　　<span class="mi">6</span>. 修改配置文件如下 [用户、端口、密码、库名和实际情况对应修改：
　　# <span class="nv">vi</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">one</span><span class="o">/</span><span class="nv">oned</span>.<span class="nv">conf</span> … … #<span class="nv">DB</span> <span class="o">=</span> [ <span class="nv">backend</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">sqlite</span><span class="s2">&quot;</span> ] <span class="ss">(</span>记得把这行注销<span class="ss">)</span> 
    # <span class="nv">Sample</span> <span class="nv">configuration</span> <span class="k">for</span> <span class="nv">DB</span> <span class="o">=</span> [ <span class="nv">backend</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">mysql</span><span class="s2">&quot;</span>, <span class="nv">server</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">localhost</span><span class="s2">&quot;</span>, <span class="nv">port</span> <span class="o">=</span> <span class="mi">0</span>, 
    <span class="ss">(</span>这里<span class="mi">0</span>的意思代表使用<span class="nv">MYSQL</span>默认<span class="mi">3306</span>端口,所以不需要修改<span class="ss">)</span> <span class="nv">user</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">刚才设置的用户名</span><span class="s2">&quot;</span>, <span class="nv">passwd</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">刚才设置的密码</span><span class="s2">&quot;</span>, 
    <span class="nv">db_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">opennebula</span><span class="s2">&quot;</span> ] … …
　　<span class="mi">7</span>. 修改<span class="nv">sunstone</span>默认监听<span class="nv">IP</span>:
　　<span class="nv">vi</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">one</span><span class="o">/</span><span class="nv">sunstone</span><span class="o">-</span><span class="nv">server</span>.<span class="nv">conf</span>
　　找到 :<span class="nv">host</span>: <span class="mi">127</span>.<span class="mi">0</span>.<span class="mi">0</span>.<span class="mi">1</span>
　　修改成 :<span class="nv">host</span>: <span class="mi">0</span>.<span class="mi">0</span>.<span class="mi">0</span>.<span class="mi">0</span>
　　<span class="mi">8</span>.启动相关服务
　　# <span class="nv">service</span> <span class="nv">opennebula</span> <span class="nv">start</span> # <span class="nv">service</span> <span class="nv">opennebula</span><span class="o">-</span><span class="nv">sunstone</span> <span class="nv">start</span> #<span class="nv">chkconfig</span> <span class="nv">opennebula</span> <span class="nv">on</span> 
    #<span class="nv">chkconfig</span> <span class="nv">opennebula</span><span class="o">-</span><span class="nv">sunstone</span> <span class="nv">on</span>
　　<span class="mi">8</span>.添加<span class="nv">NFS</span>共享存储目录
　　<span class="nv">vi</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">exports</span> <span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">lib</span><span class="o">/</span><span class="nv">one</span><span class="o">/</span> <span class="o">*</span><span class="ss">(</span><span class="nv">rw</span>,<span class="nv">sync</span>,<span class="nv">no_subtree_check</span>,<span class="nv">root_squash</span><span class="ss">)</span>
　　启动服务
　　# <span class="nv">service</span> <span class="nv">rpcbind</span> <span class="nv">restart</span> # <span class="nv">service</span> <span class="nv">nfs</span> <span class="nv">restart</span> # <span class="nv">chkconfig</span> <span class="nv">nfs</span> <span class="nv">on</span> # <span class="nv">chkconfig</span> <span class="nv">rpcbind</span> <span class="nv">on</span>
　　<span class="mi">9</span>.添加<span class="nv">SSH</span>公共<span class="nv">KEY</span>
　　# <span class="nv">su</span> <span class="o">-</span> <span class="nv">oneadmin</span> $ <span class="nv">vi</span> <span class="o">~/</span>.<span class="nv">ssh</span><span class="o">/</span><span class="nv">config</span>
　　添加以下内容
　　<span class="nv">Host</span> <span class="o">*</span> <span class="nv">StrictHostKeyChecking</span> <span class="nv">no</span> <span class="nv">UserKnownHostsFile</span> <span class="o">/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">null</span>
　　修改文件权限
　　$ <span class="nv">chmod</span> <span class="mi">600</span> <span class="o">~/</span>.<span class="nv">ssh</span><span class="o">/</span><span class="nv">config</span>
　　<span class="mi">10</span>.修改<span class="nv">oneadmin</span>密码
　　#<span class="nv">su</span> <span class="nv">oneadmin</span> $<span class="nv">passwd</span> <span class="nv">oneadmin</span>
　　注：测试过程中因为测试环境服务端时间不对，导致<span class="nv">cookie</span>被忽略，<span class="nv">OpenNebula</span> <span class="nv">Sunstone</span>选择<span class="nv">Keep</span> <span class="nv">me</span> <span class="nv">logged</span> <span class="nv">in</span>
一直登陆不上或者直接登陆很快退出，寻找原因花了很长时间，最后调整到正确时间，登陆显示<span class="nv">ok</span>。
　　<span class="nv">P</span>.<span class="nv">S</span>: 时间是一个非常容易被我们忽略的问题，切记切记<span class="o">!</span>
　　完成以上步骤之后，浏览器登陆 <span class="nv">http</span>:<span class="o">//</span><span class="nv">ip</span>:<span class="mi">9869</span> 即可
　　节点安装篇
　　系统约定:
　　<span class="nv">cloud</span>.<span class="nv">webxury</span>.<span class="nv">com</span> <span class="mi">192</span>.<span class="mi">168</span>.<span class="mi">15</span>.<span class="mi">100</span> <span class="ss">(</span>计算节点<span class="ss">)</span>
　　<span class="nv">cloud1</span>.<span class="nv">webxury</span>.<span class="nv">com</span> <span class="mi">192</span>.<span class="mi">168</span>.<span class="mi">15</span>.<span class="mi">101</span> <span class="ss">(</span>计算节点<span class="ss">)</span>
　　<span class="nv">storage</span>.<span class="nv">webxury</span>.<span class="nv">com</span> <span class="mi">192</span>.<span class="mi">168</span>.<span class="mi">15</span>.<span class="mi">200</span> <span class="ss">(</span>存储和控制<span class="ss">)</span>
　　系统最小化安装<span class="ss">(</span>略过<span class="ss">)</span>,并且根据约定配置好<span class="nv">IP</span>地址,修改好计算机名,检查系统时间是否正确,确保机器能和外界通信,
并且将以上内容添加到本地<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">hosts</span>文件内,确保域名解析正常,并且永久关闭<span class="nv">SELINUX</span>以及<span class="nv">IPTABLES</span>,并且重启,方可进行安装部署.
因为是测试,所以暂时关闭,正式上线,需要添加需要权限以及防火墙的端口设定.
　　安装篇
　　<span class="mi">1</span>.为系统添加<span class="nv">EPEL</span>源,添加<span class="nv">EPEL</span>源的原因是因为要解决一些在安装上的依赖
　　<span class="nv">yum</span> –<span class="nv">y</span> <span class="nv">install</span> <span class="nv">epel</span><span class="o">-</span><span class="nv">release</span>
　　<span class="mi">2</span>.为系统添加<span class="nv">Opennebula</span>官方源
　　# <span class="nv">vi</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">yum</span>.<span class="nv">repos</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">opennebula</span>.<span class="nv">repo</span> [<span class="nv">opennebula</span>] <span class="nv">name</span><span class="o">=</span><span class="nv">opennebula</span> <span class="nv">baseurl</span><span class="o">=</span>
    <span class="nv">http</span>:<span class="o">//</span><span class="nv">downloads</span>.<span class="nv">opennebula</span>.<span class="nv">org</span><span class="o">/</span><span class="nv">repo</span><span class="o">/</span><span class="mi">4</span>.<span class="mi">10</span><span class="o">/</span><span class="nv">CentOS</span><span class="o">/</span><span class="mi">6</span><span class="o">/</span><span class="nv">x86_64</span><span class="o">/</span> <span class="nv">enabled</span><span class="o">=</span><span class="mi">1</span> <span class="nv">gpgcheck</span><span class="o">=</span><span class="mi">0</span>
　　<span class="mi">3</span>.生成源缓存<span class="ss">(</span>个人习惯<span class="ss">)</span>
　　<span class="nv">yum</span> <span class="nv">makecache</span>
　　<span class="mi">4</span>.安装节点组件
　　<span class="nv">yum</span> –<span class="nv">y</span> <span class="nv">install</span> <span class="nv">opennebula</span><span class="o">-</span><span class="nv">node</span><span class="o">-</span><span class="nv">kvm</span>
　　启动相关服务
　　# <span class="nv">service</span> <span class="nv">messagebus</span> <span class="nv">start</span> # <span class="nv">service</span> <span class="nv">libvirtd</span> <span class="nv">start</span> # <span class="nv">chkconfig</span> <span class="nv">messagebus</span> <span class="nv">on</span> # <span class="nv">chkconfig</span> <span class="nv">libvirtd</span> <span class="nv">on</span>
　　<span class="mi">5</span>.给系统网卡做桥接
　　首先先复制一份<span class="nv">ifcfg</span><span class="o">-</span><span class="nv">eth0</span>的文件,重命名为<span class="nv">ifcfg</span><span class="o">-</span><span class="nv">br0</span>
　　网卡路径: <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">sysconfig</span><span class="o">/</span><span class="nv">network</span><span class="o">-</span><span class="nv">scripts</span><span class="o">/</span><span class="nv">ifcfg</span><span class="o">-</span><span class="nv">eth0</span>
　　拷贝一份<span class="nv">eth0</span>,并且重命名为<span class="nv">br0</span>
　　<span class="nv">cd</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">sysconfig</span><span class="o">/</span><span class="nv">network</span><span class="o">-</span><span class="nv">scripts</span><span class="o">/</span>
　　<span class="nv">cp</span> <span class="nv">ifcfg</span><span class="o">-</span><span class="nv">eth0</span> <span class="nv">ifcfg</span><span class="o">-</span><span class="nv">br0</span>
　　修改网卡文件<span class="nv">eth0</span>
　　<span class="nv">DEVICE</span><span class="o">=</span><span class="nv">eth0</span> <span class="nv">BOOTPROTO</span><span class="o">=</span><span class="nv">none</span> <span class="nv">NM_CONTROLLED</span><span class="o">=</span><span class="nv">no</span> <span class="nv">ONBOOT</span><span class="o">=</span><span class="nv">yes</span> <span class="nv">TYPE</span><span class="o">=</span><span class="nv">Ethernet</span> <span class="nv">BRIDGE</span><span class="o">=</span><span class="nv">br0</span>
　　修改刚才拷贝的<span class="nv">ifcfg</span><span class="o">-</span><span class="nv">br0</span>文件
　　<span class="nv">DEVICE</span><span class="o">=</span><span class="nv">br0</span><span class="ss">(</span>记得修改网卡名称,因为是复制过来的<span class="ss">)</span> <span class="nv">TYPE</span><span class="o">=</span><span class="nv">Bridge</span> <span class="nv">IPADDR</span><span class="o">=</span><span class="mi">192</span>.<span class="mi">168</span>.<span class="mi">15</span>.<span class="mi">100</span> <span class="nv">NETMASK</span><span class="o">=</span><span class="mi">255</span>.<span class="mi">255</span>.<span class="mi">255</span>.<span class="mi">0</span> 
    <span class="nv">GATEWAY</span><span class="o">=</span><span class="mi">192</span>.<span class="mi">168</span>.<span class="mi">15</span>.<span class="mi">1</span> <span class="nv">DNS1</span><span class="o">=</span><span class="mi">8</span>.<span class="mi">8</span>.<span class="mi">8</span>.<span class="mi">8</span> <span class="nv">DNS2</span><span class="o">=</span><span class="mi">8</span>.<span class="mi">8</span>.<span class="mi">4</span>.<span class="mi">4</span> <span class="nv">ONBOOT</span><span class="o">=</span><span class="nv">yes</span> <span class="nv">BOOTPROTO</span><span class="o">=</span><span class="nv">static</span> <span class="nv">NM_CONTROLLED</span><span class="o">=</span><span class="nv">no</span>
　　重启网卡
　　# <span class="nv">service</span> <span class="nv">network</span> <span class="nv">restart</span>
　　<span class="mi">6</span>. 挂载存储的<span class="nv">NFS</span>共享目录
　　编辑: <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">fstab</span>
　　添加以下内容
　　<span class="mi">192</span>.<span class="mi">168</span>.<span class="mi">15</span>.<span class="mi">200</span>:<span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">lib</span><span class="o">/</span><span class="nv">one</span> <span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">lib</span><span class="o">/</span><span class="nv">one</span><span class="o">/</span> <span class="nv">nfs</span> <span class="nv">soft</span>,<span class="nv">intr</span>,<span class="nv">rsize</span><span class="o">=</span><span class="mi">8192</span>,<span class="nv">wsize</span><span class="o">=</span><span class="mi">8192</span>,<span class="nv">noauto</span>
　　<span class="mi">7</span>. 修改<span class="nv">oneadmin</span>密码
　　#<span class="nv">passwd</span> <span class="nv">oneadmin</span>
　　回到控制节点服务器,让<span class="nv">SSH</span>无密码登陆节点服务器,否则控制节点添加计算节点将会失败
　　[<span class="nv">oneadmin</span>@<span class="nv">storage</span> <span class="o">~</span>]# <span class="nv">su</span> <span class="nv">oneadmin</span> [<span class="nv">oneadmin</span>@<span class="nv">storage</span> <span class="o">~</span>]$ <span class="nv">ssh</span><span class="o">-</span><span class="nv">keygen</span> <span class="nv">Generating</span> <span class="nv">public</span><span class="o">/</span><span class="nv">private</span> <span class="nv">rsa</span> <span class="nv">key</span> <span class="nv">pair</span>. 
<span class="nv">Enter</span> <span class="nv">file</span> <span class="nv">in</span> <span class="nv">which</span> <span class="nv">to</span> <span class="nv">save</span> <span class="nv">the</span> <span class="nv">key</span> <span class="ss">(</span><span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">lib</span><span class="o">/</span><span class="nv">one</span><span class="o">/</span>.<span class="nv">ssh</span><span class="o">/</span><span class="nv">id_rsa</span><span class="ss">)</span>: <span class="nv">Enter</span> <span class="nv">passphrase</span> <span class="ss">(</span><span class="nv">empty</span> <span class="k">for</span> <span class="nv">no</span> <span class="nv">passphrase</span><span class="ss">)</span>: 
<span class="nv">Enter</span> <span class="nv">same</span> <span class="nv">passphrase</span> <span class="nv">again</span>: <span class="nv">Your</span> <span class="nv">identification</span> <span class="nv">has</span> <span class="nv">been</span> <span class="nv">saved</span> <span class="nv">in</span> <span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">lib</span><span class="o">/</span><span class="nv">one</span><span class="o">/</span>.<span class="nv">ssh</span><span class="o">/</span><span class="nv">id_rsa</span>. 
<span class="nv">Your</span> <span class="nv">public</span> <span class="nv">key</span> <span class="nv">has</span> <span class="nv">been</span> <span class="nv">saved</span> <span class="nv">in</span> <span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">lib</span><span class="o">/</span><span class="nv">one</span><span class="o">/</span>.<span class="nv">ssh</span><span class="o">/</span><span class="nv">id_rsa</span>.<span class="nv">pub</span>. 一路回车直到结束 
[<span class="nv">oneadmin</span>@<span class="nv">storage</span><span class="o">~</span>]$<span class="nv">ssh</span><span class="o">-</span><span class="nv">copy</span><span class="o">-</span><span class="nv">id</span> <span class="o">-</span><span class="nv">i</span> <span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">lib</span><span class="o">/</span><span class="nv">one</span><span class="o">/</span>.<span class="nv">ssh</span><span class="o">/</span><span class="nv">id_rsa</span>.<span class="nv">pub</span> <span class="nv">oneadmin</span>@<span class="nv">cloud</span>.<span class="nv">webxury</span>.<span class="nv">com</span> <span class="nv">oneadmin</span>@<span class="nv">cloud</span>.<span class="nv">webxury</span>.<span class="nv">com</span> 
<span class="s1">&#39;</span><span class="s">s password: .ssh/authorized_keys</span>
　　根据提示输入密码后,已经成功登陆节点服务器,然后退出,尝试再次从控制节点服务器,<span class="nv">ssh</span>进入节点服务器,已经是不需要密码了,说明设置成功,
然后退出,并且重启服务器,服务器启动后,请检查是否挂载成功.
　　注:挂载的时候我遇到一个问题,我把<span class="nv">storage</span>挂载到每一个节点下的<span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">lib</span><span class="o">/</span><span class="nv">one</span><span class="o">/</span>目录下,发现权限已经改变,默认权限所属用户组和用户名
都是<span class="nv">oneadmin</span>,但是挂在后发现用户名密码都是<span class="nv">nobody</span>,所以我们要修改<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">idmapd</span>.<span class="nv">conf</span>这个文件,把<span class="nv">Nobody</span><span class="o">-</span><span class="nv">User</span><span class="o">=</span><span class="nv">XXX</span>修改成
<span class="nv">oneadmin</span>,<span class="nv">Nobody</span><span class="o">-</span><span class="nv">Group</span><span class="o">=</span><span class="nv">XXX</span>也同样修改成<span class="nv">oneadmin</span>,并且重启服务,<span class="nv">service</span> <span class="nv">rpcidmapd</span> <span class="nv">restart</span>.
　　安装教程基本完成,可以简单做测试,现在我们打开<span class="nv">UI</span>界面.


　　现在看到集群里面,有<span class="mi">2</span>个计算节点,一个虚拟网络,<span class="mi">3</span>个存储.这个是正确的.
　　现在我们导入官方的一个模板和镜像文件做测试.　　
</pre></div>


<h2 id="tmpfs">tmpfs</h2>
<div class="codehilite"><pre><span></span><span class="n">mount</span><span class="w">  </span><span class="o">-</span><span class="n">t</span><span class="w"> </span><span class="n">tmpfs</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="k">size</span><span class="o">=</span><span class="mi">20</span><span class="n">m</span><span class="w">  </span><span class="n">tmpfs</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">tmp</span><span class="w"></span>
<span class="n">mount</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">remount</span><span class="p">,</span><span class="k">size</span><span class="o">=</span><span class="mi">25</span><span class="n">G</span><span class="w"> </span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">mysql</span><span class="o">/</span><span class="n">data3326</span><span class="o">/</span><span class="w">  </span><span class="n">动态修改大小</span><span class="w"></span>

<span class="w">   </span><span class="n">上面这条命令分配了上限为20m的VM到</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">tmp目录下</span><span class="err">，</span><span class="n">用df命令查看一下</span><span class="err">，</span><span class="n">确实</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">tmp挂载点显示的大小是20m</span><span class="err">，</span><span class="w"></span>
<span class="w">   </span><span class="n">但是tmpfs一个优点就是它的大小是随着实际存储的容量而变化的</span><span class="err">，</span><span class="n">换句话说</span><span class="err">，</span><span class="n">假如</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">tmp目录下什么也没有</span><span class="err">，</span><span class="n">tmpfs并不占用VM</span><span class="err">。</span><span class="w"></span>
<span class="w">   </span><span class="n">上面的参数20m只是告诉内核这个挂载点最大可用的VM为20m</span><span class="err">，</span><span class="n">如果不加上这个参数</span><span class="err">，</span><span class="n">tmpfs默认的大小是RM的一半</span><span class="err">，</span><span class="n">假如你的物理内存是128M</span><span class="err">，</span><span class="w"></span>
<span class="w">   </span><span class="n">那么tmpfs默认的大小就是64M</span><span class="err">，</span><span class="w"></span>

<span class="w">    </span><span class="n">tmpfs有没有缺点呢</span><span class="vm">?</span><span class="w"></span>

<span class="w">    </span><span class="n">当然有</span><span class="err">，</span><span class="n">由于它的数据是在VM里面</span><span class="err">，</span><span class="n">因此断电或者你卸载它之后</span><span class="err">，</span><span class="n">数据就会立即丢失</span><span class="err">，</span><span class="n">这也许就是它叫tmpfs的原故</span><span class="err">。</span><span class="n">不过这其实不能说是缺点</span><span class="err">。</span><span class="w"></span>
<span class="w">    </span><span class="n">那tmpfs到底有什么用呢</span><span class="err">？</span><span class="w"></span>

<span class="w">    </span><span class="n">tmpfs的用途</span><span class="w"></span>

<span class="w">     </span><span class="n">由于tmpfs使用的是VM</span><span class="err">，</span><span class="n">因此它比硬盘的速度肯定要快</span><span class="err">，</span><span class="n">因此我们可以利用这个优点使用它来提升机器的性能</span><span class="err">。</span><span class="w"></span>

<span class="w">     </span><span class="n">#mount</span><span class="w"> </span><span class="o">-</span><span class="n">t</span><span class="w"> </span><span class="n">tmpfs</span><span class="w">  </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="k">size</span><span class="o">=</span><span class="mi">2</span><span class="n">m</span><span class="w">   </span><span class="n">tmpfs</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="w"></span>

<span class="w">     </span><span class="n">上面这条命令分配了最大2m的VM给</span><span class="o">/</span><span class="n">tmp</span><span class="err">。</span><span class="w">  </span>

<span class="w">      </span><span class="n">由于</span><span class="o">/</span><span class="n">tmp目录是放临时文件的地方</span><span class="err">，</span><span class="n">因此我们可以使用tmpfs来加快速度</span><span class="err">，</span><span class="n">由于没有挂载之前</span><span class="o">/</span><span class="n">tmp目录下的文件也许正在被使用</span><span class="err">，</span><span class="w"></span>
<span class="w">      </span><span class="n">因此挂载之后系统也许有的程序不能正常工作</span><span class="err">。</span><span class="n">没有关系</span><span class="err">，</span><span class="n">只要在</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">fstab里面加上下面的语句</span><span class="w"></span>

<span class="w">     </span><span class="n">tmpfs</span><span class="w">    </span><span class="o">/</span><span class="n">tmp</span><span class="w">      </span><span class="n">tmpfs</span><span class="w">  </span><span class="k">size</span><span class="o">=</span><span class="mi">2</span><span class="n">m</span><span class="w">    </span><span class="mi">0</span><span class="w">   </span><span class="mi">0</span><span class="w"></span>

<span class="w">    </span><span class="n">tmpfs应用案例</span><span class="w"></span>
<span class="n">以下是使用tmpfs文件系统的一些应用示例</span><span class="err">，</span><span class="n">一般tmpfs内存文件系统在做web缓存</span><span class="err">，</span><span class="n">cache</span><span class="err">，</span><span class="n">临时文件存储时会对web访问有很好的加速作用</span><span class="err">，</span><span class="w"></span>
<span class="n">从而提高网站访问的速度</span><span class="err">。</span><span class="w"> </span>
<span class="mf">1.</span><span class="n">反向代理缓存中</span><span class="err">，</span><span class="n">缓存目录使用tmpfs</span><span class="w"> </span>
<span class="n">例如下面是Nginx作为反向代理缓存的配置片段</span><span class="err">，</span><span class="n">可以将</span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">cdn_cache目录挂载为tmpfs</span><span class="err">。</span><span class="w"></span>
<span class="n">proxy_temp_path</span><span class="w">  </span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">cdn_cache</span><span class="o">/</span><span class="n">proxy_temp_dir</span><span class="p">;</span><span class="w"></span>
<span class="n">proxy_cache_path</span><span class="w"> </span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">cdn_cache</span><span class="o">/</span><span class="n">proxy_cache_dirlevels</span><span class="o">=</span><span class="mi">1</span><span class="err">:</span><span class="mi">2</span><span class="w"> </span><span class="n">keys_zone</span><span class="o">=</span><span class="nl">cache_one</span><span class="p">:</span><span class="mi">50</span><span class="n">m</span><span class="w"> </span><span class="n">inactive</span><span class="o">=</span><span class="mi">1</span><span class="n">d</span><span class="w"></span>

<span class="mf">2.</span><span class="n">将php的session文件放在tmpfs下</span><span class="w"> </span>
<span class="n">PHP保存seesion的方法很简单</span><span class="p">,</span><span class="n">只要修改php</span><span class="p">.</span><span class="n">ini就行了</span><span class="err">，</span><span class="n">首先挂载好tmpfs</span><span class="err">，</span><span class="n">然后修改配置文件如下</span><span class="err">：</span><span class="w"></span>
<span class="k">session</span><span class="p">.</span><span class="n">save_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">“</span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">php_session</span><span class="err">”</span><span class="w"></span>

<span class="mf">3.</span><span class="n">将服务的socket文件放在tmpfs下</span><span class="w"> </span>
<span class="n">例如在Web应用中</span><span class="err">，</span><span class="n">我们有PHP的FastCGIsocket</span><span class="err">、</span><span class="n">MySQL的</span><span class="w"> </span><span class="n">mysql</span><span class="p">.</span><span class="n">sock等等类似的socket文件</span><span class="err">，</span><span class="n">都可以放在tmpfs挂载的目录下提高性能</span><span class="err">。</span><span class="w"></span>

<span class="mf">4.</span><span class="n">其它需要高性能读写的场景</span><span class="w"></span>

<span class="n">首先</span><span class="err">，</span><span class="n">我们先来看看操作系统</span><span class="err">，</span><span class="n">在你的系统中执行df</span><span class="w"> </span><span class="err">–</span><span class="n">h查看系统的磁盘使用</span><span class="err">。</span><span class="w"></span>

<span class="w">  </span><span class="n">你会发现除了我们正常的磁盘分区挂载点外</span><span class="err">，</span><span class="n">系统还有一种叫做devtmpfs的文件系统</span><span class="err">，</span><span class="n">和多个tmpfs</span><span class="err">。</span><span class="n">那么什么是tmpfs呢</span><span class="err">？</span><span class="w"></span>

<span class="n">tmpfs简介</span><span class="w"></span>
<span class="n">tmpfs是Linux</span><span class="o">/</span><span class="n">Unix系统上的一种基于内存的文件系统</span><span class="err">。</span><span class="n">tmpfs可以使用您的内存或swap分区来存储文件</span><span class="err">。</span><span class="n">在Redhat</span><span class="o">/</span><span class="n">CentOS等linux发行版</span><span class="w"></span>
<span class="n">中默认大小为物理内存的一半</span><span class="err">。</span><span class="n">例如上面的案例中</span><span class="err">，</span><span class="n">我执行df</span><span class="w"> </span><span class="o">-</span><span class="n">h的服务器是64G内存</span><span class="err">。</span><span class="w"></span>
<span class="n">首先我们要说明</span><span class="err">，</span><span class="n">tmpfs</span><span class="w"> </span><span class="n">既可以使用物理内存</span><span class="err">，</span><span class="n">也可以使用交换分区</span><span class="err">，</span><span class="n">因为tmpfs使用的是</span><span class="w"> </span><span class="err">“</span><span class="n">虚拟内存</span><span class="err">”。</span><span class="n">Linux内核的虚拟内存同时来源于</span><span class="w"></span>
<span class="n">物理内存和交换分区</span><span class="err">，</span><span class="n">主要由内核中的</span><span class="w"> </span><span class="n">VM</span><span class="w"> </span><span class="n">子系统进行调度</span><span class="err">，</span><span class="n">进行内存页和SWAP的换入和换出操作</span><span class="err">，</span><span class="n">tmpfs</span><span class="w"> </span><span class="n">自己并不知道这些页面是在</span><span class="w"></span>
<span class="n">交换分区还是在物理内存中</span><span class="err">。</span><span class="w"></span>

<span class="n">tmpfs使用</span><span class="w"></span>
<span class="n">如果你想使用tmpfs</span><span class="err">，</span><span class="n">那么最简单的办法就是直接将文件存放在</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm下</span><span class="err">，</span><span class="n">虽然这并不是推荐的方案</span><span class="err">，</span><span class="n">因为</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm是给共享内存分配的</span><span class="err">，</span><span class="w"></span>
<span class="n">共享内存是进程间通信的一种方式</span><span class="err">。</span><span class="w"></span>
<span class="n">下面我们来做一个小实验</span><span class="err">，</span><span class="n">检验下tmpfs的特性</span><span class="err">，</span><span class="n">首先我们可以看到我目前的系统</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm的使用是12K</span><span class="err">，</span><span class="n">可用的内存为62237</span><span class="err">。</span><span class="w"></span>
<span class="o">[</span><span class="n">root@linux-node1 ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">-</span><span class="n">h</span><span class="w"></span>
<span class="n">Filesystem</span><span class="w">     </span><span class="k">Size</span><span class="w">  </span><span class="n">Used</span><span class="w"> </span><span class="n">Avail</span><span class="w"> </span><span class="k">Use</span><span class="o">%</span><span class="w"> </span><span class="n">Mounted</span><span class="w"> </span><span class="k">on</span><span class="w"></span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda3</span><span class="w">      </span><span class="mf">1.1</span><span class="n">T</span><span class="w">  </span><span class="mf">2.8</span><span class="n">G</span><span class="w">  </span><span class="mf">1.1</span><span class="n">T</span><span class="w">  </span><span class="mi">1</span><span class="o">%</span><span class="w"> </span><span class="o">/</span><span class="w"></span>
<span class="n">devtmpfs</span><span class="w">        </span><span class="mi">32</span><span class="n">G</span><span class="w">     </span><span class="mi">0</span><span class="w">   </span><span class="mi">32</span><span class="n">G</span><span class="w">  </span><span class="mi">0</span><span class="o">%</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="w"></span>
<span class="n">tmpfs</span><span class="w">           </span><span class="mi">32</span><span class="n">G</span><span class="w">   </span><span class="mi">12</span><span class="n">K</span><span class="w">   </span><span class="mi">32</span><span class="n">G</span><span class="w">  </span><span class="mi">1</span><span class="o">%</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm</span><span class="w"></span>
<span class="o">**</span><span class="n">省略部分输出</span><span class="o">**</span><span class="w"></span>

<span class="o">[</span><span class="n">root@linux-node1 ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="k">free</span><span class="w"> </span><span class="o">-</span><span class="n">m</span><span class="w"></span>
<span class="w">             </span><span class="n">total</span><span class="w">        </span><span class="n">used</span><span class="w">        </span><span class="k">free</span><span class="w">      </span><span class="n">shared</span><span class="w"> </span><span class="n">buff</span><span class="o">/</span><span class="n">cache</span><span class="w">   </span><span class="n">available</span><span class="w"></span>
<span class="nl">Mem</span><span class="p">:</span><span class="w">         </span><span class="mi">64152</span><span class="w">        </span><span class="mi">1444</span><span class="w">       </span><span class="mi">60467</span><span class="w">          </span><span class="mi">42</span><span class="w">        </span><span class="mi">2239</span><span class="w">       </span><span class="mi">62237</span><span class="w"></span>
<span class="nl">Swap</span><span class="p">:</span><span class="w">        </span><span class="mi">16383</span><span class="w">           </span><span class="mi">0</span><span class="w">       </span><span class="mi">16383</span><span class="w"></span>

<span class="n">这里我准备了一个81M的文件</span><span class="err">，</span><span class="n">我准备把它放入到tmpfs中</span><span class="err">。</span><span class="w"></span>
<span class="err">#</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="o">-</span><span class="n">lh</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="k">local</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="w"></span>
<span class="n">total</span><span class="w"> </span><span class="mi">81</span><span class="n">M</span><span class="w"></span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="c1">--r-- 1 root root 81M Apr 14 22:46go1.6.1.linux-amd64.tar.gz</span>
<span class="err">#</span><span class="w"> </span><span class="n">cp</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="k">local</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">go1</span><span class="mf">.6.1</span><span class="p">.</span><span class="n">linux</span><span class="o">-</span><span class="n">amd64</span><span class="p">.</span><span class="n">tar</span><span class="p">.</span><span class="n">gz</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm</span><span class="o">/</span><span class="w"></span>

<span class="n">下面我们再来看磁盘大小和内存大小</span><span class="err">。</span><span class="n">可以发现</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm的大小变成了81M</span><span class="err">，</span><span class="n">可用内存变成了62156</span><span class="err">。</span><span class="w"></span>
<span class="o">[</span><span class="n">root@linux-node1 ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">-</span><span class="n">h</span><span class="w"></span>
<span class="n">Filesystem</span><span class="w">     </span><span class="k">Size</span><span class="w">  </span><span class="n">Used</span><span class="w"> </span><span class="n">Avail</span><span class="w"> </span><span class="k">Use</span><span class="o">%</span><span class="w"> </span><span class="n">Mounted</span><span class="w"> </span><span class="k">on</span><span class="w"></span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda3</span><span class="w">      </span><span class="mf">1.1</span><span class="n">T</span><span class="w">  </span><span class="mf">2.8</span><span class="n">G</span><span class="w">  </span><span class="mf">1.1</span><span class="n">T</span><span class="w">  </span><span class="mi">1</span><span class="o">%</span><span class="w"> </span><span class="o">/</span><span class="w"></span>
<span class="n">devtmpfs</span><span class="w">        </span><span class="mi">32</span><span class="n">G</span><span class="w">     </span><span class="mi">0</span><span class="w">   </span><span class="mi">32</span><span class="n">G</span><span class="w">  </span><span class="mi">0</span><span class="o">%</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="w"></span>
<span class="n">tmpfs</span><span class="w">           </span><span class="mi">32</span><span class="n">G</span><span class="w">   </span><span class="mi">81</span><span class="n">M</span><span class="w">  </span><span class="mi">32</span><span class="n">G</span><span class="w">   </span><span class="mi">1</span><span class="o">%</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm</span><span class="w"></span>
<span class="o">**</span><span class="n">省略部分输出</span><span class="o">**</span><span class="w"></span>

<span class="o">[</span><span class="n">root@linux-node1 ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="k">free</span><span class="w"> </span><span class="o">-</span><span class="n">m</span><span class="w"></span>
<span class="w">              </span><span class="n">total</span><span class="w">        </span><span class="n">used</span><span class="w">        </span><span class="k">free</span><span class="w">      </span><span class="n">shared</span><span class="w"> </span><span class="n">buff</span><span class="o">/</span><span class="n">cache</span><span class="w">   </span><span class="n">available</span><span class="w"></span>
<span class="nl">Mem</span><span class="p">:</span><span class="w">         </span><span class="mi">64152</span><span class="w">        </span><span class="mi">1445</span><span class="w">       </span><span class="mi">60386</span><span class="w">         </span><span class="mi">123</span><span class="w">        </span><span class="mi">2320</span><span class="w">       </span><span class="mi">62156</span><span class="w"></span>
<span class="nl">Swap</span><span class="p">:</span><span class="w">        </span><span class="mi">16383</span><span class="w">           </span><span class="mi">0</span><span class="w">       </span><span class="mi">16383</span><span class="w"></span>

<span class="n">我们来做一个小学数学题</span><span class="w"></span>
<span class="n">可用内存</span><span class="err">：</span><span class="mi">62237</span><span class="o">-</span><span class="mi">62156</span><span class="o">=</span><span class="mi">81</span><span class="err">，</span><span class="n">证明我们放置的81M的文件是使用了内存空间</span><span class="err">。</span><span class="w"></span>
<span class="n">共享内存</span><span class="err">：</span><span class="mi">123</span><span class="o">-</span><span class="mi">42</span><span class="o">=</span><span class="mi">81</span><span class="err">，</span><span class="n">证明</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm是Linux给共享内存使用的</span><span class="w"></span>
<span class="w">  </span><span class="n">好的</span><span class="err">，</span><span class="n">现在你可以将这个81M的文件移动走</span><span class="err">，</span><span class="n">会发现内存使用率恢复如初</span><span class="err">，</span><span class="n">可以证明tmpfs是动态变化的</span><span class="err">，</span><span class="n">数据被移除后</span><span class="err">，</span><span class="n">所占用的</span><span class="w"></span>
<span class="w">  </span><span class="n">虚拟内存也会被释放</span><span class="err">，</span><span class="n">这里我不在截图了</span><span class="err">，</span><span class="n">大家可以自行实验</span><span class="err">。</span><span class="w"></span>

<span class="n">tmpfs挂载</span><span class="w"></span>
<span class="n">与其他文件系统不同</span><span class="err">，</span><span class="n">tmpfs</span><span class="w"> </span><span class="n">无需要建立或格式化</span><span class="err">，</span><span class="n">只需要直接使用</span><span class="w"> </span><span class="n">mount</span><span class="w"> </span><span class="n">挂载就会自动被建立</span><span class="err">：</span><span class="w"></span>
<span class="err">#</span><span class="w"> </span><span class="n">mount</span><span class="w"> </span><span class="o">-</span><span class="n">t</span><span class="w"> </span><span class="n">tmpfs</span><span class="w"> </span><span class="n">tmpfs</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">tmp</span><span class="w"></span>
<span class="err">#</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">-</span><span class="n">h</span><span class="w"></span>
<span class="n">Filesystem</span><span class="w">     </span><span class="k">Size</span><span class="w">  </span><span class="n">Used</span><span class="w"> </span><span class="n">Avail</span><span class="w"> </span><span class="k">Use</span><span class="o">%</span><span class="w"> </span><span class="n">Mounted</span><span class="w"> </span><span class="k">on</span><span class="w"></span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda3</span><span class="w">      </span><span class="mf">1.1</span><span class="n">T</span><span class="w">  </span><span class="mf">2.7</span><span class="n">G</span><span class="w">  </span><span class="mf">1.1</span><span class="n">T</span><span class="w">  </span><span class="mi">1</span><span class="o">%</span><span class="w"> </span><span class="o">/</span><span class="w"></span>
<span class="o">**</span><span class="n">省略部分输出</span><span class="o">**</span><span class="w"></span>
<span class="n">tmpfs</span><span class="w">            </span><span class="mi">32</span><span class="n">G</span><span class="w">     </span><span class="mi">0</span><span class="w">  </span><span class="mi">32</span><span class="n">G</span><span class="w">   </span><span class="mi">0</span><span class="o">%</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">tmp</span><span class="w"></span>
<span class="w">  </span><span class="n">现在我们就挂载了一个tmpfs文件系统到</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">tmp目录下</span><span class="err">，</span><span class="n">默认它是系统内存的一半</span><span class="err">，</span><span class="n">你可以自由的使用它</span><span class="err">，</span><span class="n">那么我们第一个问题就是</span><span class="err">，</span><span class="w"></span>
<span class="w">  </span><span class="n">如何能够自定义分配的内存大小</span><span class="err">，</span><span class="n">tmpfs支持相关的选项来让用户自定义</span><span class="w"></span>
<span class="n">Linux上的</span><span class="w"> </span><span class="n">tmpfs</span><span class="w"> </span><span class="n">支援三个挂载选项</span><span class="err">：</span><span class="w"></span>
<span class="k">size</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">设定分配给此</span><span class="w"> </span><span class="n">tmpfs</span><span class="w"> </span><span class="n">文件系统的内存上限</span><span class="err">，</span><span class="n">默认是内存的一半</span><span class="err">。</span><span class="n">也可以在尾加上百分比</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">表示占用内存的百分比</span><span class="err">，</span><span class="mi">0</span><span class="w"> </span><span class="n">表示没有上限</span><span class="err">。</span><span class="w"></span>
<span class="n">nr_blocks</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">和</span><span class="w"> </span><span class="k">size</span><span class="w"> </span><span class="n">一样设定分配内存上限</span><span class="err">，</span><span class="n">但单位为</span><span class="w"> </span><span class="n">PAGE_CACHE_SIZE</span><span class="w"> </span><span class="p">(</span><span class="n">默认为</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">KiB</span><span class="p">)</span><span class="err">。</span><span class="w"></span>
<span class="n">nr_inodes</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">设定此</span><span class="w"> </span><span class="n">tmpfs</span><span class="w"> </span><span class="n">文件系统的</span><span class="w"> </span><span class="n">inode</span><span class="w"> </span><span class="n">上限</span><span class="err">，</span><span class="n">也就是限制可以存放文件的总数</span><span class="err">。</span><span class="w"></span>
<span class="w">    </span><span class="n">以上三个选项都可以在数值后面加上k</span><span class="err">、</span><span class="n">m</span><span class="w"> </span><span class="err">、</span><span class="n">g来表示单位</span><span class="err">。</span><span class="w"></span>
<span class="n">你可以在挂载的时候直接使用这些选项</span><span class="w"></span>
<span class="err">#</span><span class="w"> </span><span class="n">mount</span><span class="o">-</span><span class="n">t</span><span class="w"> </span><span class="n">tmpfs</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="k">size</span><span class="o">=</span><span class="mi">1</span><span class="n">G</span><span class="w"> </span><span class="n">tmpfs</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">mytmpfs</span><span class="w"></span>
<span class="n">也可以在挂载后</span><span class="err">，</span><span class="n">重新挂载</span><span class="w"> </span><span class="p">(</span><span class="n">remount</span><span class="p">)</span><span class="w"> </span><span class="n">tmpfs</span><span class="w"> </span><span class="n">即可改变内存上限</span><span class="err">：</span><span class="w"></span>
<span class="err">#</span><span class="w"> </span><span class="n">mount</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">remount</span><span class="p">,</span><span class="k">size</span><span class="o">=</span><span class="mi">512</span><span class="n">m</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">tmp</span><span class="w"></span>

<span class="w"> </span><span class="n">tmpfs的优势</span><span class="w"></span>
<span class="w">    </span><span class="n">下面我们来总结一下tmpfs的优势</span><span class="err">，</span><span class="n">其实我们已经证明过了</span><span class="err">。</span><span class="w"></span>
<span class="mf">1.</span><span class="n">存储空间动态变化</span><span class="w"></span>
<span class="n">在tmpfs存放的文件是动态占用内存空间的</span><span class="err">，</span><span class="n">随着文件占用空间的增大而增大文件系统</span><span class="err">，</span><span class="n">文件被删除时</span><span class="err">，</span><span class="n">动态地减小文件系统空间并释放内存</span><span class="err">。</span><span class="w"></span>
<span class="n">这一切都是tmpf自动处理的</span><span class="err">。</span><span class="w"></span>
<span class="mf">2.</span><span class="n">速度</span><span class="w"></span>
<span class="n">天下武功</span><span class="err">，</span><span class="n">唯快不破</span><span class="err">。</span><span class="n">tmpfs</span><span class="w"> </span><span class="n">的另一个主要的好处是它闪电般的速度</span><span class="err">。</span><span class="n">因为典型的</span><span class="w"> </span><span class="n">tmpfs</span><span class="w"> </span><span class="n">文件系统会完全驻留在内存中</span><span class="err">，</span><span class="w"></span>
<span class="n">读写几乎可以是瞬间的</span><span class="err">。</span><span class="n">即使用了一些交换分区</span><span class="err">，</span><span class="n">性能仍然是非常快的</span><span class="err">。</span><span class="w"></span>
<span class="mf">3.</span><span class="n">没有持久性</span><span class="w"></span>
<span class="n">当你喜欢一个东西的时候</span><span class="err">，</span><span class="n">它的缺点在你眼里也会是优点</span><span class="err">，</span><span class="n">没有持久性其实是tmpfs的缺点</span><span class="err">，</span><span class="n">所以一定不要把系统关机或者重启后还需要</span><span class="w"></span>
<span class="n">保存的数据放入tmpfs</span><span class="err">。</span><span class="n">因为虚拟内存本质上就是易失的</span><span class="err">，</span><span class="n">但正是这种特性</span><span class="err">，</span><span class="n">实际上可能不是一件坏事</span><span class="err">。</span><span class="n">它让</span><span class="w"> </span><span class="n">tmpfs</span><span class="w"> </span><span class="n">成为一个保存您不想在</span><span class="w"></span>
<span class="n">系统重启后保留的数据的卓越的文件系统</span><span class="err">。</span><span class="w"></span>

<span class="w"> </span><span class="n">tmpfs应用案例</span><span class="w"></span>
<span class="n">以下是使用tmpfs文件系统的一些应用示例</span><span class="err">，</span><span class="n">一般tmpfs内存文件系统在做web缓存</span><span class="err">，</span><span class="n">cache</span><span class="err">，</span><span class="n">临时文件存储时会对web访问有很好的加速作用</span><span class="err">，</span><span class="w"></span>
<span class="n">从而提高网站访问的速度</span><span class="err">。</span><span class="w"> </span>
<span class="mf">1.</span><span class="n">反向代理缓存中</span><span class="err">，</span><span class="n">缓存目录使用tmpfs</span><span class="w"> </span>
<span class="n">例如下面是Nginx作为反向代理缓存的配置片段</span><span class="err">，</span><span class="n">可以将</span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">cdn_cache目录挂载为tmpfs</span><span class="err">。</span><span class="w"></span>
<span class="n">proxy_temp_path</span><span class="w">  </span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">cdn_cache</span><span class="o">/</span><span class="n">proxy_temp_dir</span><span class="p">;</span><span class="w"></span>
<span class="n">proxy_cache_path</span><span class="w"> </span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">cdn_cache</span><span class="o">/</span><span class="n">proxy_cache_dirlevels</span><span class="o">=</span><span class="mi">1</span><span class="err">:</span><span class="mi">2</span><span class="w"> </span><span class="n">keys_zone</span><span class="o">=</span><span class="nl">cache_one</span><span class="p">:</span><span class="mi">50</span><span class="n">m</span><span class="w"> </span><span class="n">inactive</span><span class="o">=</span><span class="mi">1</span><span class="n">d</span><span class="w"></span>

<span class="mf">2.</span><span class="n">将php的session文件放在tmpfs下</span><span class="w"> </span>
<span class="n">PHP保存seesion的方法很简单</span><span class="p">,</span><span class="n">只要修改php</span><span class="p">.</span><span class="n">ini就行了</span><span class="err">，</span><span class="n">首先挂载好tmpfs</span><span class="err">，</span><span class="n">然后修改配置文件如下</span><span class="err">：</span><span class="w"></span>
<span class="k">session</span><span class="p">.</span><span class="n">save_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">“</span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">php_session</span><span class="err">”</span><span class="w"></span>

<span class="mf">3.</span><span class="n">将服务的socket文件放在tmpfs下</span><span class="w"> </span>
<span class="n">例如在Web应用中</span><span class="err">，</span><span class="n">我们有PHP的FastCGIsocket</span><span class="err">、</span><span class="n">MySQL的</span><span class="w"> </span><span class="n">mysql</span><span class="p">.</span><span class="n">sock等等类似的socket文件</span><span class="err">，</span><span class="n">都可以放在tmpfs挂载的目录下提高性能</span><span class="err">。</span><span class="w"></span>

<span class="mf">4.</span><span class="n">其它需要高性能读写的场景</span><span class="w"></span>
</pre></div>


<h2 id="ipa-server">ipa-server</h2>
<div class="codehilite"><pre><span></span>备份脚本
<span class="mi">00</span> <span class="mi">1</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="o">/</span><span class="nv">home</span><span class="o">/</span><span class="nv">ipabak</span>.<span class="nv">sh</span>
#<span class="o">!/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">bash</span>
<span class="nv">backupdir</span><span class="o">=/</span><span class="nv">var</span><span class="o">/</span><span class="nv">lib</span><span class="o">/</span><span class="nv">ipa</span><span class="o">/</span><span class="nv">backup</span><span class="o">/</span>
<span class="o">/</span><span class="nv">sbin</span><span class="o">/</span><span class="nv">ipa</span><span class="o">-</span><span class="nv">backup</span> <span class="o">--</span><span class="nv">log</span><span class="o">-</span><span class="nv">file</span><span class="o">=/</span><span class="nv">var</span><span class="o">/</span><span class="nv">lib</span><span class="o">/</span><span class="nv">ipa</span><span class="o">/</span><span class="nv">backup</span><span class="o">/</span><span class="nv">ipa</span><span class="o">-</span><span class="nv">backup</span>.<span class="nv">log</span>
<span class="nv">find</span> <span class="mh">$bac</span><span class="nv">kupdir</span> <span class="o">-</span><span class="nv">name</span> <span class="s2">&quot;</span><span class="s">ipa-full-*</span><span class="s2">&quot;</span> <span class="o">-</span><span class="nv">type</span> <span class="nv">d</span> <span class="o">-</span><span class="nv">mtime</span> <span class="o">+</span><span class="mi">10</span> <span class="o">-</span><span class="k">exec</span> <span class="nv">rm</span> <span class="o">-</span><span class="nv">rf</span> {} \<span class="c1">; &gt; /dev/null 2&gt;&amp;1</span>


重置<span class="nv">admin</span>密码

<span class="nv">LDAPTLS_CACERT</span><span class="o">=/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">ipa</span><span class="o">/</span><span class="nv">ca</span>.<span class="nv">crt</span> <span class="nv">ldappasswd</span> <span class="o">-</span><span class="nv">D</span> <span class="s1">&#39;</span><span class="s">cn=directory manager</span><span class="s1">&#39;</span> <span class="o">-</span><span class="nv">W</span> <span class="o">-</span><span class="nv">S</span> <span class="nv">uid</span><span class="o">=</span><span class="nv">admin</span>,<span class="nv">cn</span><span class="o">=</span><span class="nv">users</span>,<span class="nv">cn</span><span class="o">=</span><span class="nv">accounts</span>,<span class="nv">dc</span><span class="o">=</span><span class="nv">l</span>,<span class="nv">dc</span><span class="o">=</span><span class="nv">test1</span>,<span class="nv">dc</span><span class="o">=</span><span class="nv">com</span>

在所有服务器上添加

<span class="nv">cat</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">hosts</span>
<span class="nv">ip</span> <span class="nv">ipaserver</span>

同步时间

<span class="nv">ntpdate</span> <span class="mi">0</span>.<span class="nv">centos</span>.<span class="nv">pool</span>.<span class="nv">ntp</span>.<span class="nv">org</span>

<span class="nv">yum</span> <span class="nv">install</span> <span class="nv">ipa</span><span class="o">-</span><span class="nv">server</span> <span class="nv">bind</span><span class="o">-</span><span class="nv">dyndb</span><span class="o">-</span><span class="nv">ldap</span> <span class="nv">ipa</span><span class="o">-</span><span class="nv">server</span><span class="o">-</span><span class="nv">dns</span>

<span class="nv">ipa</span><span class="o">-</span><span class="nv">server</span><span class="o">-</span><span class="nv">install</span> <span class="o">--</span><span class="nv">uninstall</span>

<span class="o">------------------------------------</span> <span class="nv">NEW</span> <span class="o">---------------------------------</span>

安装主<span class="nv">LDAP</span>

将<span class="nv">DNS</span>指向公网，新建反向区域

<span class="nv">ipa</span><span class="o">-</span><span class="nv">server</span><span class="o">-</span><span class="nv">install</span> <span class="o">--</span><span class="nv">hostname</span><span class="o">=</span><span class="nv">ipaserver</span> <span class="o">--</span><span class="nv">domain</span><span class="o">=</span><span class="nv">l</span>.<span class="nv">d01</span>.<span class="nv">test</span>.<span class="nv">com</span> <span class="o">--</span><span class="nv">admin</span><span class="o">-</span><span class="nv">password</span><span class="o">=</span><span class="mi">123456</span>.<span class="nv">test</span> <span class="o">--</span><span class="nv">setup</span><span class="o">-</span><span class="nv">dns</span> <span class="o">--</span><span class="nv">no</span><span class="o">-</span><span class="nv">forwarders</span> <span class="o">--</span><span class="nv">auto</span><span class="o">-</span><span class="nv">reverse</span>

<span class="o">------------------------------------</span> <span class="nv">NEW</span> <span class="o">---------------------------------</span>

建立副本

创建副本 参考：

<span class="nv">https</span>:<span class="o">//</span><span class="nv">access</span>.<span class="nv">redhat</span>.<span class="nv">com</span><span class="o">/</span><span class="nv">documentation</span><span class="o">/</span><span class="nv">en</span><span class="o">-</span><span class="nv">US</span><span class="o">/</span><span class="nv">Red_Hat_Enterprise_Linux</span><span class="o">/</span><span class="mi">7</span><span class="o">/</span><span class="nv">html</span><span class="o">/</span><span class="nv">Linux_Domain_Identity_Authentication_and_Policy_Guide</span><span class="o">/</span><span class="nv">creating</span><span class="o">-</span><span class="nv">the</span><span class="o">-</span><span class="nv">replica</span>.<span class="nv">html</span>
在<span class="nv">server2</span>上

<span class="nv">yum</span> <span class="nv">install</span> <span class="nv">ipa</span><span class="o">-</span><span class="nv">server</span> <span class="nv">bind</span><span class="o">-</span><span class="nv">dyndb</span><span class="o">-</span><span class="nv">ldap</span> <span class="nv">ipa</span><span class="o">-</span><span class="nv">server</span><span class="o">-</span><span class="nv">dns</span>

<span class="nv">HOSTNAME</span><span class="o">=</span><span class="nv">test1</span>

将<span class="nv">dns</span>指向主<span class="nv">ldap</span>
<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">resolv</span>.<span class="nv">conf</span>
<span class="nv">nameserver</span> <span class="nv">ipaserver</span>的<span class="nv">ip</span>

<span class="nv">hosts</span>文件一致
主机名一致，需要完整的域 <span class="nv">xxx</span>.<span class="nv">l</span>.<span class="nv">xxxx</span>.<span class="nv">com</span>
时间一致   <span class="nv">ntpdate</span> 主<span class="nv">ipa</span>
<span class="nv">selinux</span> <span class="nv">firewalld</span> <span class="nv">NetworkManager</span> <span class="nv">iptable</span>都关闭


<span class="nv">ipa</span><span class="o">-</span><span class="nv">replica</span><span class="o">-</span><span class="nv">install</span> <span class="o">--</span><span class="nv">principal</span> <span class="nv">admin</span> <span class="o">--</span><span class="nv">admin</span><span class="o">-</span><span class="nv">password</span> <span class="mi">123456</span>.<span class="nv">test</span> <span class="o">--</span><span class="nv">setup</span><span class="o">-</span><span class="nv">dns</span> <span class="o">--</span><span class="nv">no</span><span class="o">-</span><span class="nv">forwarders</span> <span class="o">--</span><span class="nv">setup</span><span class="o">-</span><span class="nv">ca</span> #<span class="o">--</span><span class="nv">setup</span><span class="o">-</span><span class="nv">kra</span>

安装<span class="nv">ca</span> 安装<span class="nv">dns</span>

<span class="o">--</span><span class="nv">server</span> 不指定<span class="nv">server</span>，自动发现

在提示<span class="nv">DNS</span>的时候，在反向区域添加<span class="nv">LDAP2</span>的记录，并检查正向解析是否已更新

<span class="nv">Client</span> <span class="nv">configuration</span> <span class="nv">complete</span>.

<span class="nv">ipa</span> : <span class="nv">ERROR</span> <span class="nv">Reverse</span> <span class="nv">DNS</span> <span class="nv">resolution</span> <span class="nv">of</span> <span class="nv">address</span>

<span class="k">Continue</span>? [<span class="nv">no</span>]: <span class="nv">yes</span>

<span class="nv">Run</span> <span class="nv">connection</span> <span class="nv">check</span> <span class="nv">to</span> <span class="nv">master</span>

<span class="nv">ipaserver</span>

<span class="nv">yum</span> <span class="nv">install</span> <span class="nv">sudo</span> <span class="nv">keyutils</span> <span class="nv">ipa</span><span class="o">-</span><span class="nv">client</span> <span class="o">--</span><span class="nv">nogpgcheck</span> <span class="o">-</span><span class="nv">y</span>

<span class="nv">yes</span><span class="o">|</span><span class="nv">ipa</span><span class="o">-</span><span class="nv">client</span><span class="o">-</span><span class="nv">install</span> <span class="o">--</span><span class="nv">hostname</span><span class="o">=</span>`<span class="nv">echo</span> $<span class="nv">HOSTNAME</span> <span class="o">|</span><span class="nv">tr</span> <span class="nv">A</span><span class="o">-</span><span class="nv">Z</span> <span class="nv">a</span><span class="o">-</span><span class="nv">z</span>` <span class="o">--</span><span class="nv">domain</span><span class="o">=</span><span class="nv">test</span>.<span class="nv">com</span> <span class="o">-</span><span class="nv">p</span> <span class="nv">admin</span> <span class="o">-</span><span class="nv">w</span> <span class="mi">123456</span>.<span class="nv">test</span> <span class="o">--</span><span class="nv">mkhomedir</span> <span class="o">-</span><span class="nv">N</span>

在<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">profile</span>中添加 <span class="nv">PS1</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">[\u@\h:\l \W]</span><span class="se">\\</span><span class="s">$ </span><span class="s2">&quot;</span>



在<span class="nv">windows</span> <span class="nv">DNS</span>添加<span class="nv">dns</span>转发


<span class="o">!</span>[]<span class="ss">(</span><span class="nv">assets</span><span class="o">/</span><span class="nv">import</span>.<span class="nv">png</span><span class="ss">)</span>



添加<span class="nv">IPA</span><span class="o">-</span><span class="nv">CLIENT</span>

先同步<span class="nv">ntp</span>

<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">sbin</span><span class="o">/</span><span class="nv">ntpdate</span> <span class="mi">10</span>.<span class="mi">21</span>.<span class="mi">10</span>.<span class="mi">8</span>

<span class="nv">rm</span> <span class="o">-</span><span class="nv">f</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">ipa</span><span class="o">/</span><span class="nv">ca</span>.<span class="nv">crt</span>

<span class="nv">wget</span> <span class="o">-</span><span class="nv">O</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">yum</span>.<span class="nv">repos</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">test</span><span class="o">-</span><span class="nv">Base</span>.<span class="nv">repo</span> <span class="nv">repourl</span>

<span class="nv">rm</span> <span class="o">-</span><span class="nv">rf</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">yum</span>.<span class="nv">repos</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">cobbler</span><span class="o">-</span><span class="nv">config</span>.<span class="nv">repo</span>

<span class="nv">mv</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">yum</span>.<span class="nv">repos</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">CentOS</span><span class="o">-</span><span class="nv">Base</span>.<span class="nv">repo</span>{,.<span class="nv">bak</span>}

添加<span class="nv">IPA</span><span class="o">-</span><span class="nv">CLIENT</span>

<span class="nv">yum</span> <span class="nv">install</span> <span class="nv">sudo</span> <span class="nv">keyutils</span> <span class="nv">ipa</span><span class="o">-</span><span class="nv">client</span> <span class="o">--</span><span class="nv">nogpgcheck</span> <span class="o">-</span><span class="nv">y</span>

<span class="nv">yum</span> <span class="o">-</span><span class="nv">y</span> <span class="nv">install</span> <span class="nv">salt</span><span class="o">-</span><span class="nv">minion</span>

<span class="nv">rm</span> <span class="o">-</span><span class="nv">rf</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">salt</span><span class="cm">/*</span>

<span class="cm">salt-call --master=ip state.highstate -l debug</span>

<span class="cm">echo &quot;no&quot; | ipa-client-install --uninstall</span>

<span class="cm">rm /etc/ipa/ca.crt -f</span>

<span class="cm">echo &#39;nameserver 192.168.41.113&#39; &amp;gt; /etc/resolv.conf</span>

<span class="cm">echo &#39;nameserver 192.168.41.114&#39; &amp;gt;&amp;gt;/etc/resolv.conf</span>

<span class="cm">HOSTNAME=`awk -F= &#39;/HOSTNAME/{print $2}&#39; /etc/sysconfig/network`</span>

<span class="cm">hostname $HOSTNAME</span>

<span class="cm">hostname</span>

<span class="cm">yes|ipa-client-install --hostname=`echo $HOSTNAME |tr A-Z a-z` --domain=test1.com -p admin -w &#39;123456.test&#39; --enable-dns-updates -N</span>

<span class="cm">rm -f /var/lib/sss/db/*</span>

<span class="cm">service sssd restart</span>

<span class="cm">SALT</span>

<span class="cm">salt -v -t 30 &#39;*&#39; cmd.run &#39;id shiwj&#39;</span>

<span class="cm">backup and restore</span>

<span class="cm">http://www.freeipa.org/page/Backup_and_Restore</span>

<span class="cm">https://fedoraproject.org/wiki/QA:Testcase_freeipav3_backup_and_restore</span>

<span class="cm">http://www.freeipa.org/page/V3/Backup_and_Restore</span>

<span class="cm">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Identity_Management_Guide/index.html</span>

<span class="cm">## ca过期</span>
<span class="cm">https://www.freeipa.org/page/Certmonger</span>
<span class="cm">正常会自动续期，过期后将系统时间改回之前几天  watch -n 1 &#39;date -s &quot;2019-01-15&quot;&#39;</span>
<span class="cm">ipa-getcert list|grep exp</span>
<span class="cm">ipa-getcert list|grep ID</span>
<span class="cm">ipa-getcert resubmit -i 20150320032117</span>
<span class="cm">ipa-getcert resubmit -i 20150320032156</span>
<span class="cm">ipa-getcert resubmit -i 201503200324554</span>

<span class="cm">4.0+ 有 ipa-cacert-manage renew</span>
</pre></div>


<h2 id="sendmail">sendmail转发</h2>
<div class="codehilite"><pre><span></span><span class="nv">yum</span> <span class="nv">install</span> <span class="nv">sendmail</span> <span class="nv">m4</span> <span class="nv">sendmail</span><span class="o">-</span><span class="nv">cf</span>

<span class="nv">vim</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">mail</span><span class="o">/</span><span class="nv">sendmail</span>.<span class="nv">mc</span>修改监听地址

<span class="nv">DAEMON_OPTIONS</span><span class="ss">(</span>`<span class="nv">Port</span><span class="o">=</span><span class="nv">smtp</span>,<span class="nv">Addr</span><span class="o">=</span><span class="mi">0</span>.<span class="mi">0</span>.<span class="mi">0</span>.<span class="mi">0</span>, <span class="nv">Name</span><span class="o">=</span><span class="nv">MTA</span><span class="s1">&#39;</span><span class="s">)dnl</span>

<span class="nv">vim</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">mail</span><span class="o">/</span><span class="nv">access</span> 添加

<span class="k">Connect</span>:<span class="mi">10</span>.<span class="mi">141</span>.<span class="mi">10</span>                       <span class="nv">RELAY</span>

生效
<span class="nv">m4</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">mail</span><span class="o">/</span><span class="nv">sendmail</span>.<span class="nv">mc</span> <span class="o">&gt;</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">mail</span><span class="o">/</span><span class="nv">sendmail</span>.<span class="nv">cf</span>
<span class="nv">service</span> <span class="nv">sendmail</span> <span class="nv">restart</span>


发信慢 

<span class="mi">1</span>、尝试<span class="nv">sendEmail</span> <span class="o">-</span><span class="nv">s</span> 主机名 发邮件

<span class="mi">2</span>、修改<span class="nv">host</span>解析
<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">hosts</span>  添加<span class="mi">127</span>.<span class="mi">0</span>.<span class="mi">0</span>.<span class="mi">1</span>       主机名

<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">sysconfig</span><span class="o">/</span><span class="nv">network</span>    <span class="nv">centos7</span>没有也要添加

<span class="nv">HOSTNAME</span><span class="o">=</span>主机名

重启<span class="nv">sendmail</span>

<span class="nv">sendmail</span> 用<span class="nv">host</span>
默认情况下，<span class="nv">sendmail</span>使用<span class="nv">DNS</span>服务器解析域名，不会使用<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">hosts</span>里的设置
<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">mail</span><span class="o">/</span><span class="nv">service</span>.<span class="nv">switch</span>   增加文件重启<span class="nv">sendmail</span>
<span class="nv">hosts</span>   <span class="nv">files</span>
<span class="nv">aliases</span> <span class="nv">files</span>

编辑<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">mail</span><span class="o">/</span><span class="nv">mailertable</span>文件，增加<span class="nv">mailserver</span> <span class="nv">smtp</span>:[<span class="mi">1</span>.<span class="mi">1</span>.<span class="mi">1</span>.<span class="mi">1</span>]行（取消注释即可）；
执行<span class="nv">makemap</span> <span class="nv">hash</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">mail</span><span class="o">/</span><span class="nv">mailertable</span> <span class="o">&lt;</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">mail</span><span class="o">/</span><span class="nv">mailertable</span> <span class="o">&amp;&amp;</span> <span class="nv">service</span> <span class="nv">sendmail</span> <span class="nv">restart</span>
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../linux-base/" title="linux-base" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                linux-base
              </span>
            </div>
          </a>
        
        
          <a href="../other/" title="other" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                other
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>