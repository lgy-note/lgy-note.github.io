



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>other - mkdocs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.30686662.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#_1" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="mkdocs" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              mkdocs
            </span>
            <span class="md-header-nav__topic">
              
                other
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href=".." class="md-tabs__link">
        home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../python-base/" class="md-tabs__link">
          python
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../nginx/" class="md-tabs__link">
          service
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../mysql/" class="md-tabs__link">
          database
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../open-falcon/" class="md-tabs__link">
          monitor
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../tcp-issue/" class="md-tabs__link md-tabs__link--active">
          basis
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="mkdocs" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    mkdocs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="home" class="md-nav__link">
      home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      python
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        python
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../python-base/" title="python-base" class="md-nav__link">
      python-base
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../python-lib/" title="python-lib" class="md-nav__link">
      python-lib
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../python-lib2/" title="python-lib2" class="md-nav__link">
      python-lib2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../python-web/" title="python-web" class="md-nav__link">
      python-web
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../python-other/" title="python-other" class="md-nav__link">
      python-other
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      service
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        service
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../nginx/" title="nginx" class="md-nav__link">
      nginx
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../nginx2/" title="nginx2" class="md-nav__link">
      nginx2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../apache/" title="apache" class="md-nav__link">
      apache
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../saltstack/" title="saltstack" class="md-nav__link">
      saltstack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tomcat/" title="tomcat" class="md-nav__link">
      tomcat
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ansible/" title="ansible" class="md-nav__link">
      ansible
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../trafficserver/" title="trafficserver" class="md-nav__link">
      trafficserver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../haproxy/" title="haproxy" class="md-nav__link">
      haproxy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../docker/" title="docker" class="md-nav__link">
      docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../varnish/" title="varnish" class="md-nav__link">
      varnish
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bind/" title="bind" class="md-nav__link">
      bind
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lvs/" title="lvs" class="md-nav__link">
      lvs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../log-analysis/" title="log-analysis" class="md-nav__link">
      log-analysis
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      database
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        database
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../mysql/" title="mysql" class="md-nav__link">
      mysql
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mysql2/" title="mysql2" class="md-nav__link">
      mysql2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../memcached/" title="memcached" class="md-nav__link">
      memcached
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../redis/" title="redis" class="md-nav__link">
      redis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mongodb/" title="mongodb" class="md-nav__link">
      mongodb
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hadoop/" title="hadoop" class="md-nav__link">
      hadoop
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../postgresql/" title="postgresql" class="md-nav__link">
      postgresql
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      monitor
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        monitor
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../open-falcon/" title="open-falcon" class="md-nav__link">
      open-falcon
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../zabbix/" title="zabbix" class="md-nav__link">
      zabbix
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../zabbix2/" title="zabbix2" class="md-nav__link">
      zabbix2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../netdata/" title="netdata" class="md-nav__link">
      netdata
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      basis
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        basis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../tcp-issue/" title="tcp-issue" class="md-nav__link">
      tcp-issue
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../git-svn/" title="git-svn" class="md-nav__link">
      git-svn
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vpn/" title="vpn" class="md-nav__link">
      vpn
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../shell/" title="shell" class="md-nav__link">
      shell
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../disk/" title="disk" class="md-nav__link">
      disk
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../filesystem/" title="filesystem" class="md-nav__link">
      filesystem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../source/" title="source" class="md-nav__link">
      source
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../command/" title="command" class="md-nav__link">
      command
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../linux-base/" title="linux-base" class="md-nav__link">
      linux-base
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../linux-soft/" title="linux-soft" class="md-nav__link">
      linux-soft
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        other
      </label>
    
    <a href="./" title="other" class="md-nav__link md-nav__link--active">
      other
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    运维
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#360" class="md-nav__link">
    360文档
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#teredo" class="md-nav__link">
    teredo
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    百度语音
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#miui" class="md-nav__link">
    miui
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bbr" class="md-nav__link">
    bbr
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chrome" class="md-nav__link">
    chrome
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    基本优化
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#io" class="md-nav__link">
    io复用
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#network" class="md-nav__link">
    network
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#io_mem" class="md-nav__link">
    io_mem
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    运维
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#360" class="md-nav__link">
    360文档
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#teredo" class="md-nav__link">
    teredo
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    百度语音
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#miui" class="md-nav__link">
    miui
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bbr" class="md-nav__link">
    bbr
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chrome" class="md-nav__link">
    chrome
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    基本优化
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#io" class="md-nav__link">
    io复用
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#network" class="md-nav__link">
    network
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#io_mem" class="md-nav__link">
    io_mem
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>other</h1>
                
                <h2 id="_1">运维</h2>
<div class="codehilite"><pre><span></span><span class="err">运维的本质是“可控”。运维是一门非常复杂的学问，不像学会两三门语言，设计几个网站应用就可以成为</span>
<span class="err">架构师那样的工作。</span>
<span class="err">他除了技术之外，经验积累、视野、大局观、甚至是心胸都有可能决定成败。优秀的开发者比比皆是，</span>
<span class="err">但是优秀的运维人员少之又少。</span>

<span class="err">原因就是运维内容太复杂了！而我为什么说运维的本质是“可控”，大概有以下几个原因：</span>

<span class="err">第一点：稳定性“可控”</span>

<span class="err">运维不是维护一两台机器，发布代码就好，而是要做成千上万，甚至十几万台的服务器和各种网络设备、</span>
<span class="err">存储设备等专有设备维护，</span>
<span class="err">这些服务器包含</span><span class="n">webserver</span><span class="err">，</span><span class="n">DB</span><span class="err">，</span><span class="k">cache</span><span class="err">，</span><span class="n">cdn</span><span class="err">，</span><span class="n">computing</span><span class="err">多种类型，如何让这些大量的服务器稳定</span>
<span class="err">的跑在生产环境中，</span>
<span class="err">不因为硬件损坏、发布变更、系统升级而引发的业务系统故障。没有东西是不会坏的，没有系统是</span>
<span class="err">没有</span><span class="n">bug</span><span class="err">的。硬件要坏，系统升级，发布变更，</span>
<span class="err">这些都没有关系，但是最重要的，一旦发生这些之后，运维人员知道，这会业务影响多大</span><span class="o">!?</span><span class="err">需要多少</span>
<span class="err">时间和工作量恢复</span><span class="o">?</span>

<span class="err">第二点：性能“可控”</span>

<span class="err">我和</span><span class="n">DBA</span><span class="err">一起维护</span><span class="n">DB</span><span class="err">多年，</span><span class="n">DBA</span><span class="err">最痛苦的地方，不在于“慢”，而在于时快时慢。一个不稳定的性能，</span>
<span class="err">就无法预估承受业务压力需要的系统规模，</span>
<span class="err">这样对于</span><span class="n">DBA</span><span class="err">在维护是无异于自杀。很多云计算厂商做设计的时候，往往也会忽略这一点，其实</span>
<span class="err">性能的问题，比最高性能，来的重要的多！</span>
<span class="err">非常漂亮的数字不能解决问题，但是一次性能的不足，可能就引发故障。</span>

<span class="err">第三点：安全“可控”</span>

<span class="err">有没有绝对的安全呢？理论上没有，所以，运维的同学，总要花很多精力在系统安全上，比如控制哪</span>
<span class="err">些用户可以登录系统环境？</span>
<span class="err">哪些用户是可以进行变更？哪些用户甚至可以拿到最高权限？测试和开发隔离，公司内外隔离，都是</span>
<span class="err">因此而生。只要能够控制权限的面积，范围，</span>
<span class="err">就能知道风险，这边是所谓的安全“可控”。</span>

<span class="err">重要如上所示，但是正如一开头所说，运维的内容相当复杂，交付“可控”，变更内容“可控”，效率“</span>
<span class="err">可控”都是可以值得深究的东西，因此，</span>
<span class="err">无论是“可视化”，“大数据”，“运维自动化”等等，都是在为“运维可控”服务的。数据可视化，带来的</span>
<span class="err">是规模可控；运维自动化，带来的是效率可控，</span>
<span class="err">风险可控，如是而已。</span>

<span class="err">每一个点的提升，都是运维的提升，希望所有从事运维的同学，都能感受到，做什么可以让“可控力”</span>
<span class="err">提升，不要再半夜的时候处理故障，</span>
<span class="err">不要和女朋友看电影的时候回公司处理故障，也许我们再次遇到这些问题的时候，可以拿起一杯茶，</span>
<span class="err">做一个优雅的运维。</span>
</pre></div>


<h2 id="360">360文档</h2>
<div class="codehilite"><pre><span></span><span class="mi">360</span><span class="err">文库复制时总要登陆</span>

<span class="err">开发者工具</span><span class="c1">---console里输入</span>
<span class="p">[...</span><span class="n">document</span><span class="p">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)].</span><span class="n">forEach</span><span class="p">(</span><span class="n">x</span> <span class="o">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">oncopy</span> <span class="o">=</span> <span class="k">function</span><span class="p">()</span><span class="err">{}</span><span class="p">)</span>
</pre></div>


<h2 id="teredo">teredo</h2>
<div class="codehilite"><pre><span></span>@<span class="nv">echo</span> <span class="nv">off</span>

<span class="nv">net</span> <span class="nv">start</span> <span class="s2">&quot;</span><span class="s">ip helper</span><span class="s2">&quot;</span>
<span class="nv">netsh</span> <span class="nv">int</span> <span class="nv">ipv6</span> <span class="nv">reset</span>

<span class="nv">netsh</span> <span class="nv">int</span> <span class="nv">teredo</span> <span class="nv">set</span> <span class="nv">state</span> <span class="nv">default</span>
<span class="nv">netsh</span> <span class="nv">int</span> <span class="mi">6</span><span class="nv">to4</span> <span class="nv">set</span> <span class="nv">state</span> <span class="nv">disable</span>
<span class="nv">netsh</span> <span class="nv">int</span> <span class="nv">isatap</span> <span class="nv">set</span> <span class="nv">state</span> <span class="nv">disable</span>
::<span class="nv">netsh</span> <span class="nv">int</span> <span class="nv">teredo</span> <span class="nv">set</span> <span class="nv">state</span> <span class="nv">server</span><span class="o">=</span><span class="nv">teredo</span>.<span class="nv">remlab</span>.<span class="nv">net</span>
<span class="nv">netsh</span> <span class="nv">int</span> <span class="nv">teredo</span> <span class="nv">set</span> <span class="nv">state</span> <span class="nv">server</span><span class="o">=</span><span class="nv">teredo</span>.<span class="nv">trex</span>.<span class="nv">fi</span>
<span class="nv">netsh</span> <span class="nv">int</span> <span class="nv">ipv6</span> <span class="nv">set</span> <span class="nv">teredo</span> <span class="nv">enterpriseclient</span>
<span class="nv">netsh</span> <span class="nv">int</span> <span class="nv">ter</span> <span class="nv">set</span> <span class="nv">state</span> <span class="nv">enterpriseclient</span>
<span class="nv">route</span> <span class="nv">DELETE</span> ::<span class="o">/</span><span class="mi">0</span>
<span class="nv">netsh</span> <span class="nv">int</span> <span class="nv">ipv6</span> <span class="nv">add</span> <span class="nv">route</span> ::<span class="o">/</span><span class="mi">0</span> <span class="s2">&quot;</span><span class="s">Teredo Tunneling Pseudo-Interface</span><span class="s2">&quot;</span>
<span class="nv">netsh</span> <span class="nv">int</span> <span class="nv">ipv6</span> <span class="nv">set</span> <span class="nv">prefix</span> <span class="mi">2002</span>::<span class="o">/</span><span class="mi">16</span> <span class="mi">30</span> <span class="mi">1</span>
<span class="nv">netsh</span> <span class="nv">int</span> <span class="nv">ipv6</span> <span class="nv">set</span> <span class="nv">prefix</span> <span class="mi">2001</span>::<span class="o">/</span><span class="mi">32</span> <span class="mi">5</span> <span class="mi">1</span>

<span class="nv">ipconfig</span> <span class="o">/</span><span class="nv">flushdns</span>
<span class="nv">route</span> <span class="nv">print</span>
<span class="nv">netsh</span> <span class="nv">int</span> <span class="nv">ipv6</span> <span class="k">show</span> <span class="nv">int</span>
<span class="nv">netsh</span> <span class="nv">int</span> <span class="nv">ipv6</span> <span class="k">show</span> <span class="nv">teredo</span>
<span class="nv">cmd</span>


<span class="nv">win10</span>开启
<span class="nv">netsh</span> <span class="nv">interface</span> <span class="nv">Teredo</span> <span class="nv">set</span> <span class="nv">state</span> <span class="nv">disable</span>
<span class="nv">netsh</span> <span class="nv">interface</span> <span class="nv">Teredo</span> <span class="nv">set</span> <span class="nv">state</span> <span class="nv">type</span><span class="o">=</span><span class="nv">default</span>
<span class="nv">netsh</span> <span class="nv">interface</span> <span class="nv">teredo</span> <span class="nv">set</span> <span class="nv">state</span> <span class="nv">enterpriseclient</span> <span class="nv">server</span><span class="o">=</span><span class="nv">teredo</span>.<span class="nv">remlab</span>.<span class="nv">net</span>
<span class="nv">ping</span> <span class="o">-</span><span class="mi">6</span> <span class="nv">ipv6</span>.<span class="nv">test</span><span class="o">-</span><span class="nv">ipv6</span>.<span class="nv">com</span>
<span class="nv">ping</span> <span class="o">-</span><span class="mi">6</span> [<span class="mi">2001</span>:<span class="mi">470</span>:<span class="mi">1</span>:<span class="mi">18</span>::<span class="mi">125</span>]
</pre></div>


<h2 id="_2">百度语音</h2>
<div class="codehilite"><pre><span></span><span class="c1"># coding=utf-8</span>
<span class="c1"># pip install baidu-aip</span>
<span class="kn">from</span> <span class="nn">aip</span> <span class="kn">import</span> <span class="n">AipSpeech</span>

<span class="n">APP_ID</span> <span class="o">=</span> <span class="s1">&#39;9953283&#39;</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="s1">&#39;p3grxzGIU55uApjDO56vXVNE&#39;</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s1">&#39;sEFXAWrwPDackWSqo4tCsTtNNZlRlBiB&#39;</span>

<span class="c1"># 初始化AipSpeech对象</span>
<span class="n">aipSpeech</span> <span class="o">=</span> <span class="n">AipSpeech</span><span class="p">(</span><span class="n">APP_ID</span><span class="p">,</span> <span class="n">API_KEY</span><span class="p">,</span> <span class="n">SECRET_KEY</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">hecheng</span><span class="p">(</span><span class="n">txt</span><span class="p">):</span>   <span class="c1">#语音合成</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">aipSpeech</span><span class="o">.</span><span class="n">synthesis</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="s1">&#39;zh&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;vol&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="p">})</span>

    <span class="c1"># 识别正确返回语音二进制 错误则返回dict 参照下面错误码</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;audio.wav&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">shibie</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="s1">&#39;amr&#39;</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="mi">16000</span><span class="p">):</span> <span class="c1">#语音识别</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="nb">file</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">asr_result</span> <span class="o">=</span> <span class="n">aipSpeech</span><span class="o">.</span><span class="n">asr</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">types</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;lan&#39;</span><span class="p">:</span> <span class="s1">&#39;zh&#39;</span><span class="p">,</span>
    <span class="p">})</span>
    <span class="k">if</span> <span class="n">asr_result</span><span class="p">[</span><span class="s1">&#39;err_msg&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;success.&quot;</span><span class="p">:</span>
        <span class="c1"># for i in asr_result[&#39;result&#39;]:</span>
        <span class="c1">#     print i</span>
        <span class="k">print</span> <span class="n">asr_result</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">asr_result</span>

<span class="n">hecheng</span><span class="p">(</span><span class="s1">&#39;你好&#39;</span><span class="p">)</span>
</pre></div>


<h2 id="miui">miui</h2>
<div class="codehilite"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">xiaomi</span><span class="p">.</span><span class="n">eu</span><span class="o">/</span><span class="n">community</span><span class="o">/</span> <span class="err">选择</span><span class="n">ROMS</span> <span class="n">DOWNLOAD</span>
<span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">xiaomi</span><span class="p">.</span><span class="n">eu</span><span class="o">/</span><span class="n">community</span><span class="o">/</span><span class="n">threads</span><span class="o">/</span><span class="mi">8</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="mi">22</span><span class="p">.</span><span class="mi">43708</span><span class="o">/</span>

<span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">dl</span><span class="p">.</span><span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">android</span><span class="o">/</span><span class="n">repository</span><span class="o">/</span><span class="n">platform</span><span class="o">-</span><span class="n">tools</span><span class="o">-</span><span class="n">latest</span><span class="o">-</span><span class="n">windows</span><span class="p">.</span><span class="n">zip</span>

<span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">jaist</span><span class="p">.</span><span class="n">dl</span><span class="p">.</span><span class="n">sourceforge</span><span class="p">.</span><span class="n">net</span><span class="o">/</span><span class="n">project</span><span class="o">/</span><span class="n">xiaomi</span><span class="o">-</span><span class="n">eu</span><span class="o">-</span><span class="n">multilang</span><span class="o">-</span><span class="n">miui</span><span class="o">-</span><span class="n">roms</span><span class="o">/</span><span class="n">xiaomi</span><span class="p">.</span><span class="n">eu</span><span class="o">/</span>  
<span class="err">源地址</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">sourceforge</span><span class="p">.</span><span class="n">mirrorservice</span><span class="p">.</span><span class="n">org</span><span class="o">/</span><span class="n">x</span><span class="o">/</span><span class="n">xi</span><span class="o">/</span><span class="n">xiaomi</span><span class="o">-</span><span class="n">eu</span><span class="o">-</span><span class="n">multilang</span><span class="o">-</span><span class="n">miui</span><span class="o">-</span><span class="n">roms</span><span class="o">/</span><span class="n">xiaomi</span><span class="p">.</span><span class="n">eu</span><span class="o">/</span> 
<span class="err">镜像，下载后验证</span><span class="n">md5</span>


<span class="n">twrp</span> <span class="n">MD5</span>    <span class="mi">1</span><span class="n">a12d541c2a3d1e95448e62f6a20f4c8</span>
<span class="err">系统</span> <span class="n">MD5</span>  <span class="mi">77</span><span class="n">e597db85858df9eef057c4fc6f202e</span>

<span class="err">系统放到手机根目录</span>

<span class="n">fastboot</span> <span class="n">flash</span> <span class="n">recovery</span> <span class="n">twrp</span><span class="p">.</span><span class="n">img</span>
<span class="n">fastboot</span> <span class="n">boot</span> <span class="n">twrp</span><span class="p">.</span><span class="n">img</span>


<span class="err">进入</span><span class="n">recovery</span><span class="err">之后，进入到“挂载”界面，里面有个解锁</span><span class="k">data</span><span class="err">选项，此步骤不可省略，否则可能会卡白米</span>
<span class="err">点击“清除”，格式化</span><span class="k">data</span><span class="err">（不格式化无法挂载</span><span class="k">data</span><span class="err">，连接电脑传不了</span><span class="n">rom</span><span class="err">包），然后三清或者四清</span>
<span class="err">把下好的包复制到根目录，点安装。安装完之后，不要立刻重启，</span><span class="n">recovery</span><span class="err">会提示双清一下，</span>
<span class="err">就先双清再重启</span>
</pre></div>


<h2 id="bbr">bbr</h2>
<div class="codehilite"><pre><span></span><span class="n">bbr</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">elrepo</span><span class="o">.</span><span class="n">org</span><span class="o">/</span>

<span class="n">rpm</span> <span class="o">--</span><span class="kn">import</span> <span class="nn">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">elrepo</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">RPM</span><span class="o">-</span><span class="n">GPG</span><span class="o">-</span><span class="n">KEY</span><span class="o">-</span><span class="n">elrepo</span><span class="o">.</span><span class="n">org</span>
<span class="n">rpm</span> <span class="o">-</span><span class="n">Uvh</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">elrepo</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">elrepo</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="mf">7.0</span><span class="o">-</span><span class="mf">3.</span><span class="n">el7</span><span class="o">.</span><span class="n">elrepo</span><span class="o">.</span><span class="n">noarch</span><span class="o">.</span><span class="n">rpm</span>
<span class="n">yum</span> <span class="o">--</span><span class="n">enablerepo</span><span class="o">=</span><span class="n">elrepo</span><span class="o">-</span><span class="n">kernel</span> <span class="n">install</span> <span class="n">kernel</span><span class="o">-</span><span class="n">ml</span> <span class="o">-</span><span class="n">y</span>  <span class="err">不要安装其他的</span>

<span class="n">rpm</span> <span class="o">-</span><span class="n">qa</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">kernel</span>  <span class="err">有</span>  <span class="n">kernel</span><span class="o">-</span><span class="n">ml</span><span class="o">-</span><span class="mf">4.</span><span class="n">xx</span>

<span class="n">egrep</span> <span class="o">^</span><span class="n">menuentry</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">grub2</span><span class="o">.</span><span class="n">cfg</span> <span class="o">|</span> <span class="n">cut</span> <span class="o">-</span><span class="n">f</span> <span class="mi">2</span> <span class="o">-</span><span class="n">d</span> \<span class="s1">&#39;</span>
<span class="n">CentOS</span> <span class="n">Linux</span> <span class="p">(</span><span class="mf">4.16</span><span class="o">.</span><span class="mi">2</span><span class="o">-</span><span class="mf">1.</span><span class="n">el7</span><span class="o">.</span><span class="n">elrepo</span><span class="o">.</span><span class="n">x86_64</span><span class="p">)</span> <span class="mi">7</span> <span class="p">(</span><span class="n">Core</span><span class="p">)</span>   <span class="err">这个第一个，</span>
<span class="err">否则要改启动顺序</span><span class="n">grub2</span><span class="o">-</span><span class="nb">set</span><span class="o">-</span><span class="n">default</span> <span class="mi">1</span>
<span class="n">CentOS</span> <span class="n">Linux</span> <span class="p">(</span><span class="mf">3.10</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="mf">693.11</span><span class="o">.</span><span class="mf">6.</span><span class="n">el7</span><span class="o">.</span><span class="n">x86_64</span><span class="p">)</span> <span class="mi">7</span> <span class="p">(</span><span class="n">Core</span><span class="p">)</span>
<span class="n">CentOS</span> <span class="n">Linux</span> <span class="p">(</span><span class="mf">3.10</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="mf">693.</span><span class="n">el7</span><span class="o">.</span><span class="n">x86_64</span><span class="p">)</span> <span class="mi">7</span> <span class="p">(</span><span class="n">Core</span><span class="p">)</span>
<span class="n">CentOS</span> <span class="n">Linux</span> <span class="p">(</span><span class="mi">0</span><span class="o">-</span><span class="n">rescue</span><span class="o">-</span><span class="n">c73a5ccf3b8145c3a675b64c4c3ab1d4</span><span class="p">)</span> <span class="mi">7</span> <span class="p">(</span><span class="n">Core</span><span class="p">)</span>

<span class="err">重启</span> <span class="err">查看内核是否为</span><span class="mf">4.16</span>

<span class="n">echo</span> <span class="s1">&#39;net.core.default_qdisc = fq&#39;</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="o">.</span><span class="n">conf</span>
<span class="n">echo</span> <span class="s1">&#39;net.ipv4.tcp_congestion_control = bbr&#39;</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="o">.</span><span class="n">conf</span>
<span class="n">sysctl</span> <span class="o">-</span><span class="n">p</span>

<span class="err">检查，以下命令输出都应该有</span><span class="n">bbr</span>
<span class="n">sysctl</span> <span class="o">-</span><span class="n">n</span> <span class="n">net</span><span class="o">.</span><span class="n">ipv4</span><span class="o">.</span><span class="n">tcp_available_congestion_control</span>
<span class="n">sysctl</span> <span class="o">-</span><span class="n">n</span> <span class="n">net</span><span class="o">.</span><span class="n">ipv4</span><span class="o">.</span><span class="n">tcp_congestion_control</span>
<span class="n">lsmod</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">bbr</span>

<span class="err">安装</span><span class="n">bbr</span><span class="err">后要注意重新关闭</span><span class="n">selinux</span>


<span class="n">aws</span><span class="err">可以直接开启</span><span class="n">bbr</span>
<span class="n">yum</span> <span class="n">remove</span> <span class="n">amazon</span><span class="o">-</span><span class="n">ssm</span><span class="o">-</span><span class="n">agent</span> <span class="n">postfix</span> <span class="n">rpcbind</span> <span class="n">update</span><span class="o">-</span><span class="n">motd</span> <span class="n">irqbalance</span> <span class="n">sysstat</span> <span class="o">-</span><span class="n">y</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;ListenAddress 0.0.0.0</span><span class="se">\n</span><span class="s2">Port 17006</span><span class="se">\n</span><span class="s2">PermitRootLogin yes&quot;</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/</span><span class="n">sshd_config</span>
<span class="n">echo</span> <span class="s1">&#39;PS1=&quot;[\e[31m\u@\e[36m\d \w]</span><span class="se">\\</span><span class="s1">$\e[m &quot;&#39;</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">profile</span>
<span class="n">systemctl</span> <span class="n">restart</span> <span class="n">sshd</span>
\<span class="n">cp</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">ec2</span><span class="o">-</span><span class="n">user</span><span class="o">/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">authorized_keys</span> <span class="o">.</span><span class="n">ssh</span><span class="o">/</span>
\<span class="n">cp</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">zoneinfo</span><span class="o">/</span><span class="n">Asia</span><span class="o">/</span><span class="n">Shanghai</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">localtime</span>
<span class="n">userdel</span> <span class="o">-</span><span class="n">r</span> <span class="n">ec2</span><span class="o">-</span><span class="n">user</span>
<span class="n">echo</span> <span class="s1">&#39;nohup /root/v2ray/v2ray &amp;&#39;</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">rc</span><span class="o">.</span><span class="n">local</span>
<span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">rc</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">rc</span><span class="o">.</span><span class="n">local</span>

<span class="n">crontab</span> <span class="o">-</span><span class="n">l</span>
<span class="mi">0</span> <span class="mi">0</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="o">&gt;/</span><span class="n">root</span><span class="o">/</span><span class="n">v2ray</span><span class="o">/</span><span class="n">access</span><span class="o">.</span><span class="n">log</span><span class="p">;</span><span class="n">find</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span> <span class="o">-</span><span class="nb">type</span> <span class="n">f</span> <span class="o">-</span><span class="n">mtime</span> <span class="mi">1</span> <span class="o">-</span><span class="k">exec</span> <span class="n">rm</span> <span class="p">{}</span> \<span class="p">;</span>
</pre></div>


<h2 id="chrome">chrome</h2>
<div class="codehilite"><pre><span></span><span class="n">Windows</span><span class="w"> </span><span class="n">平台32位离线安装包</span><span class="err">：</span><span class="w"></span>

<span class="n">Canary</span><span class="w"> </span><span class="n">金丝雀版</span><span class="err">：</span><span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">chrome</span><span class="o">/</span><span class="n">eula</span><span class="p">.</span><span class="n">html</span><span class="vm">?</span><span class="n">platform</span><span class="o">=</span><span class="n">win</span><span class="o">&amp;</span><span class="n">extra</span><span class="o">=</span><span class="n">canarychannel</span><span class="o">&amp;</span><span class="n">standalone</span><span class="o">=</span><span class="mi">1</span><span class="w"></span>
<span class="n">Dev开发版</span><span class="err">：</span><span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">chrome</span><span class="o">/</span><span class="n">eula</span><span class="p">.</span><span class="n">html</span><span class="vm">?</span><span class="n">platform</span><span class="o">=</span><span class="n">win</span><span class="o">&amp;</span><span class="n">extra</span><span class="o">=</span><span class="n">devchannel</span><span class="o">&amp;</span><span class="n">standalone</span><span class="o">=</span><span class="mi">1</span><span class="w"></span>
<span class="n">Beta测试版</span><span class="err">：</span><span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">chrome</span><span class="o">/</span><span class="n">eula</span><span class="p">.</span><span class="n">html</span><span class="vm">?</span><span class="n">platform</span><span class="o">=</span><span class="n">win</span><span class="o">&amp;</span><span class="n">extra</span><span class="o">=</span><span class="n">betachannel</span><span class="o">&amp;</span><span class="n">standalone</span><span class="o">=</span><span class="mi">1</span><span class="w"></span>
<span class="n">Stable稳定版</span><span class="err">：</span><span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">chrome</span><span class="o">/</span><span class="n">eula</span><span class="p">.</span><span class="n">html</span><span class="vm">?</span><span class="n">platform</span><span class="o">=</span><span class="n">win</span><span class="o">&amp;</span><span class="n">extra</span><span class="o">=</span><span class="n">stablechannel</span><span class="o">&amp;</span><span class="n">standalone</span><span class="o">=</span><span class="mi">1</span><span class="w"></span>

<span class="n">crx下载</span><span class="w"></span>
<span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">chrome</span><span class="o">-</span><span class="n">extension</span><span class="o">-</span><span class="n">downloader</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">how</span><span class="o">-</span><span class="n">does</span><span class="o">-</span><span class="n">it</span><span class="o">-</span><span class="k">work</span><span class="p">.</span><span class="n">php</span><span class="w"></span>
<span class="n">直接获取扩展名的URL如下</span><span class="err">：</span><span class="w"> </span>
<span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">clients2</span><span class="p">.</span><span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">service</span><span class="o">/</span><span class="n">update2</span><span class="o">/</span><span class="n">crx</span><span class="vm">?</span><span class="n">response</span><span class="o">=</span><span class="n">redirect</span><span class="o">&amp;</span><span class="n">prodversion</span><span class="o">=</span><span class="mf">49.0</span><span class="o">&amp;</span><span class="n">x</span><span class="o">=</span><span class="n">id</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">~~~~%</span><span class="mi">26</span><span class="n">installsource</span><span class="o">%</span><span class="mi">3</span><span class="n">Dondemand</span><span class="o">%</span><span class="mi">26</span><span class="n">uc</span><span class="w"> </span>
<span class="n">您必须将4个波浪号</span><span class="err">（</span><span class="o">~~~~</span><span class="err">）</span><span class="n">替换为您要下载的扩展名的ID</span><span class="err">。</span><span class="w"></span>

<span class="n">例如</span><span class="err">，</span><span class="n">如果您要下载Google地图</span><span class="err">，</span><span class="nl">可以在上面找到该扩展程序https</span><span class="p">:</span><span class="o">//</span><span class="n">chrome</span><span class="p">.</span><span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">webstore</span><span class="o">/</span><span class="n">detail</span><span class="o">/</span><span class="n">google</span><span class="o">-</span><span class="n">maps</span><span class="o">/</span><span class="n">lneaknkopdijkpnocmklfnjbeapigfbh</span><span class="err">。</span><span class="w"></span>
<span class="n">提取的Google地图ID是lneaknkopdijkpnocmklfnjbeapigfbh</span><span class="err">。</span><span class="w"></span>
<span class="nl">Google地图的直接下载网址将是https</span><span class="p">:</span><span class="o">//</span><span class="n">clients2</span><span class="p">.</span><span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">service</span><span class="o">/</span><span class="n">update2</span><span class="o">/</span><span class="n">crx</span><span class="vm">?</span><span class="n">response</span><span class="o">=</span><span class="n">redirect</span><span class="o">&amp;</span><span class="n">prodversion</span><span class="o">=</span><span class="mf">49.0</span><span class="o">&amp;</span><span class="n">x</span><span class="o">=</span><span class="n">id</span><span class="o">%</span><span class="mi">3</span><span class="n">Dlneaknkopdijkpnocmklfnjbeapigfbh</span><span class="o">%</span><span class="mi">26</span><span class="n">installsource</span><span class="o">%</span><span class="mi">3</span><span class="n">Dondemand</span><span class="o">%</span><span class="mi">26</span><span class="n">uc</span><span class="err">。</span><span class="w"></span>

<span class="n">下载的文件将始终命名为extension_</span><span class="o">[</span><span class="n">version</span><span class="o">]</span><span class="p">.</span><span class="n">crx</span><span class="err">。</span><span class="w"> </span>
<span class="n">在我们使用Google地图的示例中extension_5_2_7</span><span class="p">.</span><span class="n">crx</span><span class="err">，</span><span class="n">因为当前版本的Google地图是5</span><span class="mf">.2.7</span><span class="err">。</span><span class="w"></span>
</pre></div>


<h2 id="_3">基本优化</h2>
<div class="codehilite"><pre><span></span> 在运维工作中，我们发现<span class="nv">Linux</span>系统安装之后并不能立即投入生产环境使用，往往需要先经过我们运维人员的优化才行。
下面我就为大家简单讲解几点关于<span class="nv">Linux</span>系统安装后的基础优化操作。

注意：本次优化都是基于<span class="nv">CentOS</span>（<span class="mi">5</span>.<span class="mi">8</span><span class="o">/</span><span class="mi">6</span>.<span class="mi">4</span>）。关于<span class="mi">5</span>.<span class="mi">8</span>和<span class="mi">6</span>.<span class="mi">4</span>两者优化时的小区别，我会在文中提及的。

优化条目：
修改<span class="nv">ip</span>地址、网关、主机名、<span class="nv">DNS</span>等
关闭<span class="nv">selinux</span>，清空<span class="nv">iptables</span>
添加普通用户并进行<span class="nv">sudo</span>授权管理
更新<span class="nv">yum</span>源及必要软件安装
定时自动更新服务器时间
精简开机自启动服务
定时自动清理<span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">spool</span><span class="o">/</span><span class="nv">clientmqueue</span><span class="o">/</span>目录垃圾文件，防止<span class="nv">inode</span>节点被占满
变更默认的<span class="nv">ssh</span>服务端口，禁止<span class="nv">root</span>用户远程连接
锁定关键文件系统
调整文件描述符大小
调整字符集，使其支持中文
去除系统及内核版本登录前的屏幕显示
内核参数优化
<span class="mi">1</span>、修改<span class="nv">ip</span>地址、网关、主机名、<span class="nv">DNS</span>等
修改<span class="nv">IP</span>地址：
[<span class="nv">root</span>@<span class="nv">localhost</span> <span class="o">~</span>]# <span class="nv">vi</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">sysconfig</span><span class="o">/</span><span class="nv">network</span><span class="o">-</span><span class="nv">scripts</span><span class="o">/</span><span class="nv">ifcfg</span><span class="o">-</span><span class="nv">eth0</span>

<span class="nv">DEVICE</span><span class="o">=</span><span class="nv">eth0</span>         #网卡名字

<span class="nv">BOOTPROTO</span><span class="o">=</span><span class="nv">static</span>    #静态<span class="nv">IP</span>地址获取状态 如：<span class="nv">DHCP</span>表示自动获取<span class="nv">IP</span>地址

<span class="nv">IPADDR</span><span class="o">=</span><span class="mi">192</span>.<span class="mi">168</span>.<span class="mi">1</span>.<span class="mi">113</span>            #<span class="nv">IP</span>地址

<span class="nv">NETMASK</span><span class="o">=</span><span class="mi">255</span>.<span class="mi">255</span>.<span class="mi">255</span>.<span class="mi">0</span>           #子网掩码

<span class="nv">ONBOOT</span><span class="o">=</span><span class="nv">yes</span> #引导时是否激活

<span class="nv">GATEWAY</span><span class="o">=</span><span class="mi">192</span>.<span class="mi">168</span>.<span class="mi">1</span>.<span class="mi">1</span>

[<span class="nv">root</span>@<span class="nv">localhost</span> <span class="o">~</span>]# <span class="nv">cat</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">sysconfig</span><span class="o">/</span><span class="nv">network</span><span class="o">-</span><span class="nv">scripts</span><span class="o">/</span><span class="nv">ifcfg</span><span class="o">-</span><span class="nv">eth0</span>

<span class="nv">DEVICE</span><span class="o">=</span><span class="nv">eth0</span>

<span class="nv">BOOTPROTO</span><span class="o">=</span><span class="nv">static</span>

<span class="nv">IPADDR</span><span class="o">=</span><span class="mi">192</span>.<span class="mi">168</span>.<span class="mi">1</span>.<span class="mi">113</span>

<span class="nv">NETMASK</span><span class="o">=</span><span class="mi">255</span>.<span class="mi">255</span>.<span class="mi">255</span>.<span class="mi">0</span>

<span class="nv">ONBOOT</span><span class="o">=</span><span class="nv">yes</span>

<span class="nv">GATEWAY</span><span class="o">=</span><span class="mi">192</span>.<span class="mi">168</span>.<span class="mi">1</span>.<span class="mi">1</span>

修改主机名：
[<span class="nv">root</span>@<span class="nv">localhost</span> <span class="o">~</span>]# <span class="nv">vi</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">sysconfig</span><span class="o">/</span><span class="nv">network</span>

<span class="nv">HOSTNAME</span><span class="o">=</span><span class="nv">c64</span>     #修改主机名，重启生效

<span class="nv">GATEWAY</span><span class="o">=</span><span class="mi">192</span>.<span class="mi">168</span>.<span class="mi">1</span>.<span class="mi">1</span>    #修改默认网关,如果上面<span class="nv">eth0</span>里面不配置网关的话，默认就使用这里的网关了。

[<span class="nv">root</span>@<span class="nv">localhost</span> <span class="o">~</span>]# <span class="nv">cat</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">sysconfig</span><span class="o">/</span><span class="nv">network</span>

<span class="nv">HOSTNAME</span><span class="o">=</span><span class="nv">c64</span>

<span class="nv">GATEWAY</span><span class="o">=</span><span class="mi">192</span>.<span class="mi">168</span>.<span class="mi">1</span>.<span class="mi">1</span>

我们也可以用  <span class="nv">hostname</span> <span class="nv">c64</span>  来临时修改主机名，重新登录生效

修改<span class="nv">DNS</span>
[<span class="nv">root</span>@<span class="nv">localhost</span> <span class="o">~</span>]# <span class="nv">vi</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">resolv</span>.<span class="nv">conf</span>   #修改<span class="nv">DNS</span>信息

<span class="nv">nameserver</span> <span class="mi">114</span>.<span class="mi">114</span>.<span class="mi">114</span>.<span class="mi">114</span>

<span class="nv">nameserver</span> <span class="mi">8</span>.<span class="mi">8</span>.<span class="mi">8</span>.<span class="mi">8</span>

[<span class="nv">root</span>@<span class="nv">localhost</span> <span class="o">~</span>]# <span class="nv">cat</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">resolv</span>.<span class="nv">conf</span>  #查看修改后的<span class="nv">DNS</span>信息

<span class="nv">nameserver</span> <span class="mi">114</span>.<span class="mi">114</span>.<span class="mi">114</span>.<span class="mi">114</span>

<span class="nv">nameserver</span> <span class="mi">8</span>.<span class="mi">8</span>.<span class="mi">8</span>.<span class="mi">8</span>

[<span class="nv">root</span>@<span class="nv">localhost</span> <span class="o">~</span>]# <span class="nv">service</span> <span class="nv">network</span> <span class="nv">restart</span>   #重启网卡，生效

重启网卡，也可以用下面的命令

[<span class="nv">root</span>@<span class="nv">localhost</span> <span class="o">~</span>]# <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">init</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">network</span> <span class="nv">restart</span>

<span class="mi">2</span>、关闭<span class="nv">selinux</span>，清空<span class="nv">iptables</span>
关闭<span class="nv">selinux</span>
[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="nv">sed</span> –<span class="nv">i</span> <span class="s1">&#39;</span><span class="s">s/SELINUX=enforcing/SELINUX=disabled/g</span><span class="s1">&#39;</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">selinux</span><span class="o">/</span><span class="nv">config</span>   #修改配置文件则永久生效，
但是必须要重启系统。

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="nv">grep</span> <span class="nv">SELINUX</span><span class="o">=</span><span class="nv">disabled</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">selinux</span><span class="o">/</span><span class="nv">config</span>

<span class="nv">SELINUX</span><span class="o">=</span><span class="nv">disabled</span>     #查看更改后的结果

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="nv">setenforce</span> <span class="mi">0</span>   #临时生效命令

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="nv">getenforce</span>      #查看<span class="nv">selinux</span>当前状态

<span class="nv">Permissive</span>

清空<span class="nv">iptables</span>
[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="nv">iptables</span> –<span class="nv">F</span>     #清理防火墙规则

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="nv">iptables</span> –<span class="nv">L</span>     #查看防火墙规则

<span class="nv">Chain</span> <span class="nv">INPUT</span> <span class="ss">(</span><span class="nv">policy</span> <span class="nv">ACCEPT</span><span class="ss">)</span>

<span class="nv">target</span>     <span class="nv">prot</span> <span class="nv">opt</span> <span class="nv">source</span>               <span class="nv">destination</span>

<span class="nv">Chain</span> <span class="nv">FORWARD</span> <span class="ss">(</span><span class="nv">policy</span> <span class="nv">ACCEPT</span><span class="ss">)</span>

<span class="nv">target</span>     <span class="nv">prot</span> <span class="nv">opt</span> <span class="nv">source</span>               <span class="nv">destination</span>

<span class="nv">Chain</span> <span class="nv">OUTPUT</span> <span class="ss">(</span><span class="nv">policy</span> <span class="nv">ACCEPT</span><span class="ss">)</span>

<span class="nv">target</span>     <span class="nv">prot</span> <span class="nv">opt</span> <span class="nv">source</span>               <span class="nv">destination</span>

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]#<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">init</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">iptables</span> <span class="nv">save</span>   #保存防火墙配置信息

<span class="mi">3</span>、添加普通用户并进行<span class="nv">sudo</span>授权管理
[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="nv">useradd</span> <span class="nv">sunsky</span>

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="nv">echo</span> <span class="s2">&quot;</span><span class="s">123456</span><span class="s2">&quot;</span><span class="o">|</span><span class="nv">passwd</span> <span class="o">--</span><span class="nv">stdin</span> <span class="nv">sunsky</span><span class="o">&amp;&amp;</span><span class="nv">history</span> –<span class="nv">c</span>

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="nv">visudo</span>

在<span class="nv">root</span>    <span class="nv">ALL</span><span class="o">=</span><span class="ss">(</span><span class="nv">ALL</span><span class="ss">)</span>    <span class="nv">ALL</span>此行下，添加如下内容

<span class="nv">sunsky</span>    <span class="nv">ALL</span><span class="o">=</span><span class="ss">(</span><span class="nv">ALL</span><span class="ss">)</span>    <span class="nv">ALL</span>

<span class="mi">4</span>、更新<span class="nv">yum</span>源及必要软件安装
<span class="nv">yum</span>安装软件，默认获取<span class="nv">rpm</span>包的途径从国外官方源，改成国内的源。

国内较快的两个站点：搜狐镜像站点、网易镜像站点

法<span class="mi">1</span>：自己配置好安装源配置文件，然后上传到<span class="nv">linux</span>。

法<span class="mi">2</span>：使用镜像站点配置好的<span class="nv">yum</span>安装源配置文件

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="nv">cd</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">yum</span>.<span class="nv">repos</span>.<span class="nv">d</span><span class="o">/</span>

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="nv">yum</span>.<span class="nv">repos</span>.<span class="nv">d</span>]# <span class="o">/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">mv</span> <span class="nv">CentOS</span><span class="o">-</span><span class="nv">Base</span>.<span class="nv">repo</span> <span class="nv">CentOS</span><span class="o">-</span><span class="nv">Base</span>.<span class="nv">repo</span>.<span class="nv">bak</span>

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="nv">yum</span>.<span class="nv">repos</span>.<span class="nv">d</span>]# <span class="nv">wget</span> <span class="nv">http</span>:<span class="o">//</span><span class="nv">mirrors</span>.<span class="mi">163</span>.<span class="nv">com</span><span class="o">/</span>.<span class="nv">help</span><span class="o">/</span><span class="nv">CentOS6</span><span class="o">-</span><span class="nv">Base</span><span class="o">-</span><span class="mi">163</span>.<span class="nv">repo</span>

接下来执行如下命令，检测<span class="nv">yum</span>是否正常

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="nv">yum</span>.<span class="nv">repos</span>.<span class="nv">d</span>]# <span class="nv">yum</span> <span class="nv">clean</span> <span class="nv">all</span>  #清空<span class="nv">yum</span>缓存

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="nv">yum</span>.<span class="nv">repos</span>.<span class="nv">d</span>]# <span class="nv">yum</span> <span class="nv">makecache</span>  #建立<span class="nv">yum</span>缓存

然后使用如下命令将系统更新到最新

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="nv">yum</span>.<span class="nv">repos</span>.<span class="nv">d</span>]# <span class="nv">rpm</span> <span class="o">--</span><span class="nv">import</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">pki</span><span class="o">/</span><span class="nv">rpm</span><span class="o">-</span><span class="nv">gpg</span><span class="o">/</span><span class="nv">RPM</span><span class="o">-</span><span class="nv">GPG</span><span class="o">-</span><span class="nv">KEY</span><span class="o">*</span>       #导入签名<span class="nv">KEY</span>到<span class="nv">RPM</span>

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="nv">yum</span>.<span class="nv">repos</span>.<span class="nv">d</span>]# <span class="nv">yum</span>  <span class="nv">upgrade</span> <span class="o">-</span><span class="nv">y</span>     #更新系统内核到最新

接下来就要安装几个必要的软件了

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="nv">yum</span>.<span class="nv">repos</span>.<span class="nv">d</span>]# <span class="nv">yum</span> <span class="nv">install</span> <span class="nv">lrzsz</span> <span class="nv">ntpdate</span> <span class="nv">sysstat</span> <span class="o">-</span><span class="nv">y</span>

<span class="nv">lrzsz</span>：是一个上传下载的软件
<span class="nv">ntpdate</span>：是用来与远程时间服务器进行时间更新的软件
<span class="nv">sysstat</span>：是用来检测系统性能及效率的工具 
<span class="mi">5</span>、定时自动更新服务器时间
[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="nv">echo</span> <span class="s1">&#39;</span><span class="s">*/5 * * * * /usr/sbin/ntpdate time.windows.com &gt;/dev/null 2 &gt;&amp;1</span><span class="s1">&#39;</span> <span class="o">&gt;&gt;/</span><span class="nv">var</span><span class="o">/</span><span class="nv">spool</span><span class="o">/</span><span class="nv">cron</span><span class="o">/</span><span class="nv">root</span>

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="nv">echo</span> <span class="s1">&#39;</span><span class="s">*/10 * * * * /usr/sbin/ntpdate time.nist.gov &gt;/dev/null 2&gt;&amp;1</span><span class="s1">&#39;</span> <span class="o">&gt;&gt;/</span><span class="nv">var</span><span class="o">/</span><span class="nv">spool</span><span class="o">/</span><span class="nv">cron</span><span class="o">/</span><span class="nv">root</span>

提示：<span class="nv">CentOS</span> <span class="mi">6</span>.<span class="mi">4</span>的时间同步命令路径不一样

<span class="mi">6</span>是<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">sbin</span><span class="o">/</span><span class="nv">ntpdate</span>

<span class="mi">5</span>是<span class="o">/</span><span class="nv">sbin</span><span class="o">/</span><span class="nv">ntpdate</span>

扩展：在机器数量少时，以上定时任务同步时间就可以了。如果机器数量大时，可以在网内另外部署一台时间同步服务器<span class="nv">NTP</span> <span class="nv">Server</span>。
此处仅提及，不做部署。

<span class="mi">6</span>、精简开机自启动服务
刚装完操作系统可以只保留<span class="nv">crond</span>，<span class="nv">network</span>，<span class="nv">syslog</span>，<span class="nv">sshd</span>这四个服务。（<span class="nv">Centos6</span>.<span class="mi">4</span>为<span class="nv">rsyslog</span>）

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="k">for</span> <span class="nv">sun</span> <span class="nv">in</span> `<span class="nv">chkconfig</span> <span class="o">--</span><span class="nv">list</span><span class="o">|</span><span class="nv">grep</span> <span class="mi">3</span>:<span class="nv">on</span><span class="o">|</span><span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">{print $1}</span><span class="s1">&#39;</span>`<span class="c1">;do chkconfig --level 3 $sun off;done</span>

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="k">for</span> <span class="nv">sun</span> <span class="nv">in</span> <span class="nv">crond</span> <span class="nv">rsyslog</span> <span class="nv">sshd</span> <span class="nv">network</span><span class="c1">;do chkconfig --level 3 $sun on;done</span>

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="nv">chkconfig</span> <span class="o">--</span><span class="nv">list</span><span class="o">|</span><span class="nv">grep</span> <span class="mi">3</span>:<span class="nv">on</span>

<span class="nv">crond</span>           <span class="mi">0</span>:<span class="nv">off</span>   <span class="mi">1</span>:<span class="nv">off</span>   <span class="mi">2</span>:<span class="nv">on</span>    <span class="mi">3</span>:<span class="nv">on</span>    <span class="mi">4</span>:<span class="nv">on</span>    <span class="mi">5</span>:<span class="nv">on</span>    <span class="mi">6</span>:<span class="nv">off</span>

<span class="nv">network</span>         <span class="mi">0</span>:<span class="nv">off</span>   <span class="mi">1</span>:<span class="nv">off</span>   <span class="mi">2</span>:<span class="nv">on</span>    <span class="mi">3</span>:<span class="nv">on</span>    <span class="mi">4</span>:<span class="nv">on</span>    <span class="mi">5</span>:<span class="nv">on</span>    <span class="mi">6</span>:<span class="nv">off</span>

<span class="nv">rsyslog</span>         <span class="mi">0</span>:<span class="nv">off</span>   <span class="mi">1</span>:<span class="nv">off</span>   <span class="mi">2</span>:<span class="nv">on</span>    <span class="mi">3</span>:<span class="nv">on</span>    <span class="mi">4</span>:<span class="nv">on</span>    <span class="mi">5</span>:<span class="nv">on</span>    <span class="mi">6</span>:<span class="nv">off</span>

<span class="nv">sshd</span>            <span class="mi">0</span>:<span class="nv">off</span>   <span class="mi">1</span>:<span class="nv">off</span>   <span class="mi">2</span>:<span class="nv">on</span>    <span class="mi">3</span>:<span class="nv">on</span>    <span class="mi">4</span>:<span class="nv">on</span>    <span class="mi">5</span>:<span class="nv">on</span>    <span class="mi">6</span>:<span class="nv">off</span>

<span class="mi">7</span>、定时自动清理<span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">spool</span><span class="o">/</span><span class="nv">clientmqueue</span><span class="o">/</span>目录垃圾文件，放置<span class="nv">inode</span>节点被占满
本优化点，在<span class="mi">6</span>.<span class="mi">4</span>上可以忽略不需要操作即可！

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="nv">mkdir</span> <span class="o">/</span><span class="nv">server</span><span class="o">/</span><span class="nv">scripts</span> <span class="o">-</span><span class="nv">p</span>

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="nv">vi</span> <span class="o">/</span><span class="nv">server</span><span class="o">/</span><span class="nv">scripts</span><span class="o">/</span><span class="nv">spool_clean</span>.<span class="nv">sh</span>

#<span class="o">!/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">sh</span>

<span class="nv">find</span> <span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">spool</span><span class="o">/</span><span class="nv">clientmqueue</span><span class="o">/</span> <span class="o">-</span><span class="nv">type</span> <span class="nv">f</span> <span class="o">-</span><span class="nv">mtime</span> <span class="o">+</span><span class="mi">30</span><span class="o">|</span><span class="nv">xargs</span> <span class="nv">rm</span> <span class="o">-</span><span class="nv">f</span>

然后将其加入到<span class="nv">crontab</span>定时任务中

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="nv">echo</span> <span class="s1">&#39;</span><span class="s">*/30 * * * * /bin/sh /server/scripts/spool_clean.sh &gt;/dev/null 2&gt;&amp;1</span><span class="s1">&#39;</span><span class="o">&gt;&gt;/</span><span class="nv">var</span><span class="o">/</span><span class="nv">spool</span><span class="o">/</span><span class="nv">cron</span><span class="o">/</span><span class="nv">root</span>

<span class="mi">8</span>、变更默认的<span class="nv">ssh</span>服务端口，禁止<span class="nv">root</span>用户远程连接
[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="nv">cp</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">ssh</span><span class="o">/</span><span class="nv">sshd_config</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">ssh</span><span class="o">/</span><span class="nv">sshd_config</span>.<span class="nv">bak</span>

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="nv">vim</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">ssh</span><span class="o">/</span><span class="nv">sshd_config</span>

<span class="nv">Port</span> <span class="mi">52113</span> #<span class="nv">ssh</span>连接默认的端口

<span class="nv">PermitRootLogin</span> <span class="nv">no</span>   #<span class="nv">root</span>用户黑客都知道，禁止它远程登录

<span class="nv">PermitEmptyPasswords</span> <span class="nv">no</span> #禁止空密码登录

<span class="nv">UseDNS</span> <span class="nv">no</span>            #不使用<span class="nv">DNS</span>

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">init</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">sshd</span> <span class="nv">reload</span>    #从新加载配置

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="nv">netstat</span> <span class="o">-</span><span class="nv">lnt</span>     #查看端口信息

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="nv">lsof</span> <span class="o">-</span><span class="nv">i</span> <span class="nv">tcp</span>:<span class="mi">52113</span>

<span class="mi">9</span>、锁定关键文件系统
[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="nv">chattr</span> <span class="o">+</span><span class="nv">i</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">passwd</span>

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="nv">chattr</span> <span class="o">+</span><span class="nv">i</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">inittab</span>

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="nv">chattr</span> <span class="o">+</span><span class="nv">i</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">group</span>

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="nv">chattr</span> <span class="o">+</span><span class="nv">i</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">shadow</span>

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="nv">chattr</span> <span class="o">+</span><span class="nv">i</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">gshadow</span>

使用<span class="nv">chattr</span>命令后，为了安全我们需要将其改名

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="o">/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">mv</span> <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">chattr</span> <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">bin</span><span class="o">/</span>任意名称

<span class="mi">10</span>、调整文件描述符大小
[<span class="nv">root</span>@<span class="nv">localhost</span> <span class="o">~</span>]# <span class="nv">ulimit</span> –<span class="nv">n</span>        #查看文件描述符大小

<span class="mi">1024</span>

[<span class="nv">root</span>@<span class="nv">localhost</span> <span class="o">~</span>]# <span class="nv">echo</span> <span class="s1">&#39;</span><span class="s">*  -  nofile  65535</span><span class="s1">&#39;</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">security</span><span class="o">/</span><span class="nv">limits</span>.<span class="nv">conf</span>



配置完成后，重新登录即可查看。

提示：也可以把<span class="nv">ulimit</span> <span class="o">-</span><span class="nv">SHn</span> <span class="mi">65535</span>命令加入到<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">local</span>，然后每次重启生效

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="nv">cat</span> <span class="o">&gt;&gt;/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">local</span><span class="o">&lt;&lt;</span><span class="nv">EOF</span>

#<span class="nv">open</span> <span class="nv">files</span>

<span class="nv">ulimit</span> <span class="o">-</span><span class="nv">HSn</span> <span class="mi">65535</span>

#<span class="nv">stack</span> <span class="nv">size</span>

<span class="nv">ulimit</span> <span class="o">-</span><span class="nv">s</span> <span class="mi">65535</span>

<span class="nv">EOF</span>

扩展：文件描述符
文件描述符在形式上是一个非负整数。实际上，它是一个索引值，指向内核为每一个进程所维护的该进程打开文件的记录表。
当程序打开一个现有文件或者创建一个新文件时，内核向进程返回一个文件描述符。在程序设计中，一些涉及底层的程序编写往往会围绕着
文件描述符展开。但是文件描述符这一概念往往只适用于<span class="nv">Unix</span>、<span class="nv">Linux</span>这样的操作系统。

习惯上，标准输入（<span class="nv">standard</span> <span class="nv">input</span>）的文件描述符是 <span class="mi">0</span>，标准输出（<span class="nv">standard</span> <span class="nv">output</span>）是 <span class="mi">1</span>，标准错误（<span class="nv">standard</span> <span class="nv">error</span>）是 
<span class="mi">2</span>。尽管这种习惯并非<span class="nv">Unix</span>内核的特性，但是因为一些 <span class="nv">shell</span> 和很多应用程序都使用这种习惯，因此，如果内核不遵循这种习惯的话，
很多应用程序将不能使用。

<span class="mi">11</span>、调整字符集，使其支持中文
<span class="nv">sed</span> <span class="o">-</span><span class="nv">i</span> <span class="s1">&#39;</span><span class="s">s#LANG=&quot;en_US.UTF-8&quot;#LANG=&quot;zh_CN.GB18030&quot;#</span><span class="s1">&#39;</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">sysconfig</span><span class="o">/</span><span class="nv">i18n</span>

<span class="nv">source</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">sysconfig</span><span class="o">/</span><span class="nv">i18n</span>

扩展：什么是字符集？
简单的说就是一套文字符号及其编码。常用的字符集有：

<span class="nv">GBK</span> 定长双字节不是国际标准，支持系统不少

<span class="nv">UTF</span><span class="o">-</span><span class="mi">8</span> 非定长 <span class="mi">1</span><span class="o">-</span><span class="mi">4</span>字节广泛支持，<span class="nv">MYSQL</span>也使用<span class="nv">UTF</span><span class="o">-</span><span class="mi">8</span>

<span class="mi">12</span>、去除系统及内核版本登录前的屏幕显示
[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="o">&gt;/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">redhat</span><span class="o">-</span><span class="nv">release</span>

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="o">&gt;/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">issue</span>

<span class="mi">13</span>、内核参数优化
说明：本优化适合<span class="nv">apache</span>，<span class="nv">nginx</span>，<span class="nv">squid</span>多种等<span class="nv">web</span>应用，特殊的业务也可能需要略作调整。

[<span class="nv">root</span>@<span class="nv">c64</span> <span class="o">~</span>]# <span class="nv">vi</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">sysctl</span>.<span class="nv">conf</span>

#<span class="nv">by</span> <span class="nv">sun</span> <span class="nv">in</span> <span class="mi">20131001</span>

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_fin_timeout</span> <span class="o">=</span> <span class="mi">2</span>

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_tw_reuse</span> <span class="o">=</span> <span class="mi">1</span>

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_tw_recycle</span> <span class="o">=</span> <span class="mi">1</span>

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_syncookies</span> <span class="o">=</span> <span class="mi">1</span>

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_keepalive_time</span> <span class="o">=</span><span class="mi">600</span>

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">ip_local_port_range</span> <span class="o">=</span> <span class="mi">4000</span>    <span class="mi">65000</span>

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_max_syn_backlog</span> <span class="o">=</span> <span class="mi">16384</span>

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_max_tw_buckets</span> <span class="o">=</span> <span class="mi">36000</span>

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">route</span>.<span class="nv">gc_timeout</span> <span class="o">=</span> <span class="mi">100</span>

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_syn_retries</span> <span class="o">=</span> <span class="mi">1</span>

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_synack_retries</span> <span class="o">=</span> <span class="mi">1</span>

<span class="nv">net</span>.<span class="nv">core</span>.<span class="nv">somaxconn</span> <span class="o">=</span> <span class="mi">16384</span>

<span class="nv">net</span>.<span class="nv">core</span>.<span class="nv">netdev_max_backlog</span> <span class="o">=</span> <span class="mi">16384</span>

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_max_orphans</span> <span class="o">=</span> <span class="mi">16384</span>

#一下参数是对<span class="nv">iptables</span>防火墙的优化，防火墙不开会有提示，可以忽略不理。

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">ip_conntrack_max</span> <span class="o">=</span> <span class="mi">25000000</span>

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">netfilter</span>.<span class="nv">ip_conntrack_max</span> <span class="o">=</span> <span class="mi">25000000</span>

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">netfilter</span>.<span class="nv">ip_conntrack_tcp_timeout_established</span> <span class="o">=</span> <span class="mi">180</span>

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">netfilter</span>.<span class="nv">ip_conntrack_tcp_timeout_time_wait</span> <span class="o">=</span> <span class="mi">120</span>

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">netfilter</span>.<span class="nv">ip_conntrack_tcp_timeout_close_wait</span> <span class="o">=</span> <span class="mi">60</span>

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">netfilter</span>.<span class="nv">ip_conntrack_tcp_timeout_fin_wait</span> <span class="o">=</span> <span class="mi">120</span>

[<span class="nv">root</span>@<span class="nv">localhost</span> <span class="o">~</span>]# <span class="nv">sysctl</span> –<span class="nv">p</span>    #使配置文件生效

提示：由于<span class="nv">CentOS6</span>.<span class="nv">X</span>系统中的模块名不是<span class="nv">ip_conntrack</span>，而是<span class="nv">nf_conntrack</span>，所以在<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">sysctl</span>.<span class="nv">conf</span>优化时，
需要把<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">netfilter</span>.<span class="nv">ip_conntrack_max</span> 这种老的参数，改成<span class="nv">net</span>.<span class="nv">netfilter</span>.<span class="nv">nf_conntrack_max</span>这样才可以。

即对防火墙的优化，在<span class="mi">5</span>.<span class="mi">8</span>上是:
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">ip_conntrack_max</span> <span class="o">=</span> <span class="mi">25000000</span>

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">netfilter</span>.<span class="nv">ip_conntrack_max</span> <span class="o">=</span> <span class="mi">25000000</span>

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">netfilter</span>.<span class="nv">ip_conntrack_tcp_timeout_established</span> <span class="o">=</span> <span class="mi">180</span>

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">netfilter</span>.<span class="nv">ip_conntrack_tcp_timeout_time_wait</span> <span class="o">=</span> <span class="mi">120</span>

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">netfilter</span>.<span class="nv">ip_conntrack_tcp_timeout_close_wait</span> <span class="o">=</span> <span class="mi">60</span>

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">netfilter</span>.<span class="nv">ip_conntrack_tcp_timeout_fin_wait</span> <span class="o">=</span> <span class="mi">120</span>

在<span class="mi">6</span>.<span class="mi">4</span>上是:
<span class="nv">net</span>.<span class="nv">nf_conntrack_max</span> <span class="o">=</span> <span class="mi">25000000</span>

<span class="nv">net</span>.<span class="nv">netfilter</span>.<span class="nv">nf_conntrack_max</span> <span class="o">=</span> <span class="mi">25000000</span>

<span class="nv">net</span>.<span class="nv">netfilter</span>.<span class="nv">nf_conntrack_tcp_timeout_established</span> <span class="o">=</span> <span class="mi">180</span>

<span class="nv">net</span>.<span class="nv">netfilter</span>.<span class="nv">nf_conntrack_tcp_timeout_time_wait</span> <span class="o">=</span> <span class="mi">120</span>

<span class="nv">net</span>.<span class="nv">netfilter</span>.<span class="nv">nf_conntrack_tcp_timeout_close_wait</span> <span class="o">=</span> <span class="mi">60</span>

<span class="nv">net</span>.<span class="nv">netfilter</span>.<span class="nv">nf_conntrack_tcp_timeout_fin_wait</span> <span class="o">=</span> <span class="mi">120</span>

另外，在此优化过程中可能会有报错：

<span class="mi">1</span>、<span class="mi">5</span>.<span class="mi">8</span>版本上
<span class="nv">error</span>: <span class="s2">&quot;</span><span class="s">net.ipv4.ip_conntrack_max</span><span class="s2">&quot;</span> <span class="nv">is</span> <span class="nv">an</span> <span class="nv">unknown</span> <span class="nv">key</span>

<span class="nv">error</span>: <span class="s2">&quot;</span><span class="s">net.ipv4.netfilter.ip_conntrack_max</span><span class="s2">&quot;</span> <span class="nv">is</span> <span class="nv">an</span> <span class="nv">unknown</span> <span class="nv">key</span>

<span class="nv">error</span>: <span class="s2">&quot;</span><span class="s">net.ipv4.netfilter.ip_conntrack_tcp_timeout_established</span><span class="s2">&quot;</span> <span class="nv">is</span> <span class="nv">an</span> <span class="nv">unknown</span> <span class="nv">key</span>

<span class="nv">error</span>: <span class="s2">&quot;</span><span class="s">net.ipv4.netfilter.ip_conntrack_tcp_timeout_time_wait</span><span class="s2">&quot;</span> <span class="nv">is</span> <span class="nv">an</span> <span class="nv">unknown</span> <span class="nv">key</span>

<span class="nv">error</span>: <span class="s2">&quot;</span><span class="s">net.ipv4.netfilter.ip_conntrack_tcp_timeout_close_wait</span><span class="s2">&quot;</span> <span class="nv">is</span> <span class="nv">an</span> <span class="nv">unknown</span> <span class="nv">key</span>

<span class="nv">error</span>: <span class="s2">&quot;</span><span class="s">net.ipv4.netfilter.ip_conntrack_tcp_timeout_fin_wait</span><span class="s2">&quot;</span> <span class="nv">is</span> <span class="nv">an</span> <span class="nv">unknown</span> <span class="nv">key</span>

这个错误可能是你的防火墙没有开启或者自动处理可载入的模块<span class="nv">ip_conntrack</span>没有自动载入，解决办法有二，一是开启防火墙，
二是自动处理开载入的模块<span class="nv">ip_conntrack</span>

<span class="nv">modprobe</span> <span class="nv">ip_conntrack</span>

<span class="nv">echo</span> <span class="s2">&quot;</span><span class="s">modprobe ip_conntrack</span><span class="s2">&quot;</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">local</span>

<span class="mi">2</span>、<span class="mi">6</span>.<span class="mi">4</span>版本上
<span class="nv">error</span>: <span class="s2">&quot;</span><span class="s">net.nf_conntrack_max</span><span class="s2">&quot;</span> <span class="nv">is</span> <span class="nv">an</span> <span class="nv">unknown</span> <span class="nv">key</span>

<span class="nv">error</span>: <span class="s2">&quot;</span><span class="s">net.netfilter.nf_conntrack_max</span><span class="s2">&quot;</span> <span class="nv">is</span> <span class="nv">an</span> <span class="nv">unknown</span> <span class="nv">key</span>

<span class="nv">error</span>: <span class="s2">&quot;</span><span class="s">net.netfilter.nf_conntrack_tcp_timeout_established</span><span class="s2">&quot;</span> <span class="nv">is</span> <span class="nv">an</span> <span class="nv">unknown</span> <span class="nv">key</span>

<span class="nv">error</span>: <span class="s2">&quot;</span><span class="s">net.netfilter.nf_conntrack_tcp_timeout_time_wait</span><span class="s2">&quot;</span> <span class="nv">is</span> <span class="nv">an</span> <span class="nv">unknown</span> <span class="nv">key</span>

<span class="nv">error</span>: <span class="s2">&quot;</span><span class="s">net.netfilter.nf_conntrack_tcp_timeout_close_wait</span><span class="s2">&quot;</span> <span class="nv">is</span> <span class="nv">an</span> <span class="nv">unknown</span> <span class="nv">key</span>

<span class="nv">error</span>: <span class="s2">&quot;</span><span class="s">net.netfilter.nf_conntrack_tcp_timeout_fin_wait</span><span class="s2">&quot;</span> <span class="nv">is</span> <span class="nv">an</span> <span class="nv">unknown</span> <span class="nv">key</span>

这个错误可能是你的防火墙没有开启或者自动处理可载入的模块<span class="nv">ip_conntrack</span>没有自动载入，解决办法有二，一是开启防火墙，
二是自动处理开载入的模块<span class="nv">ip_conntrack</span>

<span class="nv">modprobe</span> <span class="nv">nf_conntrack</span>

<span class="nv">echo</span> <span class="s2">&quot;</span><span class="s">modprobe nf_conntrack</span><span class="s2">&quot;</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">local</span>

<span class="mi">3</span>、<span class="mi">6</span>.<span class="mi">4</span>版本上
<span class="nv">error</span>: <span class="s2">&quot;</span><span class="s">net.bridge.bridge-nf-call-ip6tables</span><span class="s2">&quot;</span> <span class="nv">is</span> <span class="nv">an</span> <span class="nv">unknown</span> <span class="nv">key</span>

<span class="nv">error</span>: <span class="s2">&quot;</span><span class="s">net.bridge.bridge-nf-call-iptables</span><span class="s2">&quot;</span> <span class="nv">is</span> <span class="nv">an</span> <span class="nv">unknown</span> <span class="nv">key</span>

<span class="nv">error</span>: <span class="s2">&quot;</span><span class="s">net.bridge.bridge-nf-call-arptables</span><span class="s2">&quot;</span> <span class="nv">is</span> <span class="nv">an</span> <span class="nv">unknown</span> <span class="nv">key</span>

这个错误是由于自动处理可载入的模块<span class="nv">bridge</span>没有自动载入，解决办法是自动处理开载入的模块<span class="nv">ip_conntrack</span>

<span class="nv">modprobe</span> <span class="nv">bridge</span>

<span class="nv">echo</span> <span class="s2">&quot;</span><span class="s">modprobe bridge</span><span class="s2">&quot;</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">local</span>

到此，我们<span class="nv">Linux</span>系统安装后的基础优化已经操作的差不多了，总结下来一共有<span class="mi">13</span>个优化点需要我们来熟知。
</pre></div>


<h2 id="io">io复用</h2>
<div class="codehilite"><pre><span></span><span class="nv">socket</span>阻塞与非阻塞，同步与异步
作者：<span class="nv">huangguisu</span>
<span class="mi">1</span>. 概念理解
     在进行网络编程时，我们常常见到同步<span class="ss">(</span><span class="nv">Sync</span><span class="ss">)</span><span class="o">/</span>异步<span class="ss">(</span><span class="nv">Async</span><span class="ss">)</span>，阻塞<span class="ss">(</span><span class="nv">Block</span><span class="ss">)</span><span class="o">/</span>非阻塞<span class="ss">(</span><span class="nv">Unblock</span><span class="ss">)</span>四种调用方式：
同步：
      所谓同步，就是在发出一个功能调用时，在没有得到结果之前，该调用就不返回。也就是必须一件一件事做,等前一件做完了才能做下一件事。
例如普通<span class="nv">B</span><span class="o">/</span><span class="nv">S</span>模式（同步）：提交请求<span class="o">-&gt;</span>等待服务器处理<span class="o">-&gt;</span>处理完毕返回 这个期间客户端浏览器不能干任何事
异步：
      异步的概念和同步相对。当一个异步过程调用发出后，调用者不能立刻得到结果。实际处理这个调用的部件在完成后，通过状态、
      通知和回调来通知调用者。
     例如 <span class="nv">ajax</span>请求（异步）: 请求通过事件触发<span class="o">-&gt;</span>服务器处理（这是浏览器仍然可以作其他事情）<span class="o">-&gt;</span>处理完毕
阻塞
     阻塞调用是指调用结果返回之前，当前线程会被挂起（线程进入非可执行状态，在这个状态下，<span class="nv">cpu</span>不会给线程分配时间片，即线程暂停运行）。
     函数只有在得到结果之后才会返回。
     有人也许会把阻塞调用和同步调用等同起来，实际上他是不同的。对于同步调用来说，很多时候当前线程还是激活的，只是从逻辑上当前函数没有
     返回而已。 例如，我们在<span class="nv">socket</span>中调用<span class="nv">recv</span>函数，如果缓冲区中没有数据，这个函数就会一直等待，直到有数据才返回。而此时，当前线程还会
     继续处理各种各样的消息。
非阻塞
      非阻塞和阻塞的概念相对应，指在不能立刻得到结果之前，该函数不会阻塞当前线程，而会立刻返回。
对象的阻塞模式和阻塞函数调用
对象是否处于阻塞模式和函数是不是阻塞调用有很强的相关性，但是并不是一一对应的。阻塞对象上可以有非阻塞的调用方式，我们可以通过一定的<span class="nv">API</span>
去轮询状 态，在适当的时候调用阻塞函数，就可以避免阻塞。而对于非阻塞对象，调用特殊的函数也可以进入阻塞调用。函数<span class="nv">select</span>就是这样的
一个例子。

<span class="mi">1</span>. 同步，就是我调用一个功能，该功能没有结束前，我死等结果。
<span class="mi">2</span>. 异步，就是我调用一个功能，不需要知道该功能结果，该功能有结果后通知我（回调通知）
<span class="mi">3</span>. 阻塞，      就是调用我（函数），我（函数）没有接收完数据或者没有得到结果之前，我不会返回。
<span class="mi">4</span>. 非阻塞，  就是调用我（函数），我（函数）立即返回，通过<span class="nv">select</span>通知调用者
同步<span class="nv">IO</span>和异步<span class="nv">IO</span>的区别就在于：数据拷贝的时候进程是否阻塞！
阻塞<span class="nv">IO</span>和非阻塞<span class="nv">IO</span>的区别就在于：应用程序的调用是否立即返回！

对于举个简单<span class="nv">c</span><span class="o">/</span><span class="nv">s</span> 模式：
同步：提交请求<span class="o">-&gt;</span>等待服务器处理<span class="o">-&gt;</span>处理完毕返回这个期间客户端浏览器不能干任何事
异步：请求通过事件触发<span class="o">-&gt;</span>服务器处理（这是浏览器仍然可以作其他事情）<span class="o">-&gt;</span>处理完毕
同步和异步都只针对于本机<span class="nv">SOCKET</span>而言的。
同步和异步,阻塞和非阻塞,有些混用,其实它们完全不是一回事,而且它们修饰的对象也不相同。
阻塞和非阻塞是指当进程访问的数据如果尚未就绪,进程是否需要等待,简单说这相当于函数内部的实现区别,也就是未就绪时是直接返回还是等待就绪<span class="c1">;</span>
而同步和异步是指访问数据的机制,同步一般指主动请求并等待<span class="nv">I</span><span class="o">/</span><span class="nv">O</span>操作完毕的方式,当数据就绪后在读写的时候必须阻塞<span class="ss">(</span>区别就绪与读写二个阶段,
同步的读写必须阻塞<span class="ss">)</span>,异步则指主动请求数据后便可以继续处理其它任务,随后等待<span class="nv">I</span><span class="o">/</span><span class="nv">O</span>,操作完毕的通知,这可以使进程在数据读写时也不阻塞。
<span class="ss">(</span>等待<span class="s2">&quot;</span><span class="s">通知</span><span class="s2">&quot;</span><span class="ss">)</span>
<span class="mi">1</span>. <span class="nv">Linux</span>下的五种<span class="nv">I</span><span class="o">/</span><span class="nv">O</span>模型
<span class="mi">1</span><span class="ss">)</span>阻塞<span class="nv">I</span><span class="o">/</span><span class="nv">O</span>（<span class="nv">blocking</span> <span class="nv">I</span><span class="o">/</span><span class="nv">O</span>）
<span class="mi">2</span><span class="ss">)</span>非阻塞<span class="nv">I</span><span class="o">/</span><span class="nv">O</span> （<span class="nv">nonblocking</span> <span class="nv">I</span><span class="o">/</span><span class="nv">O</span>）
<span class="mi">3</span><span class="ss">)</span> <span class="nv">I</span><span class="o">/</span><span class="nv">O</span>复用<span class="ss">(</span><span class="nv">select</span> 和<span class="nv">poll</span><span class="ss">)</span> （<span class="nv">I</span><span class="o">/</span><span class="nv">O</span> <span class="nv">multiplexing</span>）
<span class="mi">4</span><span class="ss">)</span>信号驱动<span class="nv">I</span><span class="o">/</span><span class="nv">O</span> （<span class="nv">signal</span> <span class="nv">driven</span> <span class="nv">I</span><span class="o">/</span><span class="nv">O</span> <span class="ss">(</span><span class="nv">SIGIO</span><span class="ss">)</span>）
<span class="mi">5</span><span class="ss">)</span>异步<span class="nv">I</span><span class="o">/</span><span class="nv">O</span> （<span class="nv">asynchronous</span> <span class="nv">I</span><span class="o">/</span><span class="nv">O</span> <span class="ss">(</span><span class="nv">the</span> <span class="nv">POSIX</span> <span class="nv">aio_functions</span><span class="ss">)</span>）

前四种都是同步，只有最后一种才是异步<span class="nv">IO</span>。

阻塞<span class="nv">I</span><span class="o">/</span><span class="nv">O</span>模型：
        简介：进程会一直阻塞，直到数据拷贝完成
     应用程序调用一个<span class="nv">IO</span>函数，导致应用程序阻塞，等待数据准备好。 如果数据没有准备好，一直等待….数据准备好了，从内核拷贝到用户空间,
     <span class="nv">IO</span>函数返回成功指示。

阻塞<span class="nv">I</span><span class="o">/</span><span class="nv">O</span>模型图：在调用<span class="nv">recv</span><span class="ss">()</span><span class="o">/</span><span class="nv">recvfrom</span>（）函数时，发生在内核中等待数据和复制数据的过程。



    当调用<span class="nv">recv</span><span class="ss">()</span>函数时，系统首先查是否有准备好的数据。如果数据没有准备好，那么系统就处于等待状态。当数据准备好后，
    将数据从系统缓冲区复制到用户空间，然后该函数返回。在套接应用程序中，当调用<span class="nv">recv</span><span class="ss">()</span>函数时，未必用户空间就已经存在数据，那么此时
    <span class="nv">recv</span><span class="ss">()</span>函数就会处于等待状态。


     当使用<span class="nv">socket</span><span class="ss">()</span>函数和<span class="nv">WSASocket</span><span class="ss">()</span>函数创建套接字时，默认的套接字都是阻塞的。这意味着当调用<span class="nv">Windows</span> <span class="nv">Sockets</span> <span class="nv">API</span>不能立即完成时，
     线程处于等待状态，直到操作完成。

    并不是所有<span class="nv">Windows</span> <span class="nv">Sockets</span> <span class="nv">API</span>以阻塞套接字为参数调用都会发生阻塞。例如，以阻塞模式的套接字为参数调用<span class="nv">bind</span><span class="ss">()</span>、<span class="nv">listen</span><span class="ss">()</span>函数时，
    函数会立即返回。将可能阻塞套接字的<span class="nv">Windows</span> <span class="nv">Sockets</span> <span class="nv">API</span>调用分为以下四种:

    <span class="mi">1</span>．输入操作： <span class="nv">recv</span><span class="ss">()</span>、<span class="nv">recvfrom</span><span class="ss">()</span>、<span class="nv">WSARecv</span><span class="ss">()</span>和<span class="nv">WSARecvfrom</span><span class="ss">()</span>函数。以阻塞套接字为参数调用该函数接收数据。如果此时套接字缓冲区
    内没有数据可读，则调用线程在数据到来前一直睡眠。

    <span class="mi">2</span>．输出操作： <span class="k">send</span><span class="ss">()</span>、<span class="nv">sendto</span><span class="ss">()</span>、<span class="nv">WSASend</span><span class="ss">()</span>和<span class="nv">WSASendto</span><span class="ss">()</span>函数。以阻塞套接字为参数调用该函数发送数据。如果套接字缓冲区没有
    可用空间，线程会一直睡眠，直到有空间。

    <span class="mi">3</span>．接受连接：<span class="nv">accept</span><span class="ss">()</span>和<span class="nv">WSAAcept</span><span class="ss">()</span>函数。以阻塞套接字为参数调用该函数，等待接受对方的连接请求。如果此时没有连接请求，线程就会进
    入睡眠状态。

   <span class="mi">4</span>．外出连接：<span class="k">connect</span><span class="ss">()</span>和<span class="nv">WSAConnect</span><span class="ss">()</span>函数。对于<span class="nv">TCP</span>连接，客户端以阻塞套接字为参数，调用该函数向服务器发起连接。该函数在收到服务器
   的应答前，不会返回。这意味着<span class="nv">TCP</span>连接总会等待至少到服务器的一次往返时间。

　　使用阻塞模式的套接字，开发网络程序比较简单，容易实现。当希望能够立即发送和接收数据，且处理的套接字数量比较少的情况下，
使用阻塞模式来开发网络程序比较合适。

    阻塞模式套接字的不足表现为，在大量建立好的套接字线程之间进行通信时比较困难。当使用“生产者<span class="o">-</span>消费者”模型开发网络程序时，为每个
    套接字都分别分配一个读线程、一个处理数据线程和一个用于同步的事件，那么这样无疑加大系统的开销。其最大的缺点是当希望同时处理大量
    套接字时，将无从下手，其扩展性很差

非阻塞<span class="nv">IO</span>模型 
       简介：非阻塞<span class="nv">IO</span>通过进程反复调用<span class="nv">IO</span>函数（多次系统调用，并马上返回）；在数据拷贝的过程中，进程是阻塞的；

       我们把一个<span class="nv">SOCKET</span>接口设置为非阻塞就是告诉内核，当所请求的<span class="nv">I</span><span class="o">/</span><span class="nv">O</span>操作无法完成时，不要将进程睡眠，而是返回一个错误。这样我们的
       <span class="nv">I</span><span class="o">/</span><span class="nv">O</span>操作函数将不断的测试数据是否已经准备好，如果没有准备好，继续测试，直到数据准备好为止。在这个不断测试的过程中，会大量的
       占用<span class="nv">CPU</span>的时间。
    把<span class="nv">SOCKET</span>设置为非阻塞模式，即通知系统内核：在调用<span class="nv">Windows</span> <span class="nv">Sockets</span> <span class="nv">API</span>时，不要让线程睡眠，而应该让函数立即返回。在返回时，
    该函数返回一个错误代码。图所示，一个非阻塞模式套接字多次调用<span class="nv">recv</span><span class="ss">()</span>函数的过程。前三次调用<span class="nv">recv</span><span class="ss">()</span>函数时，内核数据还没有准备好。
    因此，该函数立即返回<span class="nv">WSAEWOULDBLOCK</span>错误代码。第四次调用<span class="nv">recv</span><span class="ss">()</span>函数时，数据已经准备好，被复制到应用程序的缓冲区中，<span class="nv">recv</span><span class="ss">()</span>函数
    返回成功指示，应用程序开始处理数据。




     当使用<span class="nv">socket</span><span class="ss">()</span>函数和<span class="nv">WSASocket</span><span class="ss">()</span>函数创建套接字时，默认都是阻塞的。在创建套接字之后，通过调用<span class="nv">ioctlsocket</span><span class="ss">()</span>函数，将该套接字
     设置为非阻塞模式。<span class="nv">Linux</span>下的函数是:<span class="nv">fcntl</span><span class="ss">()</span>.
    套接字设置为非阻塞模式后，在调用<span class="nv">Windows</span> <span class="nv">Sockets</span> <span class="nv">API</span>函数时，调用函数会立即返回。大多数情况下，这些函数调用都会调用“失败”，
    并返回<span class="nv">WSAEWOULDBLOCK</span>错误代码。说明请求的操作在调用期间内没有时间完成。通常，应用程序需要重复调用该函数，直到获得成功返回代码。

    需要说明的是并非所有的<span class="nv">Windows</span> <span class="nv">Sockets</span> <span class="nv">API</span>在非阻塞模式下调用，都会返回<span class="nv">WSAEWOULDBLOCK</span>错误。例如，以非阻塞模式的套接字为参数
    调用
    <span class="nv">bind</span><span class="ss">()</span>函数时，就不会返回该错误代码。当然，在调用<span class="nv">WSAStartup</span><span class="ss">()</span>函数时更不会返回该错误代码，因为该函数是应用程序第一调用的函数，
    当然不会返回这样的错误代码。

    要将套接字设置为非阻塞模式，除了使用<span class="nv">ioctlsocket</span><span class="ss">()</span>函数之外，还可以使用<span class="nv">WSAAsyncselect</span><span class="ss">()</span>和<span class="nv">WSAEventselect</span><span class="ss">()</span>函数。当调用该函数
    时，套接字会自动地设置为非阻塞方式。

　　由于使用非阻塞套接字在调用函数时，会经常返回<span class="nv">WSAEWOULDBLOCK</span>错误。所以在任何时候，都应仔细检查返回代码并作好对“失败”的准备。
应用程序连续不断地调用这个函数，直到它返回成功指示为止。上面的程序清单中，在<span class="k">While</span>循环体内不断地调用<span class="nv">recv</span><span class="ss">()</span>函数，以读入<span class="mi">1024</span>个字节
的数据。这种做法很浪费系统资源。

    要完成这样的操作，有人使用<span class="nv">MSG_PEEK</span>标志调用<span class="nv">recv</span><span class="ss">()</span>函数查看缓冲区中是否有数据可读。同样，这种方法也不好。因为该做法对系统造成的
    开销是很大的，并且应用程序至少要调用<span class="nv">recv</span><span class="ss">()</span>函数两次，才能实际地读入数据。较好的做法是，使用套接字的“<span class="nv">I</span><span class="o">/</span><span class="nv">O</span>模型”来判断非阻塞套接字
    是否可读可写。

    非阻塞模式套接字与阻塞模式套接字相比，不容易使用。使用非阻塞模式套接字，需要编写更多的代码，以便在每个<span class="nv">Windows</span> <span class="nv">Sockets</span> <span class="nv">API</span>函
    数调用中，对收到的<span class="nv">WSAEWOULDBLOCK</span>错误进行处理。因此，非阻塞套接字便显得有些难于使用。

    但是，非阻塞套接字在控制建立的多个连接，在数据的收发量不均，时间不定时，明显具有优势。这种套接字在使用上存在一定难度，但只要排除
    了这些困难，它在功能上还是非常强大的。通常情况下，可考虑使用套接字的“<span class="nv">I</span><span class="o">/</span><span class="nv">O</span>模型”，它有助于应用程序通过异步方式，同时对一个或多个
    套接字的通信加以管理。


<span class="nv">IO</span>复用模型：
             简介：主要是<span class="nv">select</span>和<span class="nv">epoll</span>；对一个<span class="nv">IO</span>端口，两次调用，两次返回，比阻塞<span class="nv">IO</span>并没有什么优越性；关键是能实现同时对多个<span class="nv">IO</span>端口
             进行监听；
      <span class="nv">I</span><span class="o">/</span><span class="nv">O</span>复用模型会用到<span class="nv">select</span>、<span class="nv">poll</span>、<span class="nv">epoll</span>函数，这几个函数也会使进程阻塞，但是和阻塞<span class="nv">I</span><span class="o">/</span><span class="nv">O</span>所不同的的，这两个函数可以同时阻塞多个<span class="nv">I</span><span class="o">/</span><span class="nv">O</span>
      操作。而且可以同时对多个读操作，多个写操作的<span class="nv">I</span><span class="o">/</span><span class="nv">O</span>函数进行检测，直到有数据可读或可写时，才真正调用<span class="nv">I</span><span class="o">/</span><span class="nv">O</span>操作函数。



信号驱动<span class="nv">IO</span>
    简介：两次调用，两次返回；

    首先我们允许套接口进行信号驱动<span class="nv">I</span><span class="o">/</span><span class="nv">O</span>,并安装一个信号处理函数，进程继续运行并不阻塞。当数据准备好时，进程会收到一个<span class="nv">SIGIO</span>信号，可以
    在信号处理函数中调用<span class="nv">I</span><span class="o">/</span><span class="nv">O</span>操作函数处理数据。



异步<span class="nv">IO</span>模型
         简介：数据拷贝的时候进程无需阻塞。
     当一个异步过程调用发出后，调用者不能立刻得到结果。实际处理这个调用的部件在完成后，通过状态、通知和回调来通知调用者的输入输出
     操作


同步<span class="nv">IO</span>引起进程阻塞，直至<span class="nv">IO</span>操作完成。
异步<span class="nv">IO</span>不会引起进程阻塞。
<span class="nv">IO</span>复用是先通过<span class="nv">select</span>调用阻塞。

<span class="mi">5</span>个<span class="nv">I</span><span class="o">/</span><span class="nv">O</span>模型的比较：


<span class="mi">1</span>. <span class="nv">select</span>、<span class="nv">poll</span>、<span class="nv">epoll</span>简介
<span class="nv">epoll</span>跟<span class="nv">select</span>都能提供多路<span class="nv">I</span><span class="o">/</span><span class="nv">O</span>复用的解决方案。在现在的<span class="nv">Linux</span>内核里有都能够支持，其中<span class="nv">epoll</span>是<span class="nv">Linux</span>所特有，而<span class="nv">select</span>则应该是<span class="nv">POSIX</span>
所规定，一般操作系统均有实现
<span class="nv">select</span>：

<span class="nv">select</span>本质上是通过设置或者检查存放<span class="nv">fd</span>标志位的数据结构来进行下一步处理。这样所带来的缺点是：

<span class="mi">1</span>、 单个进程可监视的<span class="nv">fd</span>数量被限制，即能监听端口的大小有限。

      一般来说这个数目和系统内存关系很大，具体数目可以<span class="nv">cat</span> <span class="o">/</span><span class="nv">proc</span><span class="o">/</span><span class="nv">sys</span><span class="o">/</span><span class="nv">fs</span><span class="o">/</span><span class="nv">file</span><span class="o">-</span><span class="nv">max</span>察看。<span class="mi">32</span>位机默认是<span class="mi">1024</span>个。<span class="mi">64</span>位机默认是<span class="mi">2048</span>.
<span class="mi">2</span>、 对<span class="nv">socket</span>进行扫描时是线性扫描，即采用轮询的方法，效率较低：
       当套接字比较多的时候，每次<span class="nv">select</span><span class="ss">()</span>都要通过遍历<span class="nv">FD_SETSIZE</span>个<span class="nv">Socket</span>来完成调度,不管哪个<span class="nv">Socket</span>是活跃的,都遍历一遍。
       这会浪费很多<span class="nv">CPU</span>时间。如果能给套接字注册某个回调函数，当他们活跃时，自动完成相关操作，那就避免了轮询，<span class="nv">epoll</span>与<span class="nv">kqueue</span>做的。

<span class="mi">3</span>、需要维护一个用来存放大量<span class="nv">fd</span>的数据结构，这样会使得用户空间和内核空间在传递该结构时复制开销大

<span class="nv">poll</span>：

<span class="nv">poll</span>本质上和<span class="nv">select</span>没有区别，它将用户传入的数组拷贝到内核空间，然后查询每个<span class="nv">fd</span>对应的设备状态，如果设备就绪则在设备等待队列中加入
一项并继续遍历，如果遍历完所有<span class="nv">fd</span>后没有发现就绪设备，则挂起当前进程，直到设备就绪或者主动超时，被唤醒后它又要再次遍历<span class="nv">fd</span>。
这个过程经历了多次无谓的遍历。

它没有最大连接数的限制，原因是它是基于链表来存储的，但是同样有一个缺点：

<span class="mi">1</span>、大量的<span class="nv">fd</span>的数组被整体复制于用户态和内核地址空间之间，而不管这样的复制是不是有意义。 
<span class="mi">2</span>、<span class="nv">poll</span>还有一个特点是“水平触发”，如果报告了<span class="nv">fd</span>后，没有被处理，那么下次<span class="nv">poll</span>时会再次报告该<span class="nv">fd</span>。

<span class="nv">epoll</span>:
<span class="nv">epoll</span>支持水平触发和边缘触发，最大的特点在于边缘触发，它只告诉进程哪些<span class="nv">fd</span>刚刚变为就需态，并且只会通知一次。还有一个特点是，
<span class="nv">epoll</span>使用“事件”的就绪通知方式，通过<span class="nv">epoll_ctl</span>注册<span class="nv">fd</span>，一旦该<span class="nv">fd</span>就绪，内核就会采用类似<span class="nv">callback</span>的回调机制来激活该<span class="nv">fd</span>，
<span class="nv">epoll_wait</span>便可以收到通知

<span class="nv">epoll</span>的优点：

<span class="mi">1</span>、没有最大并发连接的限制，能打开的<span class="nv">FD</span>的上限远大于<span class="mi">1024</span>（<span class="mi">1</span><span class="nv">G</span>的内存上能监听约<span class="mi">10</span>万个端口）；
<span class="mi">2</span>、效率提升，不是轮询的方式，不会随着<span class="nv">FD</span>数目的增加效率下降。只有活跃可用的<span class="nv">FD</span>才会调用<span class="nv">callback</span>函数；
      即<span class="nv">Epoll</span>最大的优点就在于它只管你“活跃”的连接，而跟连接总数无关，因此在实际的网络环境中，<span class="nv">Epoll</span>的效率就会远远高于<span class="nv">select</span>和<span class="nv">poll</span>。
<span class="mi">3</span>、 内存拷贝，利用<span class="nv">mmap</span><span class="ss">()</span>文件映射内存加速与内核空间的消息传递；即<span class="nv">epoll</span>使用<span class="nv">mmap</span>减少复制开销。

<span class="nv">select</span>、<span class="nv">poll</span>、<span class="nv">epoll</span> 区别总结：
<span class="mi">1</span>、支持一个进程所能打开的最大连接数

<span class="nv">select</span>

单个进程所能打开的最大连接数有<span class="nv">FD_SETSIZE</span>宏定义，其大小是<span class="mi">32</span>个整数的大小（在<span class="mi">32</span>位的机器上，大小就是<span class="mi">32</span><span class="o">*</span><span class="mi">32</span>，同理<span class="mi">64</span>位机器上
<span class="nv">FD_SETSIZE</span>为<span class="mi">32</span><span class="o">*</span><span class="mi">64</span>），当然我们可以对进行修改，然后重新编译内核，但是性能可能会受到影响，这需要进一步的测试。

<span class="nv">poll</span>

<span class="nv">poll</span>本质上和<span class="nv">select</span>没有区别，但是它没有最大连接数的限制，原因是它是基于链表来存储的

<span class="nv">epoll</span>

虽然连接数有上限，但是很大，<span class="mi">1</span><span class="nv">G</span>内存的机器上可以打开<span class="mi">10</span>万左右的连接，<span class="mi">2</span><span class="nv">G</span>内存的机器可以打开<span class="mi">20</span>万左右的连接

<span class="mi">2</span>、<span class="nv">FD</span>剧增后带来的<span class="nv">IO</span>效率问题

<span class="nv">select</span>

因为每次调用时都会对连接进行线性遍历，所以随着<span class="nv">FD</span>的增加会造成遍历速度慢的“线性下降性能问题”。

<span class="nv">poll</span>

同上

<span class="nv">epoll</span>

因为<span class="nv">epoll</span>内核中实现是根据每个<span class="nv">fd</span>上的<span class="nv">callback</span>函数来实现的，只有活跃的<span class="nv">socket</span>才会主动调用<span class="nv">callback</span>，所以在活跃<span class="nv">socket</span>较少的情况下，
使用<span class="nv">epoll</span>没有前面两者的线性下降的性能问题，但是所有<span class="nv">socket</span>都很活跃的情况下，可能会有性能问题。

<span class="mi">3</span>、 消息传递方式

<span class="nv">select</span>

内核需要将消息传递到用户空间，都需要内核拷贝动作

<span class="nv">poll</span>

同上

<span class="nv">epoll</span>

<span class="nv">epoll</span>通过内核和用户空间共享一块内存来实现的。

总结：

综上，在选择<span class="nv">select</span>，<span class="nv">poll</span>，<span class="nv">epoll</span>时要根据具体的使用场合以及这三种方式的自身特点。

<span class="mi">1</span>、表面上看<span class="nv">epoll</span>的性能最好，但是在连接数少并且连接都十分活跃的情况下，<span class="nv">select</span>和<span class="nv">poll</span>的性能可能比<span class="nv">epoll</span>好，毕竟<span class="nv">epoll</span>的通知机制
需要很多函数回调。

<span class="mi">2</span>、<span class="nv">select</span>低效是因为每次它都需要轮询。但低效也是相对的，视情况而定，也可通过良好的设计改善

来源： <span class="nv">http</span>:<span class="o">//</span><span class="nv">blog</span>.<span class="nv">csdn</span>.<span class="nv">net</span><span class="o">/</span><span class="nv">jay900323</span><span class="o">/</span><span class="nv">article</span><span class="o">/</span><span class="nv">details</span><span class="o">/</span><span class="mi">18141217</span>
</pre></div>


<h2 id="network">network</h2>
<div class="codehilite"><pre><span></span><span class="n">Network调优</span><span class="w"></span>

<span class="mi">1</span><span class="err">、</span><span class="w"> </span><span class="n">NIC</span><span class="w"> </span><span class="n">网络介质卡</span><span class="w"></span>
<span class="err">（</span><span class="mi">1</span><span class="err">）、</span><span class="n">socket</span><span class="w">  </span><span class="n">套接字</span><span class="err">，</span><span class="n">连接进程的连通性</span><span class="w"></span>
<span class="w">     </span><span class="n">具有两种模式</span><span class="err">：</span><span class="w"></span>
<span class="w">        </span><span class="mi">1</span><span class="err">、</span><span class="w"> </span><span class="n">基于文件的sock</span><span class="w"></span>
<span class="w">        </span><span class="n">ls</span><span class="w"> </span><span class="err">–</span><span class="n">l</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">mysql</span><span class="p">.</span><span class="n">sock</span><span class="w"> </span><span class="n">客户端和服务器端在同一个机器上</span><span class="err">，</span><span class="n">这种连接是非常高的</span><span class="err">。</span><span class="w"></span>
<span class="w">        </span><span class="mi">2</span><span class="err">、</span><span class="w"> </span><span class="n">基于网络的sock</span><span class="err">（</span><span class="n">五个元素</span><span class="err">）</span><span class="w"></span>
<span class="w">        </span><span class="err">（</span><span class="mi">1</span><span class="err">）、</span><span class="n">源IP</span><span class="w"> </span><span class="n">源端口</span><span class="w"> </span><span class="n">协议</span><span class="w"> </span><span class="n">目标IP</span><span class="w"> </span><span class="n">目标端口</span><span class="w"></span>
<span class="w">        </span><span class="err">（</span><span class="mi">2</span><span class="err">）、</span><span class="n">服务器端的端口和IP是固定的</span><span class="w"></span>
<span class="w">        </span><span class="err">（</span><span class="mi">3</span><span class="err">）、</span><span class="n">mysql使用的是tcp协议</span><span class="w"></span>
<span class="w">        </span><span class="err">（</span><span class="mi">4</span><span class="err">）、</span><span class="n">socket</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="n">就是一块大内存</span><span class="w"></span>
<span class="w">        </span><span class="err">（</span><span class="mi">5</span><span class="err">）、</span><span class="n">core</span><span class="w"> </span><span class="n">是针对所有协议</span><span class="err">，</span><span class="n">IPV4是针对tcp协议的</span><span class="w"></span>
<span class="w">        </span><span class="err">（</span><span class="mi">6</span><span class="err">）、</span><span class="n">默认值以tcp为准</span><span class="err">，</span><span class="n">最大值以核心的为准</span><span class="w"></span>
<span class="w">        </span><span class="err">（</span><span class="mi">7</span><span class="err">）、</span><span class="n">tcp_mem</span><span class="w"> </span><span class="n">可以拿出多大的内存来存储sk_buffer</span><span class="err">，</span><span class="n">单位是页</span><span class="err">：</span><span class="mi">4</span><span class="n">KB</span><span class="err">，</span><span class="mi">32</span><span class="n">位系统最大支持</span><span class="err">：</span><span class="mi">900</span><span class="n">M</span><span class="w"></span>
<span class="w">        </span><span class="err">（</span><span class="mi">8</span><span class="err">）、</span><span class="n">如果增大并发量</span><span class="err">，</span><span class="n">可以将tcp_mem的值加大</span><span class="err">，</span><span class="n">如果没有什么连接</span><span class="err">，</span><span class="n">调大则会浪费内存</span><span class="w"></span>
<span class="w">        </span><span class="err">（</span><span class="mi">9</span><span class="err">）、</span><span class="n">网络最优值</span><span class="o">=</span><span class="n">带宽</span><span class="o">*</span><span class="n">延时</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="err">（</span><span class="n">基调网可以帮你测出来每个地区连接的延时</span><span class="err">）</span><span class="w"></span>
<span class="w">        </span><span class="err">（</span><span class="mi">10</span><span class="err">）、</span><span class="n">增大文件描述符</span><span class="err">，</span><span class="n">不建议主机上做防火墙</span><span class="w"></span>
<span class="mi">2</span><span class="err">、</span><span class="n">TCP状态对性能的影响</span><span class="w"></span>
<span class="w">    </span><span class="err">（</span><span class="mi">1</span><span class="err">）、</span><span class="n">当第三次握手成功后</span><span class="err">，</span><span class="n">进入established状态</span><span class="w"></span>
<span class="w">    </span><span class="err">（</span><span class="mi">2</span><span class="err">）、</span><span class="n">半开攻击</span><span class="err">，</span><span class="n">syn排队</span><span class="w"></span>
<span class="w">    </span><span class="err">（</span><span class="mi">3</span><span class="err">）、</span><span class="n">主动断开那端会进入Time_wait状态</span><span class="err">，</span><span class="n">被动那端会进入Close_wait</span><span class="w"></span>
<span class="w">    </span><span class="err">（</span><span class="mi">4</span><span class="err">）、</span><span class="n">established</span><span class="o">=</span><span class="n">最大连接数</span><span class="o">+</span><span class="n">somaxconn</span><span class="err">（</span><span class="n">排队人数</span><span class="err">）</span><span class="w"></span>
<span class="w">    </span><span class="err">（</span><span class="mi">5</span><span class="err">）、</span><span class="n">慢速攻击</span><span class="err">，</span><span class="n">本来一次可以发送完的数据</span><span class="err">，</span><span class="n">改变成多次发送并且时间间隔很长</span><span class="err">（</span><span class="n">最好的方法就是将apache换成nginx</span><span class="p">.</span><span class="n">php</span><span class="w"> </span><span class="n">hash攻击</span><span class="err">）</span><span class="w"></span>
<span class="mi">3</span><span class="err">、</span><span class="n">监控网卡工具</span><span class="err">：</span><span class="n">安装yum</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">iptraf</span><span class="w"></span>
<span class="w">                 </span><span class="n">命令</span><span class="w"> </span><span class="n">iptraf</span><span class="w"></span>
<span class="w">                      </span><span class="n">mtr</span><span class="w"> </span><span class="n">远程IP</span><span class="w"></span>
<span class="n">网络监控</span><span class="c1">----cacti</span>
<span class="w">        </span><span class="n">cactiez工作原理</span><span class="err">：</span><span class="w"> </span><span class="n">数据的采集</span><span class="err">，</span><span class="n">存储</span><span class="err">，</span><span class="n">分析</span><span class="err">，</span><span class="n">画图</span><span class="err">。</span><span class="w"></span>
<span class="n">安装cactiez后请注意系统时间和当前时间是否一致</span><span class="err">（</span><span class="n">最好使用网络时间</span><span class="err">）</span><span class="w"></span>

<span class="n">首先监控主机上安装net</span><span class="o">-</span><span class="n">snmp</span><span class="o">-</span><span class="n">utils</span><span class="w"></span>
<span class="n">服务器端安装net</span><span class="o">-</span><span class="n">snmp</span><span class="w"></span>

<span class="n">snmp</span><span class="err">：</span><span class="n">简单网络监控协议</span><span class="w">  </span><span class="n">port</span><span class="err">：</span><span class="mi">161</span><span class="w"></span>
<span class="n">cactiez数据路径</span><span class="err">：</span><span class="w"> </span><span class="n">cd</span><span class="w"> </span><span class="o">/</span><span class="nf">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">rra</span><span class="w"></span>
<span class="n">cactiez脚本路径</span><span class="err">：</span><span class="w"> </span><span class="n">cd</span><span class="w"> </span><span class="o">/</span><span class="nf">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">scripts</span><span class="w"></span>
<span class="nf">log</span><span class="err">:</span><span class="w"> </span><span class="o">/</span><span class="nf">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="nf">log</span><span class="w"></span>
<span class="n">实验整理</span><span class="err">：</span><span class="w"></span>
<span class="n">修改被监控主机的snmp的配置文件</span><span class="err">：</span><span class="w"> </span>
<span class="n">vim</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">snmp</span><span class="o">/</span><span class="n">snmpd</span><span class="p">.</span><span class="n">conf</span><span class="w"></span>
<span class="n">rocommunity</span><span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="mf">192.168.18.0</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">#被监控的网段</span><span class="err">（</span><span class="n">也可以是单独的IP</span><span class="err">）</span><span class="w"></span>
<span class="n">syslocation</span><span class="w">        </span><span class="n">China</span><span class="p">.</span><span class="n">beijing</span><span class="w">   </span><span class="n">#网页里显示的信息</span><span class="w"></span>
<span class="n">syscontact</span><span class="w">         </span><span class="n">Root</span><span class="w">      </span><span class="n">haha</span><span class="nv">@vfast</span><span class="p">.</span><span class="n">com</span><span class="w">   </span><span class="n">#联系方式</span><span class="w"></span>
<span class="n">主配文件留这三行就可以</span><span class="w"> </span><span class="n">其他的可以注释掉或删了</span><span class="w"></span>
<span class="w">         </span><span class="nl">在被监控主机上启动snmp服务</span><span class="p">:</span><span class="w"></span>
<span class="n">service</span><span class="w"> </span><span class="n">snmpd</span><span class="w"> </span><span class="k">start</span><span class="w"></span>
<span class="n">打开浏览器访问cactiez服务器的ip</span><span class="w"> </span><span class="n">就可以进行监控的设置了</span><span class="w"></span>
<span class="n">snmpwalk</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="mi">2</span><span class="n">c</span><span class="w"> </span><span class="o">-</span><span class="n">c</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="mf">192.168.18.96</span><span class="w"> </span><span class="mf">.1.3.6.1.4.1.2021.4.4.0</span><span class="w"></span>
<span class="mi">4</span><span class="err">、</span><span class="w"> </span><span class="n">配置文件</span><span class="w"></span>
<span class="n">其实linux系统的TCP网络设置并不适用于大文件在广域网中传递</span><span class="err">，</span><span class="n">通常只是为了节省内存资源</span><span class="err">，</span><span class="n">可以通过调节linux的网络协议栈的缓冲区大小</span><span class="err">，</span><span class="w"></span>
<span class="n">增加网络的高速网络连接的服务器系统</span><span class="err">，</span><span class="n">以处理更多的数据包</span><span class="err">。</span><span class="w"></span>
<span class="err">（</span><span class="mi">1</span><span class="err">）、</span><span class="n">linux系统默认tcp缓冲非常小</span><span class="err">，</span><span class="n">这个数值是根据系统内存计算出来的</span><span class="w"></span>
<span class="w">        </span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="k">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">ipv4</span><span class="o">/</span><span class="n">tcp_mem</span><span class="w"></span>
<span class="err">（</span><span class="mi">2</span><span class="err">）、</span><span class="n">默认和最大的系统套接字缓冲区</span><span class="err">（</span><span class="n">收取</span><span class="err">）</span><span class="w"></span>
<span class="w">        </span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="k">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">rmem_default</span><span class="w"></span>
<span class="w">        </span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="k">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">rmem_max</span><span class="w"></span>
<span class="err">（</span><span class="mi">3</span><span class="err">）、</span><span class="n">默认和最大的系统套接字缓冲区</span><span class="err">（</span><span class="n">发送</span><span class="err">）</span><span class="w"> </span>
<span class="w">        </span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="k">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">wmem_default</span><span class="w"></span>
<span class="w">        </span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="k">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">wmem_max</span><span class="w"></span>
<span class="err">（</span><span class="mi">4</span><span class="err">）、</span><span class="n">socket</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="n">的最大初始化值</span><span class="w"></span>
<span class="w">        </span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="k">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">optmem_max</span><span class="w"></span>

<span class="w">     </span><span class="n">调优1</span><span class="w"></span>
<span class="w">         </span><span class="n">讲上文提到的收取和发送缓冲到12MB</span><span class="err">，</span><span class="n">系统套接字缓冲区的调整将会对所有协议有影响</span><span class="err">，</span><span class="n">也就是说以后tcp发送或者接收数据时的缓冲</span><span class="w"></span>
<span class="w">         </span><span class="n">都用这个数值</span><span class="w"></span>
<span class="w">         </span><span class="n">注</span><span class="err">：</span><span class="n">rmem_max和wmem_max的默认大小是128KB</span><span class="err">，</span><span class="n">在大多数情况下兵不需要修改</span><span class="err">，</span><span class="n">在web或者dns服务器中使用默认值也不错</span><span class="err">，</span><span class="n">当你感到</span><span class="w"></span>
<span class="w">         </span><span class="n">有明显的延迟时便可以根据以下的参数修改</span><span class="err">，</span><span class="n">修改后会增大内存的开销</span><span class="w"></span>
<span class="w">        </span><span class="err">（</span><span class="mi">1</span><span class="err">）、</span><span class="n">增大系统套接字缓冲区</span><span class="w"></span>
<span class="w">                </span><span class="n">echo</span><span class="w"> </span><span class="err">‘</span><span class="n">net</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">wmem_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12582912</span><span class="err">’</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span><span class="w">     </span>
<span class="n">echo</span><span class="w"> </span><span class="err">‘</span><span class="n">net</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">rmem_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12582912</span><span class="err">’</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span><span class="w"></span>
<span class="w">        </span><span class="err">（</span><span class="mi">2</span><span class="err">）、</span><span class="n">增大tcp接收和发送缓冲区</span><span class="w"></span>
<span class="w">                </span><span class="n">echo</span><span class="w"> </span><span class="err">‘</span><span class="n">net</span><span class="p">.</span><span class="n">ipv4</span><span class="p">.</span><span class="n">tcp_rmem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10240</span><span class="w"> </span><span class="mi">87380</span><span class="w"> </span><span class="mi">12582912</span><span class="err">’</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span><span class="w"></span>
<span class="w">                </span><span class="n">echo</span><span class="w"> </span><span class="err">‘</span><span class="n">net</span><span class="p">.</span><span class="n">ipv4</span><span class="p">.</span><span class="n">tcp_wmem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10240</span><span class="w"> </span><span class="mi">87380</span><span class="w"> </span><span class="mi">12582912</span><span class="err">’</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span><span class="w"></span>
<span class="w">        </span><span class="err">（</span><span class="mi">3</span><span class="err">）、</span><span class="n">开启window</span><span class="w"> </span><span class="n">scaling功能</span><span class="w"></span>
<span class="w">                </span><span class="n">echo</span><span class="w"> </span><span class="err">‘</span><span class="n">net</span><span class="p">.</span><span class="n">ipv4</span><span class="p">.</span><span class="n">tcp_window_scaling</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="err">’</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span><span class="w"></span>
<span class="w">        </span><span class="err">（</span><span class="mi">4</span><span class="err">）、</span><span class="n">时间戳在</span><span class="err">（</span><span class="n">请参考RFC</span><span class="w"> </span><span class="mi">1323</span><span class="err">）</span><span class="n">tcp的包含增加12个字节</span><span class="w"></span>
<span class="w">                </span><span class="n">echo</span><span class="w"> </span><span class="err">‘</span><span class="n">net</span><span class="p">.</span><span class="n">ipv4</span><span class="p">.</span><span class="n">tcp_timestamps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="err">’</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span><span class="w"></span>
<span class="w">        </span><span class="err">（</span><span class="mi">5</span><span class="err">）、</span><span class="n">启动有选择的应答</span><span class="w"></span>
<span class="w">                </span><span class="n">echo</span><span class="w"> </span><span class="err">‘</span><span class="n">net</span><span class="p">.</span><span class="n">ipv4</span><span class="p">.</span><span class="n">tcp_sock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="err">’</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span><span class="w"></span>
<span class="err">（</span><span class="mi">6</span><span class="err">）、</span><span class="n">默认情况下一个tcp连接关闭后</span><span class="err">，</span><span class="n">把这个连接曾经有的参数比如慢启动门限snd_sthresh</span><span class="err">，</span><span class="n">拥塞窗口snd_cwnd</span><span class="err">，</span><span class="n">还有srtt等信息都保存到</span><span class="w"></span>
<span class="n">dst_entry中</span><span class="err">，</span><span class="w"></span>
<span class="n">只要dst_rntey没有失效</span><span class="err">，</span><span class="n">下次新建立相同连接的时候就可以使用保存的参数来初始化这个连接</span><span class="err">，</span><span class="n">通常是关闭的</span><span class="w"></span>
<span class="w">    </span><span class="n">echo</span><span class="w"> </span><span class="err">‘</span><span class="n">net</span><span class="p">.</span><span class="n">ipv4</span><span class="p">.</span><span class="n">tcp_no_metrics_save</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="err">’</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span><span class="w"></span>
<span class="err">（</span><span class="mi">7</span><span class="err">）、</span><span class="n">每个网络接口接收数据包的速率比内核处理这些包的速率时</span><span class="err">，</span><span class="n">允许送到队列的数据包的最大数目</span><span class="w"></span>
<span class="w">    </span><span class="n">echo</span><span class="w"> </span><span class="err">‘</span><span class="n">net</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">netdev_max_backlog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5000</span><span class="err">’</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="p">.</span><span class="n">conf</span><span class="w"></span>
<span class="err">（</span><span class="mi">8</span><span class="err">）、</span><span class="n">重新加载配置文件</span><span class="w">    </span><span class="n">sysctl</span><span class="w"> </span><span class="err">–</span><span class="n">p</span><span class="w"></span>
<span class="n">使用tcpdump看看修改后带来的变化</span><span class="w">   </span><span class="n">tcpdump</span><span class="w"> </span><span class="o">-</span><span class="n">ni</span><span class="w"> </span><span class="n">eth0</span><span class="w"></span>

<span class="w">    </span><span class="n">调优2</span><span class="w"></span>
<span class="w">    </span><span class="n">如下的网络配置参数调整</span><span class="err">，</span><span class="n">主要是针对请求压力大的linux</span><span class="err">（</span><span class="mf">2.6</span><span class="w"> </span><span class="n">kernel</span><span class="err">）</span><span class="n">服务器而言</span><span class="err">，</span><span class="n">如果服务器压力不大</span><span class="err">，</span><span class="n">维持默认值即可</span><span class="w"></span>
<span class="w">    </span><span class="err">（</span><span class="mi">1</span><span class="err">）、</span><span class="w"> </span><span class="o">/</span><span class="k">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">wmem_max</span><span class="w"></span>
<span class="w">           </span><span class="n">最大socket写buffer</span><span class="err">，</span><span class="n">可参考的优化值</span><span class="err">：</span><span class="mi">873200</span><span class="w"></span>
<span class="w">    </span><span class="err">（</span><span class="mi">2</span><span class="err">）、</span><span class="w"> </span><span class="o">/</span><span class="k">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">rmem_max</span><span class="w"></span>
<span class="w">           </span><span class="n">最大socket读buffer</span><span class="err">，</span><span class="n">可参考的优化值</span><span class="err">：</span><span class="mi">873200</span><span class="w"></span>
<span class="w">    </span><span class="err">（</span><span class="mi">3</span><span class="err">）、</span><span class="w"> </span><span class="o">/</span><span class="k">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">ipv4</span><span class="o">/</span><span class="n">tcp_wmem</span><span class="w"></span>
<span class="w">           </span><span class="n">Tcp写buffer</span><span class="err">，</span><span class="n">可参考的优化值</span><span class="err">：</span><span class="mi">8192</span><span class="w"> </span><span class="mi">436600</span><span class="w"> </span><span class="mi">873200</span><span class="w"></span>
<span class="w">    </span><span class="err">（</span><span class="mi">4</span><span class="err">）、</span><span class="w"> </span><span class="o">/</span><span class="k">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">ipv4</span><span class="o">/</span><span class="n">tcp_rmem</span><span class="w"></span>
<span class="w">           </span><span class="n">Tcp读buffer</span><span class="err">，</span><span class="n">可参考的优化值</span><span class="err">：</span><span class="mi">32768</span><span class="w"> </span><span class="mi">436600</span><span class="w"> </span><span class="mi">873200</span><span class="w"></span>
<span class="w">    </span><span class="err">（</span><span class="mi">5</span><span class="err">）、</span><span class="w"> </span><span class="o">/</span><span class="k">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">ipv4</span><span class="o">/</span><span class="n">tcp_mem</span><span class="w"></span>
<span class="w">           </span><span class="n">同样有3个值</span><span class="err">，</span><span class="n">意思是</span><span class="err">：</span><span class="w"></span>
<span class="w">           </span><span class="n">net</span><span class="p">.</span><span class="n">ipv4</span><span class="p">.</span><span class="n">tcp_mem</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="err">：</span><span class="n">低于此值</span><span class="err">，</span><span class="n">tcp没有内存压力</span><span class="w"></span>
<span class="w">           </span><span class="n">net</span><span class="p">.</span><span class="n">ipv4</span><span class="p">.</span><span class="n">tcp_mem</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="err">：</span><span class="n">在此值下</span><span class="err">，</span><span class="n">进入内存压力阶段</span><span class="w"></span>
<span class="w">           </span><span class="n">net</span><span class="p">.</span><span class="n">ipv4</span><span class="p">.</span><span class="n">tcp_mem</span><span class="o">[</span><span class="n">2</span><span class="o">]</span><span class="err">：</span><span class="n">高于此值</span><span class="err">，</span><span class="n">tcp拒绝分配socket</span><span class="w"></span>
<span class="w">           </span><span class="n">上述内存单位是页</span><span class="err">，</span><span class="n">页的大小是</span><span class="err">：</span><span class="mi">4</span><span class="n">KB</span><span class="w"></span>
<span class="w">           </span><span class="n">可参考的优化值</span><span class="err">：</span><span class="mi">786432</span><span class="w"> </span><span class="mi">1048576</span><span class="w"> </span><span class="mi">1572864</span><span class="w"></span>
<span class="w">    </span><span class="err">（</span><span class="mi">6</span><span class="err">）、</span><span class="w"> </span><span class="o">/</span><span class="k">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">netdev_max_backlog</span><span class="w"></span>
<span class="w">           </span><span class="n">进入包的最大设备队列</span><span class="err">，</span><span class="n">默认是300</span><span class="err">，</span><span class="n">对重负载服务器而言</span><span class="err">，</span><span class="n">该值太低</span><span class="err">，</span><span class="n">可调整到1000</span><span class="w"></span>
<span class="w">    </span><span class="err">（</span><span class="mi">7</span><span class="err">）、</span><span class="w"> </span><span class="o">/</span><span class="k">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">somaxconn</span><span class="w"></span>
<span class="n">Listen</span><span class="p">()</span><span class="n">的默认参数</span><span class="err">，</span><span class="n">挂起请求的最大数量</span><span class="err">，</span><span class="n">默认是128</span><span class="err">，</span><span class="n">对繁忙的服务器</span><span class="err">，</span><span class="n">增加该值有助于网络性能</span><span class="err">，</span><span class="n">可调整到256</span><span class="w"></span>
<span class="w">    </span><span class="err">（</span><span class="mi">8</span><span class="err">）、</span><span class="w"> </span><span class="o">/</span><span class="k">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">optmem_max</span><span class="w"></span>
<span class="w">           </span><span class="n">socket</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="n">的最大初始值</span><span class="err">，</span><span class="n">默认是10K</span><span class="w"></span>
<span class="w">    </span><span class="err">（</span><span class="mi">9</span><span class="err">）、</span><span class="w"> </span><span class="o">/</span><span class="k">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">ipv4</span><span class="o">/</span><span class="n">tcp_max_syn_backlog</span><span class="w"></span>
<span class="w">           </span><span class="n">进入syn包的最大请求队列</span><span class="err">，</span><span class="n">默认是1024</span><span class="err">，</span><span class="n">对重负载服务器</span><span class="err">，</span><span class="n">增加该值显然有好处</span><span class="err">，</span><span class="n">可调整到2048</span><span class="w"></span>
<span class="w">    </span><span class="err">（</span><span class="mi">10</span><span class="err">）、</span><span class="o">/</span><span class="k">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">ipv4</span><span class="o">/</span><span class="n">tcp_retrises2</span><span class="w"></span>
<span class="w">           </span><span class="n">tcp失败重传次数</span><span class="err">，</span><span class="n">默认是15</span><span class="err">，</span><span class="n">以为着重传15次才彻底放弃</span><span class="err">，</span><span class="n">可减少到5</span><span class="err">，</span><span class="n">以尽早释放内核资源</span><span class="w"></span>
<span class="w">    </span><span class="err">（</span><span class="mi">11</span><span class="err">）、</span><span class="o">/</span><span class="k">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">ipv4</span><span class="o">/</span><span class="n">tcp_keepalive_time</span><span class="w"></span>
<span class="w">           </span><span class="o">/</span><span class="k">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">ipv4</span><span class="o">/</span><span class="n">tcp_keepalive_intvl</span><span class="w"></span>
<span class="w">           </span><span class="o">/</span><span class="k">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">ipv4</span><span class="o">/</span><span class="n">tcp_keepalive_probes</span><span class="w"></span>
<span class="w">           </span><span class="n">这3个参数与tcp</span><span class="w"> </span><span class="n">keepalive有关</span><span class="err">，</span><span class="n">默认值是</span><span class="err">：</span><span class="w"></span>
<span class="w">           </span><span class="n">tcp_keepalive_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7200</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="n">hours</span><span class="p">)</span><span class="w"></span>
<span class="w">           </span><span class="n">tcp_keepalive_probes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="w"></span>
<span class="w">           </span><span class="n">tcp_keepalive_intvl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">75</span><span class="w"> </span><span class="n">seconds</span><span class="w"></span>
<span class="w">           </span><span class="n">意思是如果某个tcp连接在idle</span><span class="w"> </span><span class="mi">2</span><span class="n">个小时后</span><span class="err">，</span><span class="n">内核才会发起probe</span><span class="w"></span>
<span class="w">           </span><span class="n">如果probe</span><span class="w"> </span><span class="mi">9</span><span class="n">次</span><span class="err">（</span><span class="n">每次75秒</span><span class="err">）</span><span class="n">不成功</span><span class="err">，</span><span class="n">内核才彻底放弃</span><span class="err">，</span><span class="n">认为该连接已失效</span><span class="w"></span>
<span class="w">           </span><span class="n">对服务器而言</span><span class="err">，</span><span class="n">显然上述值太大</span><span class="err">，</span><span class="n">可调整到</span><span class="err">：</span><span class="w"></span>
<span class="w">           </span><span class="n">tcp_keepalive_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1800</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span>
<span class="w">           </span><span class="n">tcp_keepalive_probes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="w">           </span><span class="n">tcp_keepalive_intvl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="n">seconds</span><span class="w"></span>
<span class="w">    </span><span class="err">（</span><span class="mi">12</span><span class="err">）、</span><span class="o">/</span><span class="k">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">ipv4</span><span class="o">/</span><span class="n">ip_local_range</span><span class="w"></span>
<span class="w">          </span><span class="n">指定端口范围的一个配置</span><span class="err">，</span><span class="n">默认是32768</span><span class="w">  </span><span class="mi">61000</span><span class="n">已够大</span><span class="w"></span>
</pre></div>


<h2 id="io_mem">io_mem</h2>
<div class="codehilite"><pre><span></span>磁盘：
修改文件描述符
临时：<span class="nv">ulimit</span> <span class="o">-</span><span class="nv">SHn</span> <span class="mi">65535</span>
永久：<span class="nv">vim</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">security</span><span class="o">/</span><span class="nv">limits</span>.<span class="nv">conf</span>
<span class="o">*</span>               <span class="nv">soft</span>    <span class="nv">nofile</span>          <span class="mi">65535</span>
<span class="o">*</span>               <span class="nv">hard</span>    <span class="nv">nofile</span>          <span class="mi">65535</span>

<span class="nv">io</span>调度算法   <span class="nv">noop</span>           <span class="nv">ssd</span>固态硬盘，节省<span class="nv">cpu</span>
             <span class="nv">anticipatory</span>   预期算法，适合文件服务器
             <span class="nv">deadline</span>       要求响应速度的场景，适合数据库
             <span class="nv">cfg</span>            默认算法，完全公平

<span class="nv">cat</span> <span class="o">/</span><span class="nv">sys</span><span class="o">/</span><span class="nv">block</span><span class="o">/</span><span class="nv">sda</span><span class="o">/</span><span class="nv">queue</span><span class="o">/</span><span class="nv">scheduler</span>
<span class="nv">noop</span> <span class="nv">anticipatory</span> <span class="nv">deadline</span> [<span class="nv">cfq</span>]
临时修改 <span class="nv">echo</span> <span class="nv">deadline</span> <span class="o">&gt;</span> <span class="o">/</span><span class="nv">sys</span><span class="o">/</span><span class="nv">block</span><span class="o">/</span><span class="nv">sda</span><span class="o">/</span><span class="nv">queue</span><span class="o">/</span><span class="nv">scheduler</span>
永久： <span class="nv">vim</span> <span class="o">/</span><span class="nv">boot</span><span class="o">/</span><span class="nv">grub</span><span class="o">/</span><span class="nv">menu</span>.<span class="nv">lst</span>
<span class="nv">kernel</span> <span class="o">/</span><span class="nv">boot</span><span class="o">/</span><span class="nv">vmlinuz</span><span class="o">-</span><span class="mi">2</span>.<span class="mi">6</span>.<span class="mi">18</span><span class="o">-</span><span class="mi">8</span>.<span class="nv">el5</span> <span class="nv">ro</span> <span class="nv">root</span><span class="o">=</span><span class="nv">LABEL</span><span class="o">=/</span> <span class="nv">elevator</span><span class="o">=</span><span class="nv">deadline</span> <span class="nv">rhgb</span> <span class="nv">quiet</span>


内存：
释放内存
<span class="nv">sync</span>
<span class="nv">echo</span> <span class="mi">3</span> <span class="o">&gt;</span> <span class="o">/</span><span class="nv">proc</span><span class="o">/</span><span class="nv">sys</span><span class="o">/</span><span class="nv">vm</span><span class="o">/</span><span class="nv">drop_caches</span>

网络：
<span class="nv">vim</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">sysctl</span>.<span class="nv">conf</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_keepalive_intvl</span> <span class="o">=</span> <span class="mi">75</span>
当检测没有确认时，重新发送检测的频度，默认是<span class="mi">75</span>秒。

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_keepalive_probes</span> <span class="o">=</span> <span class="mi">9</span>
在认定链接失效之前，发送多少个<span class="nv">TCP</span>的<span class="nv">keepalive</span>的检测包，默认值为<span class="mi">9</span>.这个值乘以<span class="nv">tcp_keepalive_intvl</span>之后决定了一个链接发送了
<span class="nv">keepalive</span>之后可以有多少时间没有回应。

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_keepalive_time</span> <span class="o">=</span> <span class="mi">7200</span>
当启用<span class="nv">keepalive</span>的时候，<span class="nv">TCP</span>发送<span class="nv">keepalive</span>消息的频度，默认为<span class="mi">2</span>小时。

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_syn_retries</span> <span class="o">=</span> <span class="mi">5</span>
在内核放弃建立连接前发送<span class="nv">SYN</span>包的数量。

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_synack_retries</span> <span class="o">=</span> <span class="mi">5</span>
为了打开对端的链接，内核需要发送一个<span class="nv">SYN</span>并附带一个回应前面一个<span class="nv">SYN</span>的<span class="nv">ACK</span>。也就是所谓三次握手中的第二次握手。这个设置决定了
内核放弃链接前发送<span class="nv">SYN</span><span class="o">+</span><span class="nv">ACK</span>包的数量。

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_syncookies</span> <span class="o">=</span> <span class="mi">1</span> 
表示开启<span class="nv">SYN</span> <span class="nv">cookies</span>。当出现<span class="nv">SYN</span>等待队列溢出时，启用<span class="nv">cookies</span>来处理，可防范少量<span class="nv">SYN</span>攻击，默认为<span class="mi">0</span>，表示关闭；
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_tw_reuse</span> <span class="o">=</span> <span class="mi">1</span> 
表示开启重用。允许将<span class="nv">TIME</span><span class="o">-</span><span class="k">WAIT</span> <span class="nv">sockets</span>重新用于新的<span class="nv">TCP</span>连接，默认为<span class="mi">0</span>，表示关闭；
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_tw_recycle</span> <span class="o">=</span> <span class="mi">1</span> 
表示开启<span class="nv">TCP</span>连接中<span class="nv">TIME</span><span class="o">-</span><span class="k">WAIT</span> <span class="nv">sockets</span>的快速回收，默认为<span class="mi">0</span>，表示关闭。
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_fin_timeout</span> <span class="o">=</span> <span class="mi">30</span> 
修改系統默认的 <span class="nb">TIMEOUT</span> 时间


<span class="nv">sysctl</span> <span class="o">-</span><span class="nv">p</span>生效
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../linux-soft/" title="linux-soft" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                linux-soft
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>