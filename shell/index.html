



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>shell - mkdocs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.30686662.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#shellip" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="mkdocs" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              mkdocs
            </span>
            <span class="md-header-nav__topic">
              
                shell
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href=".." class="md-tabs__link">
        home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../python-base/" class="md-tabs__link">
          python
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../nginx/" class="md-tabs__link">
          service
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../mysql/" class="md-tabs__link">
          database
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../open-falcon/" class="md-tabs__link">
          monitor
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../tcp-issue/" class="md-tabs__link md-tabs__link--active">
          basis
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="mkdocs" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    mkdocs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="home" class="md-nav__link">
      home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      python
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        python
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../python-base/" title="python-base" class="md-nav__link">
      python-base
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../python-lib/" title="python-lib" class="md-nav__link">
      python-lib
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../python-lib2/" title="python-lib2" class="md-nav__link">
      python-lib2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../python-web/" title="python-web" class="md-nav__link">
      python-web
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../python-other/" title="python-other" class="md-nav__link">
      python-other
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      service
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        service
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../nginx/" title="nginx" class="md-nav__link">
      nginx
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../nginx2/" title="nginx2" class="md-nav__link">
      nginx2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../apache/" title="apache" class="md-nav__link">
      apache
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../saltstack/" title="saltstack" class="md-nav__link">
      saltstack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tomcat/" title="tomcat" class="md-nav__link">
      tomcat
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ansible/" title="ansible" class="md-nav__link">
      ansible
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../trafficserver/" title="trafficserver" class="md-nav__link">
      trafficserver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../haproxy/" title="haproxy" class="md-nav__link">
      haproxy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../docker/" title="docker" class="md-nav__link">
      docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../varnish/" title="varnish" class="md-nav__link">
      varnish
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bind/" title="bind" class="md-nav__link">
      bind
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lvs/" title="lvs" class="md-nav__link">
      lvs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../log-analysis/" title="log-analysis" class="md-nav__link">
      log-analysis
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      database
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        database
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../mysql/" title="mysql" class="md-nav__link">
      mysql
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mysql2/" title="mysql2" class="md-nav__link">
      mysql2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../memcached/" title="memcached" class="md-nav__link">
      memcached
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../redis/" title="redis" class="md-nav__link">
      redis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mongodb/" title="mongodb" class="md-nav__link">
      mongodb
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hadoop/" title="hadoop" class="md-nav__link">
      hadoop
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../postgresql/" title="postgresql" class="md-nav__link">
      postgresql
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      monitor
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        monitor
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../open-falcon/" title="open-falcon" class="md-nav__link">
      open-falcon
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../zabbix/" title="zabbix" class="md-nav__link">
      zabbix
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../zabbix2/" title="zabbix2" class="md-nav__link">
      zabbix2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../netdata/" title="netdata" class="md-nav__link">
      netdata
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      basis
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        basis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../tcp-issue/" title="tcp-issue" class="md-nav__link">
      tcp-issue
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../git-svn/" title="git-svn" class="md-nav__link">
      git-svn
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vpn/" title="vpn" class="md-nav__link">
      vpn
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        shell
      </label>
    
    <a href="./" title="shell" class="md-nav__link md-nav__link--active">
      shell
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#shellip" class="md-nav__link">
    shell获取ip地址
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    初始脚本
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ssh" class="md-nav__link">
    ssh端口
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#txtcsv" class="md-nav__link">
    txt转csv
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#if" class="md-nav__link">
    if判断
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    限制模式
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vip" class="md-nav__link">
    vip切换
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hostname" class="md-nav__link">
    hostname主机名
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sed" class="md-nav__link">
    sed
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#awk" class="md-nav__link">
    awk函数
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#awk_1" class="md-nav__link">
    awk分析例子
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    找隐藏文件
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#expect" class="md-nav__link">
    expect密钥
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#select" class="md-nav__link">
    select交互
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    命令重定向
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#while-read" class="md-nav__link">
    while read
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    高效不常见的命令
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#echo-read" class="md-nav__link">
    echo read
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    脚本控制
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cut-sort" class="md-nav__link">
    cut sort
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shell" class="md-nav__link">
    shell颜色
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    常用正则
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../disk/" title="disk" class="md-nav__link">
      disk
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../filesystem/" title="filesystem" class="md-nav__link">
      filesystem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../source/" title="source" class="md-nav__link">
      source
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../command/" title="command" class="md-nav__link">
      command
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../linux-base/" title="linux-base" class="md-nav__link">
      linux-base
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../linux-soft/" title="linux-soft" class="md-nav__link">
      linux-soft
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../other/" title="other" class="md-nav__link">
      other
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#shellip" class="md-nav__link">
    shell获取ip地址
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    初始脚本
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ssh" class="md-nav__link">
    ssh端口
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#txtcsv" class="md-nav__link">
    txt转csv
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#if" class="md-nav__link">
    if判断
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    限制模式
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vip" class="md-nav__link">
    vip切换
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hostname" class="md-nav__link">
    hostname主机名
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sed" class="md-nav__link">
    sed
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#awk" class="md-nav__link">
    awk函数
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#awk_1" class="md-nav__link">
    awk分析例子
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    找隐藏文件
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#expect" class="md-nav__link">
    expect密钥
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#select" class="md-nav__link">
    select交互
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    命令重定向
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#while-read" class="md-nav__link">
    while read
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    高效不常见的命令
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#echo-read" class="md-nav__link">
    echo read
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    脚本控制
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cut-sort" class="md-nav__link">
    cut sort
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shell" class="md-nav__link">
    shell颜色
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    常用正则
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>shell</h1>
                
                <h2 id="shellip">shell获取ip地址</h2>
<div class="codehilite"><pre><span></span>使用<span class="nv">ip</span>库可以做到。但十分不方便。<span class="ss">(</span><span class="nv">nali</span><span class="ss">)</span>
<span class="nv">nali</span>安装
解压
.<span class="o">/</span><span class="nv">configue</span> <span class="o">&amp;&amp;</span> <span class="nv">make</span> <span class="o">&amp;&amp;</span> <span class="nv">make</span> <span class="nv">install</span>
我这里用外部<span class="nv">url</span>来获取相关信息。
最常见的<span class="nv">www</span>.<span class="nv">ip138</span>.<span class="nv">com</span>  <span class="nv">www</span>.<span class="nv">ip</span>.<span class="nv">cn</span>什么的都可以获取到目标<span class="nv">IP</span>的地区和运营商。
但适用于<span class="nv">shell</span>脚本的还是<span class="nv">ip</span>.<span class="nv">cn</span>舒坦。
复制内容到剪贴板
代码:
[<span class="nv">root</span>@<span class="nv">localhost</span> <span class="o">~</span>]# <span class="nv">curl</span> <span class="nv">ip</span>.<span class="nv">cn</span>?<span class="nv">ip</span><span class="o">=</span><span class="mi">114</span>.<span class="mi">114</span>.<span class="mi">114</span>.<span class="mi">114</span>
<span class="nv">IP</span>：<span class="mi">114</span>.<span class="mi">114</span>.<span class="mi">114</span>.<span class="mi">114</span> 来自：江苏省南京市 信风网络
[<span class="nv">root</span>@<span class="nv">localhost</span> <span class="o">~</span>]#
用<span class="nv">curl</span>命令就搞定了。但想把内容拆分一下给到变量使用时确发现他万恶的用了中文符号
复制内容到剪贴板
代码:
：
。
用<span class="nv">awk</span> <span class="o">-</span><span class="nv">F</span> 倒也是可以搞定。如下：
复制内容到剪贴板
代码:
[<span class="nv">root</span>@<span class="nv">localhost</span> <span class="o">~</span>]# <span class="nv">cat</span> <span class="nv">getip</span>.<span class="nv">sh</span>
#<span class="o">!/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">bash</span>
<span class="nv">Getip</span><span class="o">=</span>$<span class="ss">(</span><span class="nv">curl</span> <span class="o">-</span><span class="nv">s</span> <span class="nv">ip</span>.<span class="nv">cn</span>?<span class="nv">ip</span><span class="o">=</span><span class="mh">$1</span><span class="ss">)</span>
<span class="nv">IParea</span><span class="o">=</span>$<span class="ss">(</span><span class="nv">echo</span> $<span class="nv">Getip</span><span class="o">|</span><span class="nv">awk</span> <span class="o">-</span><span class="nv">F</span> <span class="s2">&quot;</span><span class="s">：</span><span class="s2">&quot;</span> <span class="s1">&#39;</span><span class="s">{print $3}</span><span class="s1">&#39;</span><span class="o">|</span><span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">{print $1}</span><span class="s1">&#39;</span><span class="ss">)</span>
<span class="nv">IPisp</span><span class="o">=</span>$<span class="ss">(</span><span class="nv">echo</span> $<span class="nv">Getip</span><span class="o">|</span><span class="nv">awk</span> <span class="o">-</span><span class="nv">F</span> <span class="s2">&quot;</span><span class="s">：</span><span class="s2">&quot;</span> <span class="s1">&#39;</span><span class="s">{print $3}</span><span class="s1">&#39;</span><span class="o">|</span><span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">{print $2}</span><span class="s1">&#39;</span><span class="ss">)</span>
<span class="k">if</span> [ <span class="o">!</span> <span class="mh">$1</span> ]<span class="c1">;then</span>
<span class="nv">IP</span><span class="o">=</span>$<span class="ss">(</span><span class="nv">echo</span> $<span class="nv">Getip</span><span class="o">|</span><span class="nv">awk</span> <span class="o">-</span><span class="nv">F</span> <span class="s2">&quot;</span><span class="s">：</span><span class="s2">&quot;</span> <span class="s1">&#39;</span><span class="s">{print $2}</span><span class="s1">&#39;</span><span class="o">|</span><span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">{print $1}</span><span class="s1">&#39;</span><span class="ss">)</span>
<span class="nv">echo</span> $<span class="nv">IP</span> $<span class="nv">IParea</span> $<span class="nv">IPisp</span>
<span class="k">else</span>
<span class="nv">echo</span> <span class="mh">$1</span> $<span class="nv">IParea</span> $<span class="nv">IPisp</span>
<span class="nv">fi</span>
[<span class="nv">root</span>@<span class="nv">localhost</span> <span class="o">~</span>]# .<span class="o">/</span><span class="nv">getip</span>.<span class="nv">sh</span> <span class="mi">114</span>.<span class="mi">114</span>.<span class="mi">114</span>.<span class="mi">114</span>
<span class="mi">114</span>.<span class="mi">114</span>.<span class="mi">114</span>.<span class="mi">114</span> 江苏省南京市 信风网络
但还是有点不方便。于是各种百度弄了段<span class="nv">php</span>的代码来转换一下<span class="nv">ip</span>.<span class="nv">cn</span>的输出结果：
复制内容到剪贴板
代码:
<span class="o">&lt;</span>?<span class="nv">php</span>
<span class="nv">header</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">Content-Type: text/html;charset=utf-8</span><span class="s2">&quot;</span><span class="ss">)</span><span class="c1">;</span>
        $<span class="nv">user_IP</span> <span class="o">=</span> <span class="ss">(</span>$<span class="nv">_SERVER</span>[<span class="s2">&quot;</span><span class="s">HTTP_VIA</span><span class="s2">&quot;</span>]<span class="ss">)</span> ? $<span class="nv">_SERVER</span>[<span class="s2">&quot;</span><span class="s">HTTP_X_FORWARDED_FOR</span><span class="s2">&quot;</span>] : $<span class="nv">_SERVER</span>[<span class="s2">&quot;</span><span class="s">REMOTE_ADDR</span><span class="s2">&quot;</span>]<span class="c1">;</span>
        $<span class="nv">user_IP</span> <span class="o">=</span> <span class="ss">(</span>$<span class="nv">user_IP</span><span class="ss">)</span> ? $<span class="nv">user_IP</span> : $<span class="nv">_SERVER</span>[<span class="s2">&quot;</span><span class="s">REMOTE_ADDR</span><span class="s2">&quot;</span>]<span class="c1">;</span>
        $<span class="nv">ip</span> <span class="o">=</span> <span class="ss">(</span>$<span class="nv">_GET</span>[<span class="s2">&quot;</span><span class="s">ip</span><span class="s2">&quot;</span>]<span class="ss">)</span> ? $<span class="nv">_GET</span>[<span class="s2">&quot;</span><span class="s">ip</span><span class="s2">&quot;</span>] : $<span class="nv">user_IP</span><span class="c1">;</span>

        <span class="mh">$c</span><span class="nv">h</span> <span class="o">=</span> <span class="nv">curl_init</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">http://www.ip.cn?ip=$ip</span><span class="s2">&quot;</span><span class="ss">)</span><span class="c1">;</span>
                <span class="nv">curl_setopt</span><span class="ss">(</span><span class="mh">$c</span><span class="nv">h</span>,<span class="nv">CURLOPT_USERAGENT</span>,<span class="s1">&#39;</span><span class="s">curl/7.31</span><span class="s1">&#39;</span><span class="ss">)</span><span class="c1">;</span>
                <span class="nv">curl_setopt</span><span class="ss">(</span><span class="mh">$c</span><span class="nv">h</span>, <span class="nv">CURLOPT_RETURNTRANSFER</span>, <span class="nv">true</span><span class="ss">)</span><span class="c1">;</span>
                <span class="nv">curl_setopt</span><span class="ss">(</span><span class="mh">$c</span><span class="nv">h</span>, <span class="nv">CURLOPT_BINARYTRANSFER</span>, <span class="nv">true</span><span class="ss">)</span><span class="c1">;</span>
                $<span class="nv">output</span> <span class="o">=</span> <span class="nv">curl_exec</span><span class="ss">(</span><span class="mh">$c</span><span class="nv">h</span><span class="ss">)</span><span class="c1">;</span>
                        $<span class="nv">output2</span> <span class="o">=</span> <span class="nv">substr</span><span class="ss">(</span>$<span class="nv">output</span>,<span class="mi">5</span><span class="ss">)</span><span class="c1">;</span>
                        $<span class="nv">row</span><span class="o">=</span><span class="nv">split</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s"> </span><span class="s1">&#39;</span>,$<span class="nv">output2</span><span class="ss">)</span><span class="c1">;</span>
                                <span class="mh">$c</span><span class="nv">ip</span><span class="o">=</span>$<span class="nv">row</span>[<span class="mi">0</span>]<span class="c1">;</span>
                                <span class="mh">$ca</span><span class="nv">rea</span><span class="o">=</span><span class="nv">substr</span><span class="ss">(</span>$<span class="nv">row</span>[<span class="mi">1</span>],<span class="mi">9</span><span class="ss">)</span><span class="c1">;</span>
                                <span class="mh">$c</span><span class="nv">isp</span><span class="o">=</span>$<span class="nv">row</span>[<span class="mi">2</span>]<span class="c1">;</span>

        $<span class="nv">s</span> <span class="o">=</span> <span class="ss">(</span>$<span class="nv">_GET</span>[<span class="s2">&quot;</span><span class="s">s</span><span class="s2">&quot;</span>]<span class="ss">)</span> ? $<span class="nv">_GET</span>[<span class="s2">&quot;</span><span class="s">s</span><span class="s2">&quot;</span>] : <span class="s2">&quot;</span><span class="s">0</span><span class="s2">&quot;</span><span class="c1">;</span>
                <span class="k">if</span> <span class="ss">(</span>$<span class="nv">s</span><span class="o">==</span><span class="mi">0</span><span class="ss">)</span>
                {
                        <span class="nv">echo</span> <span class="s2">&quot;</span><span class="s">$cip $carea $cisp</span><span class="s2">&quot;</span><span class="c1">;</span>
                }
                <span class="k">else</span>
                {
                        <span class="mh">$ca</span><span class="nv">rea1</span><span class="o">=</span><span class="nv">substr</span><span class="ss">(</span><span class="mh">$ca</span><span class="nv">rea</span>,<span class="mi">0</span>,<span class="mi">9</span><span class="ss">)</span><span class="c1">;</span>
                        <span class="nv">echo</span> <span class="s2">&quot;</span><span class="s">$cip $carea1 $cisp</span><span class="s2">&quot;</span><span class="c1">;</span>
                }

        <span class="nv">curl_close</span><span class="ss">(</span><span class="mh">$c</span><span class="nv">h</span><span class="ss">)</span><span class="c1">;</span>
?<span class="o">&gt;</span>
复制内容到剪贴板
代码:
[<span class="nv">root</span>@<span class="nv">localhost</span> <span class="nv">html</span>]# <span class="nv">curl</span> <span class="nv">localhost</span>?<span class="nv">ip</span><span class="o">=</span><span class="mi">114</span>.<span class="mi">114</span>.<span class="mi">114</span>.<span class="mi">114</span>
<span class="mi">114</span>.<span class="mi">114</span>.<span class="mi">114</span>.<span class="mi">114</span> 江苏省南京市 信风网络
[<span class="nv">root</span>@<span class="nv">localhost</span> <span class="nv">html</span>]#
随便找个空间一放。以后用的时候直接访问自己的页面就可以了。
</pre></div>


<h2 id="_1">初始脚本</h2>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>
<span class="k">for</span> i in <span class="sb">`</span>chkconfig --list <span class="p">|</span> awk <span class="s1">&#39;{print $1}&#39;</span><span class="sb">`</span><span class="p">;</span><span class="k">do</span>
    <span class="k">if</span> <span class="o">[[</span> <span class="nv">$i</span> <span class="o">=</span> <span class="s1">&#39;atd&#39;</span> <span class="o">||</span> <span class="nv">$i</span> <span class="o">=</span> <span class="s1">&#39;crond&#39;</span> <span class="o">||</span> <span class="nv">$i</span> <span class="o">=</span> <span class="s1">&#39;irqbalance&#39;</span> <span class="o">||</span> <span class="nv">$i</span> <span class="o">=</span> <span class="s1">&#39;network&#39;</span> <span class="o">||</span> <span class="nv">$i</span> <span class="o">=</span> <span class="s1">&#39;sshd&#39;</span> <span class="o">||</span> <span class="nv">$i</span> <span class="o">=</span> <span class="s1">&#39;rsyslog&#39;</span> 
    <span class="o">||</span> <span class="nv">$i</span> <span class="o">=</span> <span class="s1">&#39;httpd&#39;</span> <span class="o">||</span> <span class="nv">$i</span> <span class="o">=</span> salt-* <span class="o">||</span> <span class="nv">$i</span> <span class="o">=</span> zabbix_* <span class="o">]]</span><span class="p">;</span><span class="k">then</span>
        chkconfig --level <span class="m">3</span> <span class="nv">$i</span> on
    <span class="k">else</span>
        chkconfig <span class="nv">$i</span> off
    <span class="k">fi</span>
<span class="k">done</span>
grep -v <span class="s2">&quot;^#&quot;</span> /etc/ssh/sshd_config <span class="p">|</span> grep -v <span class="s2">&quot;^</span>$<span class="s2">&quot;</span> <span class="p">|</span> grep <span class="s2">&quot;^UseDNS no&quot;</span> &gt; /dev/null
<span class="k">if</span> <span class="o">[[</span> <span class="nv">$?</span> -ne <span class="m">0</span> <span class="o">]]</span><span class="p">;</span><span class="k">then</span>
    sed -i <span class="s1">&#39;122a\UseDNS no&#39;</span> /etc/ssh/sshd_config
    /etc/init.d/sshd restart
<span class="k">fi</span>
cat  &gt;&gt;/etc/profile<span class="s">&lt;&lt;EOF</span>
<span class="s">if [ $SHELL = &quot;/bin/ksh&quot; ]; then</span>
<span class="s">     ulimit -p 16384</span>
<span class="s">     ulimit -n 65536</span>
<span class="s">     ulimit -c unlimited</span>
<span class="s">else</span>
<span class="s">     ulimit -u 16384 -n 65536 -c unlimited</span>
<span class="s">fi</span>
<span class="s">EOF</span>

<span class="nb">source</span> /etc/profile

<span class="c1">##set ulimit file</span>
cat &gt;&gt; /etc/security/limits.conf<span class="s">&lt;&lt;EOF</span>
<span class="s">*           soft    nproc   10000</span>
<span class="s">*          hard    nproc   16384</span>
<span class="s">*           soft    nofile   65536</span>
<span class="s">*           hard    nofile  65536</span>
<span class="s">EOF</span>


<span class="c1">## set sysctl</span>
cat &gt;&gt;/etc/sysctl.conf <span class="s">&lt;&lt;EOF</span>
<span class="s">fs.aio-max-nr = 1048576</span>
<span class="s">fs.file-max = 6815744</span>
<span class="s">net.ipv4.ip_local_port_range = 10000 65000</span>
<span class="s">net.ipv4.ip_conntrack_max = 10240</span>
<span class="s">net.ipv4.tcp_max_syn_backlog = 65536</span>
<span class="s">net.core.netdev_max_backlog = 32768</span>
<span class="s">net.ipv4.tcp_syncookies = 1</span>
<span class="s">net.ipv4.tcp_tw_reuse = 1</span>
<span class="s">net.ipv4.tcp_tw_recycle = 1</span>
<span class="s">net.ipv4.tcp_fin_timeout = 30</span>
<span class="s">net.core.rmem_default=262144</span>
<span class="s">net.core.wmem_default=262144</span>
<span class="s">net.core.rmem_max=4194304</span>
<span class="s">net.core.wmem_max=4194304</span>
<span class="s">net.ipv4.tcp_timestamps =0</span>
<span class="s">net.ipv4.tcp_sack =1</span>
<span class="s">net.ipv4.tcp_window_scaling =1</span>
<span class="s">EOF</span>

sysctl -p

<span class="c1">##install</span>

yum install -y @base ntp gcc gcc-c++ make telnet openssl lrzsz vim openssl-devel unzip gd gd-devel libcurl-devel

<span class="c1">##set clock</span>

ntpdate us.pool.ntp.org


<span class="c1">##set ssh port</span>
<span class="c1">#set -- $(sed -n &#39;/^Port/&#39;p /etc/ssh/sshd_config)</span>

<span class="c1">#port=$2</span>

<span class="c1">#if [[ &quot;xx${port}&quot; == &quot;xx&quot; ]]</span>
<span class="c1">#then</span>
 <span class="c1">#  cat &gt;&gt;/etc/ssh/sshd_config&lt;&lt;EOF</span>
<span class="c1">#Port 7522</span>
<span class="c1">#EOF</span>
<span class="c1">#elif [[ ${port} -eq 7522 ]]</span>
<span class="c1">#then</span>
<span class="c1">#        sed -i &quot;s/7522/22/g&quot; /etc/ssh/sshd_config</span>
<span class="c1">#        echo &#39;ok&#39;</span>
<span class="c1">#elif [[ ${port} -eq 22 ]]</span>
<span class="c1">#then</span>
<span class="c1">#        sed -i &quot;s/22/7522/g&quot; /etc/ssh/sshd_config</span>
<span class="c1">#fi</span>

<span class="c1">#service sshd restart</span>
<span class="c1">##set ssh listener ip is Private IP.</span>
</pre></div>
</td></tr></table>

<h2 id="ssh">ssh端口</h2>
<div class="codehilite"><pre><span></span><span class="n">ssh</span><span class="o">-</span><span class="k">copy</span><span class="o">-</span><span class="kt">id</span> <span class="o">-</span><span class="n">i</span> <span class="p">.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span><span class="p">.</span><span class="n">pub</span> <span class="err">&#39;</span><span class="o">-</span><span class="n">p</span> <span class="mi">27005</span> <span class="n">root</span><span class="mf">@192.168.3.129</span><span class="err">&#39;</span>
<span class="n">rsync</span> <span class="err">&#39;</span><span class="o">-</span><span class="n">e</span> <span class="n">ssh</span> <span class="o">-</span><span class="n">p</span> <span class="n">Port</span><span class="err">&#39;</span>  

<span class="n">sftp</span> <span class="o">-</span><span class="n">o</span> <span class="n">port</span><span class="o">=</span><span class="mi">9999</span> <span class="n">dachui</span><span class="mf">@210.14.133.237</span>

 <span class="n">vi</span> <span class="o">~/</span><span class="p">.</span><span class="n">ssh</span><span class="o">/</span><span class="n">config</span>
 <span class="n">Port</span> <span class="mi">20022</span>
 <span class="n">cd</span> <span class="o">~/</span><span class="p">.</span><span class="n">ssh</span>
 <span class="n">chmod</span> <span class="mi">600</span> <span class="n">config</span>
<span class="err">或者修改全局的</span>
<span class="n">vi</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/</span><span class="n">ssh_config</span>
<span class="n">Port</span> <span class="mi">20022</span>
</pre></div>


<h2 id="txtcsv">txt转csv</h2>
<div class="codehilite"><pre><span></span><span class="n">sed</span> <span class="s1">&#39;s/\t/,\t/g&#39;</span> <span class="n">jigou</span><span class="p">.</span><span class="n">txt</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">.</span><span class="n">csv</span>  <span class="err">数据后面加，\</span><span class="n">t</span>

<span class="n">sed</span> <span class="s1">&#39;s/\t/\t,/g&#39;</span> <span class="n">jigou</span><span class="p">.</span><span class="n">txt</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">.</span><span class="n">csv</span>  <span class="err">数据后面加</span> <span class="err">\</span><span class="n">t</span> <span class="err">，</span>

<span class="err">导出</span><span class="n">csv</span><span class="err">文件数字会自动变科学计数法的解决方法</span>
<span class="err">其实这个问题跟用什么语言导出</span><span class="n">csv</span><span class="err">文件没有关系。</span><span class="n">Excel</span><span class="err">显示数字时，如果数字大于</span><span class="mi">12</span><span class="err">位，它会自动转化为科学计数法；</span>
<span class="err">如果数字大于</span><span class="mi">15</span><span class="err">位，它不仅用于科学技术费表示，还会只保留高</span><span class="mi">15</span><span class="err">位，其他位都变</span><span class="mi">0</span><span class="err">。</span>
<span class="err">解决这个问题：</span>
<span class="err">只要把数字字段后面加上显示上看不见的字符即可，字符串前面或者结尾加上制表符</span><span class="ss">&quot;\t&quot;</span><span class="p">.</span>
</pre></div>


<h2 id="if">if判断</h2>
<div class="codehilite"><pre><span></span><span class="k">if</span> ....<span class="c1">; then</span>
....
<span class="nv">elif</span> ....<span class="c1">; then</span>
....
<span class="k">else</span>
....
<span class="nv">fi</span>

[[ <span class="mh">$c</span><span class="nv">pu_int</span> <span class="o">&gt;</span> <span class="mi">600</span>.<span class="mi">0</span> ]]  小数比较不准，去掉小数点 在比较 <span class="nv">awk</span> <span class="o">-</span><span class="nv">F</span> <span class="s1">&#39;</span><span class="s">.</span><span class="s1">&#39;</span> <span class="s1">&#39;</span><span class="s">{print $1}</span><span class="s1">&#39;</span>

关键词匹配判断
<span class="k">if</span> [[ <span class="s2">&quot;</span><span class="s">$CmdLine</span><span class="s2">&quot;</span> <span class="o">=~</span> <span class="s2">&quot;</span><span class="s">install</span><span class="s2">&quot;</span> ]]<span class="o">||</span>[[ <span class="s2">&quot;</span><span class="s">$CmdLine</span><span class="s2">&quot;</span> <span class="o">=~</span> <span class="s2">&quot;</span><span class="s">remove</span><span class="s2">&quot;</span> ]]<span class="o">||</span>[[ <span class="s2">&quot;</span><span class="s">$CmdLine</span><span class="s2">&quot;</span> <span class="o">=~</span> <span class="s2">&quot;</span><span class="s">update</span><span class="s2">&quot;</span> ]]<span class="c1">;then</span>
        <span class="nv">MAIL</span>
<span class="nv">fi</span>

<span class="o">-</span><span class="nv">b</span> 文件
判断该文件是否存在，并且是否为块设备文件（是块设备文件为真）

<span class="o">-</span><span class="nv">c</span>文件
判断该文件是否存在，并且是否为字符设备文件（是字符设备文件为真）

<span class="o">-</span><span class="nv">d</span> 文件
判断该文件是否存在，并且是否为目录文件（是目录为真）

<span class="o">-</span><span class="nv">e</span> 文件
判断该文件是否存在（存在为真）

<span class="o">-</span><span class="nv">f</span> 文件
判断该文件是否存在，并且是否为普通文件（是普通文件为真）

<span class="o">-</span><span class="nv">L</span> 文件
判断该文件是否存在，并且是否为符号链接文件（是符号链接文件为真）

<span class="o">-</span><span class="nv">p</span> 文件
判断该文件是否存在，并且是否为管道文件（是管道文件为真）

<span class="o">-</span><span class="nv">s</span> 文件
判断该文件是否存在，并且是否为非空（非空为真）

<span class="o">-</span><span class="nv">S</span> 文件
判断该文件是否存在，并且是否为套接字文件（是套接字文件为真）

文件<span class="mi">1</span> <span class="o">-</span><span class="nv">nt</span> 文件<span class="mi">2</span>
判断文件<span class="mi">1</span>的修改时间是否比文件<span class="mi">2</span>的新（如果新则为真）

文件<span class="mi">1</span> <span class="o">-</span><span class="nv">ot</span> 文件<span class="mi">2</span>
判断文件<span class="mi">1</span>的修改时间是否比文件<span class="mi">2</span>的旧（如果旧则为真）

文件<span class="mi">1</span> <span class="o">-</span><span class="nv">ef</span> 文件<span class="mi">2</span>
判断文件<span class="mi">1</span>是否和文件<span class="mi">2</span>的<span class="nv">Inode</span>号一致，可以理解为两个
文件是否为同一个文件。这个判断用于判断硬链接是很
好的方法

整数<span class="mi">1</span> <span class="o">-</span><span class="nv">eq</span> 整数
判断整数<span class="mi">1</span>是否和整数<span class="mi">2</span>相等（相等为真）

整数<span class="mi">1</span> <span class="o">-</span><span class="nv">ne</span> 整数
判断整数<span class="mi">1</span>是否和整数<span class="mi">2</span>不相等（不相等位置）

整数<span class="mi">1</span> <span class="o">-</span><span class="nv">gt</span> 整数<span class="mi">2</span>
判断整数<span class="mi">1</span>是否大于整数<span class="mi">2</span>（大于为真）

整数<span class="mi">1</span> <span class="o">-</span><span class="nv">lt</span> 整数<span class="mi">2</span>
判断整数<span class="mi">1</span>是否小于整数<span class="mi">2</span>（小于位置）

整数<span class="mi">1</span> <span class="o">-</span><span class="nv">ge</span> 整数<span class="mi">2</span>
判断整数<span class="mi">1</span>是否大于等于整数<span class="mi">2</span>（大于等于为真）

整数<span class="mi">1</span> <span class="o">-</span><span class="nv">le</span> 整数<span class="mi">2</span>
判断整数<span class="mi">1</span>是否小于等于整数<span class="mi">2</span>（小于等于为真）

<span class="o">-</span><span class="nv">z</span> 字符串
判断字符串是否为空（为空返回真）

<span class="o">-</span><span class="nv">n</span> 字符串
判断字符串是否为非空（非空返回真）

字串<span class="mi">1</span> <span class="o">==</span>字串<span class="mi">2</span>
判断字符串<span class="mi">1</span>是否和字符串<span class="mi">2</span>相等（相等返回真）

字串<span class="mi">1</span> <span class="o">!=</span> 字串<span class="mi">2</span>
判断字符串<span class="mi">1</span>是否和字符串<span class="mi">2</span>不相等（不相等返回真）

判断<span class="mi">1</span> <span class="o">-</span><span class="nv">a</span> 判断<span class="mi">2</span>
逻辑与，判断<span class="mi">1</span>和判断<span class="mi">2</span>都成立，最终的结果才为真

判断<span class="mi">1</span> <span class="o">-</span><span class="nv">o</span> 判断<span class="mi">2</span>
逻辑或，判断<span class="mi">1</span>和判断<span class="mi">2</span>有一个成立，最终的结果就为真

！判断
逻辑非，使原始的判断式取反
</pre></div>


<h2 id="_2">限制模式</h2>
<div class="codehilite"><pre><span></span><span class="nv">bash</span> <span class="o">-</span><span class="nv">r</span>


.<span class="nv">bash_profile</span>  添加 <span class="o">/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">bash</span> <span class="o">-</span><span class="nv">r</span>
.<span class="nv">bashrc</span>
<span class="nv">set</span> <span class="o">-</span><span class="nv">o</span> <span class="nv">ignoreeof</span>
<span class="nv">alias</span> <span class="k">exit</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">kill $(ps aux | grep logcat@pts | grep -v grep | awk &#39;{print $2}&#39;)</span><span class="s2">&quot;</span>

<span class="nv">set</span> <span class="o">-</span><span class="nv">o</span> <span class="nv">option</span> <span class="ss">(</span>开启<span class="ss">)</span>   <span class="nv">set</span> <span class="o">+</span><span class="nv">o</span> <span class="nv">option</span><span class="ss">(</span>关闭<span class="ss">)</span>
<span class="nv">set</span> <span class="o">-</span><span class="nv">o</span> <span class="nv">noclobber</span>   该特性可防止重定向时不经意地重写了已存在的文件 
<span class="nv">echo</span> <span class="s2">&quot;</span><span class="s">kick</span><span class="s2">&quot;</span> <span class="o">&gt;</span> <span class="nv">tmp</span>
<span class="o">-</span><span class="nv">bash</span>: <span class="nv">tmp</span>: <span class="nv">Cannot</span> <span class="nv">overwrite</span> <span class="nv">existing</span> <span class="nv">file</span>

<span class="nv">set</span> <span class="o">-</span><span class="nv">o</span> <span class="nv">ignoreeof</span>
之后，用户只能用<span class="nv">logout</span>或<span class="k">exit</span>命令退出<span class="nv">shell</span>。

<span class="nv">set</span> <span class="o">-</span><span class="nv">o</span> <span class="nv">noglob</span>
配置<span class="nv">noglob</span>变量后，<span class="nv">shell</span>将不扩展文档名中一些特别的字符或字符串。如字符<span class="o">*</span>、?、［］等将不再作为通配符

限制模式下被禁用的命令

在限制模式下运行一个脚本或部分脚本将禁用一些命令，尽管这些命令在正常模式下是可用的。这是个安全措施，可以限制脚本用户的权限，
减少运行脚本可能带来的损害。
被禁用的命令和功能：

使用 <span class="nv">cd</span> 来改变工作目录。
修改 $<span class="nv">PATH</span>, $<span class="nv">SHELL</span>, <span class="mh">$BA</span><span class="nv">SH_ENV</span> 或 <span class="mh">$E</span><span class="nv">NV</span> 等环境变量
读取或修改 $<span class="nv">SHELLOPTS</span>，<span class="nv">shell</span>环境选项。
输出重定向。
调用包含 <span class="o">/</span> 的命令。
调用 <span class="k">exec</span> 来替代<span class="nv">shell</span>进程。
其他各种会造成混乱或颠覆脚本用途的命令。
在脚本中跳出限制模式。
</pre></div>


<h2 id="vip">vip切换</h2>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>
<span class="nv">vip</span><span class="o">=</span><span class="s2">&quot;192.168.1.20/24&quot;</span>
<span class="nv">key</span><span class="o">=</span><span class="s2">&quot;5&quot;</span>
<span class="nv">stop_vip</span><span class="o">=</span><span class="s2">&quot;/sbin/ifconfig em2:</span><span class="nv">$key</span><span class="s2"> down&quot;</span>
<span class="nv">start_vip</span><span class="o">=</span><span class="s2">&quot;/sbin/ifconfig em2:</span><span class="nv">$key</span><span class="s2"> </span><span class="nv">$vip</span><span class="s2">&quot;</span>
<span class="nv">pingtest</span><span class="o">=</span><span class="k">$(</span>fping <span class="m">192</span>.168.1.20 <span class="m">2</span>&gt; /dev/null <span class="p">|</span> grep -c alive<span class="k">)</span>
<span class="k">while</span> <span class="nb">true</span>
<span class="k">do</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$pingtest</span> -ne <span class="m">1</span>  <span class="o">]</span><span class="p">;</span><span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;redis master is down&quot;</span>
    <span class="nv">$start_vip</span>
    <span class="nb">exit</span> <span class="m">1</span>
<span class="k">else</span>
    <span class="nv">conne</span><span class="o">=</span><span class="k">$(</span>/usr/local/redis-3.0.0/src/redis-cli -h <span class="m">192</span>.168.1.20 ping <span class="m">2</span>&gt;/dev/null <span class="p">|</span> grep -c PONG<span class="k">)</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nv">$conne</span> -ne <span class="m">1</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
        <span class="nb">echo</span> <span class="s2">&quot;redis master is unreachable&quot;</span>
        <span class="nv">pingtest2</span><span class="o">=</span><span class="k">$(</span>fping <span class="m">192</span>.168.1.20 <span class="m">2</span>&gt; /dev/null <span class="p">|</span> grep -c alive<span class="k">)</span>
        <span class="o">[</span> <span class="nv">$pingtest2</span> -eq <span class="m">1</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> ssh root@192.168.1.5 <span class="nv">$stop_vip</span>
    <span class="nv">$start_vip</span>
        <span class="nb">exit</span> <span class="m">2</span>
    <span class="k">fi</span>
<span class="k">fi</span>
sleep <span class="m">2</span>
<span class="nb">echo</span> <span class="s2">&quot;======================&quot;</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>

<h2 id="hostname">hostname主机名</h2>
<div class="codehilite"><pre><span></span><span class="err">修改</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysconfig</span><span class="o">/</span><span class="n">network</span><span class="err">下的</span><span class="n">HOSTNAME</span>   <span class="err">重启服务器生效</span>
<span class="n">hostname</span> <span class="o">+</span><span class="err">主机名</span>  <span class="err">命令使其生效，重新登陆生效</span>

<span class="err">可以一起修改</span>
</pre></div>


<h2 id="sed">sed</h2>
<div class="codehilite"><pre><span></span><span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">N;s/</span><span class="se">\n</span><span class="s">/ /g</span><span class="s1">&#39;</span>  两行变一行
<span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">N;N;s/</span><span class="se">\n</span><span class="s">/ /g</span><span class="s1">&#39;</span>  三行变一行

#高级编辑命令
<span class="nv">h</span>: 模式空间覆盖保持空间
<span class="nv">H</span>：模式空间追加保持空间
<span class="nv">g</span>：保持空间取出覆盖至模式空间
<span class="nv">G</span>：保持空间取出追加至模式空间
<span class="nv">x</span>: 模式空间互换保持空间
<span class="nv">n</span>: 读取匹配到的行的下一行至模式空间
<span class="nv">N</span>：读取匹配到的行和下一行至模式空间
<span class="nv">d</span>: 删除模式空间中的行
<span class="nv">D</span>：删除多行模式空间中的所有行
<span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">n;d</span><span class="s1">&#39;</span> <span class="nv">test</span>.<span class="nv">txt</span>    #显示奇数行
<span class="nv">sed</span> <span class="o">-</span><span class="nv">n</span> <span class="s1">&#39;</span><span class="s">1~2p</span><span class="s1">&#39;</span> <span class="nv">test</span>.<span class="nv">txt</span>    #显示奇数行
<span class="nv">sed</span> <span class="o">-</span><span class="nv">n</span> <span class="s1">&#39;</span><span class="s">n;p</span><span class="s1">&#39;</span> <span class="nv">ip</span>    #显示偶数行
<span class="nv">sed</span> <span class="o">-</span><span class="nv">n</span> <span class="s1">&#39;</span><span class="s">2~2p</span><span class="s1">&#39;</span> <span class="nv">test</span>.<span class="nv">txt</span>    #显示偶数行
<span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">1!G;h;$!d</span><span class="s1">&#39;</span> <span class="nv">test</span>.<span class="nv">txt</span>    #逆序显示文件内容
<span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">$!d</span><span class="s1">&#39;</span> <span class="nv">fsta</span>    #取出文件最后一行
<span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">G</span><span class="s1">&#39;</span> <span class="nv">test</span>.<span class="nv">txt</span>    #每行追加空白行
<span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">/^$/d;G</span><span class="s1">&#39;</span> <span class="nv">test</span>.<span class="nv">txt</span>    #每行追加空白行，多行空白行合并一个空白行

#普通参数
<span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">/^#\|^$/d</span><span class="s1">&#39;</span> <span class="nv">fstab</span>    #删除#和空行
<span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">1,8d</span><span class="s1">&#39;</span> <span class="nv">fstab</span>    <span class="sc">#1</span><span class="o">-</span><span class="mi">8</span>行删除
<span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">/^#/d</span><span class="s1">&#39;</span> <span class="nv">fstab</span><span class="o">-----&gt;</span><span class="nv">sed</span> <span class="o">-</span><span class="nv">n</span> <span class="s1">&#39;</span><span class="s">/^#/p</span><span class="s1">&#39;</span> <span class="nv">fstab</span>  #相反
<span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">10a\&quot;IP&quot;</span><span class="s1">&#39;</span> <span class="nv">fstab</span>    #第<span class="mi">10</span>行后追加
<span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">/^tmpfs/a\&quot;IP&quot;</span><span class="s1">&#39;</span> <span class="nv">fstab</span>    #<span class="nv">tmpfs</span>开头的行后增加
<span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">/^tmpfs/a\Hello</span><span class="se">\n</span><span class="s">word</span><span class="s1">&#39;</span> <span class="nv">fstab</span>    #追加两行
<span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">/^tmpfs/i\hello</span><span class="se">\n</span><span class="s">word</span><span class="s1">&#39;</span> <span class="nv">fstab</span>   #在行前面追加
<span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">/^tmpfs/c\hello</span><span class="se">\n</span><span class="s">word</span><span class="s1">&#39;</span> <span class="nv">fstab</span>     #替换匹配到的行
<span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">/^tmpfs/w b.txt</span><span class="s1">&#39;</span> <span class="nv">fstab</span>    #查找出来的行写到<span class="nv">b</span>.<span class="nv">txt</span>
<span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">/^tmpfs/!d</span><span class="s1">&#39;</span> <span class="nv">fstab</span>    #除了<span class="nv">tmpfs</span>的行删除
<span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">s/r..t/&amp;er/g</span><span class="s1">&#39;</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">passwd</span>    #所有<span class="nv">r</span>..<span class="nv">t</span>的字符串后面加<span class="nv">er</span>
<span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">s/^[[:space:]]\+//</span><span class="s1">&#39;</span> <span class="o">/</span><span class="nv">boot</span><span class="o">/</span><span class="nv">grub</span><span class="o">/</span><span class="nv">grub</span>.<span class="nv">conf</span>    #删除每行空白字符开头的空白字符
<span class="nv">echo</span> <span class="s2">&quot;</span><span class="s">/etc/sysconfig</span><span class="s2">&quot;</span> <span class="o">|</span> <span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">s#[^/]\+$##</span><span class="s1">&#39;</span>    #取出目录


<span class="nv">sed</span>引用变量
<span class="nv">sed</span>命令使用双引号的情况下，使用$<span class="nv">var</span>直接引用
$ <span class="nv">echo</span><span class="o">|</span><span class="nv">sed</span> <span class="s2">&quot;</span><span class="s">s/^/$RANDOM.rmvb_/g</span><span class="s2">&quot;</span> 
<span class="nv">sed</span>命令使用单引号的情况下，使用<span class="s1">&#39;</span><span class="s">&quot;$var&quot;</span><span class="s1">&#39;</span>引用，单引号加双引号
$ <span class="nv">echo</span><span class="o">|</span><span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">s/^/</span><span class="s1">&#39;</span><span class="s2">&quot;</span><span class="s">$RANDOM</span><span class="s2">&quot;</span><span class="s1">&#39;</span><span class="s">.rmvb_/g</span><span class="s1">&#39;</span>

<span class="nv">sed</span>中执行外部命令
<span class="nv">sed</span>命令使用单引号的情况下使用<span class="s1">&#39;</span><span class="s">`shell command`</span><span class="s1">&#39;</span>或者<span class="s1">&#39;</span><span class="s">$(shell command)</span><span class="s1">&#39;</span>引用命令执行的结果 
$ <span class="nv">echo</span><span class="o">|</span><span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">s/^/</span><span class="s1">&#39;</span>`<span class="nv">echo</span> $<span class="k">RANDOM</span>`<span class="s1">&#39;</span><span class="s">.rmvb_/g</span><span class="s1">&#39;</span> 
$ <span class="nv">echo</span><span class="o">|</span><span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">s/^/</span><span class="s1">&#39;</span>$<span class="ss">(</span><span class="nv">echo</span> $<span class="k">RANDOM</span><span class="ss">)</span><span class="s1">&#39;</span><span class="s">.rmvb_/g</span><span class="s1">&#39;</span> 
$ <span class="nv">echo</span><span class="o">|</span><span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">s/^/</span><span class="s1">&#39;</span>$<span class="ss">(</span><span class="nv">date</span> <span class="o">+</span><span class="s2">&quot;</span><span class="s">%Y%m%d</span><span class="s2">&quot;</span><span class="ss">)</span><span class="s1">&#39;</span><span class="s">.rmvb_/g</span><span class="s1">&#39;</span>

<span class="nv">sed</span> <span class="nv">options</span> <span class="nv">script</span> <span class="nv">file</span>
语法：
<span class="nv">sed</span> [<span class="nv">options</span>] <span class="s1">&#39;</span><span class="s">{command}[flags]</span><span class="s1">&#39;</span> [<span class="nv">filename</span>]
<span class="o">-</span><span class="nv">e</span> <span class="nv">script</span> 将脚本中指定的命令添加到处理输入时执行的命令中  多条件，一行中要有多个操作
<span class="o">-</span><span class="nv">f</span> <span class="nv">script</span> 将文件中指定的命令添加到处理输入时执行的命令中
<span class="o">-</span><span class="nv">n</span>        抑制自动输出
<span class="o">-</span><span class="nv">i</span>        编辑文件内容，会破坏软硬链接，<span class="o">--</span><span class="nv">follow</span><span class="o">-</span><span class="nv">symlinks</span>可以保留软链接
<span class="o">-</span><span class="nv">i</span>.<span class="nv">bak</span>    修改时同时创建.<span class="nv">bak</span>备份文件。
<span class="o">-</span><span class="nv">r</span>        使用扩展的正则表达式
<span class="o">!</span>         取反 （跟在模式条件后与<span class="nv">shell</span>有所区别）
<span class="nv">q</span>         退出                           <span class="nv">w</span> 另存
<span class="nv">r</span> <span class="nv">filename</span>读取文件  <span class="nv">R</span> 读取一行
保持前面匹配的内容    （与正则分组类似）

<span class="nv">sed</span>常用内部命令
<span class="nv">a</span>   在匹配后面添加
<span class="nv">i</span>   在匹配前面添加
<span class="nv">p</span>   打印
<span class="nv">d</span>   删除
<span class="nv">s</span>   查找替换
<span class="nv">c</span>   更改
<span class="nv">y</span>   转换   <span class="nv">N</span> <span class="nv">D</span> <span class="nv">P</span> 
<span class="nv">h</span> <span class="nv">H</span> 拷贝<span class="o">/</span>添加模式空间到内存缓冲区
<span class="nv">g</span> <span class="nv">G</span> 拷贝<span class="o">/</span>添加内存缓冲区到模式空间
<span class="o">/</span><span class="nv">s</span> <span class="nv">replace</span>

<span class="nv">echo</span> <span class="s2">&quot;</span><span class="s">this is a test</span><span class="s2">&quot;</span> <span class="o">|</span><span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">s/test/text/</span><span class="s1">&#39;</span>
<span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">s/dog/cat</span><span class="s1">&#39;</span><span class="o">/</span> <span class="nv">data1</span>
<span class="nv">sed</span> <span class="o">-</span><span class="nv">e</span> <span class="s1">&#39;</span><span class="s">s/brown/green/;s/dog/cat/</span><span class="s1">&#39;</span> <span class="nv">data1</span>

<span class="nv">sed</span> <span class="o">-</span><span class="nv">n</span> <span class="s1">&#39;</span><span class="s">1p</span><span class="s1">&#39;</span> <span class="nv">data1</span>       #显示第一行
<span class="nv">sed</span> <span class="o">-</span><span class="nv">n</span> <span class="s1">&#39;</span><span class="s">$p</span><span class="s1">&#39;</span> <span class="nv">data1</span>       #显示最后一行
<span class="nv">sed</span> <span class="o">-</span><span class="nv">n</span> <span class="s1">&#39;</span><span class="s">1,2p</span><span class="s1">&#39;</span> <span class="nv">data1</span>     #显示第一行到第二行
<span class="nv">sed</span> <span class="o">-</span><span class="nv">n</span> <span class="s1">&#39;</span><span class="s">2,$p</span><span class="s1">&#39;</span> <span class="nv">data1</span>     #显示第二行到最后一行

<span class="nv">s</span><span class="o">/</span><span class="nv">pattern</span><span class="o">/</span><span class="nv">repleacement</span><span class="o">/</span><span class="nv">flags</span>

<span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">1,3y/abc/ABC/</span><span class="s1">&#39;</span> <span class="nv">newfile</span> 
<span class="nv">y</span>命令就是将小写转换成了大写，正则表达式元字符不能使用这个命令

<span class="nv">flags</span>
数字  表示新文本替换的模式
<span class="nv">g</span>：表示用新文本替换现有文本的全部实例
<span class="nv">p</span>：表示打印原始的内容
<span class="nv">w</span> <span class="nv">file</span>:将替换的结果写入文件

<span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">2{s/fox/elephant/;s/dog/cat/}</span><span class="s1">&#39;</span> <span class="nv">data1</span>
<span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">2,${s/fox/elephant/;s/dog/cat/}</span><span class="s1">&#39;</span> <span class="nv">data1</span>

<span class="nv">sed</span> <span class="s1">&#39;</span><span class="s">1,10y/abcde/ABCDE/</span><span class="s1">&#39;</span> <span class="nv">example</span>.<span class="nv">file</span> 
把<span class="mi">1</span>—<span class="mi">10</span>行内所有<span class="nv">abcde</span>转变为大写，注意，正则表达式元字符不能使用这个命令。参数<span class="nv">y</span>，表示把一个字符翻译为另外的字符（但是不用于正则表达式）

<span class="nv">modify</span> <span class="nv">file</span>
<span class="nv">sed</span> <span class="o">-</span><span class="nv">i</span>

<span class="nv">sed</span> <span class="o">-</span><span class="nv">i</span> <span class="s1">&#39;</span><span class="s">/修改点/i增加内容</span><span class="s1">&#39;</span> <span class="nv">filename</span>
<span class="nv">sed</span> <span class="o">-</span><span class="nv">i</span> <span class="s1">&#39;</span><span class="s">/修改点/d</span><span class="s1">&#39;</span>  <span class="nv">filename</span>

修改点可以是行号
可是字符串【唯一字符串】
增
<span class="nv">sed</span> <span class="o">-</span><span class="nv">i</span> <span class="s1">&#39;</span><span class="s">4iabc</span><span class="s1">&#39;</span> <span class="nv">data3</span>  在第四行之前插入<span class="nv">abc</span>
<span class="nv">sed</span> <span class="o">-</span><span class="nv">i</span> <span class="s1">&#39;</span><span class="s">4aabc</span><span class="s1">&#39;</span> <span class="nv">data3</span>  在第三行之后插入<span class="nv">abc</span>
<span class="nv">sed</span> <span class="o">-</span><span class="nv">i</span> <span class="s1">&#39;</span><span class="s">/abc/c789</span><span class="s1">&#39;</span> <span class="nv">data3</span> 将<span class="nv">abc</span>改为<span class="mi">789</span>

删
<span class="nv">sed</span> <span class="o">-</span><span class="nv">i</span> <span class="s1">&#39;</span><span class="s">4d</span><span class="s1">&#39;</span> <span class="nv">data3</span>
<span class="nv">sed</span> <span class="o">-</span><span class="nv">i</span> <span class="s1">&#39;</span><span class="s">/number 2/d</span><span class="s1">&#39;</span> <span class="nv">data3</span>

改
将<span class="nv">This</span> <span class="nv">is</span> <span class="nv">line</span> <span class="nv">number</span> <span class="mi">2</span>.改为 <span class="nv">this</span> <span class="nv">is</span> <span class="nv">a</span> <span class="nv">test</span> <span class="nv">line</span> <span class="nv">number</span> <span class="mi">2</span>.
<span class="nv">sed</span> <span class="o">-</span><span class="nv">i</span> <span class="s1">&#39;</span><span class="s">/line number 2/cthis is test line number 2</span><span class="s1">&#39;</span> <span class="nv">data3</span>


<span class="nv">sed</span> <span class="o">-</span><span class="nv">n</span> <span class="s2">&quot;</span><span class="s">$=</span><span class="s2">&quot;</span> <span class="nv">test</span>  统计<span class="nv">test</span>有多少行

<span class="nv">sed</span> 在指定位置插入一行

正则表达式

元字符集<span class="o">^</span>
锚定行的开始如：<span class="o">/^</span><span class="nv">sed</span><span class="o">/</span>匹配所有以<span class="nv">sed</span>开头的行。
$
锚定行的结束如：<span class="o">/</span><span class="nv">sed</span>$<span class="o">/</span>匹配所有以<span class="nv">sed</span>结尾的行。
.
匹配一个非换行符的字符如：<span class="o">/</span><span class="nv">s</span>.<span class="nv">d</span><span class="o">/</span>匹配<span class="nv">s</span>后接一个任意字符，然后是<span class="nv">d</span>。
<span class="o">*</span>
匹配零或多个字符如：<span class="cm">/*sed/匹配所有模板是一个或多个空格后紧跟sed的行。</span>
<span class="cm">[]</span>
<span class="cm">匹配一个指定范围内的字符，如/[Ss]ed/匹配sed和Sed。</span>
<span class="cm">[^]</span>
<span class="cm">匹配一个不在指定范围内的字符，如：/[^A-RT-Z]ed/匹配不包含A-R和T-Z的一个字母开头，紧跟ed的行。</span>
<span class="cm">\(..\)</span>
<span class="cm">保存匹配的字符，如s/\(love\)able/\1rs，loveable被替换成lovers。</span>
<span class="cm">&amp;</span>
<span class="cm">保存搜索字符用来替换其他字符，如s/love/**&amp;**/</span>，<span class="nv">love</span>这成<span class="o">**</span><span class="nv">love</span><span class="o">**</span>。
\<span class="o">&lt;</span>
锚定单词的开始，如:<span class="o">/</span>\<span class="o">&lt;</span><span class="nv">love</span><span class="o">/</span>匹配包含以<span class="nv">love</span>开头的单词的行。
\<span class="o">&gt;</span>
锚定单词的结束，如<span class="o">/</span><span class="nv">love</span>\<span class="o">&gt;/</span>匹配包含以<span class="nv">love</span>结尾的单词的行。
<span class="nv">x</span>\{<span class="nv">m</span>\}
重复字符<span class="nv">x</span>，<span class="nv">m</span>次，如：<span class="o">/</span><span class="mi">0</span>\{<span class="mi">5</span>\}<span class="o">/</span>匹配包含<span class="mi">5</span>个<span class="nv">o</span>的行。
<span class="nv">x</span>\{<span class="nv">m</span>,\}
重复字符<span class="nv">x</span>,至少<span class="nv">m</span>次，如：<span class="o">/</span><span class="nv">o</span>\{<span class="mi">5</span>,\}<span class="o">/</span>匹配至少有<span class="mi">5</span>个<span class="nv">o</span>的行。
<span class="nv">x</span>\{<span class="nv">m</span>,<span class="nv">n</span>\}
重复字符<span class="nv">x</span>，至少<span class="nv">m</span>次，不多于<span class="nv">n</span>次，如：<span class="o">/</span><span class="nv">o</span>\{<span class="mi">5</span>,<span class="mi">10</span>\}<span class="o">/</span>匹配<span class="mi">5</span><span class="o">--</span><span class="mi">10</span>个<span class="nv">o</span>的行。
</pre></div>


<h2 id="awk">awk函数</h2>
<div class="codehilite"><pre><span></span><span class="n">awk</span> <span class="err">认为文件中的每一行是一条记录</span> <span class="err">记录与记录的分隔符为换行符</span>
                <span class="err">每一列是一个字段</span> <span class="err">字段与字段的分隔符默认为空格</span>
<span class="n">awk</span>
<span class="n">awk</span> <span class="n">options</span> <span class="n">program</span> <span class="n">file</span>

<span class="err">获取指定时间端的日志</span> <span class="n">awk</span> <span class="err">&#39;$</span><span class="mi">4</span><span class="o">&gt;=</span><span class="s">&quot;[31/Jan/2018:16:00:00&quot;</span> <span class="o">&amp;&amp;</span> <span class="err">$</span><span class="mi">4</span><span class="o">&lt;=</span><span class="s">&quot;[31/Jan/2018:16:30:00&quot;</span><span class="err">&#39;</span> <span class="n">log</span>
<span class="err">或</span>  <span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span><span class="n">split</span><span class="p">(</span><span class="err">$</span><span class="mi">4</span><span class="p">,</span><span class="n">array</span><span class="p">,</span><span class="s">&quot;[&quot;</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;=</span><span class="s">&quot;31/Jan/2018:17:00:00&quot;</span> <span class="o">&amp;&amp;</span> <span class="n">array</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&lt;=</span><span class="s">&quot;31/Jan/2018:17:30:00&quot;</span><span class="p">){</span><span class="n">print</span> <span class="err">$</span><span class="mi">0</span><span class="p">}}</span><span class="err">&#39;</span> <span class="n">log</span>

<span class="err">统计日志</span><span class="n">uv</span>  <span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span><span class="n">a</span><span class="p">[</span><span class="err">$</span><span class="mi">1</span><span class="p">]</span><span class="o">++</span><span class="p">}</span> <span class="n">END</span><span class="p">{</span><span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="n">a</span><span class="p">)</span><span class="n">print</span> <span class="n">i</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]}</span><span class="err">&#39;</span> <span class="n">localhost_access_log</span><span class="mf">.2016</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mf">12.</span><span class="n">txt</span> <span class="o">|</span> <span class="n">wc</span> <span class="o">-</span><span class="n">l</span>
<span class="n">pv</span>                 <span class="n">wc</span> <span class="o">-</span><span class="n">l</span>  <span class="n">localhost_access_log</span><span class="mf">.2016</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mf">12.</span><span class="n">txt</span>

<span class="err">列转行</span>
<span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="o">++</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">NF</span><span class="p">;)</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">?</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="n">FS</span> <span class="err">$</span><span class="nl">i</span><span class="p">:</span><span class="err">$</span><span class="n">i</span><span class="p">}</span><span class="n">END</span><span class="p">{</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">++&lt;</span><span class="n">NF</span><span class="p">;)</span><span class="n">print</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]}</span><span class="err">&#39;</span> <span class="mf">1.</span><span class="n">txt</span>
<span class="n">name</span> <span class="n">age</span>                     <span class="n">alice</span> <span class="mi">21</span>         <span class="o">====&gt;</span>       <span class="n">ryan</span> <span class="mi">30</span>


<span class="err">行加求和</span>  <span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span>
                  <span class="n">sum</span><span class="o">=</span><span class="mi">0</span> 
                   <span class="k">for</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">n</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">;</span><span class="n">n</span><span class="o">++</span><span class="p">)</span>
                    <span class="p">(</span><span class="n">sum</span><span class="o">+=</span><span class="err">$</span><span class="n">n</span><span class="p">)</span>
                    <span class="n">print</span> <span class="n">sum</span><span class="p">}</span><span class="err">&#39;</span> <span class="n">t2</span>
<span class="err">列加求和</span>  <span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span><span class="n">sum</span> <span class="o">+=</span><span class="err">$</span><span class="mi">1</span><span class="p">}</span><span class="n">END</span><span class="p">{</span><span class="n">print</span> <span class="n">sum</span><span class="p">}</span><span class="err">&#39;</span> <span class="n">t2</span>

<span class="o">-</span><span class="n">F</span> <span class="n">fs</span> <span class="err">指定描绘一行中数据字段的文件分隔符</span>  <span class="err">默认为空格</span>
<span class="o">-</span><span class="n">f</span> <span class="n">file</span> <span class="err">指定读取程序的文件名</span>
<span class="o">-</span><span class="n">v</span> <span class="n">var</span><span class="o">=</span><span class="n">value</span> <span class="err">定义</span><span class="n">awk</span><span class="err">程序中使用的变量和默认值</span>
<span class="o">-</span><span class="n">mf</span> <span class="n">N</span> <span class="err">指定数据文件中要处理的字段的最大数目</span>
<span class="o">-</span><span class="n">mr</span> <span class="n">N</span> <span class="err">指定数据文件中的最大记录大小</span>
<span class="o">-</span><span class="n">w</span> <span class="n">keyword</span> <span class="err">指定</span><span class="n">awk</span><span class="err">的兼容模式或警告级别</span>

<span class="n">awk</span> <span class="err">程序脚本由左大括号和右大括号定义。脚本命令必须放置在两个大括号之间。由于</span><span class="n">awk</span><span class="err">命令行假定脚本是单文本字符串，</span>
<span class="err">所以必须将脚本包括在单引号内。</span>

<span class="err">$</span><span class="mi">0</span> <span class="err">表示整行文本</span>
<span class="err">$</span><span class="mi">1</span> <span class="err">表示文本行中的第一个数据字段</span>
<span class="err">$</span><span class="mi">2</span> <span class="err">表示文本行中的第二个数据字段</span>
<span class="err">$</span><span class="n">N</span>                    <span class="n">N</span> 
<span class="err">$</span><span class="n">NF</span>


<span class="err">通过</span><span class="n">awk</span><span class="err">进行输出排列</span>
<span class="err">将</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span><span class="err">文件中的</span> <span class="err">描述：</span><span class="n">UID</span><span class="err">：</span><span class="n">GID</span><span class="err">：</span><span class="n">shell</span><span class="err">按顺序输出【$</span><span class="mi">5</span> <span class="err">$</span><span class="mi">3</span> <span class="err">$</span><span class="mi">4</span> <span class="err">$</span><span class="mi">7</span><span class="err">】</span>

<span class="err">输出格式如：</span>
<span class="err">　</span><span class="nl">username</span><span class="p">:</span> <span class="n">root</span> <span class="nl">UID</span><span class="p">:</span> <span class="mi">0</span> <span class="nl">GID</span><span class="p">:</span> <span class="mi">0</span> <span class="nl">SHELL</span><span class="p">:</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span>


<span class="n">echo</span> <span class="s">&quot;my name is rich&quot;</span> <span class="o">|</span> <span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span><span class="err">$</span><span class="mi">4</span><span class="o">=</span><span class="s">&quot;dave&quot;</span><span class="p">;</span><span class="n">print</span> <span class="err">$</span><span class="mi">0</span><span class="p">}</span><span class="err">&#39;</span>

<span class="err">从文件中读取程序</span>

<span class="p">[</span><span class="n">root</span><span class="p">@</span><span class="n">VFAST</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">vim</span> <span class="n">script2</span>
<span class="p">{</span>
<span class="n">print</span> <span class="err">$</span><span class="mi">5</span> <span class="s">&quot;&#39;s userid is &quot;</span> <span class="err">$</span><span class="mi">1</span>
<span class="p">}</span>

<span class="p">[</span><span class="n">root</span><span class="p">@</span><span class="n">VFAST</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">awk</span> <span class="o">-</span><span class="nl">F</span><span class="p">:</span> <span class="o">-</span><span class="n">f</span> <span class="n">script2</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span>


<span class="err">在处理数据之前运行脚本</span> <span class="err">【插入文件头】</span>
<span class="p">[</span><span class="n">root</span><span class="p">@</span><span class="n">VFAST</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">awk</span> <span class="err">&#39;</span><span class="n">BEGIN</span> <span class="p">{</span><span class="n">print</span> <span class="s">&quot;hello world!&quot;</span><span class="p">}</span><span class="err">&#39;</span>
<span class="n">hello</span> <span class="n">world</span><span class="o">!</span>


<span class="err">高级</span><span class="n">awk</span> <span class="n">command</span>

<span class="n">awk</span> <span class="err">支持两种不同类型的变量</span>
<span class="err">内置变量</span>
<span class="err">用户自定义变量</span>


<span class="err">内置变量</span>
<span class="mf">1.</span><span class="err">字段和记录分隔符变量</span>

<span class="err">数据字段变量</span>
<span class="err">允许使用美元符和数据字段在记录中的数字位置引用数据记录中的单个数据字段</span>   <span class="err">$</span><span class="mi">1</span> <span class="err">$</span><span class="mi">2</span> <span class="err">$</span><span class="n">n</span>
<span class="err">数据字段由字段分隔符号描述</span>  <span class="err">默认为空格</span>

<span class="n">FS</span><span class="err">内置变量属于一组内置变量，他们用于控制</span><span class="n">awk</span><span class="err">在输入数据和输出数据中处理字段和记录的方式</span>


<span class="n">awk</span><span class="err">数据字段和记录变量</span>

<span class="err">变量</span>                 <span class="err">描述</span>
<span class="n">FIELDWIDTHS</span>          <span class="err">以空格分隔的数字列表，用空格定义每个数据字段的精确宽度</span>
<span class="n">FS</span>                   <span class="err">输入字段分隔符号</span>
<span class="n">RS</span>                   <span class="err">输入记录分隔符</span>
<span class="n">OFS</span>                  <span class="err">输出字段分隔符号</span>
<span class="n">ORS</span>                  <span class="err">输出记录分隔符号</span>


<span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span>
<span class="p">[</span><span class="n">root</span><span class="p">@</span><span class="n">VFAST</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">awk</span> <span class="o">-</span><span class="nl">F</span><span class="p">:</span> <span class="err">&#39;</span><span class="p">{</span><span class="n">print</span> <span class="err">$</span><span class="mi">1</span><span class="p">,</span><span class="err">$</span><span class="mi">2</span><span class="p">,</span><span class="err">$</span><span class="mi">3</span><span class="p">}</span><span class="err">&#39;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span>
        <span class="err">等价</span>
<span class="p">[</span><span class="n">root</span><span class="p">@</span><span class="n">VFAST</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">awk</span> <span class="err">&#39;</span><span class="n">BEGIN</span> <span class="p">{</span><span class="n">FS</span><span class="o">=</span><span class="s">&quot;:&quot;</span><span class="p">}</span> <span class="p">{</span><span class="n">print</span> <span class="err">$</span><span class="mi">1</span><span class="p">,</span><span class="err">$</span><span class="mi">2</span><span class="p">,</span><span class="err">$</span><span class="mi">3</span><span class="p">}</span> <span class="err">&#39;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span>


<span class="p">[</span><span class="n">root</span><span class="p">@</span><span class="n">VFAST</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">awk</span> <span class="err">&#39;</span><span class="n">BEGIN</span> <span class="p">{</span><span class="n">FS</span><span class="o">=</span><span class="s">&quot;:&quot;</span><span class="p">;</span><span class="n">OFS</span><span class="o">=</span><span class="s">&quot;-&quot;</span><span class="p">}</span> <span class="p">{</span><span class="n">print</span> <span class="err">$</span><span class="mi">1</span><span class="p">,</span><span class="err">$</span><span class="mi">2</span><span class="p">,</span><span class="err">$</span><span class="mi">3</span><span class="p">}</span> <span class="err">&#39;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span>


<span class="n">FIELDWIDTHS</span> <span class="err">变量允许不使用字段分隔符读取记录，在某些应用程序中，数据不使用字段分隔符号，而是被放置的特定列中，</span>
<span class="err">在这种情况下必须使用</span><span class="n">FIELDWIDTHS</span><span class="err">变量以匹配记录中的数据布局</span>

<span class="n">vim</span> <span class="n">data3</span>

<span class="mf">1005.324759.37</span>
<span class="mi">115</span><span class="o">-</span><span class="mf">2.349194.00</span>
<span class="mo">05</span><span class="n">b10</span><span class="mf">.1298100.1</span>

<span class="p">[</span><span class="n">root</span><span class="p">@</span><span class="n">VFAST</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">awk</span> <span class="err">&#39;</span><span class="n">BEGIN</span><span class="p">{</span><span class="n">FIELDWIDTHS</span><span class="o">=</span><span class="s">&quot;3 5 2 5&quot;</span><span class="p">}</span><span class="err">&#39;&#39;</span><span class="p">{</span><span class="n">print</span> <span class="err">$</span><span class="mi">1</span><span class="p">,</span><span class="err">$</span><span class="mi">2</span><span class="p">,</span><span class="err">$</span><span class="mi">3</span><span class="p">,</span><span class="err">$</span><span class="mi">4</span><span class="p">}</span><span class="err">&#39;</span> <span class="n">data3</span>
<span class="mi">100</span> <span class="mf">5.324</span> <span class="mi">75</span> <span class="mf">9.37</span>
<span class="mi">115</span> <span class="o">-</span><span class="mf">2.34</span> <span class="mi">91</span> <span class="mf">94.00</span>
<span class="mo">05</span><span class="n">b</span> <span class="mf">10.12</span> <span class="mi">98</span> <span class="mf">100.1</span>

<span class="n">RS</span> <span class="n">ORS</span><span class="err">变量定义</span><span class="n">awk</span><span class="err">程序处理数据流中记录的方式，默认情况是换行符</span>
<span class="n">RS</span><span class="err">默认变量值表示输入数据流中文本的每个新行为一条新纪录</span>
  <span class="err">有时数据字段分布在数据流的多行上，典型的例子是包含地址和电话号码的数据，他们分别在单独的行上</span>

<span class="p">[</span><span class="n">root</span><span class="p">@</span><span class="n">VFAST</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">cat</span> <span class="n">data7</span>
<span class="n">Riley</span> <span class="n">Mullen</span>
<span class="mi">123</span> <span class="n">Main</span> <span class="n">Street</span>
<span class="n">Chicago</span><span class="p">,</span><span class="n">IL</span> <span class="mi">60602</span>
<span class="p">(</span><span class="mi">312</span><span class="p">)</span><span class="mi">555</span><span class="o">-</span><span class="mi">1234</span>

<span class="p">[</span><span class="n">root</span><span class="p">@</span><span class="n">VFAST</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">awk</span> <span class="err">&#39;</span><span class="n">BEGIN</span><span class="p">{</span><span class="n">FS</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="n">RS</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">}</span> <span class="p">{</span><span class="n">print</span> <span class="err">$</span><span class="mi">1</span><span class="p">,</span><span class="err">$</span><span class="mi">4</span><span class="p">}</span><span class="err">&#39;</span> <span class="n">data7</span>
<span class="n">Riley</span> <span class="n">Mullen</span> <span class="p">(</span><span class="mi">312</span><span class="p">)</span><span class="mi">555</span><span class="o">-</span><span class="mi">1234</span>

<span class="err">将</span><span class="n">RS</span><span class="err">变量设置问空字符串，然后再数据流中的数据记录之间保留一个空行，</span><span class="n">awk</span><span class="err">会将每个空行解析为记录的分隔符</span>
<span class="p">[</span><span class="n">root</span><span class="p">@</span><span class="n">VFAST</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">cat</span> <span class="n">data7</span> <span class="o">|</span><span class="n">awk</span> <span class="err">&#39;</span><span class="n">BEGIN</span><span class="p">{</span><span class="n">FS</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="n">RS</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">}{</span><span class="n">print</span> <span class="err">$</span><span class="mi">1</span><span class="p">,</span><span class="err">$</span><span class="mi">2</span><span class="p">,</span><span class="err">$</span><span class="mi">3</span><span class="p">,</span><span class="err">$</span><span class="mi">4</span><span class="p">}</span><span class="err">&#39;</span>
<span class="n">Riley</span> <span class="n">Mullen</span> <span class="mi">123</span> <span class="n">Main</span> <span class="n">Street</span> <span class="n">Chicago</span><span class="p">,</span><span class="n">IL</span> <span class="mi">60602</span> <span class="p">(</span><span class="mi">312</span><span class="p">)</span><span class="mi">555</span><span class="o">-</span><span class="mi">1234</span>

<span class="p">[</span><span class="n">root</span><span class="p">@</span><span class="n">VFAST</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">awk</span> <span class="err">&#39;</span><span class="n">BEGIN</span><span class="p">{</span><span class="n">FS</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="n">OFS</span><span class="o">=</span><span class="s">&quot;-&quot;</span><span class="p">}</span> <span class="p">{</span><span class="n">print</span> <span class="err">$</span><span class="mi">1</span><span class="p">,</span><span class="err">$</span><span class="mi">2</span><span class="p">,</span><span class="err">$</span><span class="mi">3</span><span class="p">,</span><span class="err">$</span><span class="mi">4</span><span class="p">}</span><span class="err">&#39;</span> <span class="n">data7</span>
<span class="n">Riley</span> <span class="n">Mullen</span><span class="o">---</span>
<span class="mi">123</span> <span class="n">Main</span> <span class="n">Street</span><span class="o">---</span>
<span class="n">Chicago</span><span class="p">,</span><span class="n">IL</span> <span class="mi">60602</span><span class="o">---</span>
<span class="p">(</span><span class="mi">312</span><span class="p">)</span><span class="mi">555</span><span class="o">-</span><span class="mi">1234</span><span class="o">---</span>


<span class="n">vim</span> <span class="n">vfast</span>
<span class="mi">123</span>
<span class="mi">456</span> <span class="mi">789</span>
<span class="mi">123456</span>
<span class="mi">789</span>


<span class="n">awk</span> <span class="err">&#39;</span><span class="n">BEGIN</span><span class="p">{</span><span class="n">RS</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="n">ORS</span><span class="o">=</span><span class="s">&quot;***&quot;</span><span class="p">}{</span><span class="n">print</span> <span class="err">$</span><span class="mi">0</span><span class="p">}</span><span class="err">&#39;</span> <span class="n">vfast</span>



<span class="err">用户自定义的变量</span>
<span class="err">在脚本中附值变量</span>
<span class="p">[</span><span class="n">root</span><span class="p">@</span><span class="n">VFAST</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">awk</span> <span class="err">&#39;</span><span class="n">BEGIN</span><span class="p">{</span>
<span class="o">&gt;</span> <span class="n">testing</span><span class="o">=</span><span class="s">&quot;this is a test&quot;</span>
<span class="o">&gt;</span> <span class="n">print</span> <span class="n">testing</span>
<span class="o">&gt;</span> <span class="n">testing</span><span class="o">=</span><span class="mi">45</span>
<span class="o">&gt;</span> <span class="n">print</span> <span class="n">testing</span>
<span class="o">&gt;</span> <span class="p">}</span><span class="err">&#39;</span>
<span class="n">this</span> <span class="n">is</span> <span class="n">a</span> <span class="n">test</span>
<span class="mi">45</span>


<span class="err">数学计算</span>

<span class="p">[</span><span class="n">root</span><span class="p">@</span><span class="n">VFAST</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">awk</span> <span class="err">&#39;</span><span class="n">BEGIN</span><span class="p">{</span><span class="n">x</span><span class="o">=</span><span class="mi">4</span><span class="p">;</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">3</span><span class="p">;</span><span class="n">print</span> <span class="n">x</span><span class="p">}</span><span class="err">&#39;</span>
<span class="mi">11</span>

<span class="err">在命令行中附值变量</span>

<span class="n">vim</span> <span class="n">script0</span>
<span class="n">BEGIN</span><span class="p">{</span><span class="n">FS</span><span class="o">=</span><span class="s">&quot;:&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="n">print</span> <span class="err">$</span><span class="n">n</span><span class="p">}</span>
<span class="p">[</span><span class="n">root</span><span class="p">@</span><span class="n">VFAST</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">awk</span> <span class="o">-</span><span class="n">f</span> <span class="n">script0</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span>
<span class="err">将$</span><span class="n">n</span><span class="err">变量附值为</span><span class="mi">1</span>


<span class="err">使用数组</span>
<span class="n">awk</span> <span class="err">使用关联数组，其不同于数字数组，他的索引值可以是任何文本字符串，不需要使用使用一系列的数字来标识数组中包含的数组元素。</span>
<span class="err">关联数组由引用各个值的混杂的字符串构成。每个索引必须唯一。且唯一标识分配给它的数据元素</span>

<span class="err">定义数组变量</span>
<span class="n">var</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">=</span><span class="n">element</span>
<span class="n">var</span><span class="err">是变量名称，</span><span class="n">index</span><span class="err">是关联数组的索引值，而</span><span class="n">element</span><span class="err">是数据元素值</span>
<span class="nl">EXAMPLES</span><span class="p">:</span>
<span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
<span class="n">var</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span>

<span class="p">[</span><span class="n">root</span><span class="p">@</span><span class="n">VFAST</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">awk</span> <span class="err">&#39;</span><span class="n">BEGIN</span><span class="p">{</span>
<span class="o">&gt;</span> <span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
<span class="o">&gt;</span> <span class="n">var</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span>
<span class="o">&gt;</span> <span class="n">total</span><span class="o">=</span><span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">var</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="o">&gt;</span> <span class="n">print</span> <span class="n">total</span>
<span class="o">&gt;</span> <span class="p">}</span><span class="err">&#39;</span>

<span class="err">通过计算结果为</span><span class="mi">3</span>
<span class="mi">3</span>


<span class="n">awk</span> <span class="err">&#39;</span><span class="n">NR</span><span class="o">==</span><span class="mi">1</span><span class="p">{</span><span class="n">print</span> <span class="err">$</span><span class="mi">2</span><span class="p">}</span><span class="err">&#39;</span> <span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">meminfo</span>  <span class="err">取</span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">memeinfo</span><span class="err">文件的第一列的第一行</span>
<span class="n">NR</span> <span class="err">指定行号</span>


<span class="err">打印第一行</span> <span class="err">第二行数值</span>

<span class="n">awk</span> <span class="err">&#39;</span><span class="n">NR</span><span class="o">==</span><span class="mi">1</span><span class="p">{</span><span class="n">t</span><span class="o">=</span><span class="err">$</span><span class="mi">2</span><span class="p">}</span><span class="n">NR</span><span class="o">==</span><span class="mi">2</span><span class="p">{</span><span class="n">f</span><span class="o">=</span><span class="err">$</span><span class="mi">2</span><span class="p">;</span><span class="n">print</span> <span class="n">f</span><span class="o">/</span><span class="n">t</span><span class="o">*</span><span class="mi">100</span><span class="p">}</span><span class="err">&#39;</span> <span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">meminfo</span>


<span class="n">vim</span> <span class="n">aa</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">3</span>
<span class="mi">4</span>

<span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span> <span class="n">sum</span> <span class="o">+=</span> <span class="err">$</span><span class="mi">1</span> <span class="p">}</span> <span class="n">END</span> <span class="p">{</span> <span class="n">print</span> <span class="n">sum</span><span class="p">}</span><span class="err">&#39;</span> <span class="n">aa</span>




<span class="n">awk</span> <span class="err">&#39;</span><span class="n">END</span><span class="p">{</span><span class="n">print</span> <span class="n">NR</span><span class="p">}</span><span class="err">&#39;</span> <span class="n">test</span>  <span class="err">统计</span><span class="n">test</span><span class="err">有多少行</span>
<span class="n">awk</span> <span class="err">&#39;</span><span class="n">END</span><span class="p">{</span><span class="n">print</span> <span class="err">$</span><span class="mi">0</span><span class="p">}</span><span class="err">&#39;</span> <span class="n">test</span>  <span class="err">打印最后一行</span>


<span class="n">awk</span> <span class="err">&#39;</span><span class="n">END</span><span class="p">{</span><span class="n">print</span> <span class="n">NF</span><span class="p">}</span><span class="err">&#39;</span> <span class="n">test</span>  <span class="err">统计列数</span>



<span class="mf">2.3</span><span class="p">.</span>     <span class="err">条件操作符</span><span class="o">:</span>


    <span class="o">&lt;</span><span class="err">、</span><span class="o">&lt;=</span><span class="err">、</span><span class="o">==</span><span class="err">、</span><span class="o">!=</span><span class="err">、</span><span class="o">&gt;=</span><span class="err">、</span><span class="o">~</span> <span class="err">匹配正则表达式、</span><span class="o">!~</span><span class="err">不匹配正则表达式</span>


<span class="err">匹配字符串</span>
<span class="o">==</span> <span class="err">精确匹配</span>
<span class="o">!=</span><span class="err">取反</span>

<span class="n">awk</span> <span class="o">-</span><span class="nl">F</span><span class="p">:</span> <span class="err">&#39;$</span><span class="mi">1</span><span class="o">==</span><span class="s">&quot;root&quot;</span><span class="p">{</span><span class="n">print</span> <span class="err">$</span><span class="mi">0</span><span class="p">}</span><span class="err">&#39;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span>
<span class="n">awk</span> <span class="o">-</span><span class="nl">F</span><span class="p">:</span> <span class="err">&#39;$</span><span class="mi">1</span><span class="o">!=</span><span class="s">&quot;root&quot;</span><span class="p">{</span><span class="n">print</span> <span class="err">$</span><span class="mi">0</span><span class="p">}</span><span class="err">&#39;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span>

<span class="o">~</span>
<span class="o">!~</span> <span class="err">模糊匹配</span>

<span class="n">awk</span> <span class="o">-</span><span class="nl">F</span><span class="p">:</span> <span class="err">&#39;$</span><span class="mi">1</span> <span class="o">~</span> <span class="s">&quot;ro&quot;</span><span class="p">{</span><span class="n">print</span> <span class="err">$</span><span class="mi">0</span><span class="p">}</span><span class="err">&#39;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span>

<span class="n">awk</span> <span class="o">-</span><span class="nl">F</span><span class="p">:</span> <span class="err">&#39;$</span><span class="mi">1</span> <span class="o">!~</span> <span class="s">&quot;ro&quot;</span><span class="p">{</span><span class="n">print</span> <span class="err">$</span><span class="mi">0</span><span class="p">}</span><span class="err">&#39;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span>


<span class="err">数字匹配</span>

<span class="o">&gt;</span> <span class="o">&lt;</span> <span class="o">&gt;=</span> <span class="o">&lt;=</span>   <span class="o">==</span>

<span class="n">vim</span> <span class="n">file</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">3</span>
<span class="mi">4</span>

<span class="n">awk</span> <span class="err">&#39;$</span><span class="mi">1</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">{</span><span class="n">print</span> <span class="err">$</span><span class="mi">0</span><span class="p">}</span><span class="err">&#39;</span> <span class="n">file</span>
<span class="n">awk</span> <span class="err">&#39;$</span><span class="mi">1</span><span class="o">&gt;=</span><span class="mi">2</span><span class="p">{</span><span class="n">print</span> <span class="err">$</span><span class="mi">0</span><span class="p">}</span><span class="err">&#39;</span> <span class="n">file</span>
<span class="n">awk</span> <span class="err">&#39;$</span><span class="mi">1</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">{</span><span class="n">print</span> <span class="err">$</span><span class="mi">0</span><span class="p">}</span><span class="err">&#39;</span> <span class="n">file</span>
<span class="n">awk</span> <span class="err">&#39;$</span><span class="mi">1</span><span class="o">&lt;=</span><span class="mi">2</span><span class="p">{</span><span class="n">print</span> <span class="err">$</span><span class="mi">0</span><span class="p">}</span><span class="err">&#39;</span> <span class="n">file</span>
<span class="n">awk</span> <span class="err">&#39;$</span><span class="mi">1</span><span class="o">==</span><span class="mi">2</span><span class="p">{</span><span class="n">print</span> <span class="err">$</span><span class="mi">0</span><span class="p">}</span><span class="err">&#39;</span> <span class="n">file</span>


    <span class="err">匹配</span><span class="o">:</span><span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span><span class="k">if</span> <span class="p">(</span><span class="err">$</span><span class="mi">4</span><span class="o">~/</span><span class="n">ASIMA</span><span class="o">/</span><span class="p">)</span> <span class="n">print</span> <span class="err">$</span><span class="mi">0</span><span class="p">}</span><span class="err">&#39;</span> <span class="n">temp</span> <span class="err">表示如果第四个域包含</span><span class="n">ASIMA</span><span class="err">，就打印整条</span>

    <span class="err">精确匹配</span><span class="o">:</span><span class="n">awk</span> <span class="err">&#39;$</span><span class="mi">3</span><span class="o">==</span><span class="s">&quot;48&quot;</span> <span class="p">{</span><span class="n">print</span> <span class="err">$</span><span class="mi">0</span><span class="p">}</span><span class="err">&#39;</span> <span class="n">temp</span>    <span class="err">只打印第</span><span class="mi">3</span><span class="err">域等于</span><span class="s">&quot;48&quot;</span><span class="err">的记录</span>

    <span class="err">不匹配</span><span class="o">:</span>  <span class="n">awk</span> <span class="err">&#39;$</span><span class="mi">0</span> <span class="o">!~</span> <span class="o">/</span><span class="n">ASIMA</span><span class="o">/</span><span class="err">&#39;</span> <span class="n">temp</span>      <span class="err">打印整条不包含</span><span class="n">ASIMA</span><span class="err">的记录</span>

    <span class="err">不等于</span><span class="o">:</span>  <span class="n">awk</span> <span class="err">&#39;$</span><span class="mi">1</span> <span class="o">!=</span> <span class="s">&quot;asima&quot;</span><span class="err">&#39;</span> <span class="n">temp</span>

    <span class="err">小于</span><span class="o">:</span>    <span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span><span class="k">if</span> <span class="p">(</span><span class="err">$</span><span class="mi">1</span><span class="o">&lt;</span><span class="err">$</span><span class="mi">2</span><span class="p">)</span> <span class="n">print</span> <span class="err">$</span><span class="mi">1</span> <span class="s">&quot;is smaller&quot;</span><span class="p">}</span><span class="err">&#39;</span> <span class="n">temp</span>

    <span class="err">设置大小写</span><span class="o">:</span> <span class="n">awk</span> <span class="err">&#39;</span><span class="o">/</span><span class="p">[</span><span class="n">Gg</span><span class="p">]</span><span class="n">reen</span><span class="o">/</span><span class="err">&#39;</span> <span class="n">temp</span>      <span class="err">打印整条包含</span><span class="n">Green</span><span class="err">，或者</span><span class="n">green</span><span class="err">的记录</span>

    <span class="err">任意字符</span><span class="o">:</span> <span class="n">awk</span> <span class="err">&#39;$</span><span class="mi">1</span> <span class="o">~/^</span><span class="p">...</span><span class="n">a</span><span class="o">/</span><span class="err">&#39;</span> <span class="n">temp</span>    <span class="err">打印第</span><span class="mi">1</span><span class="err">域中第四个字符是</span><span class="n">a</span><span class="err">的记录，符号’</span><span class="o">^</span><span class="err">’代表行首，符合’</span><span class="p">.</span><span class="err">’代表任意字符</span>

    <span class="err">或关系匹配</span><span class="o">:</span> <span class="n">awk</span> <span class="err">&#39;$</span><span class="mi">0</span><span class="o">~/</span><span class="p">(</span><span class="n">abc</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">efg</span><span class="p">)</span><span class="o">/</span><span class="err">&#39;</span> <span class="n">temp</span>   <span class="err">使用</span><span class="o">|</span><span class="err">时，语句需要括起来</span>

    <span class="n">AND</span><span class="err">与关系</span><span class="o">:</span>  <span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span><span class="k">if</span> <span class="p">(</span> <span class="err">$</span><span class="mi">1</span><span class="o">==</span><span class="s">&quot;a&quot;</span> <span class="o">&amp;&amp;</span> <span class="err">$</span><span class="mi">2</span><span class="o">==</span><span class="s">&quot;b&quot;</span> <span class="p">)</span> <span class="n">print</span> <span class="err">$</span><span class="mi">0</span><span class="p">}</span><span class="err">&#39;</span> <span class="n">temp</span>
    <span class="n">OR</span><span class="err">或关系</span><span class="o">:</span>   <span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span><span class="k">if</span> <span class="p">(</span><span class="err">$</span><span class="mi">1</span><span class="o">==</span><span class="s">&quot;a&quot;</span> <span class="o">||</span> <span class="err">$</span><span class="mi">1</span><span class="o">==</span><span class="s">&quot;b&quot;</span><span class="p">)</span> <span class="n">print</span> <span class="err">$</span><span class="mi">0</span><span class="p">}</span><span class="err">&#39;</span> <span class="n">temp</span>


<span class="n">awk</span> <span class="err">函数</span>

<span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span> <span class="k">if</span> <span class="p">(</span> <span class="err">$</span><span class="mi">1</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">)</span> <span class="n">print</span> <span class="err">$</span><span class="mi">1</span><span class="p">}</span><span class="err">&#39;</span>
<span class="mi">10</span>


<span class="n">awk</span> <span class="err">`</span><span class="p">{</span><span class="k">if</span> <span class="p">(</span><span class="err">$</span><span class="mi">1</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">)</span> <span class="n">print</span> <span class="err">$</span><span class="mi">1</span> <span class="o">*</span> <span class="mi">2</span><span class="p">}</span> <span class="n">data</span><span class="err">`</span>

<span class="mi">20</span>

<span class="n">or</span>

<span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span>
<span class="k">if</span> <span class="p">(</span><span class="err">$</span><span class="mi">1</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">)</span>
<span class="p">{</span>
<span class="n">x</span><span class="o">=</span><span class="err">$</span><span class="mi">1</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">print</span> <span class="n">x</span>
<span class="p">}}</span><span class="err">&#39;</span> <span class="n">data</span>



<span class="k">else</span>

<span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span> <span class="k">if</span> <span class="p">(</span> <span class="err">$</span><span class="mi">1</span> <span class="o">&gt;</span> <span class="mi">9</span> <span class="p">)</span> <span class="n">print</span> <span class="err">$</span><span class="mi">1</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span><span class="k">else</span> <span class="n">print</span> <span class="err">$</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span> <span class="p">}</span><span class="err">&#39;</span> <span class="n">data</span>


<span class="n">or</span>

<span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span><span class="k">if</span> <span class="p">(</span><span class="err">$</span><span class="mi">1</span><span class="o">&gt;</span><span class="mi">9</span><span class="p">)</span>
<span class="p">{</span>
   <span class="n">x</span><span class="o">=</span><span class="err">$</span><span class="mi">1</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">print</span> <span class="n">x</span>
<span class="p">}</span>
<span class="k">else</span>
  <span class="p">{</span>
    <span class="n">y</span><span class="o">=</span><span class="err">$</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span>
<span class="p">}}</span><span class="err">&#39;</span> <span class="n">data</span>







<span class="k">while</span><span class="err">语句</span>

<span class="k">while</span> <span class="p">(</span><span class="n">condition</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">satements</span>
<span class="p">}</span>



<span class="n">cat</span> <span class="n">data1</span>
<span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span>
<span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span>
<span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span>

<span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span>
<span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">while</span> <span class="p">(</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="p">)</span>
<span class="p">{</span>
 <span class="n">total</span> <span class="o">+=</span> <span class="err">$</span><span class="n">i</span>
 <span class="n">i</span><span class="o">++</span>
<span class="p">}</span>
<span class="n">print</span> <span class="n">total</span>
<span class="p">}</span><span class="err">&#39;</span> <span class="n">data1</span>




<span class="n">total</span> <span class="o">+=</span><span class="err">$</span><span class="n">i</span>
<span class="n">i</span><span class="o">++</span>
<span class="err">的意思是将</span><span class="n">data1</span><span class="err">中的</span><span class="mi">1</span> <span class="err">到</span><span class="mi">3</span> <span class="err">个字段累加</span>




<span class="k">break</span> <span class="k">continue</span>


<span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span>
<span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">while</span> <span class="p">(</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="p">)</span>
<span class="p">{</span>
 <span class="n">total</span> <span class="o">+=</span> <span class="err">$</span><span class="n">i</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">break</span>
 <span class="n">i</span><span class="o">++</span>
<span class="p">}</span>
<span class="n">print</span> <span class="n">total</span>
<span class="p">}</span><span class="err">&#39;</span> <span class="n">data1</span>


<span class="err">输出结果$</span><span class="mi">1</span> <span class="o">+</span> <span class="err">$</span><span class="mi">2</span>

<span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span>
<span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="p">{</span>
<span class="n">total</span> <span class="o">+=</span> <span class="err">$</span><span class="n">i</span>
<span class="p">}</span>
<span class="n">print</span> <span class="n">total</span>
<span class="p">}</span><span class="err">&#39;</span> <span class="n">data1</span>


<span class="err">输出结果</span>
<span class="err">$</span><span class="mi">1</span><span class="o">+</span><span class="err">$</span><span class="mi">2</span><span class="o">+</span><span class="err">$</span><span class="mi">3</span><span class="err">的和</span>


<span class="k">do</span><span class="o">-</span><span class="k">while</span>
<span class="err">在检查之前执行语句</span>
<span class="k">do</span>
<span class="p">{</span>
<span class="n">statements</span>
<span class="p">}</span><span class="k">while</span> <span class="p">(</span><span class="n">condition</span><span class="p">)</span>


<span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span>
<span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">do</span>
<span class="p">{</span>
<span class="n">total</span> <span class="o">+=</span> <span class="err">$</span><span class="n">i</span>
<span class="n">i</span><span class="o">++</span>
<span class="p">}</span><span class="k">while</span> <span class="p">(</span><span class="n">total</span> <span class="o">&lt;</span> <span class="mi">150</span><span class="p">)</span>
<span class="n">print</span> <span class="n">total</span><span class="p">}</span><span class="err">&#39;</span> <span class="n">data1</span>


<span class="err">判断</span><span class="n">total</span><span class="err">的值是否大于</span><span class="mi">150</span>  <span class="err">如果不大于</span><span class="mi">150</span><span class="err">和后一个字段累加</span> <span class="err">如果大于</span><span class="mi">150</span><span class="err">则输出该字段</span>  <span class="err">如果累加大于</span><span class="mi">150</span><span class="err">则不在往后累加</span>



<span class="err">关于</span><span class="k">while</span><span class="err">例子</span>

<span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span>
<span class="n">a</span><span class="o">=</span><span class="mi">0</span>
<span class="n">i</span><span class="o">=</span><span class="mi">1</span>
<span class="k">do</span>
<span class="p">{</span>
<span class="n">a</span><span class="o">+=</span><span class="err">$</span><span class="n">i</span>
<span class="n">i</span><span class="o">++</span>
<span class="p">}</span>
<span class="k">while</span> <span class="p">(</span><span class="n">a</span><span class="o">&gt;</span><span class="mi">150</span><span class="p">)</span>
<span class="n">print</span> <span class="n">a</span>
<span class="p">}</span><span class="err">&#39;</span> <span class="n">data</span>
<span class="mi">10</span>
<span class="mi">7</span>
<span class="mi">3</span>
<span class="p">[</span><span class="n">root</span><span class="p">@</span><span class="n">instructor</span> <span class="n">tmp</span><span class="p">]</span><span class="err">#</span> <span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span>
<span class="n">a</span><span class="o">=</span><span class="mi">0</span>
<span class="n">i</span><span class="o">=</span><span class="mi">1</span>
<span class="k">do</span>
<span class="p">{</span>
<span class="n">a</span><span class="o">+=</span><span class="err">$</span><span class="n">i</span>
<span class="n">i</span><span class="o">++</span>
<span class="p">}</span>
<span class="k">while</span> <span class="p">(</span><span class="n">a</span><span class="o">&lt;</span><span class="mi">150</span><span class="p">)</span>
<span class="n">print</span> <span class="n">a</span>
<span class="p">}</span><span class="err">&#39;</span> <span class="n">data</span>
<span class="mi">263</span>
<span class="mi">187</span>
<span class="mi">287</span>

<span class="err">错误死循环</span>

<span class="p">[</span><span class="n">root</span><span class="p">@</span><span class="n">instructor</span> <span class="n">tmp</span><span class="p">]</span><span class="err">#</span> <span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span>
<span class="n">a</span><span class="o">=</span><span class="mi">0</span>
<span class="n">i</span><span class="o">=</span><span class="mi">1</span>
<span class="k">do</span>
<span class="p">{</span>
<span class="n">a</span><span class="o">+=</span><span class="err">$</span><span class="n">i</span>
<span class="n">i</span><span class="o">++</span>
<span class="p">}</span>
<span class="k">while</span> <span class="p">(</span><span class="n">a</span><span class="o">&gt;</span><span class="mi">150</span><span class="p">)</span>
<span class="n">print</span> <span class="n">a</span>
<span class="p">}</span><span class="err">&#39;</span> <span class="n">data</span>



<span class="p">[</span><span class="n">root</span><span class="p">@</span><span class="n">instructor</span> <span class="n">tmp</span><span class="p">]</span><span class="err">#</span> <span class="n">cat</span> <span class="n">data1</span>
<span class="mi">100</span> <span class="mi">110</span> <span class="mi">20</span> 
<span class="mi">160</span> <span class="mi">150</span> <span class="mi">140</span>
<span class="mi">130</span> <span class="mi">10</span> <span class="mi">20</span>



<span class="err">当第二行$</span><span class="mi">1</span><span class="err">是</span><span class="mi">160</span>  <span class="err">符合</span><span class="k">while</span><span class="err">条件为真，则继续累加$</span><span class="mi">2</span>  <span class="err">依然大于</span><span class="mi">150</span>  <span class="err">继续累加$</span><span class="mi">3</span><span class="err">依然大于</span><span class="mi">150</span>  <span class="err">条件永远为真</span>  <span class="err">自然不会跳出循环</span>

<span class="n">system</span><span class="err">函数</span>
<span class="err">在</span><span class="n">awk</span><span class="err">中调用系统</span><span class="n">shell</span><span class="err">命令</span>

<span class="n">awk</span> <span class="err">&#39;</span><span class="n">BEGIN</span><span class="p">{</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;echo hello&quot;</span><span class="p">)}</span><span class="err">&#39;</span>
<span class="n">hello</span>


<span class="n">or</span>
<span class="p">[</span><span class="n">root</span><span class="p">@</span><span class="n">baism</span> <span class="err">桌面</span><span class="p">]</span><span class="err">#</span> <span class="n">awk</span> <span class="err">&#39;</span><span class="n">BEGIN</span><span class="p">{</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;date&quot;</span><span class="p">)}</span><span class="err">&#39;</span>
<span class="mi">2014</span><span class="err">年</span> <span class="mo">04</span><span class="err">月</span> <span class="mi">30</span><span class="err">日</span> <span class="err">星期三</span> <span class="mi">11</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">23</span> <span class="n">CST</span>

<span class="err">注意</span> <span class="err">一定要把</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="err">中的命令用双引号引起来</span>




<span class="n">cat</span> <span class="n">a</span><span class="p">.</span><span class="n">txt</span>
<span class="mf">192.168.1</span>
<span class="mf">192.168.2</span>
<span class="mf">192.168.3</span>
<span class="mf">172.16.3</span>
<span class="mf">192.16.1</span>
<span class="mf">192.16.2</span>
<span class="mf">192.16.3</span>
<span class="mf">10.0.4</span>
<span class="err">期望输出</span>
<span class="mf">192.168.1</span><span class="o">-</span><span class="mf">192.168.3</span>
<span class="mf">172.16.3</span>
<span class="mf">192.16.3</span><span class="o">-</span><span class="mf">192.16.1</span>
<span class="mf">10.0.4</span>

<span class="p">[</span><span class="n">root</span><span class="p">@</span><span class="n">instructor</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">awk</span> <span class="err">&#39;</span><span class="n">BEGIN</span><span class="p">{</span><span class="n">RS</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">;</span><span class="n">FS</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="n">OFS</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">}{</span><span class="n">print</span> <span class="err">$</span><span class="mi">1</span> <span class="s">&quot;-&quot;</span> <span class="err">$</span><span class="mi">3</span><span class="p">,</span><span class="err">$</span><span class="mi">4</span><span class="p">,</span><span class="err">$</span><span class="mi">7</span> <span class="s">&quot;-&quot;</span> <span class="err">$</span><span class="mi">4</span><span class="p">,</span><span class="err">$</span><span class="mi">8</span><span class="p">}</span><span class="err">&#39;</span> <span class="n">aa</span><span class="p">.</span><span class="n">txt</span> 
<span class="mf">192.168.1</span><span class="o">-</span><span class="mf">192.168.3</span>
<span class="mf">172.16.3</span>
<span class="mf">192.16.3</span><span class="o">-</span><span class="mf">172.16.3</span>
<span class="mf">10.0.4</span>

<span class="n">zhangsan</span>
<span class="n">Beijing</span><span class="p">.</span><span class="n">China</span>
<span class="n">san</span><span class="mf">@163.</span><span class="n">com</span>
<span class="mo">010</span><span class="o">-</span><span class="mi">12345678</span>

<span class="n">wangwu</span>
<span class="n">Tianjin</span><span class="p">.</span><span class="n">China</span>
<span class="n">wu</span><span class="mf">@163.</span><span class="n">com</span>
<span class="mo">010</span><span class="o">-</span><span class="mi">23456789</span>

<span class="n">awk</span> <span class="err">&#39;</span><span class="n">BEGIN</span><span class="p">{</span><span class="n">RS</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">;</span><span class="n">FS</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">}{</span><span class="n">print</span> <span class="s">&quot;~~~~~~~~~~~~~~~~~~~~~~~~&quot;</span><span class="p">}{</span><span class="n">print</span> <span class="err">$</span><span class="mi">1</span><span class="p">,</span><span class="err">$</span><span class="mi">2</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="err">$</span><span class="mi">3</span><span class="p">,</span><span class="err">$</span><span class="mi">4</span><span class="p">}</span><span class="err">&#39;</span> <span class="n">data</span>
</pre></div>


<h2 id="awk_1">awk分析例子</h2>
<div class="codehilite"><pre><span></span><span class="nv">Linux</span> <span class="nv">Web</span>服务器网站故障分析常用的命令

系统连接状态篇：
<span class="mi">1</span>.查看<span class="nv">TCP</span>连接状态
<span class="nv">netstat</span> <span class="o">-</span><span class="nv">nat</span> <span class="o">|</span><span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">{print $6}</span><span class="s1">&#39;</span><span class="o">|</span><span class="nv">sort</span><span class="o">|</span><span class="nv">uniq</span> <span class="o">-</span><span class="nv">c</span><span class="o">|</span><span class="nv">sort</span> <span class="o">-</span><span class="nv">rn</span>
<span class="nv">netstat</span> <span class="o">-</span><span class="nv">n</span> <span class="o">|</span> <span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">/^tcp/ {++S[$NF]};END {for(a in S) print a, S[a]}</span><span class="s1">&#39;</span> 或
<span class="nv">netstat</span> <span class="o">-</span><span class="nv">n</span> <span class="o">|</span> <span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">/^tcp/ {++state[$NF]}; END {for(key in state) print key,&quot;</span><span class="se">\t</span><span class="s">&quot;,state[key]}</span><span class="s1">&#39;</span>
<span class="nv">netstat</span> <span class="o">-</span><span class="nv">n</span> <span class="o">|</span> <span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">/^tcp/ {++arr[$NF]};END {for(k in arr) print k,&quot;t&quot;,arr[k]}</span><span class="s1">&#39;</span>
<span class="nv">netstat</span> <span class="o">-</span><span class="nv">n</span> <span class="o">|</span><span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">/^tcp/ {print $NF}</span><span class="s1">&#39;</span> <span class="o">|</span><span class="nv">sort</span><span class="o">|</span><span class="nv">uniq</span> <span class="o">-</span><span class="nv">c</span><span class="o">|</span><span class="nv">sort</span> <span class="o">-</span><span class="nv">rn</span>
<span class="nv">netstat</span> <span class="o">-</span><span class="nv">ant</span> <span class="o">|</span> <span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">{print $NF}</span><span class="s1">&#39;</span> <span class="o">|</span> <span class="nv">grep</span> <span class="o">-</span><span class="nv">v</span> <span class="s1">&#39;</span><span class="s">[a-z]</span><span class="s1">&#39;</span> <span class="o">|</span> <span class="nv">sort</span> <span class="o">|</span> <span class="nv">uniq</span> <span class="o">-</span><span class="nv">c</span>

<span class="mi">2</span>.查找请求数请<span class="mi">20</span>个<span class="nv">IP</span>（常用于查找攻来源）：
<span class="nv">netstat</span> <span class="o">-</span><span class="nv">anlp</span><span class="o">|</span><span class="nv">grep</span> <span class="mi">80</span><span class="o">|</span><span class="nv">grep</span> <span class="nv">tcp</span><span class="o">|</span><span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">{print $5}</span><span class="s1">&#39;</span><span class="o">|</span><span class="nv">awk</span> <span class="o">-</span><span class="nv">F</span>: <span class="s1">&#39;</span><span class="s">{print $1}</span><span class="s1">&#39;</span><span class="o">|</span><span class="nv">sort</span><span class="o">|</span><span class="nv">uniq</span> <span class="o">-</span><span class="nv">c</span><span class="o">|</span><span class="nv">sort</span> <span class="o">-</span><span class="nv">nr</span><span class="o">|</span><span class="nv">head</span> <span class="o">-</span><span class="nv">n20</span>
<span class="nv">netstat</span> <span class="o">-</span><span class="nv">ant</span> <span class="o">|</span><span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">/:80/{split($5,ip,&quot;:&quot;);++A[ip[1]]}END{for(i in A) print A[i],i}</span><span class="s1">&#39;</span> <span class="o">|</span><span class="nv">sort</span> <span class="o">-</span><span class="nv">rn</span><span class="o">|</span><span class="nv">head</span> <span class="o">-</span><span class="nv">n20</span>

<span class="mi">3</span>.用<span class="nv">tcpdump</span>嗅探<span class="mi">80</span>端口的访问看看谁最高
<span class="nv">tcpdump</span> <span class="o">-</span><span class="nv">i</span> <span class="nv">eth0</span> <span class="o">-</span><span class="nv">tnn</span> <span class="nv">dst</span> <span class="nv">port</span> <span class="mi">80</span> <span class="o">-</span><span class="nv">c</span> <span class="mi">1000</span> <span class="o">|</span> <span class="nv">awk</span> <span class="o">-</span><span class="nv">F</span><span class="s2">&quot;</span><span class="s">.</span><span class="s2">&quot;</span> <span class="s1">&#39;</span><span class="s">{print $1&quot;.&quot;$2&quot;.&quot;$3&quot;.&quot;$4}’ | sort | uniq -c | sort -nr |head -20</span>

<span class="mi">4</span>.查找较多<span class="nv">time_wait</span>连接
<span class="nv">netstat</span> <span class="o">-</span><span class="nv">n</span><span class="o">|</span><span class="nv">grep</span> <span class="nv">TIME_WAIT</span><span class="o">|</span><span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">{print $5}</span><span class="s1">&#39;</span><span class="o">|</span><span class="nv">sort</span><span class="o">|</span><span class="nv">uniq</span> <span class="o">-</span><span class="nv">c</span><span class="o">|</span><span class="nv">sort</span> <span class="o">-</span><span class="nv">rn</span><span class="o">|</span><span class="nv">head</span> <span class="o">-</span><span class="nv">n20</span>

<span class="mi">5</span>.找查较多的<span class="nv">SYN</span>连接
<span class="nv">netstat</span> <span class="o">-</span><span class="nv">an</span> <span class="o">|</span> <span class="nv">grep</span> <span class="nv">SYN</span> <span class="o">|</span> <span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">{print $5}</span><span class="s1">&#39;</span> <span class="o">|</span> <span class="nv">awk</span> <span class="o">-</span><span class="nv">F</span>: <span class="s1">&#39;</span><span class="s">{print $1}’ | sort | uniq -c | sort -nr | more</span>

<span class="mi">6</span>.根据端口列进程
<span class="nv">netstat</span> <span class="o">-</span><span class="nv">ntlp</span> <span class="o">|</span> <span class="nv">grep</span> <span class="mi">80</span> <span class="o">|</span> <span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">{print $7}</span><span class="s1">&#39;</span> <span class="o">|</span> <span class="nv">cut</span> <span class="o">-</span><span class="nv">d</span><span class="o">/</span> <span class="o">-</span><span class="nv">f1</span>



网站日志分析篇<span class="mi">1</span>（<span class="nv">Apache</span>）：
<span class="mi">1</span>.获得访问前<span class="mi">10</span>位的<span class="nv">ip</span>地址
<span class="nv">cat</span> <span class="nv">access</span>.<span class="nv">log</span><span class="o">|</span><span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">{print $1}’|sort|uniq -c|sort -nr|head -10</span>
<span class="nv">cat</span> <span class="nv">access</span>.<span class="nv">log</span><span class="o">|</span><span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">{counts[$(11)]+=1}; END {for(url in counts) print counts[url], url}’</span>

<span class="mi">2</span>.访问次数最多的文件或页面,取前<span class="mi">20</span>
<span class="nv">cat</span> <span class="nv">access</span>.<span class="nv">log</span><span class="o">|</span><span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">{print $11}’|sort|uniq -c|sort -nr|head -20</span>

<span class="mi">3</span>.列出传输最大的几个<span class="nv">exe</span>文件（分析下载站的时候常用）
<span class="nv">cat</span> <span class="nv">access</span>.<span class="nv">log</span> <span class="o">|</span><span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">($7~/.exe/){print $10 &quot; &quot; $1 &quot; &quot; $4 &quot; &quot; $7}’|sort -nr|head -20</span>

<span class="mi">4</span>.列出输出大于<span class="mi">200000</span><span class="nv">byte</span><span class="ss">(</span>约<span class="mi">200</span><span class="nv">kb</span><span class="ss">)</span>的<span class="nv">exe</span>文件以及对应文件发生次数
<span class="nv">cat</span> <span class="nv">access</span>.<span class="nv">log</span> <span class="o">|</span><span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">($10 &gt; 200000 &amp;&amp; $7~/.exe/){print $7}’|sort -n|uniq -c|sort -nr|head -100</span>

<span class="mi">5</span>.如果日志最后一列记录的是页面文件传输时间，则有列出到客户端最耗时的页面
<span class="nv">cat</span> <span class="nv">access</span>.<span class="nv">log</span> <span class="o">|</span><span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">($7~/.php/){print $NF &quot; &quot; $1 &quot; &quot; $4 &quot; &quot; $7}’|sort -nr|head -100</span>

<span class="mi">6</span>.列出最最耗时的页面<span class="ss">(</span>超过<span class="mi">60</span>秒的<span class="ss">)</span>的以及对应页面发生次数
<span class="nv">cat</span> <span class="nv">access</span>.<span class="nv">log</span> <span class="o">|</span><span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">($NF &gt; 60 &amp;&amp; $7~/.php/){print $7}’|sort -n|uniq -c|sort -nr|head -100</span>

<span class="mi">7</span>.列出传输时间超过 <span class="mi">30</span> 秒的文件
<span class="nv">cat</span> <span class="nv">access</span>.<span class="nv">log</span> <span class="o">|</span><span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">($NF &gt; 30){print $7}’|sort -n|uniq -c|sort -nr|head -20</span>

<span class="mi">8</span>.统计网站流量（<span class="nv">G</span><span class="ss">)</span>
<span class="nv">cat</span> <span class="nv">access</span>.<span class="nv">log</span> <span class="o">|</span><span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">{sum+=$10} END {print sum/1024/1024/1024}’</span>

<span class="mi">9</span>.统计<span class="mi">404</span>的连接
<span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">($9 ~/404/)’ access.log | awk </span><span class="s1">&#39;</span>{<span class="nv">print</span> <span class="mh">$9</span>,<span class="mh">$7</span>}’ <span class="o">|</span> <span class="nv">sort</span>

<span class="mi">10</span>. 统计<span class="nv">http</span> <span class="nv">status</span>
<span class="nv">cat</span> <span class="nv">access</span>.<span class="nv">log</span> <span class="o">|</span><span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">{counts[$(9)]+=1}; END {for(code in counts) print code, counts[code]}</span><span class="s1">&#39;</span>
<span class="nv">cat</span> <span class="nv">access</span>.<span class="nv">log</span> <span class="o">|</span><span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">{print $9}</span><span class="s1">&#39;</span><span class="o">|</span><span class="nv">sort</span><span class="o">|</span><span class="nv">uniq</span> <span class="o">-</span><span class="nv">c</span><span class="o">|</span><span class="nv">sort</span> <span class="o">-</span><span class="nv">rn</span>

<span class="mi">10</span>.蜘蛛分析，查看是哪些蜘蛛在抓取内容。
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">sbin</span><span class="o">/</span><span class="nv">tcpdump</span> <span class="o">-</span><span class="nv">i</span> <span class="nv">eth0</span> <span class="o">-</span><span class="nv">l</span> <span class="o">-</span><span class="nv">s</span> <span class="mi">0</span> <span class="o">-</span><span class="nv">w</span> <span class="o">-</span> <span class="nv">dst</span> <span class="nv">port</span> <span class="mi">80</span> <span class="o">|</span> <span class="nv">strings</span> <span class="o">|</span> <span class="nv">grep</span> <span class="o">-</span><span class="nv">i</span> <span class="nv">user</span><span class="o">-</span><span class="nv">agent</span> <span class="o">|</span> <span class="nv">grep</span> <span class="o">-</span><span class="nv">i</span> <span class="o">-</span><span class="nv">E</span> 
<span class="s1">&#39;</span><span class="s">bot|crawler|slurp|spider</span><span class="s1">&#39;</span>

网站日分析<span class="mi">2</span><span class="ss">(</span><span class="nv">Squid</span>篇）按域统计流量
<span class="nv">zcat</span> <span class="nv">squid_access</span>.<span class="nv">log</span>.<span class="nv">tar</span>.<span class="nv">gz</span><span class="o">|</span> <span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">{print $10,$7}</span><span class="s1">&#39;</span> <span class="o">|</span><span class="nv">awk</span> <span class="s1">&#39;</span><span class="s">BEGIN{FS=&quot;[ /]&quot;}{trfc[$4]+=$1}END</span>
{<span class="k">for</span><span class="ss">(</span><span class="nv">domain</span> <span class="nv">in</span> <span class="nv">trfc</span><span class="ss">)</span>{<span class="nv">printf</span> <span class="s2">&quot;</span><span class="s">%st%dn</span><span class="s2">&quot;</span>,<span class="nv">domain</span>,<span class="nv">trfc</span>[<span class="nv">domain</span>]}}<span class="s1">&#39;</span>

数据库篇
<span class="mi">1</span>.查看数据库执行的<span class="nv">sql</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">sbin</span><span class="o">/</span><span class="nv">tcpdump</span> <span class="o">-</span><span class="nv">i</span> <span class="nv">eth0</span> <span class="o">-</span><span class="nv">s</span> <span class="mi">0</span> <span class="o">-</span><span class="nv">l</span> <span class="o">-</span><span class="nv">w</span> <span class="o">-</span> <span class="nv">dst</span> <span class="nv">port</span> <span class="mi">3306</span> <span class="o">|</span> <span class="nv">strings</span> <span class="o">|</span> <span class="nv">egrep</span> <span class="o">-</span><span class="nv">i</span> <span class="s1">&#39;</span><span class="s">SELECT|UPDATE|DELETE</span>
<span class="o">|</span><span class="nv">INSERT</span><span class="o">|</span><span class="nv">SET</span><span class="o">|</span><span class="nv">COMMIT</span><span class="o">|</span><span class="nv">ROLLBACK</span><span class="o">|</span><span class="nv">CREATE</span><span class="o">|</span><span class="nv">DROP</span><span class="o">|</span><span class="nv">ALTER</span><span class="o">|</span><span class="nv">CALL</span><span class="s1">&#39;</span>

系统<span class="nv">Debug</span>分析篇
<span class="mi">1</span>.调试命令
<span class="nv">strace</span> <span class="o">-</span><span class="nv">p</span> <span class="nv">pid</span>
<span class="mi">2</span>.跟踪指定进程的<span class="nv">PID</span>
<span class="nv">gdb</span> <span class="o">-</span><span class="nv">p</span> <span class="nv">pid</span>
</pre></div>


<h2 id="_3">找隐藏文件</h2>
<div class="codehilite"><pre><span></span><span class="n">ls</span> <span class="o">-</span><span class="n">AF</span> <span class="o">|</span><span class="n">grep</span> <span class="s1">&#39;^\.&#39;</span>  <span class="err">只显示隐藏文件</span>
<span class="n">find</span> <span class="o">-</span><span class="n">name</span> <span class="s1">&#39;.?*&#39;</span>
</pre></div>


<h2 id="expect">expect密钥</h2>
<div class="codehilite"><pre><span></span>生成密钥文件  <span class="nv">ssh</span><span class="o">-</span><span class="nv">keygen</span> <span class="o">-</span><span class="nv">q</span> <span class="o">-</span><span class="nv">t</span> <span class="nv">rsa</span> <span class="o">-</span><span class="nv">N</span> <span class="s2">&quot;&quot;</span> <span class="o">-</span><span class="nv">f</span> <span class="o">/</span><span class="nv">root</span><span class="o">/</span>.<span class="nv">ssh</span><span class="o">/</span><span class="nv">id_rsa</span>
<span class="nv">yum</span> <span class="nv">install</span> <span class="nv">expect</span>

<span class="nv">expect</span> <span class="s2">&quot;</span><span class="s">*</span><span class="s2">&quot;</span>   匹配所有，空行等等。

#<span class="o">!/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">expect</span>
<span class="nv">set</span> <span class="nv">ip</span> [<span class="nv">lindex</span> <span class="mh">$a</span><span class="nv">rgv</span> <span class="mi">0</span>]
<span class="nv">set</span> <span class="nv">pass</span> [<span class="nv">lindex</span> <span class="mh">$a</span><span class="nv">rgv</span> <span class="mi">1</span>]
<span class="nv">spawn</span>  <span class="nv">ssh</span><span class="o">-</span><span class="nv">copy</span><span class="o">-</span><span class="nv">id</span> <span class="o">-</span><span class="nv">i</span> <span class="o">/</span><span class="nv">root</span><span class="o">/</span>.<span class="nv">ssh</span><span class="o">/</span><span class="nv">id_rsa</span>.<span class="nv">pub</span> $<span class="nv">ip</span>
<span class="nv">expect</span> {
    <span class="s2">&quot;</span><span class="s">(yes/no)?</span><span class="s2">&quot;</span> {
        <span class="k">send</span> <span class="s2">&quot;</span><span class="s">yes</span><span class="se">\n</span><span class="s2">&quot;</span>
           <span class="nv">expect</span> <span class="s2">&quot;</span><span class="s">password:</span><span class="s2">&quot;</span> {
            <span class="k">send</span> <span class="s2">&quot;</span><span class="s">$pass</span><span class="se">\n</span><span class="s2">&quot;</span>
           }
    }

    <span class="s2">&quot;</span><span class="s">password:</span><span class="s2">&quot;</span> {
        <span class="k">send</span> <span class="s2">&quot;</span><span class="s">$pass</span><span class="se">\n</span><span class="s2">&quot;</span>
    }
}
<span class="nv">expect</span> <span class="nv">eof</span>

<span class="nv">chmod</span> <span class="nv">expect_l1</span>.<span class="nv">sh</span>
.<span class="o">/</span><span class="nv">expect_l1</span>.<span class="nv">sh</span> <span class="nv">ip</span> <span class="nv">pass</span>
注意，不是<span class="nv">bash</span>脚本，不能<span class="nv">sh</span> <span class="nv">except_l1</span>.<span class="nv">sh</span>
<span class="o">-----------------------------------</span>
<span class="nv">sudo</span> 
#<span class="o">!/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">expect</span>
<span class="nv">set</span> <span class="nb">timeout</span> <span class="mi">10</span>
<span class="nv">spawn</span> <span class="nv">sudo</span> <span class="o">-</span><span class="nv">i</span>
<span class="nv">expect</span> <span class="s2">&quot;</span><span class="s">*password*</span><span class="s2">&quot;</span>
<span class="k">send</span> <span class="s2">&quot;</span><span class="s">Tm121#^gnaM</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="nv">interact</span>   #执行完成后保持交互状态，把控制权交给控制台

命令行 <span class="nv">expect</span> <span class="o">-</span><span class="nv">c</span> <span class="s2">&quot;</span><span class="s">spawn sudo -i;expect </span><span class="s2">&quot;</span><span class="o">*</span><span class="nv">password</span><span class="o">*</span><span class="s2">&quot;</span><span class="s">;send </span><span class="s2">&quot;</span><span class="nv">Tm121</span>#<span class="o">^</span><span class="nv">gnaM</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s">;interact</span><span class="s2">&quot;</span>
</pre></div>


<h2 id="select">select交互</h2>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="nv">PS3</span><span class="o">=</span><span class="s2">&quot;make your choice in (1-4): &quot;</span>
<span class="k">select</span> i in www groad net <span class="nb">exit</span>
<span class="k">do</span>
    <span class="k">case</span> <span class="nv">$i</span> in
         www<span class="o">)</span> <span class="nb">echo</span> <span class="s2">&quot;1-www&quot;</span><span class="p">;;</span>
         groad<span class="o">)</span> <span class="nb">echo</span> <span class="s2">&quot;2-groad&quot;</span><span class="p">;;</span>
         net<span class="o">)</span> <span class="nb">echo</span> <span class="s2">&quot;3-net&quot;</span><span class="p">;;</span>
         <span class="nb">exit</span><span class="o">)</span> exit<span class="p">;;</span>
    <span class="k">esac</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>

<h2 id="_4">命令重定向</h2>
<div class="codehilite"><pre><span></span><span class="o">|</span><span class="w"> </span><span class="n">管道符接收标准输出</span><span class="err">，</span><span class="n">arping</span><span class="w"> </span><span class="o">-</span><span class="n">h</span><span class="w"> </span><span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">tail</span><span class="w"> </span><span class="o">-</span><span class="n">n</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="p">,</span><span class="n">这样就可以接受标准错误输出</span><span class="err">（</span><span class="n">标准错误输出</span><span class="err">（</span><span class="n">stderr</span><span class="err">）</span><span class="n">默认也是输出到屏幕</span><span class="err">）</span><span class="w"></span>

<span class="mi">1</span><span class="err">，</span><span class="n">标准输入的控制</span><span class="w"></span>
<span class="n">语法</span><span class="err">：</span><span class="n">命令</span><span class="o">&lt;</span><span class="w"> </span><span class="n">文件将文件做为命令的输入</span><span class="err">。</span><span class="w"></span>
<span class="n">例如</span><span class="err">：</span><span class="w">   </span><span class="n">mail</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="w"> </span><span class="err">“</span><span class="n">mail</span><span class="w"> </span><span class="n">test</span><span class="err">”</span><span class="w"> </span><span class="n">test</span><span class="nv">@ahlinux</span><span class="p">.</span><span class="n">com</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">file1</span><span class="w"></span>
<span class="n">将文件file1</span><span class="w"> </span><span class="n">当做信件的内容</span><span class="err">，</span><span class="n">主题名称为mail</span><span class="w"> </span><span class="n">test</span><span class="err">，</span><span class="n">送给收信人</span><span class="err">。</span><span class="w"></span>

<span class="mi">2</span><span class="err">，</span><span class="n">标准输出的控制</span><span class="w"></span>
<span class="n">语法</span><span class="err">：</span><span class="n">命令</span><span class="o">&gt;</span><span class="w"> </span><span class="n">文件将命令的执行结果送至指定的文件中</span><span class="err">。</span><span class="w"></span>
<span class="n">例如</span><span class="err">：</span><span class="w">    </span><span class="n">ls</span><span class="w"> </span><span class="o">-</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">list</span><span class="w"></span>
<span class="n">将执行</span><span class="err">“</span><span class="n">ls</span><span class="w"> </span><span class="o">-</span><span class="n">l</span><span class="err">”</span><span class="w"> </span><span class="n">命令的结果写入文件list</span><span class="w"> </span><span class="n">中</span><span class="err">。</span><span class="w"></span>

<span class="n">语法</span><span class="err">：</span><span class="n">命令</span><span class="o">&gt;</span><span class="err">!</span><span class="w"> </span><span class="n">文件将命令的执行结果送至指定的文件中</span><span class="err">，</span><span class="n">若文件已经存在</span><span class="err">，</span><span class="n">则覆盖</span><span class="err">。</span><span class="w"></span>
<span class="n">例如</span><span class="err">：</span><span class="w">    </span><span class="n">ls</span><span class="w"> </span><span class="o">-</span><span class="n">lg</span><span class="w"> </span><span class="o">&gt;</span><span class="err">!</span><span class="w"> </span><span class="n">list</span><span class="w"> </span>
<span class="n">将执行</span><span class="err">“</span><span class="n">ls</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lg</span><span class="err">”</span><span class="w"> </span><span class="n">命令的结果覆盖写入文件list</span><span class="w"> </span><span class="n">中</span><span class="err">。</span><span class="w"></span>

<span class="n">语法</span><span class="err">：</span><span class="n">命令</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">文件将命令执行时屏幕上所产生的任何信息写入指定的文件中</span><span class="err">。</span><span class="w"></span>
<span class="n">例如</span><span class="err">：</span><span class="n">cc</span><span class="w"> </span><span class="n">file1</span><span class="p">.</span><span class="n">c</span><span class="w"> </span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">error</span><span class="w"></span>
<span class="n">将编译file1</span><span class="p">.</span><span class="n">c</span><span class="w"> </span><span class="n">文件时所产生的任何信息写入文件error</span><span class="w"> </span><span class="n">中</span><span class="err">。</span><span class="w"></span>

<span class="n">语法</span><span class="err">：</span><span class="n">命令</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">文件将命令执行的结果附加到指定的文件中</span><span class="err">。</span><span class="w"></span>
<span class="n">例如</span><span class="err">：</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lag</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">list</span><span class="w"></span>
<span class="n">将执行</span><span class="err">“</span><span class="n">ls</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lag</span><span class="err">”</span><span class="w"> </span><span class="n">命令的结果附加到文件list</span><span class="w"> </span><span class="n">中</span><span class="err">。</span><span class="w"></span>

<span class="n">语法</span><span class="err">：</span><span class="n">命令</span><span class="w"> </span><span class="o">&gt;&gt;&amp;</span><span class="w"> </span><span class="n">文件将命令执行时屏幕上所产生的任何信息附加到指定的文件中</span><span class="err">。</span><span class="w"></span>
<span class="n">例如</span><span class="err">：</span><span class="w"> </span><span class="n">cc</span><span class="w"> </span><span class="n">file2</span><span class="p">.</span><span class="n">c</span><span class="w"> </span><span class="o">&gt;&gt;&amp;</span><span class="w"> </span><span class="n">error</span><span class="w"></span>
<span class="n">将编译file2</span><span class="p">.</span><span class="n">c</span><span class="w"> </span><span class="n">文件时屏幕所产生的任何信息附加到文件error</span><span class="w"> </span><span class="n">中</span><span class="err">。</span><span class="w"></span>

<span class="n">关于输入</span><span class="err">、</span><span class="n">输出和错误输出</span><span class="w"></span>

<span class="n">在字符终端环境中</span><span class="err">，</span><span class="n">标准输入</span><span class="o">/</span><span class="n">标准输出的概念很好理解</span><span class="err">。</span><span class="n">输入即指对一个应用程序或命令的输入</span><span class="err">，</span><span class="n">无论是从键盘输入还是从别的文件输入</span><span class="err">；</span><span class="w"></span>
<span class="n">输出即指应用程序或命令产生的一些信息</span><span class="err">；</span><span class="n">与</span><span class="w"> </span><span class="n">Windows</span><span class="w"> </span><span class="n">系统下不同的是</span><span class="err">，</span><span class="n">Linux</span><span class="w"> </span><span class="n">系统下还有一个标准错误输出的概念</span><span class="err">，</span><span class="n">这个概念主要是</span><span class="w"></span>
<span class="n">为程序调试和系统维护目的而设置的</span><span class="err">，</span><span class="n">错误输出于标准输出分开可以让一些高级的错误信息不干扰正常的输出信息</span><span class="err">，</span><span class="n">从而方便一般用户的使用</span><span class="err">。</span><span class="w"></span>

<span class="n">在</span><span class="w"> </span><span class="n">Linux</span><span class="w"> </span><span class="n">系统中</span><span class="err">：</span><span class="n">标准输入</span><span class="err">（</span><span class="n">stdin</span><span class="err">）</span><span class="n">默认为键盘输入</span><span class="err">；</span><span class="n">标准输出</span><span class="err">（</span><span class="n">stdout</span><span class="err">）</span><span class="n">默认为屏幕输出</span><span class="err">；</span><span class="n">标准错误输出</span><span class="err">（</span><span class="n">stderr</span><span class="err">）</span><span class="n">默认也是输出到</span><span class="w"></span>
<span class="n">屏幕</span><span class="err">（</span><span class="n">上面的</span><span class="w"> </span><span class="n">std</span><span class="w"> </span><span class="n">表示</span><span class="w"> </span><span class="n">standard</span><span class="err">）。</span><span class="n">在</span><span class="w"> </span><span class="n">BASH</span><span class="w"> </span><span class="n">中使用这些概念时一般将标准输出表示为</span><span class="w"> </span><span class="mi">1</span><span class="err">，</span><span class="n">将标准错误输出表示为</span><span class="w"> </span><span class="mi">2</span><span class="err">。</span><span class="n">下面我们举例来</span><span class="w"></span>
<span class="n">说明如何使用他们</span><span class="err">，</span><span class="n">特别是标准输出和标准错误输出</span><span class="err">。</span><span class="w"></span>

<span class="n">输入</span><span class="err">、</span><span class="n">输出及标准错误输出主要用于</span><span class="w"> </span><span class="n">I</span><span class="o">/</span><span class="n">O</span><span class="w"> </span><span class="n">的重定向</span><span class="err">，</span><span class="n">就是说需要改变他们的默认设置</span><span class="err">。</span><span class="w"></span>
<span class="n">先看这个例子</span><span class="err">：</span><span class="w"></span>
<span class="err">$</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">ls_result</span><span class="w"></span>
<span class="err">$</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="o">-</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">ls_result</span><span class="w"></span>
<span class="n">上面这两个命令分别将</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="n">命令的结果输出重定向到</span><span class="w"> </span><span class="n">ls_result</span><span class="w"> </span><span class="n">文件中和追加到</span><span class="w"> </span><span class="n">ls_result</span><span class="w"> </span><span class="n">文件中</span><span class="err">，</span><span class="n">而不是输出到屏幕上</span><span class="err">。</span><span class="ss">&quot;&gt;&quot;</span><span class="n">就是</span><span class="w"></span>
<span class="n">输出</span><span class="err">（</span><span class="n">标准输出和标准错误输出</span><span class="err">）</span><span class="n">重定向的代表符号</span><span class="err">，</span><span class="n">连续两个</span><span class="w"> </span><span class="ss">&quot;&gt;&quot;</span><span class="w"> </span><span class="n">符号</span><span class="err">，</span><span class="n">即</span><span class="w"> </span><span class="ss">&quot;&gt;&gt;&quot;</span><span class="w"> </span><span class="n">则表示不清除原来的而追加输出</span><span class="err">。</span><span class="w"></span>
<span class="n">再来看一个稍微复杂的例子</span><span class="err">：</span><span class="w"></span>


<span class="err">$</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="w"> </span><span class="o">-</span><span class="n">name</span><span class="w"> </span><span class="n">lost</span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">err_result</span><span class="w"></span>
<span class="n">这个命令在</span><span class="w"> </span><span class="ss">&quot;&gt;&quot;</span><span class="w"> </span><span class="n">符号之前多了一个</span><span class="w"> </span><span class="ss">&quot;2&quot;</span><span class="err">，</span><span class="ss">&quot;2&gt;&quot;</span><span class="w"> </span><span class="n">表示将标准错误输出重定向</span><span class="err">。</span><span class="n">由于</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="w"> </span><span class="n">目录下有些目录由于权限限制不能访问</span><span class="err">，</span><span class="n">因此</span><span class="w"></span>
<span class="n">会产生一些标准错误输出被存放在</span><span class="w"> </span><span class="n">err_result</span><span class="w"> </span><span class="n">文件中</span><span class="err">。</span><span class="n">大家可以设想一下</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="w"> </span><span class="o">-</span><span class="n">name</span><span class="w"> </span><span class="n">lost</span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="err">》</span><span class="n">err_result</span><span class="w"> </span><span class="n">命令会产生什么结果</span><span class="err">？</span><span class="w"></span>

<span class="n">如果直接执行</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="w"> </span><span class="o">-</span><span class="n">name</span><span class="w"> </span><span class="n">lost</span><span class="o">*</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">all_result</span><span class="w"> </span><span class="err">，</span><span class="n">其结果是只有标准输出被存入</span><span class="w"> </span><span class="n">all_result</span><span class="w"> </span><span class="n">文件中</span><span class="err">，</span><span class="n">要想让标准错误输出和</span><span class="w"></span>
<span class="n">标准输入一样都被存入到文件中</span><span class="err">，</span><span class="n">那该怎么办呢</span><span class="err">？</span><span class="n">看下面这个例子</span><span class="err">：</span><span class="w"></span>


<span class="err">$</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="w"> </span><span class="o">-</span><span class="n">name</span><span class="w"> </span><span class="n">lost</span><span class="o">*</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">all_result</span><span class="w"> </span><span class="mi">2</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="n">上面这个例子中将首先将标准错误输出也重定向到标准输出中</span><span class="err">，</span><span class="n">再将标准输出重定向到</span><span class="w"> </span><span class="n">all_result</span><span class="w"> </span><span class="n">这个文件中</span><span class="err">。</span><span class="n">这样我们就可以将所有的</span><span class="w"></span>
<span class="n">输出都存储到文件中了</span><span class="err">。</span><span class="n">为实现上述功能</span><span class="err">，</span><span class="n">还有一种简便的写法如下</span><span class="err">：</span><span class="w"></span>


<span class="err">$</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="w"> </span><span class="o">-</span><span class="n">name</span><span class="w"> </span><span class="n">lost</span><span class="o">*</span><span class="w"> </span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">all_result</span><span class="w"></span>
<span class="n">如果那些出错信息并不重要</span><span class="err">，</span><span class="n">下面这个命令可以让你避开众多无用出错信息的干扰</span><span class="err">：</span><span class="w"></span>


<span class="err">$</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="w"> </span><span class="o">-</span><span class="n">name</span><span class="w"> </span><span class="n">lost</span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="k">null</span><span class="w"></span>
<span class="n">有兴趣的朋友</span><span class="err">，</span><span class="n">可以试验下如下的几种重定向方式</span><span class="err">，</span><span class="n">看看结果是什么</span><span class="err">？</span><span class="w"></span>


<span class="err">$</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="w"> </span><span class="o">-</span><span class="n">name</span><span class="w"> </span><span class="n">lost</span><span class="o">*</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">all_result</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="err">$</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="w"> </span><span class="o">-</span><span class="n">name</span><span class="w"> </span><span class="n">lost</span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">all_result</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="err">$</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="w"> </span><span class="o">-</span><span class="n">name</span><span class="w"> </span><span class="n">lost</span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">all_result</span><span class="w"></span>
<span class="n">另外一个非常有用的重定向操作符是</span><span class="w"> </span><span class="ss">&quot;-&quot;</span><span class="err">，</span><span class="n">请看下面这个例子</span><span class="err">：</span><span class="w"></span>


<span class="err">$</span><span class="w"> </span><span class="err">（</span><span class="n">cd</span><span class="w"> </span><span class="o">/</span><span class="n">source</span><span class="o">/</span><span class="n">directory</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">tar</span><span class="w"> </span><span class="n">cf</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="err">）</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">（</span><span class="n">cd</span><span class="w"> </span><span class="o">/</span><span class="n">dest</span><span class="o">/</span><span class="n">directory</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">tar</span><span class="w"> </span><span class="n">xvfp</span><span class="w"> </span><span class="o">-</span><span class="err">）</span><span class="w"></span>
<span class="n">该命令表示把</span><span class="w"> </span><span class="o">/</span><span class="n">source</span><span class="o">/</span><span class="n">directory</span><span class="w"> </span><span class="n">目录下的所有文件通过压缩和解压</span><span class="err">，</span><span class="n">快速的全部移动到</span><span class="w"> </span><span class="o">/</span><span class="n">dest</span><span class="o">/</span><span class="n">directory</span><span class="w"> </span><span class="n">目录下去</span><span class="err">，</span><span class="n">这个命令在</span><span class="w"> </span>
<span class="o">/</span><span class="n">source</span><span class="o">/</span><span class="n">directory</span><span class="w"> </span><span class="n">和</span><span class="w"> </span><span class="o">/</span><span class="n">dest</span><span class="o">/</span><span class="n">directory</span><span class="w"> </span><span class="n">不处在同一个文件系统下时将显示出特别的优势</span><span class="err">。</span><span class="w"></span>

<span class="n">另外</span><span class="err">，</span><span class="n">几种不常见的用法</span><span class="err">：</span><span class="w"></span>
<span class="n">n</span><span class="o">&lt;&amp;-</span><span class="w"> </span><span class="n">表示将</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="n">号输入关闭</span><span class="w"></span>
<span class="o">&lt;&amp;-</span><span class="w"> </span><span class="n">表示关闭标准输入</span><span class="err">（</span><span class="n">键盘</span><span class="err">）</span><span class="w"></span>
<span class="n">n</span><span class="o">&gt;&amp;-</span><span class="w"> </span><span class="n">表示将</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="n">号输出关闭</span><span class="w"></span>
<span class="o">&gt;&amp;-</span><span class="w"> </span><span class="n">表示将标准输出关闭</span><span class="w"></span>
</pre></div>


<h2 id="while-read">while read</h2>
<div class="codehilite"><pre><span></span><span class="mi">1</span>、准备数据文件
<span class="mh">$ca</span><span class="nv">t</span> <span class="nv">a</span>.<span class="nv">txt</span>
<span class="mi">200</span>:<span class="mi">2</span>
<span class="mi">300</span>:<span class="mi">3</span>
<span class="mi">400</span>:<span class="mi">4</span>
<span class="mi">500</span>:<span class="mi">5</span>

<span class="mi">2</span>、用<span class="k">while</span>循环从文件中读取数据
#<span class="o">!/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">ksh</span>
<span class="k">while</span> <span class="nv">read</span> <span class="nv">line</span>
<span class="k">do</span>
    <span class="nv">echo</span> $<span class="nv">line</span>
<span class="nv">done</span> <span class="o">&lt;</span> <span class="nv">a</span>.<span class="nv">txt</span>
</pre></div>


<h2 id="_5">高效不常见的命令</h2>
<div class="codehilite"><pre><span></span><span class="mi">1</span>. <span class="nv">mv</span> <span class="nv">xxxx</span>{,.<span class="nv">bak</span>}等同于<span class="nv">mv</span> <span class="nv">xxxx</span> <span class="nv">xxxx</span>.<span class="nv">bak</span>
<span class="mi">2</span>. <span class="nv">esc</span> <span class="o">+</span> . 能填充之前命令的最后一个字段
<span class="mi">3</span>. <span class="nv">diff</span> <span class="o">&lt;</span><span class="ss">(</span><span class="nv">ssh</span> <span class="nv">host1</span> <span class="nv">cat</span> <span class="nv">file1</span><span class="ss">)</span> <span class="o">&lt;</span><span class="ss">(</span><span class="nv">ssh</span> <span class="nv">host2</span> <span class="nv">cat</span> <span class="nv">file2</span><span class="ss">)</span> <span class="nv">diff</span>两个远程文件
<span class="mi">4</span>. <span class="nv">ctrl</span> <span class="o">+</span> <span class="nv">r</span>然后输入<span class="nv">xxx</span>，搜索之前包含<span class="nv">xxx</span>的命令
<span class="mi">5</span>. <span class="nv">Python</span> <span class="o">-</span><span class="nv">m</span> <span class="nv">SimpleHTTPServer</span>，启动一个<span class="nv">HTTP</span>服务器，可以用来下载文件
<span class="mi">6</span>. <span class="nv">vim</span>编辑文件后发现需要<span class="nv">root</span>权限， :<span class="nv">w</span> <span class="o">!</span><span class="nv">sudo</span> <span class="nv">tee</span> <span class="o">%</span> 。<span class="ss">(</span><span class="nv">w</span>：表示<span class="nv">vim</span>的修改操作，这个命令的输出更改后的文件到“标准输出”
！<span class="nv">sudo</span> <span class="nv">tee</span> <span class="o">%</span> ：执行 一个 <span class="nv">shell</span> 命令， <span class="o">%</span> 表示当前打开的这个文件的名字。
整个命令就是 将<span class="nv">w</span>的输出传给 <span class="nv">tee</span>，<span class="nv">tee</span> 在<span class="nv">root</span> 权限下 把更改的内容存在文件当中。<span class="ss">)</span>
<span class="mi">7</span>. <span class="nv">ctrl</span><span class="o">+</span><span class="nv">z</span>可以把当前程序丢后台，<span class="nv">fg</span>命令可以恢复。
<span class="mi">8</span>. 退出<span class="nv">su</span>，退出<span class="nv">ssh</span>，可以用<span class="nv">ctrl</span><span class="o">+</span><span class="nv">d</span><span class="ss">(</span>真有人不知道这个，手敲<span class="k">exit</span>, <span class="nv">logout</span><span class="ss">)</span>。
<span class="mi">9</span>. <span class="nv">sudo</span> <span class="o">!!</span>用<span class="nv">sudo</span>执行上条命令。
<span class="mi">10</span>. 如果在前台运行了一个程序，但是你需要退出终端，保持程序继续在后台运行，你可以这样：<span class="nv">ctrl</span><span class="o">+</span><span class="nv">z</span>，把程序放在后台；
让程序继续运行；<span class="nv">disown</span> <span class="o">-</span><span class="nv">h</span> <span class="o">%</span><span class="mi">1</span>（<span class="o">%</span><span class="nv">n</span>是你<span class="nv">jobs</span>命令返回的那个，没有其它后台程序的话，一般是<span class="o">%</span><span class="mi">1</span>）。
</pre></div>


<h2 id="echo-read">echo read</h2>
<div class="codehilite"><pre><span></span><span class="nv">echo</span> <span class="o">-</span><span class="nv">e</span> 解释转义字符  <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="nv">tab</span>键      <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>  回车
         <span class="o">-</span><span class="nv">n</span>  不换行
<span class="nv">echo</span> $?  上条命令状态码
<span class="nv">echo</span> $#   参数个数
<span class="nv">echo</span> $<span class="o">*</span>    返回所有参数
$@基本上与上面相同。只不过是“$<span class="o">*</span>”返回的是一个字符串，字符串中存在多外空格。“$@”返回多个字符串
<span class="nv">echo</span> $<span class="nv">n</span>  位置参数变量

<span class="nv">B</span><span class="o">=</span>$<span class="k">RANDOM</span>  随机数
     $<span class="ss">((</span><span class="k">RANDOM</span> <span class="o">%</span><span class="mi">10</span><span class="ss">))</span>  <span class="mi">10</span>以内的随机数

<span class="nv">read</span>  <span class="o">-</span><span class="nv">p</span>  打印信息
         <span class="o">-</span><span class="nv">t</span>   限定时间
         <span class="o">-</span><span class="nv">s</span>  不回显
         <span class="o">-</span><span class="nv">n</span>  输入字符个数
</pre></div>


<h2 id="_6">脚本控制</h2>
<div class="codehilite"><pre><span></span>脚本控制


<span class="o">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
查看信号
<span class="nv">kill</span> <span class="o">-</span><span class="nv">l</span> 



<span class="nv">crtl</span><span class="o">+</span><span class="nv">C</span>   <span class="nv">SIGINT</span>
<span class="nv">ctrl</span><span class="o">+</span><span class="nv">Z</span>   <span class="nv">SIGTSTP</span>  暂停进程
程序退出   <span class="k">EXIT</span>


<span class="o">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

信号捕获
<span class="nv">trap</span> 命令格式
<span class="nv">trap</span> <span class="nv">commands</span> <span class="nv">signals</span>      例如 <span class="nv">trap</span> <span class="s2">&quot;</span><span class="s">echo hehe</span><span class="s2">&quot;</span> <span class="nv">SIGINT</span>  当收到<span class="nv">ctrl</span><span class="o">-</span><span class="nv">c</span>时输出 <span class="nv">hehe</span>,多个信号 空格隔开


<span class="o">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
移除捕获
使用  “<span class="o">-</span>” 移除捕获

<span class="nv">trap</span> <span class="o">-</span> <span class="nv">SIGINT</span>  移除忽略<span class="nv">ctrl</span><span class="o">-</span><span class="nv">c</span>信号


<span class="o">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="nv">count</span><span class="o">=</span><span class="mi">1</span>
<span class="nv">trap</span> <span class="s2">&quot;</span><span class="s">echo hello</span><span class="s2">&quot;</span> <span class="nv">SIGINT</span>   
<span class="k">while</span> [ <span class="mh">$c</span><span class="nv">ount</span> <span class="o">-</span><span class="nv">lt</span> <span class="mi">50</span> ]
  <span class="k">do</span>
    <span class="nv">echo</span> <span class="s2">&quot;</span><span class="s">#loop $count</span><span class="s2">&quot;</span>
             <span class="nv">sleep</span> <span class="mi">3</span>
        <span class="nv">count</span><span class="o">=</span>$[<span class="mh">$c</span><span class="nv">ount</span> <span class="o">+</span> <span class="mi">1</span> ]
              <span class="k">if</span> [ <span class="mh">$c</span><span class="nv">ount</span> <span class="o">-</span><span class="nv">eq</span> <span class="mi">5</span> ]
                      <span class="k">then</span>
                         <span class="nv">trap</span> <span class="o">-</span> <span class="nv">SIGINT</span>
                         <span class="nv">echo</span> <span class="s2">&quot;</span><span class="s">I just remove the trap</span><span class="s2">&quot;</span>
               <span class="nv">fi</span>
 <span class="nv">done</span>

<span class="o">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="nv">trap</span> <span class="s2">&quot;</span><span class="s">echo hello</span><span class="s2">&quot;</span> <span class="nv">SIGINT</span>  捕获<span class="nv">ctrl</span><span class="o">-</span><span class="nv">c</span>信号 如果在<span class="mh">$c</span><span class="nv">ount</span>等于<span class="mi">1</span><span class="o">-</span><span class="mi">5</span>的时候执行<span class="nv">ctrl</span><span class="o">-</span><span class="nv">c</span>这忽略信号

<span class="k">if</span> [ <span class="mh">$c</span><span class="nv">ount</span> <span class="o">-</span><span class="nv">eq</span> <span class="mi">5</span> ]
                      <span class="k">then</span>
                         <span class="nv">trap</span> <span class="o">-</span> <span class="nv">SIGINT</span>
                         <span class="nv">echo</span> <span class="s2">&quot;</span><span class="s">I just remove the trap</span><span class="s2">&quot;</span>
<span class="nv">fi</span>

在<span class="mh">$c</span><span class="nv">ount</span><span class="o">=</span><span class="mi">5</span>后 移除捕获
则受到<span class="nv">ctrl</span><span class="o">-</span><span class="nv">c</span>之后中断



<span class="o">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>


以后台模式运行脚本

<span class="nv">nohup</span> <span class="nv">scripts</span> <span class="o">&amp;</span>       <span class="nv">and</span>   <span class="o">&amp;</span>               <span class="nv">jobs</span>       <span class="nv">kill</span> <span class="o">%</span><span class="nv">ID</span>



演示的时候给脚本<span class="mi">755</span> 权限  执行不能使用<span class="nv">sh</span>

<span class="o">/</span><span class="nv">script</span> <span class="o">&amp;</span>  ## <span class="mi">1111</span>

<span class="nv">and</span>

<span class="nv">nohup</span> <span class="o">/</span><span class="nv">script</span> <span class="o">&amp;</span> #<span class="sc">#2222</span>

注销用户 登陆在查看进程是否在     <span class="mi">1111</span>不在  <span class="mi">2222</span>在


运行多个后台程序     <span class="o">&amp;</span>

每运行一个后台程序 都会有一个后台作业号

.<span class="o">/</span><span class="nv">test1</span> <span class="o">&amp;</span>
.<span class="o">/</span><span class="nv">test2</span> <span class="o">&amp;</span>


此类后台运行当注销该账户的时候所有后台程序也退出



不使用控制台的情况下运行脚本   <span class="nv">nohup</span> <span class="nv">scripts</span> <span class="o">&amp;</span>




<span class="nv">ctrl</span><span class="o">-</span><span class="nv">z</span>   <span class="nv">bg</span>  <span class="nv">fg</span>

<span class="nv">ctrl</span><span class="o">-</span><span class="nv">z</span>  停止当前运行程序

<span class="nv">fg</span> 后台到前台

<span class="nv">bg</span>  启动后台停止程序




<span class="nv">nice</span>指定程序运行的优先级    <span class="o">-</span><span class="mi">19</span>   <span class="o">----</span>  <span class="mi">20</span>  值越小  优先级越大


<span class="nv">nice</span> <span class="o">-</span><span class="nv">n</span> <span class="o">-</span><span class="mi">10</span> .<span class="o">/</span><span class="nv">test</span> <span class="o">&amp;</span>



<span class="nv">renice</span>  更改正在运行程序的优先级

<span class="nv">renice</span> <span class="mi">10</span> <span class="o">-</span><span class="nv">p</span> <span class="mi">1234</span>       <span class="o">-</span><span class="nv">p</span>  <span class="nv">pid</span>



<span class="o">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

任务定制

<span class="nv">at</span>   <span class="nv">batch</span>  <span class="nv">cron</span>


<span class="nv">at</span>  <span class="nv">atq</span>  <span class="nv">atrm</span> 




<span class="nv">batch</span>  让脚本在计算机负载比较低的情况下运行  

<span class="nv">batch</span> <span class="o">-</span><span class="nv">f</span> <span class="nv">filename</span> <span class="nv">time</span>     如果你定义的该时间服务器负载高 会延迟执行


<span class="nv">cron</span>    
定制<span class="nv">cron</span>任务表格

<span class="nv">crontab</span> <span class="o">-</span><span class="nv">e</span>



<span class="nv">anacron</span> 程序

<span class="nv">cron</span>只能在<span class="nv">linux</span>运行的时候执行  当<span class="nv">linux</span>关闭后就不会再运行了   <span class="nv">anacron</span>能够在机器关闭运行后检查程序使用的时间戳确定
程序是否在关闭服务器的时候错过了运行，如果错过了会安排程序尽快运行



<span class="nv">anacron</span>程序使用自己的表格 （<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">anacron</span>）指定作业

表格格式
<span class="nv">period</span> <span class="nv">delay</span> <span class="nv">identifier</span> <span class="nv">command</span>



<span class="nv">period</span>  定义作业应该间隔多久运行一次  以天为单位
<span class="nv">delay</span>   指定在<span class="nv">anacron</span>程序确定应该运行一个命令之后需要多长时间才会实际运行该命令，该选项可以为不同的命令设置不同的
执行延迟，避免在开机时大量程序执行

<span class="nv">identifier</span> 是一个唯一的非空字符串 可以唯一的标识日志消息和错误电子邮件中的作用
</pre></div>


<h2 id="cut-sort">cut sort</h2>
<div class="codehilite"><pre><span></span><span class="n">cut</span> <span class="o">-</span><span class="k">c</span> <span class="err">指定字符</span>   <span class="o">-</span><span class="k">c</span> <span class="mi">1</span><span class="o">-</span><span class="mi">5</span> <span class="mi">1</span><span class="o">-</span><span class="mi">5</span><span class="err">个字符</span>  <span class="o">-</span><span class="k">c</span> <span class="mi">5</span>  <span class="err">第</span><span class="mi">5</span><span class="err">个字符</span>
    <span class="o">-</span><span class="n">d</span> <span class="err">列于列之间分隔符</span>
    <span class="o">-</span><span class="n">f</span> <span class="err">指定列</span>  <span class="o">-</span><span class="n">f1</span><span class="o">-</span><span class="mi">3</span> <span class="mi">1</span><span class="o">-</span><span class="mi">3</span><span class="err">列</span> <span class="o">-</span><span class="n">f</span> <span class="mi">4</span> <span class="err">第四列</span>
    <span class="o">-</span><span class="n">b</span>  <span class="n">byte</span>  


<span class="n">sort</span>  <span class="o">-</span><span class="n">r</span>  <span class="err">倒序</span>
        <span class="o">-</span><span class="n">n</span>  <span class="err">按数字排序</span>
        <span class="o">-</span><span class="n">k2</span>  <span class="err">排序第</span><span class="mi">2</span><span class="err">列</span>
        <span class="o">-</span><span class="n">t</span><span class="p">:</span>   <span class="err">指定：为分割符</span>
</pre></div>


<h2 id="shell">shell颜色</h2>
<div class="codehilite"><pre><span></span><span class="n">linux</span> <span class="n">shell</span><span class="err">脚本的颜色</span>

<span class="err">脚本中</span><span class="n">echo</span><span class="err">显示内容带颜色显示</span><span class="p">,</span><span class="n">echo</span><span class="err">显示带颜色，需要使用参数</span><span class="o">-</span><span class="n">e</span>
<span class="err">　　格式如下：</span>
<span class="err">　　</span><span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="ss">&quot;\033[字背景颜色；文字颜色m字符串\033[0m&quot;</span>
<span class="err">　　例如：</span>
<span class="err">　　</span><span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="ss">&quot;\033[41;36m something here \033[0m&quot;</span>
<span class="err">　　其中</span><span class="mi">41</span><span class="err">的位置代表底色，</span> <span class="mi">36</span><span class="err">的位置是代表字的颜色</span>
<span class="err">　　注：</span> <span class="o">?</span><span class="n">www</span><span class="p">.</span><span class="mi">2</span><span class="n">cto</span><span class="p">.</span><span class="n">com</span> <span class="o">?</span>
<span class="err">　　</span><span class="mi">1</span><span class="err">、字背景颜色和文字颜色之间是英文的</span><span class="ss">&quot;&quot;</span>
<span class="err">　　</span><span class="mi">2</span><span class="err">、文字颜色后面有个</span><span class="n">m</span>
<span class="err">　　</span><span class="mi">3</span><span class="err">、字符串前后可以没有空格，如果有的话，输出也是同样有空格</span>
<span class="err">　　下面是相应的字和背景颜色，可以自己来尝试找出不同颜色搭配</span>

<span class="err">　　例</span>
<span class="err">　　</span><span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="err">“\</span><span class="mi">033</span><span class="p">[</span><span class="mi">31</span><span class="n">m</span> <span class="err">红色字</span> <span class="err">\</span><span class="mi">033</span><span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="err">”</span>
<span class="err">　　</span><span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="err">“\</span><span class="mi">033</span><span class="p">[</span><span class="mi">34</span><span class="n">m</span> <span class="err">黄色字</span> <span class="err">\</span><span class="mi">033</span><span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="err">”</span>
<span class="err">　　</span><span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="err">“\</span><span class="mi">033</span><span class="p">[</span><span class="mi">41</span><span class="p">;</span><span class="mi">33</span><span class="n">m</span> <span class="err">红底黄字</span> <span class="err">\</span><span class="mi">033</span><span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="err">”</span>
<span class="err">　　</span><span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="err">“\</span><span class="mi">033</span><span class="p">[</span><span class="mi">41</span><span class="p">;</span><span class="mi">37</span><span class="n">m</span> <span class="err">红底白字</span> <span class="err">\</span><span class="mi">033</span><span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="err">”</span>
<span class="err">　　字颜色：</span><span class="mi">30</span><span class="err">—–</span><span class="mi">37</span>
<span class="err">　　</span><span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="err">“\</span><span class="mi">033</span><span class="p">[</span><span class="mi">30</span><span class="n">m</span> <span class="err">黑色字</span> <span class="err">\</span><span class="mi">033</span><span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="err">”</span>
<span class="err">　　</span><span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="err">“\</span><span class="mi">033</span><span class="p">[</span><span class="mi">31</span><span class="n">m</span> <span class="err">红色字</span> <span class="err">\</span><span class="mi">033</span><span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="err">”</span>
<span class="err">　　</span><span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="err">“\</span><span class="mi">033</span><span class="p">[</span><span class="mi">32</span><span class="n">m</span> <span class="err">绿色字</span> <span class="err">\</span><span class="mi">033</span><span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="err">”</span>
<span class="err">　　</span><span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="err">“\</span><span class="mi">033</span><span class="p">[</span><span class="mi">33</span><span class="n">m</span> <span class="err">黄色字</span> <span class="err">\</span><span class="mi">033</span><span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="err">”</span>
<span class="err">　　</span><span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="err">“\</span><span class="mi">033</span><span class="p">[</span><span class="mi">34</span><span class="n">m</span> <span class="err">蓝色字</span> <span class="err">\</span><span class="mi">033</span><span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="err">”</span>
<span class="err">　　</span><span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="err">“\</span><span class="mi">033</span><span class="p">[</span><span class="mi">35</span><span class="n">m</span> <span class="err">紫色字</span> <span class="err">\</span><span class="mi">033</span><span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="err">”</span>
<span class="err">　　</span><span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="err">“\</span><span class="mi">033</span><span class="p">[</span><span class="mi">36</span><span class="n">m</span> <span class="err">天蓝字</span> <span class="err">\</span><span class="mi">033</span><span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="err">”</span>
<span class="err">　　</span><span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="err">“\</span><span class="mi">033</span><span class="p">[</span><span class="mi">37</span><span class="n">m</span> <span class="err">白色字</span> <span class="err">\</span><span class="mi">033</span><span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="err">”</span>

<span class="err">　　字背景颜色范围：</span><span class="mi">40</span><span class="err">—–</span><span class="mi">47</span>
<span class="err">　　</span><span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="err">“\</span><span class="mi">033</span><span class="p">[</span><span class="mi">40</span><span class="p">;</span><span class="mi">37</span><span class="n">m</span> <span class="err">黑底白字</span> <span class="err">\</span><span class="mi">033</span><span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="err">”</span>
<span class="err">　　</span><span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="err">“\</span><span class="mi">033</span><span class="p">[</span><span class="mi">41</span><span class="p">;</span><span class="mi">37</span><span class="n">m</span> <span class="err">红底白字</span> <span class="err">\</span><span class="mi">033</span><span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="err">”</span>
<span class="err">　　</span><span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="err">“\</span><span class="mi">033</span><span class="p">[</span><span class="mi">42</span><span class="p">;</span><span class="mi">37</span><span class="n">m</span> <span class="err">绿底白字</span> <span class="err">\</span><span class="mi">033</span><span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="err">”</span>
<span class="err">　　</span><span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="err">“\</span><span class="mi">033</span><span class="p">[</span><span class="mi">43</span><span class="p">;</span><span class="mi">37</span><span class="n">m</span> <span class="err">黄底白字</span> <span class="err">\</span><span class="mi">033</span><span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="err">”</span>
<span class="err">　　</span><span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="err">“\</span><span class="mi">033</span><span class="p">[</span><span class="mi">44</span><span class="p">;</span><span class="mi">37</span><span class="n">m</span> <span class="err">蓝底白字</span> <span class="err">\</span><span class="mi">033</span><span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="err">”</span>
<span class="err">　　</span><span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="err">“\</span><span class="mi">033</span><span class="p">[</span><span class="mi">45</span><span class="p">;</span><span class="mi">37</span><span class="n">m</span> <span class="err">紫底白字</span> <span class="err">\</span><span class="mi">033</span><span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="err">”</span>
<span class="err">　　</span><span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="err">“\</span><span class="mi">033</span><span class="p">[</span><span class="mi">46</span><span class="p">;</span><span class="mi">37</span><span class="n">m</span> <span class="err">天蓝底白字</span> <span class="err">\</span><span class="mi">033</span><span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="err">”</span>
<span class="err">　　</span><span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="err">“\</span><span class="mi">033</span><span class="p">[</span><span class="mi">47</span><span class="p">;</span><span class="mi">30</span><span class="n">m</span> <span class="err">白底黑字</span> <span class="err">\</span><span class="mi">033</span><span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="err">”</span>
<span class="err">　　最后面控制选项说明</span> <span class="o">?</span><span class="n">www</span><span class="p">.</span><span class="mi">2</span><span class="n">cto</span><span class="p">.</span><span class="n">com</span> <span class="o">?</span>
<span class="err">　　\</span><span class="mi">33</span><span class="p">[</span><span class="mi">0</span><span class="n">m</span> <span class="err">关闭所有属性</span>
<span class="err">　　\</span><span class="mi">33</span><span class="p">[</span><span class="mi">1</span><span class="n">m</span> <span class="err">设置高亮度</span>
<span class="err">　　\</span><span class="mi">33</span><span class="p">[</span><span class="mi">4</span><span class="n">m</span> <span class="err">下划线</span>
<span class="err">　　\</span><span class="mi">33</span><span class="p">[</span><span class="mi">5</span><span class="n">m</span> <span class="err">闪烁</span>
<span class="err">　　\</span><span class="mi">33</span><span class="p">[</span><span class="mi">7</span><span class="n">m</span> <span class="err">反显</span>
<span class="err">　　\</span><span class="mi">33</span><span class="p">[</span><span class="mi">8</span><span class="n">m</span> <span class="err">消隐</span>
<span class="o">?</span>
<span class="err">　　\</span><span class="mi">33</span><span class="p">[</span><span class="mi">30</span><span class="n">m</span> <span class="err">—</span> <span class="err">\</span><span class="mi">33</span><span class="p">[</span><span class="mi">37</span><span class="n">m</span> <span class="err">设置前景色</span>
<span class="err">　　\</span><span class="mi">33</span><span class="p">[</span><span class="mi">40</span><span class="n">m</span> <span class="err">—</span> <span class="err">\</span><span class="mi">33</span><span class="p">[</span><span class="mi">47</span><span class="n">m</span> <span class="err">设置背景色</span>
<span class="err">　　\</span><span class="mi">33</span><span class="p">[</span><span class="n">nA</span> <span class="err">光标上移</span><span class="n">n</span><span class="err">行</span>
<span class="err">　　\</span><span class="mi">33</span><span class="p">[</span><span class="n">nB</span> <span class="err">光标下移</span><span class="n">n</span><span class="err">行</span>
<span class="err">　　\</span><span class="mi">33</span><span class="p">[</span><span class="n">nC</span> <span class="err">光标右移</span><span class="n">n</span><span class="err">行</span>
<span class="err">　　\</span><span class="mi">33</span><span class="p">[</span><span class="n">nD</span> <span class="err">光标左移</span><span class="n">n</span><span class="err">行</span>
<span class="err">　　\</span><span class="mi">33</span><span class="p">[</span><span class="n">y</span><span class="p">;</span><span class="n">xH</span><span class="err">设置光标位置</span>
<span class="err">　　\</span><span class="mi">33</span><span class="p">[</span><span class="mi">2</span><span class="n">J</span> <span class="err">清屏</span>
<span class="err">　　\</span><span class="mi">33</span><span class="p">[</span><span class="n">K</span> <span class="err">清除从光标到行尾的内容</span>
<span class="err">　　\</span><span class="mi">33</span><span class="p">[</span><span class="n">s</span> <span class="err">保存光标位置</span>
<span class="err">　　\</span><span class="mi">33</span><span class="p">[</span><span class="n">u</span> <span class="err">恢复光标位置</span>
<span class="err">　　\</span><span class="mi">33</span><span class="p">[</span><span class="o">?</span><span class="mi">25</span><span class="n">l</span> <span class="err">隐藏光标</span>
<span class="err">　　\</span><span class="mi">33</span><span class="p">[</span><span class="o">?</span><span class="mi">25</span><span class="n">h</span> <span class="err">显示光标</span>
</pre></div>


<h2 id="_7">常用正则</h2>
<div class="codehilite"><pre><span></span><span class="err">一、校验数字的表达式</span>
<span class="err">数字：</span><span class="o">^</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="err">$</span>
<span class="n">n</span><span class="err">位的数字：</span><span class="o">^</span><span class="err">\</span><span class="n">d</span><span class="err">{</span><span class="n">n</span><span class="err">}$</span>
<span class="err">至少</span><span class="n">n</span><span class="err">位的数字：</span><span class="o">^</span><span class="err">\</span><span class="n">d</span><span class="err">{</span><span class="n">n</span><span class="p">,</span><span class="err">}$</span>
<span class="n">m</span><span class="o">-</span><span class="n">n</span><span class="err">位的数字：</span><span class="o">^</span><span class="err">\</span><span class="n">d</span><span class="err">{</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="err">}$</span>
<span class="err">零和非零开头的数字：</span><span class="o">^</span><span class="p">(</span><span class="mi">0</span><span class="o">|</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">][</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="p">)</span><span class="err">$</span>
<span class="err">非零开头的最多带两位小数的数字：</span><span class="o">^</span><span class="p">([</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">][</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="p">)</span><span class="o">+</span><span class="p">(.[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="err">}</span><span class="p">)</span><span class="o">?</span><span class="err">$</span>
<span class="err">带</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="err">位小数的正数或负数：</span><span class="o">^</span><span class="p">(</span><span class="err">\</span><span class="o">-</span><span class="p">)</span><span class="o">?</span><span class="err">\</span><span class="n">d</span><span class="o">+</span><span class="p">(</span><span class="err">\</span><span class="p">.</span><span class="err">\</span><span class="n">d</span><span class="err">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="err">}</span><span class="p">)</span><span class="o">?</span><span class="err">$</span>
<span class="err">正数、负数、和小数：</span><span class="o">^</span><span class="p">(</span><span class="err">\</span><span class="o">-|</span><span class="err">\</span><span class="o">+</span><span class="p">)</span><span class="o">?</span><span class="err">\</span><span class="n">d</span><span class="o">+</span><span class="p">(</span><span class="err">\</span><span class="p">.</span><span class="err">\</span><span class="n">d</span><span class="o">+</span><span class="p">)</span><span class="o">?</span><span class="err">$</span>
<span class="err">有两位小数的正实数：</span><span class="o">^</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="p">(.[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">{</span><span class="mi">2</span><span class="err">}</span><span class="p">)</span><span class="o">?</span><span class="err">$</span>
<span class="err">有</span><span class="mi">1</span><span class="o">~</span><span class="mi">3</span><span class="err">位小数的正实数：</span><span class="o">^</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="p">(.[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="err">}</span><span class="p">)</span><span class="o">?</span><span class="err">$</span>
<span class="err">非零的正整数：</span><span class="o">^</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">\</span><span class="n">d</span><span class="o">*</span><span class="err">$</span> <span class="err">或</span> <span class="o">^</span><span class="p">([</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">][</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="p">)</span><span class="err">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="err">}$</span> <span class="err">或</span> <span class="o">^</span><span class="err">\</span><span class="o">+?</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">][</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="err">$</span>
<span class="err">非零的负整数：</span><span class="o">^</span><span class="err">\</span><span class="o">-</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">][]</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="err">″</span><span class="o">*</span><span class="err">$</span> <span class="err">或</span> <span class="o">^-</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">\</span><span class="n">d</span><span class="o">*</span><span class="err">$</span>
<span class="err">非负整数：</span><span class="o">^</span><span class="err">\</span><span class="n">d</span><span class="o">+</span><span class="err">$</span> <span class="err">或</span> <span class="o">^</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">\</span><span class="n">d</span><span class="o">*|</span><span class="mi">0</span><span class="err">$</span>
<span class="err">非正整数：</span><span class="o">^-</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">\</span><span class="n">d</span><span class="o">*|</span><span class="mi">0</span><span class="err">$</span> <span class="err">或</span> <span class="o">^</span><span class="p">((</span><span class="o">-</span><span class="err">\</span><span class="n">d</span><span class="o">+</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="mi">0</span><span class="o">+</span><span class="p">))</span><span class="err">$</span>
<span class="err">非负浮点数：</span><span class="o">^</span><span class="err">\</span><span class="n">d</span><span class="o">+</span><span class="p">(</span><span class="err">\</span><span class="p">.</span><span class="err">\</span><span class="n">d</span><span class="o">+</span><span class="p">)</span><span class="o">?</span><span class="err">$</span> <span class="err">或</span> <span class="o">^</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">\</span><span class="n">d</span><span class="o">*</span><span class="err">\</span><span class="p">.</span><span class="err">\</span><span class="n">d</span><span class="o">*|</span><span class="mi">0</span><span class="err">\</span><span class="p">.</span><span class="err">\</span><span class="n">d</span><span class="o">*</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">\</span><span class="n">d</span><span class="o">*|</span><span class="mi">0</span><span class="o">?</span><span class="err">\</span><span class="p">.</span><span class="mi">0</span><span class="o">+|</span><span class="mi">0</span><span class="err">$</span>
<span class="err">非正浮点数：</span><span class="o">^</span><span class="p">((</span><span class="o">-</span><span class="err">\</span><span class="n">d</span><span class="o">+</span><span class="p">(</span><span class="err">\</span><span class="p">.</span><span class="err">\</span><span class="n">d</span><span class="o">+</span><span class="p">)</span><span class="o">?</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="mi">0</span><span class="o">+</span><span class="p">(</span><span class="err">\</span><span class="p">.</span><span class="mi">0</span><span class="o">+</span><span class="p">)</span><span class="o">?</span><span class="p">))</span><span class="err">$</span> <span class="err">或</span> <span class="o">^</span><span class="p">(</span><span class="o">-</span><span class="p">([</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">\</span><span class="n">d</span><span class="o">*</span><span class="err">\</span><span class="p">.</span><span class="err">\</span><span class="n">d</span><span class="o">*|</span><span class="mi">0</span><span class="err">\</span><span class="p">.</span><span class="err">\</span><span class="n">d</span><span class="o">*</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">\</span><span class="n">d</span><span class="o">*</span><span class="p">))</span><span class="o">|</span><span class="mi">0</span><span class="o">?</span><span class="err">\</span><span class="p">.</span><span class="mi">0</span><span class="o">+|</span><span class="mi">0</span><span class="err">$</span>
<span class="err">正浮点数：</span><span class="o">^</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">\</span><span class="n">d</span><span class="o">*</span><span class="err">\</span><span class="p">.</span><span class="err">\</span><span class="n">d</span><span class="o">*|</span><span class="mi">0</span><span class="err">\</span><span class="p">.</span><span class="err">\</span><span class="n">d</span><span class="o">*</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">\</span><span class="n">d</span><span class="o">*</span><span class="err">$</span> <span class="err">或</span> <span class="o">^</span><span class="p">(([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="err">\</span><span class="p">.[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">][</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="p">)</span><span class="o">|</span><span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">][</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="err">\</span><span class="p">.[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="p">)</span><span class="o">|</span>
<span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">][</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="p">))</span><span class="err">$</span>
<span class="err">负浮点数：</span><span class="o">^-</span><span class="p">([</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">\</span><span class="n">d</span><span class="o">*</span><span class="err">\</span><span class="p">.</span><span class="err">\</span><span class="n">d</span><span class="o">*|</span><span class="mi">0</span><span class="err">\</span><span class="p">.</span><span class="err">\</span><span class="n">d</span><span class="o">*</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">\</span><span class="n">d</span><span class="o">*</span><span class="p">)</span><span class="err">$</span> <span class="err">或</span> <span class="o">^</span><span class="p">(</span><span class="o">-</span><span class="p">(([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="err">\</span><span class="p">.[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">][</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="p">)</span><span class="o">|</span><span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">][</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="err">\</span><span class="p">.[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="p">)</span><span class="o">|</span>
<span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">][</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="p">)))</span><span class="err">$</span>
<span class="err">浮点数：</span><span class="o">^</span><span class="p">(</span><span class="o">-?</span><span class="err">\</span><span class="n">d</span><span class="o">+</span><span class="p">)(</span><span class="err">\</span><span class="p">.</span><span class="err">\</span><span class="n">d</span><span class="o">+</span><span class="p">)</span><span class="o">?</span><span class="err">$</span> <span class="err">或</span> <span class="o">^-?</span><span class="p">([</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">\</span><span class="n">d</span><span class="o">*</span><span class="err">\</span><span class="p">.</span><span class="err">\</span><span class="n">d</span><span class="o">*|</span><span class="mi">0</span><span class="err">\</span><span class="p">.</span><span class="err">\</span><span class="n">d</span><span class="o">*</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">\</span><span class="n">d</span><span class="o">*|</span><span class="mi">0</span><span class="o">?</span><span class="err">\</span><span class="p">.</span><span class="mi">0</span><span class="o">+|</span><span class="mi">0</span><span class="p">)</span><span class="err">$</span>

<span class="err">二、校验字符的表达式</span>
<span class="err">汉字：</span><span class="o">^</span><span class="p">[</span><span class="err">\</span><span class="n">u4e00</span><span class="o">-</span><span class="err">\</span><span class="n">u9fa5</span><span class="p">]</span><span class="err">{</span><span class="mi">0</span><span class="p">,</span><span class="err">}$</span>
<span class="err">英文和数字：</span><span class="o">^</span><span class="p">[</span><span class="n">A</span><span class="o">-</span><span class="n">Za</span><span class="o">-</span><span class="n">z0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="err">$</span> <span class="err">或</span> <span class="o">^</span><span class="p">[</span><span class="n">A</span><span class="o">-</span><span class="n">Za</span><span class="o">-</span><span class="n">z0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">{</span><span class="mi">4</span><span class="p">,</span><span class="mi">40</span><span class="err">}$</span>
<span class="err">长度为</span><span class="mi">3</span><span class="o">-</span><span class="mi">20</span><span class="err">的所有字符：</span><span class="o">^</span><span class="p">.</span><span class="err">{</span><span class="mi">3</span><span class="p">,</span><span class="mi">20</span><span class="err">}$</span>
<span class="err">由</span><span class="mi">26</span><span class="err">个英文字母组成的字符串：</span><span class="o">^</span><span class="p">[</span><span class="n">A</span><span class="o">-</span><span class="n">Za</span><span class="o">-</span><span class="n">z</span><span class="p">]</span><span class="o">+</span><span class="err">$</span>
<span class="err">由</span><span class="mi">26</span><span class="err">个大写英文字母组成的字符串：</span><span class="o">^</span><span class="p">[</span><span class="n">A</span><span class="o">-</span><span class="n">Z</span><span class="p">]</span><span class="o">+</span><span class="err">$</span>
<span class="err">由</span><span class="mi">26</span><span class="err">个小写英文字母组成的字符串：</span><span class="o">^</span><span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">z</span><span class="p">]</span><span class="o">+</span><span class="err">$</span>
<span class="err">由数字和</span><span class="mi">26</span><span class="err">个英文字母组成的字符串：</span><span class="o">^</span><span class="p">[</span><span class="n">A</span><span class="o">-</span><span class="n">Za</span><span class="o">-</span><span class="n">z0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="err">$</span>
<span class="err">由数字、</span><span class="mi">26</span><span class="err">个英文字母或者下划线组成的字符串：</span><span class="o">^</span><span class="err">\</span><span class="n">w</span><span class="o">+</span><span class="err">$</span> <span class="err">或</span> <span class="o">^</span><span class="err">\</span><span class="n">w</span><span class="err">{</span><span class="mi">3</span><span class="p">,</span><span class="mi">20</span><span class="err">}$</span>
<span class="err">中文、英文、数字包括下划线：</span><span class="o">^</span><span class="p">[</span><span class="err">\</span><span class="n">u4E00</span><span class="o">-</span><span class="err">\</span><span class="n">u9FA5A</span><span class="o">-</span><span class="n">Za</span><span class="o">-</span><span class="n">z0</span><span class="o">-</span><span class="mi">9</span><span class="n">_</span><span class="p">]</span><span class="o">+</span><span class="err">$</span>
<span class="err">中文、英文、数字但不包括下划线等符号：</span><span class="o">^</span><span class="p">[</span><span class="err">\</span><span class="n">u4E00</span><span class="o">-</span><span class="err">\</span><span class="n">u9FA5A</span><span class="o">-</span><span class="n">Za</span><span class="o">-</span><span class="n">z0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="err">$</span> <span class="err">或</span> <span class="o">^</span><span class="p">[</span><span class="err">\</span><span class="n">u4E00</span><span class="o">-</span><span class="err">\</span><span class="n">u9FA5A</span><span class="o">-</span><span class="n">Za</span><span class="o">-</span><span class="n">z0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">{</span><span class="mi">2</span><span class="p">,</span><span class="mi">20</span><span class="err">}$</span>
<span class="err">可以输入含有</span><span class="o">^%&amp;</span><span class="err">’</span><span class="p">,;</span><span class="o">=?</span><span class="err">$\”等字符：</span><span class="p">[</span><span class="o">^%&amp;</span><span class="err">&#39;</span><span class="p">,;</span><span class="o">=?</span><span class="err">$\</span><span class="n">x22</span><span class="p">]</span><span class="o">+</span>
<span class="err">禁止输入含有</span><span class="o">~</span><span class="err">的字符：</span><span class="p">[</span><span class="o">^~</span><span class="err">\</span><span class="n">x22</span><span class="p">]</span><span class="o">+</span>

<span class="err">三、特殊需求表达式</span>
<span class="n">Email</span><span class="err">地址：</span><span class="o">^</span><span class="err">\</span><span class="n">w</span><span class="o">+</span><span class="p">([</span><span class="o">-+</span><span class="p">.]</span><span class="err">\</span><span class="n">w</span><span class="o">+</span><span class="p">)</span><span class="o">*@</span><span class="err">\</span><span class="n">w</span><span class="o">+</span><span class="p">([</span><span class="o">-</span><span class="p">.]</span><span class="err">\</span><span class="n">w</span><span class="o">+</span><span class="p">)</span><span class="o">*</span><span class="err">\</span><span class="p">.</span><span class="err">\</span><span class="n">w</span><span class="o">+</span><span class="p">([</span><span class="o">-</span><span class="p">.]</span><span class="err">\</span><span class="n">w</span><span class="o">+</span><span class="p">)</span><span class="o">*</span><span class="err">$</span>
<span class="err">域名：</span><span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">Z0</span><span class="o">-</span><span class="mi">9</span><span class="p">][</span><span class="o">-</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">Z0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">62</span><span class="err">}</span><span class="p">(</span><span class="o">/</span><span class="p">.[</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">Z0</span><span class="o">-</span><span class="mi">9</span><span class="p">][</span><span class="o">-</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">Z0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">62</span><span class="err">}</span><span class="p">)</span><span class="o">+/</span><span class="p">.</span><span class="o">?</span>
<span class="n">InternetURL</span><span class="err">：</span><span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">z</span><span class="p">]</span><span class="o">+</span><span class="p">:</span><span class="o">//</span><span class="p">[</span><span class="o">^</span><span class="err">\</span><span class="n">s</span><span class="p">]</span><span class="o">*</span> <span class="err">或</span> <span class="o">^</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="p">([</span><span class="err">\</span><span class="n">w</span><span class="o">-</span><span class="p">]</span><span class="o">+</span><span class="err">\</span><span class="p">.)</span><span class="o">+</span><span class="p">[</span><span class="err">\</span><span class="n">w</span><span class="o">-</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="o">/</span><span class="p">[</span><span class="err">\</span><span class="n">w</span><span class="o">-</span><span class="p">.</span><span class="o">/?%&amp;=</span><span class="p">]</span><span class="o">*</span><span class="p">)</span><span class="o">?</span><span class="err">$</span>
<span class="err">手机号码：</span><span class="o">^</span><span class="p">(</span><span class="mi">13</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">|</span><span class="mi">14</span><span class="p">[</span><span class="mi">5</span><span class="o">|</span><span class="mi">7</span><span class="p">]</span><span class="o">|</span><span class="mi">15</span><span class="p">[</span><span class="mi">0</span><span class="o">|</span><span class="mi">1</span><span class="o">|</span><span class="mi">2</span><span class="o">|</span><span class="mi">3</span><span class="o">|</span><span class="mi">5</span><span class="o">|</span><span class="mi">6</span><span class="o">|</span><span class="mi">7</span><span class="o">|</span><span class="mi">8</span><span class="o">|</span><span class="mi">9</span><span class="p">]</span><span class="o">|</span><span class="mi">18</span><span class="p">[</span><span class="mi">0</span><span class="o">|</span><span class="mi">1</span><span class="o">|</span><span class="mi">2</span><span class="o">|</span><span class="mi">3</span><span class="o">|</span><span class="mi">5</span><span class="o">|</span><span class="mi">6</span><span class="o">|</span><span class="mi">7</span><span class="o">|</span><span class="mi">8</span><span class="o">|</span><span class="mi">9</span><span class="p">])</span><span class="err">\</span><span class="n">d</span><span class="err">{</span><span class="mi">8</span><span class="err">}$</span>
<span class="err">电话号码</span><span class="p">(</span><span class="err">“</span><span class="n">XXX</span><span class="o">-</span><span class="n">XXXXXXX</span><span class="err">”、”</span><span class="n">XXXX</span><span class="o">-</span><span class="n">XXXXXXXX</span><span class="err">”、”</span><span class="n">XXX</span><span class="o">-</span><span class="n">XXXXXXX</span><span class="err">”、”</span><span class="n">XXX</span><span class="o">-</span><span class="n">XXXXXXXX</span><span class="err">”、”</span><span class="n">XXXXXXX</span><span class="err">”和”</span><span class="n">XXXXXXXX</span><span class="p">)</span><span class="err">：</span><span class="o">^</span><span class="p">(</span><span class="err">$$\</span><span class="n">d</span><span class="err">{</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="err">}</span><span class="o">-</span><span class="p">)</span><span class="o">|</span>
<span class="err">\</span><span class="n">d</span><span class="err">{</span><span class="mi">3</span><span class="p">.</span><span class="mi">4</span><span class="err">}</span><span class="o">-</span><span class="p">)</span><span class="o">?</span><span class="err">\</span><span class="n">d</span><span class="err">{</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="err">}$</span>
<span class="err">国内电话号码</span><span class="p">(</span><span class="mi">0511</span><span class="o">-</span><span class="mi">4405222</span><span class="err">、</span><span class="mi">021</span><span class="o">-</span><span class="mi">87888822</span><span class="p">)</span><span class="err">：\</span><span class="n">d</span><span class="err">{</span><span class="mi">3</span><span class="err">}</span><span class="o">-</span><span class="err">\</span><span class="n">d</span><span class="err">{</span><span class="mi">8</span><span class="err">}</span><span class="o">|</span><span class="err">\</span><span class="n">d</span><span class="err">{</span><span class="mi">4</span><span class="err">}</span><span class="o">-</span><span class="err">\</span><span class="n">d</span><span class="err">{</span><span class="mi">7</span><span class="err">}</span>
<span class="err">身份证号</span><span class="p">(</span><span class="mi">15</span><span class="err">位、</span><span class="mi">18</span><span class="err">位数字</span><span class="p">)</span><span class="err">：</span><span class="o">^</span><span class="err">\</span><span class="n">d</span><span class="err">{</span><span class="mi">15</span><span class="err">}</span><span class="o">|</span><span class="err">\</span><span class="n">d</span><span class="err">{</span><span class="mi">18</span><span class="err">}$</span>
<span class="err">短身份证号码</span><span class="p">(</span><span class="err">数字、字母</span><span class="n">x</span><span class="err">结尾</span><span class="p">)</span><span class="err">：</span><span class="o">^</span><span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">])</span><span class="err">{</span><span class="mi">7</span><span class="p">,</span><span class="mi">18</span><span class="err">}</span><span class="p">(</span><span class="n">x</span><span class="o">|</span><span class="n">X</span><span class="p">)</span><span class="o">?</span><span class="err">$</span> <span class="err">或</span> <span class="o">^</span><span class="err">\</span><span class="n">d</span><span class="err">{</span><span class="mi">8</span><span class="p">,</span><span class="mi">18</span><span class="err">}</span><span class="o">|</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="n">x</span><span class="p">]</span><span class="err">{</span><span class="mi">8</span><span class="p">,</span><span class="mi">18</span><span class="err">}</span><span class="o">|</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="n">X</span><span class="p">]</span><span class="err">{</span><span class="mi">8</span><span class="p">,</span><span class="mi">18</span><span class="err">}</span><span class="o">?</span><span class="err">$</span>
<span class="err">帐号是否合法</span><span class="p">(</span><span class="err">字母开头，允许</span><span class="mi">5</span><span class="o">-</span><span class="mi">16</span><span class="err">字节，允许字母数字下划线</span><span class="p">)</span><span class="err">：</span><span class="o">^</span><span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">Z</span><span class="p">][</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">Z0</span><span class="o">-</span><span class="mi">9</span><span class="n">_</span><span class="p">]</span><span class="err">{</span><span class="mi">4</span><span class="p">,</span><span class="mi">15</span><span class="err">}$</span>
<span class="err">密码</span><span class="p">(</span><span class="err">以字母开头，长度在</span><span class="mi">6</span><span class="o">~</span><span class="mi">18</span><span class="err">之间，只能包含字母、数字和下划线</span><span class="p">)</span><span class="err">：</span><span class="o">^</span><span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">Z</span><span class="p">]</span><span class="err">\</span><span class="n">w</span><span class="err">{</span><span class="mi">5</span><span class="p">,</span><span class="mi">17</span><span class="err">}$</span>
<span class="err">强密码</span><span class="p">(</span><span class="err">必须包含大小写字母和数字的组合，不能使用特殊字符，长度在</span><span class="mi">8</span><span class="o">-</span><span class="mi">10</span><span class="err">之间</span><span class="p">)</span><span class="err">：</span><span class="o">^</span><span class="p">(</span><span class="o">?=</span><span class="p">.</span><span class="o">*</span><span class="err">\</span><span class="n">d</span><span class="p">)(</span><span class="o">?=</span><span class="p">.</span><span class="o">*</span><span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">z</span><span class="p">])(</span><span class="o">?=</span><span class="p">.</span><span class="o">*</span><span class="p">[</span><span class="n">A</span><span class="o">-</span><span class="n">Z</span><span class="p">]).</span><span class="err">{</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="err">}$</span>
<span class="err">日期格式：</span><span class="o">^</span><span class="err">\</span><span class="n">d</span><span class="err">{</span><span class="mi">4</span><span class="err">}</span><span class="o">-</span><span class="err">\</span><span class="n">d</span><span class="err">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="err">}</span><span class="o">-</span><span class="err">\</span><span class="n">d</span><span class="err">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="err">}</span>
<span class="err">一年的</span><span class="mi">12</span><span class="err">个月</span><span class="p">(</span><span class="mi">01</span><span class="err">～</span><span class="mi">09</span><span class="err">和</span><span class="mi">1</span><span class="err">～</span><span class="mi">12</span><span class="p">)</span><span class="err">：</span><span class="o">^</span><span class="p">(</span><span class="mi">0</span><span class="o">?</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">|</span><span class="mi">1</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="err">$</span>
<span class="err">一个月的</span><span class="mi">31</span><span class="err">天</span><span class="p">(</span><span class="mi">01</span><span class="err">～</span><span class="mi">09</span><span class="err">和</span><span class="mi">1</span><span class="err">～</span><span class="mi">31</span><span class="p">)</span><span class="err">：</span><span class="o">^</span><span class="p">((</span><span class="mi">0</span><span class="o">?</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">])</span><span class="o">|</span><span class="p">((</span><span class="mi">1</span><span class="o">|</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">])</span><span class="o">|</span><span class="mi">30</span><span class="o">|</span><span class="mi">31</span><span class="p">)</span><span class="err">$</span>
<span class="err">钱的输入格式：</span>
<span class="err">有四种钱的表示形式我们可以接受</span><span class="p">:</span><span class="err">”</span><span class="mi">10000</span><span class="p">.</span><span class="mi">00</span><span class="err">″</span> <span class="err">和</span> <span class="err">“</span><span class="mi">10</span><span class="p">,</span><span class="mi">000</span><span class="p">.</span><span class="mi">00</span><span class="err">″</span><span class="p">,</span> <span class="err">和没有</span> <span class="err">“分”</span> <span class="err">的</span> <span class="err">“</span><span class="mi">10000</span><span class="err">″</span> <span class="err">和</span> <span class="err">“</span><span class="mi">10</span><span class="p">,</span><span class="mi">000</span><span class="err">″：</span><span class="o">^</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">][</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="err">$</span>
<span class="err">这表示任意一个不以</span><span class="mi">0</span><span class="err">开头的数字，但是，这也意味着一个字符”</span><span class="mi">0</span><span class="err">″不通过，所以我们采用下面的形式：</span><span class="o">^</span><span class="p">(</span><span class="mi">0</span><span class="o">|</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">][</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="p">)</span><span class="err">$</span>
<span class="err">一个</span><span class="mi">0</span><span class="err">或者一个不以</span><span class="mi">0</span><span class="err">开头的数字</span><span class="p">.</span><span class="err">我们还可以允许开头有一个负号：</span><span class="o">^</span><span class="p">(</span><span class="mi">0</span><span class="o">|-?</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">][</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="p">)</span><span class="err">$</span>
<span class="err">这表示一个</span><span class="mi">0</span><span class="err">或者一个可能为负的开头不为</span><span class="mi">0</span><span class="err">的数字</span><span class="p">.</span><span class="err">让用户以</span><span class="mi">0</span><span class="err">开头好了</span><span class="p">.</span><span class="err">把负号的也去掉，因为钱总不能是负的吧</span><span class="p">.</span><span class="err">下面我们要加的是说明</span>
<span class="err">可能的小数部分：</span><span class="o">^</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="p">(.[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="p">)</span><span class="o">?</span><span class="err">$</span>
<span class="err">必须说明的是，小数点后面至少应该有</span><span class="mi">1</span><span class="err">位数，所以”</span><span class="mi">10</span><span class="p">.</span><span class="err">”是不通过的，但是</span> <span class="err">“</span><span class="mi">10</span><span class="err">″</span> <span class="err">和</span> <span class="err">“</span><span class="mi">10</span><span class="p">.</span><span class="mi">2</span><span class="err">″</span> <span class="err">是通过的：</span><span class="o">^</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="p">(.[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">{</span><span class="mi">2</span><span class="err">}</span><span class="p">)</span><span class="o">?</span><span class="err">$</span>
<span class="err">这样我们规定小数点后面必须有两位，如果你认为太苛刻了，可以这样：</span><span class="o">^</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="p">(.[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="err">}</span><span class="p">)</span><span class="o">?</span><span class="err">$</span>
<span class="err">这样就允许用户只写一位小数。下面我们该考虑数字中的逗号了，我们可以这样：</span><span class="o">^</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="err">}</span><span class="p">(,[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">{</span><span class="mi">3</span><span class="err">}</span><span class="p">)</span><span class="o">*</span><span class="p">(.[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="err">}</span><span class="p">)</span><span class="o">?</span><span class="err">$</span>
<span class="mi">1</span><span class="err">到</span><span class="mi">3</span><span class="err">个数字，后面跟着任意个</span> <span class="err">逗号</span><span class="o">+</span><span class="mi">3</span><span class="err">个数字，逗号成为可选，而不是必须：</span><span class="o">^</span><span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+|</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="err">}</span><span class="p">(,[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">{</span><span class="mi">3</span><span class="err">}</span><span class="p">)</span><span class="o">*</span><span class="p">)(.[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="err">}</span><span class="p">)</span><span class="o">?</span><span class="err">$</span>
<span class="err">备注：这就是最终结果了，别忘了”</span><span class="o">+</span><span class="err">”可以用”</span><span class="o">*</span><span class="err">”替代。如果你觉得空字符串也可以接受的话</span><span class="p">(</span><span class="err">奇怪，为什么</span><span class="o">?</span><span class="p">)</span><span class="err">最后，别忘了在用函数时去掉</span>
<span class="err">去掉那个反斜杠，一般的错误都在这里</span>
<span class="n">xml</span><span class="err">文件：</span><span class="o">^</span><span class="p">([</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">Z</span><span class="p">]</span><span class="o">+-?</span><span class="p">)</span><span class="o">+</span><span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">Z0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="err">\\</span><span class="p">.[</span><span class="n">x</span><span class="o">|</span><span class="n">X</span><span class="p">][</span><span class="n">m</span><span class="o">|</span><span class="n">M</span><span class="p">][</span><span class="n">l</span><span class="o">|</span><span class="n">L</span><span class="p">]</span><span class="err">$</span>
<span class="err">中文字符的正则表达式：</span><span class="p">[</span><span class="err">\</span><span class="n">u4e00</span><span class="o">-</span><span class="err">\</span><span class="n">u9fa5</span><span class="p">]</span>
<span class="err">双字节字符：</span><span class="p">[</span><span class="o">^</span><span class="err">\</span><span class="n">x00</span><span class="o">-</span><span class="err">\</span><span class="n">xff</span><span class="p">]</span> <span class="p">(</span><span class="err">包括汉字在内，可以用来计算字符串的长度</span><span class="p">(</span><span class="err">一个双字节字符长度计</span><span class="mi">2</span><span class="err">，</span><span class="n">ASCII</span><span class="err">字符计</span><span class="mi">1</span><span class="p">))</span>
<span class="err">空白行的正则表达式：\</span><span class="n">n</span><span class="err">\</span><span class="n">s</span><span class="o">*</span><span class="err">\</span><span class="n">r</span> <span class="p">(</span><span class="err">可以用来删除空白行</span><span class="p">)</span>
<span class="n">HTML</span><span class="err">标记的正则表达式：</span><span class="o">&lt;</span><span class="p">(</span><span class="err">\</span><span class="n">S</span><span class="o">*?</span><span class="p">)[</span><span class="o">^&gt;</span><span class="p">]</span><span class="o">*&gt;</span><span class="p">.</span><span class="o">*?&lt;/</span><span class="err">\</span><span class="mi">1</span><span class="o">&gt;|&lt;</span><span class="p">.</span><span class="o">*?</span> <span class="o">/&gt;</span> <span class="p">(</span><span class="err">网上流传的版本太糟糕，上面这个也仅仅能部分，对于复杂的嵌套标记依旧无能为力</span><span class="p">)</span>
<span class="err">首尾空白字符的正则表达式：</span><span class="o">^</span><span class="err">\</span><span class="n">s</span><span class="o">*|</span><span class="err">\</span><span class="n">s</span><span class="o">*</span><span class="err">$或</span><span class="p">(</span><span class="o">^</span><span class="err">\</span><span class="n">s</span><span class="o">*</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="err">\</span><span class="n">s</span><span class="o">*</span><span class="err">$</span><span class="p">)</span> <span class="p">(</span><span class="err">可以用来删除行首行尾的空白字符</span><span class="p">(</span><span class="err">包括空格、制表符、换页符等等</span><span class="p">)</span><span class="err">，</span>
<span class="err">非常有用的表达式</span><span class="p">)</span>
<span class="err">腾讯</span><span class="n">QQ</span><span class="err">号：</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">][</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">{</span><span class="mi">4</span><span class="p">,</span><span class="err">}</span> <span class="p">(</span><span class="err">腾讯</span><span class="n">QQ</span><span class="err">号从</span><span class="mi">10000</span><span class="err">开始</span><span class="p">)</span>
<span class="err">中国邮政编码：</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="err">\</span><span class="n">d</span><span class="err">{</span><span class="mi">5</span><span class="err">}</span><span class="p">(</span><span class="o">?!</span><span class="err">\</span><span class="n">d</span><span class="p">)</span> <span class="p">(</span><span class="err">中国邮政编码为</span><span class="mi">6</span><span class="err">位数字</span><span class="p">)</span>
<span class="n">IP</span><span class="err">地址：\</span><span class="n">d</span><span class="o">+</span><span class="err">\</span><span class="p">.</span><span class="err">\</span><span class="n">d</span><span class="o">+</span><span class="err">\</span><span class="p">.</span><span class="err">\</span><span class="n">d</span><span class="o">+</span><span class="err">\</span><span class="p">.</span><span class="err">\</span><span class="n">d</span><span class="o">+</span> <span class="p">(</span><span class="err">提取</span><span class="n">IP</span><span class="err">地址时有用</span><span class="p">)</span>
<span class="n">IP</span><span class="err">地址：</span><span class="p">((</span><span class="o">?</span><span class="p">:(</span><span class="o">?</span><span class="p">:</span><span class="mi">25</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span><span class="o">|</span><span class="mi">2</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="err">\\</span><span class="n">d</span><span class="o">|</span><span class="p">[</span><span class="mi">01</span><span class="p">]</span><span class="o">?</span><span class="err">\\</span><span class="n">d</span><span class="o">?</span><span class="err">\\</span><span class="n">d</span><span class="p">)</span><span class="err">\\</span><span class="p">.)</span><span class="err">{</span><span class="mi">3</span><span class="err">}</span><span class="p">(</span><span class="o">?</span><span class="p">:</span><span class="mi">25</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span><span class="o">|</span><span class="mi">2</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="err">\\</span><span class="n">d</span><span class="o">|</span><span class="p">[</span><span class="mi">01</span><span class="p">]</span><span class="o">?</span><span class="err">\\</span><span class="n">d</span><span class="o">?</span><span class="err">\\</span><span class="n">d</span><span class="p">))</span>
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../vpn/" title="vpn" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                vpn
              </span>
            </div>
          </a>
        
        
          <a href="../disk/" title="disk" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                disk
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>